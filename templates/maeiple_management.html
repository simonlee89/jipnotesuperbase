<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë©”ì´í”Œê´€ë¦¬ - ì§‘ë…¸íŠ¸</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap');
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: #f8fafc;
            color: #1a202c;
            line-height: 1.6;
            min-height: 100vh;
        }
        
        .app-container {
            display: flex;
            height: 100vh;
        }
        
        /* ì‚¬ì´ë“œë°” */
        .sidebar {
            width: 260px;
            background: #ffffff;
            border-right: 1px solid #e2e8f0;
            display: flex;
            flex-direction: column;
            position: fixed;
            height: 100vh;
            z-index: 1000;
        }
        
        .sidebar-header {
            padding: 24px 20px;
            border-bottom: 1px solid #e2e8f0;
        }
        
        .logo {
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .logo-icon {
            width: 40px;
            height: 40px;
            background: linear-gradient(135deg, #6366f1, #8b5cf6);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
        }
        
        .logo-text {
            font-size: 18px;
            font-weight: 700;
            color: #1a202c;
        }
        
        .sidebar-nav {
            flex: 1;
            padding: 20px 0;
        }
        
        .nav-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px 20px;
            color: #64748b;
            text-decoration: none;
            font-weight: 500;
            font-size: 14px;
            transition: all 0.2s ease;
            border-left: 3px solid transparent;
        }
        
        .nav-item:hover {
            background: #f1f5f9;
            color: #6366f1;
        }
        
        .nav-item.active {
            background: #f1f5f9;
            color: #6366f1;
            border-left-color: #6366f1;
        }
        
        .nav-icon {
            width: 20px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        /* ë©”ì¸ ì»¨í…ì¸  */
        .main-content {
            flex: 1;
            margin-left: 260px;
            display: flex;
            flex-direction: column;
        }
        
        .header {
            background: #ffffff;
            border-bottom: 1px solid #e2e8f0;
            padding: 8px 32px;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        
        .header-left {
            display: flex;
            align-items: center;
            gap: 20px;
        }
        
        .header-right {
            display: flex;
            align-items: center;
            gap: 16px;
        }
        
        .user-profile {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 8px 12px;
            border-radius: 12px;
            background: #f8fafc;
        }
        
        .user-avatar {
            width: 32px;
            height: 32px;
            background: linear-gradient(135deg, #6366f1, #8b5cf6);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 600;
        }
        
        .user-info {
            display: flex;
            flex-direction: column;
        }
        
        .user-name {
            font-weight: 600;
            font-size: 14px;
        }
        
        .user-role {
            font-size: 12px;
            color: #64748b;
        }
        
        .logout-btn {
            padding: 8px 16px;
            background: #ef4444;
            color: white;
            border: none;
            border-radius: 8px;
            text-decoration: none;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.2s ease;
        }
        
        .logout-btn:hover {
            background: #dc2626;
        }
        
        /* ì»¨í…ì¸  */
        .content {
            flex: 1;
            padding: 32px;
            overflow-y: auto;
        }
        
        .page-header {
            margin-bottom: 32px;
        }
        
        .page-title {
            font-size: 32px;
            font-weight: 700;
            color: #1a202c;
            margin-bottom: 8px;
        }
        
        .page-subtitle {
            color: #64748b;
            font-size: 16px;
        }
        
        /* í…Œì´ë¸” */
        .table-container {
            background: white;
            border-radius: 12px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }
        
        .table-header {
            padding: 24px;
            border-bottom: 1px solid #e2e8f0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        /* í•„í„° ì„¹ì…˜ */
        .filter-section {
            padding: 12px 24px;
            border-bottom: 1px solid #e2e8f0;
            background: #ffffff;
            display: flex;
            gap: 24px;
            flex-wrap: wrap;
            align-items: center;
        }
        .filter-group {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .filter-label {
            color: #64748b;
            font-size: 13px;
            font-weight: 600;
            margin-right: 4px;
        }
        .filter-buttons {
            display: flex;
            gap: 6px;
        }
        .filter-btn {
            padding: 6px 10px;
            border: 1px solid #e2e8f0;
            background: #ffffff;
            color: #334155;
            border-radius: 20px;
            font-size: 12px;
            cursor: pointer;
        }
        .filter-btn.active {
            background: #e0e7ff;
            color: #4338ca;
            border-color: #c7d2fe;
            font-weight: 600;
        }
        
        /* ì •ë ¬ ë²„íŠ¼ */
        .sort-header {
            display: flex;
            align-items: center;
            gap: 4px;
            cursor: pointer;
            user-select: none;
        }
        
        .sort-header:hover {
            color: #6366f1;
        }
        
        .sort-icon {
            font-size: 12px;
            color: #9ca3af;
            transition: color 0.2s ease;
        }
        
        .sort-header.active .sort-icon {
            color: #6366f1;
        }
        
        .sort-header.desc .sort-icon:after {
            content: 'â–¼';
        }
        
        .sort-header.asc .sort-icon:after {
            content: 'â–²';
        }
        

        
        .sort-header:not(.active) .sort-icon:after {
            content: 'â†•ï¸';
        }
        
        .table-title {
            font-size: 20px;
            font-weight: 600;
            color: #1a202c;
        }
        
        .add-btn {
            padding: 10px 20px;
            background: #6366f1;
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .add-btn:hover {
            background: #5855eb;
        }
        
        .maeiple-table {
            width: 100%;
            border-collapse: collapse;
        }
        
        .maeiple-table th {
            background: #f8fafc;
            padding: 16px 12px;
            text-align: left;
            font-weight: 600;
            color: #374151;
            border-bottom: 1px solid #e2e8f0;
            font-size: 14px;
        }
        
        .maeiple-table td {
            padding: 16px 12px;
            border-bottom: 1px solid #f1f5f9;
            font-size: 14px;
            color: #374151;
        }
        
        .maeiple-table tr:hover {
            background: #f8fafc;
        }
        
        /* ìƒˆ í–‰ ìŠ¤íƒ€ì¼ */
        .new-row {
            background: #f0f9ff !important;
            border-left: 4px solid #3b82f6;
        }
        
        .new-row:hover {
            background: #e0f2fe !important;
        }
        
        /* ì…€ ìŠ¤íƒ€ì¼ */
        .date-cell {
            cursor: pointer;
            position: relative;
        }
        
        .date-cell:hover {
            background-color: #f0f9ff;
        }
        
        .number-cell {
            cursor: pointer;
            font-weight: 500;
        }
        
        .number-cell:hover {
            background-color: #f0f9ff;
        }
        
        .price-cell {
            cursor: pointer;
            color: #2563eb;
            font-weight: 500;
        }
        
        .price-cell:hover {
            background-color: #f0f9ff;
        }
        
        .monthly-rent-container {
            display: flex;
            align-items: center;
        }
        
        .deposit {
            cursor: pointer;
            margin-right: 2px;
            color: #6366f1;
        }
        
        .monthly {
            cursor: pointer;
            color: #2563eb;
            font-weight: 500;
        }
        
        .deposit:hover, .monthly:hover {
            background-color: #f0f9ff;
        }
        
        .phone-cell {
            cursor: pointer;
            font-family: monospace;
            letter-spacing: 0.5px;
            max-width: 120px;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        
        .phone-cell:hover {
            background-color: #f0f9ff;
        }
        
        .memo-preview {
            cursor: pointer;
            color: #64748b;
            font-style: italic;
            max-width: 150px;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }
        
        .memo-preview:hover {
            background-color: #f0f9ff;
            color: #334155;
        }
        
        .like-rating, .dislike-rating {
            cursor: pointer;
            letter-spacing: -2px;
        }
        
        /* íŒì—… ë©”ë‰´ */
        .popup-menu {
            position: absolute;
            background: white;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            z-index: 100;
            padding: 8px 0;
        }
        
        .popup-menu-item {
            padding: 8px 16px;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .popup-menu-item:hover {
            background: #f8fafc;
        }
        
        .popup-menu-item.active {
            background: #e0f2fe;
            color: #2563eb;
            font-weight: 500;
        }
        
        /* ì¢‹ì•„ìš”/ì‹«ì–´ìš” íŒì—… */
        .rating-popup {
            display: flex;
            padding: 8px;
            gap: 4px;
        }
        
        .rating-option {
            padding: 4px 8px;
            cursor: pointer;
            border-radius: 4px;
        }
        
        .rating-option:hover {
            background: #f0f9ff;
        }
        
        /* ì‘ì—… ë²„íŠ¼ */
        .action-buttons {
            display: flex;
            gap: 8px;
        }
        
        .btn {
            padding: 6px 12px;
            border: none;
            border-radius: 6px;
            font-size: 12px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .btn-sm {
            padding: 4px 8px;
            font-size: 11px;
        }
        
        .btn-primary {
            background: #3b82f6;
            color: white;
        }
        
        .btn-primary:hover {
            background: #2563eb;
        }
        
        .btn-secondary {
            background: #6b7280;
            color: white;
        }
        
        .btn-secondary:hover {
            background: #4b5563;
        }
        
        .btn-danger {
            background: #ef4444;
            color: white;
        }
        
        .btn-danger:hover {
            background: #dc2626;
        }
        
        /* ìƒíƒœ í† ê¸€ ë²„íŠ¼ */
        .status-toggle {
            padding: 6px 12px;
            border: none;
            border-radius: 6px;
            font-size: 12px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .status-trading {
            background: #fef3c7;
            color: #92400e;
        }
        
        .status-completed {
            background: #d1fae5;
            color: #065f46;
        }
        
        /* ìƒˆë¡œìš´ í˜„í™© ìƒ‰ìƒ ë§¤í•‘ */
        .status-available {
            background: #e0f2fe; /* sky-100 */
            color: #0369a1;      /* sky-700 */
        }
        .status-hold {
            background: #fef3c7; /* amber-100 */
            color: #92400e;      /* amber-800 */
        }
        .status-absent {
            background: #ede9fe; /* violet-100 */
            color: #5b21b6;      /* violet-800 */
        }
        
        /* ì¢‹ì•„ìš”/ì‹«ì–´ìš” */
        .like-dislike {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .like-btn, .dislike-btn {
            background: none;
            border: none;
            cursor: pointer;
            font-size: 16px;
            padding: 4px;
            border-radius: 4px;
            transition: all 0.2s ease;
        }
        
        .like-btn:hover {
            background: #fef2f2;
            color: #dc2626;
        }
        
        .dislike-btn:hover {
            background: #f0f9ff;
            color: #2563eb;
        }
        
        .like-count, .dislike-count {
            font-size: 12px;
            font-weight: 500;
            min-width: 20px;
            text-align: center;
        }
        
        /* ë©”ëª¨ ì•„ì´ì½˜ */
        .memo-icon {
            background: none;
            border: none;
            cursor: pointer;
            font-size: 18px;
            padding: 4px;
            border-radius: 4px;
            transition: all 0.2s ease;
        }
        
        .memo-icon:hover {
            background: #f3f4f6;
        }
        
        /* ëª¨ë‹¬ */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
        }
        
        .modal-content {
            background-color: white;
            margin: 5% auto;
            padding: 24px;
            border-radius: 12px;
            width: 90%;
            max-width: 500px;
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1);
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .modal-title {
            font-size: 20px;
            font-weight: 600;
            color: #1a202c;
        }
        
        .close {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: #64748b;
        }
        
        .close:hover {
            color: #1a202c;
        }
        
        .memo-textarea {
            width: 100%;
            height: 120px;
            padding: 12px;
            border: 1px solid #d1d5db;
            border-radius: 8px;
            font-size: 14px;
            resize: vertical;
            font-family: inherit;
        }
        
        .memo-textarea:focus {
            outline: none;
            border-color: #6366f1;
            box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);
        }
        
        .modal-actions {
            display: flex;
            justify-content: flex-end;
            gap: 12px;
            margin-top: 20px;
        }
        
        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .btn-primary {
            background: #6366f1;
            color: white;
        }
        
        .btn-primary:hover {
            background: #5855eb;
        }
        
        .btn-secondary {
            background: #6b7280;
            color: white;
        }
        
        .btn-secondary:hover {
            background: #4b5563;
        }
        
        /* ì…ë ¥ í•„ë“œ */
        .input-field {
            width: 100%;
            padding: 8px 12px;
            border: 1px solid #d1d5db;
            border-radius: 6px;
            font-size: 14px;
            transition: all 0.2s ease;
        }
        
        .input-field:focus {
            outline: none;
            border-color: #6366f1;
            box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);
        }
        
        .input-small {
            width: 80px;
        }
        
        /* ì‹¤ê±°ì£¼ ì—¬ë¶€ í† ê¸€ */
        .occupied-toggle {
            background: none;
            border: none;
            cursor: pointer;
            font-size: 18px;
            padding: 4px;
            border-radius: 4px;
            transition: all 0.2s ease;
        }
        
        .occupied-toggle:hover {
            background: #f3f4f6;
        }
        
        .occupied-yes {
            color: #059669;
        }
        
        .occupied-no {
            color: #dc2626;
        }
        
        /* ë¡œë”© */
        .loading {
            text-align: center;
            padding: 40px;
            color: #64748b;
        }
        
        /* ë¹ˆ ìƒíƒœ */
        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #64748b;
        }
        
        .empty-state-icon {
            font-size: 48px;
            margin-bottom: 16px;
            opacity: 0.5;
        }
    </style>
</head>
<body>
    <div class="app-container">
        <!-- ì‚¬ì´ë“œë°” -->
        <div class="sidebar">
            <div class="sidebar-header">
                <div class="logo">
                    <div class="logo-icon">ğŸ </div>
                    <div class="logo-text">ì§‘ë…¸íŠ¸</div>
                </div>
            </div>
            
            <nav class="sidebar-nav">
                <a href="/dashboard" class="nav-item">
                    <div class="nav-icon">ğŸ“Š</div>
                    ëŒ€ì‹œë³´ë“œ
                </a>
                <a href="/maeiple" class="nav-item active">
                    <div class="nav-icon">ğŸ¢</div>
                    ë©”ì´í”Œê´€ë¦¬
                </a>
                <a href="#" class="nav-item" id="guarantee-log-menu">
                    <div class="nav-icon">ğŸ›¡ï¸</div>
                    ë³´ì¦ë³´í—˜
                </a>
                <a href="/logout" class="nav-item">
                    <div class="nav-icon">ğŸšª</div>
                    ë¡œê·¸ì•„ì›ƒ
                </a>
            </nav>
        </div>
        
        <!-- ë©”ì¸ ì»¨í…ì¸  -->
        <div class="main-content">
            <!-- í—¤ë” -->
            <div class="header">
                <div class="header-left">
                    <h2>ë©”ì´í”Œê´€ë¦¬</h2>
                </div>
                
                <div class="header-right">
                    <div class="user-profile">
                        <div class="user-avatar">{{ employee_name[0] if employee_name else 'ì§' }}</div>
                        <div class="user-info">
                            <div class="user-name">{{ employee_name or 'ì§ì›' }}</div>
                            <div class="user-role">ì§ì›</div>
                        </div>
                    </div>
                    <a href="/logout" class="logout-btn">ë¡œê·¸ì•„ì›ƒ</a>
                </div>
            </div>
            
            <!-- ì»¨í…ì¸  -->
            <div class="content">
                <div class="page-header">
                    <h1 class="page-title">ì•„íŒŒíŠ¸ëª©ë¡</h1>
                    <p class="page-subtitle">ë§¤ë¬¼ í˜„í™© ë° ê´€ë¦¬</p>
                </div>
                
                <!-- ë§¤ë¬¼ í…Œì´ë¸” -->
                <div class="table-container">
                    <div class="table-header">
                        <h2 class="table-title">ë§¤ë¬¼ ë¦¬ìŠ¤íŠ¸</h2>
                        <button class="add-btn" onclick="addNewPropertyRow()">+ ìƒˆ ë§¤ë¬¼ ì¶”ê°€</button>
                    </div>
                 <div class="filter-section">
                     <!-- í˜¸ìˆ˜ ê²€ìƒ‰ -->
                     <div class="filter-group">
                         <span class="filter-label">í˜¸ìˆ˜ ê²€ìƒ‰:</span>
                         <input type="text" id="room-search" placeholder="í˜¸ìˆ˜ ì…ë ¥ (ì˜ˆ: 101, 102)" 
                                style="padding: 6px 12px; border: 1px solid #e2e8f0; border-radius: 6px; font-size: 12px; width: 120px;"
                                oninput="filterByRoom(this.value)">
                     </div>
                     
                     <!-- ê±°ë˜ ìœ í˜• í•„í„° -->
                     <div class="filter-group" id="deal-type-filter-group">
                         <span class="filter-label">ê±°ë˜ìœ í˜•:</span>
                         <div class="filter-buttons">
                             <button class="filter-btn active" data-value="all" onclick="setDealTypeFilter('all', this)">ì „ì²´</button>
                             <button class="filter-btn" data-value="ì „ì„¸" onclick="setDealTypeFilter('ì „ì„¸', this)">ì „ì„¸</button>
                             <button class="filter-btn" data-value="ì›”ì„¸" onclick="setDealTypeFilter('ì›”ì„¸', this)">ì›”ì„¸</button>
                             <button class="filter-btn" data-value="ë§¤ë§¤" onclick="setDealTypeFilter('ë§¤ë§¤', this)">ë§¤ë§¤</button>
                         </div>
                     </div>
                     
                     <div class="filter-group" id="status-filter-group">
                         <span class="filter-label">í˜„í™©:</span>
                         <div class="filter-buttons">
                             <button class="filter-btn active" data-value="all" onclick="setStatusFilter('all', this)">ì „ì²´</button>
                             <button class="filter-btn" data-value="ê±°ë˜ê°€ëŠ¥" onclick="setStatusFilter('ê±°ë˜ê°€ëŠ¥', this)">ê±°ë˜ê°€ëŠ¥</button>
                             <button class="filter-btn" data-value="ê³„ì•½ì™„ë£Œ" onclick="setStatusFilter('ê³„ì•½ì™„ë£Œ', this)">ê³„ì•½ì™„ë£Œ</button>
                             <button class="filter-btn" data-value="ë³´ë¥˜" onclick="setStatusFilter('ë³´ë¥˜', this)">ë³´ë¥˜</button>
                             <button class="filter-btn" data-value="ë¶€ì¬" onclick="setStatusFilter('ë¶€ì¬', this)">ë¶€ì¬</button>
                         </div>
                     </div>
                     <div class="filter-group" id="occupied-filter-group">
                         <span class="filter-label">ì‹¤ê±°ì£¼:</span>
                         <div class="filter-buttons">
                             <button class="filter-btn active" data-value="all" onclick="setOccupiedFilter('all', this)">ì „ì²´</button>
                             <button class="filter-btn" data-value="O" onclick="setOccupiedFilter('O', this)">O</button>
                             <button class="filter-btn" data-value="X" onclick="setOccupiedFilter('X', this)">X</button>
                         </div>
                     </div>
                     
                     <!-- íŒ€ í•„í„° (íŒ€ì¥ì¸ ê²½ìš°ë§Œ í‘œì‹œ) -->
                     <div class="filter-group" id="team-filter-group" style="display: none;">
                         <span class="filter-label">íŒ€:</span>
                         <div class="filter-buttons">
                             <button class="filter-btn active" data-value="all" onclick="setTeamFilter('all', this)">ì „ì²´</button>
                             <button class="filter-btn" data-value="current" onclick="setTeamFilter('current', this)">í˜„ì¬íŒ€</button>
                         </div>
                     </div>
                 </div>
                    
                    <div id="table-content">
                        <div class="loading">ë¡œë”© ì¤‘...</div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- ë©”ëª¨ ëª¨ë‹¬ -->
    <div id="memoModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">íŠ¹ì´ì‚¬í•­ ë©”ëª¨</h3>
                <button class="close" onclick="closeMemoModal()">&times;</button>
            </div>
            <textarea id="memoTextarea" class="memo-textarea" placeholder="ë©”ëª¨ë¥¼ ì…ë ¥í•˜ì„¸ìš”..."></textarea>
            <div class="modal-actions">
                <button class="btn btn-secondary" onclick="closeMemoModal()">ì·¨ì†Œ</button>
                <button class="btn btn-primary" onclick="saveMemo()">ì €ì¥</button>
            </div>
        </div>
    </div>
    

    
    <script>
        let properties = [];
        let statusFilter = 'all';
        let occupiedFilter = 'all';
        let dealTypeFilter = 'all';
        let roomSearchFilter = '';
        let teamFilter = 'all';
        let currentMemoId = null;
        let currentSortBy = 'check_date';
        let currentSortOrder = 'desc';
        let currentUserTeam = '';
        let isTeamLeader = false;
        
        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì‚¬ìš©ì ì •ë³´ í™•ì¸ ë° ë§¤ë¬¼ ëª©ë¡ ì¡°íšŒ
        document.addEventListener('DOMContentLoaded', async function() {
            await checkUserInfo();
            loadProperties();
        });
        
        // ì‚¬ìš©ì ì •ë³´ í™•ì¸
        async function checkUserInfo() {
            try {
                const response = await fetch('/api/user-info');
                if (response.ok) {
                    const userInfo = await response.json();
                    currentUserTeam = userInfo.employee_team || '';
                    isTeamLeader = userInfo.role === 'íŒ€ì¥' || userInfo.employee_role === 'íŒ€ì¥';
                    
                    // íŒ€ì¥ì¸ ê²½ìš° íŒ€ í•„í„° í‘œì‹œ
                    if (isTeamLeader) {
                        document.getElementById('team-filter-group').style.display = 'flex';
                        console.log('ğŸ¯ íŒ€ì¥ ê¶Œí•œ í™•ì¸ - íŒ€ í•„í„° í™œì„±í™”');
                    }
                    
                    console.log('ğŸ‘¤ ì‚¬ìš©ì ì •ë³´:', userInfo);
                    console.log('ğŸ¢ í˜„ì¬ íŒ€:', currentUserTeam);
                    console.log('ğŸ‘‘ íŒ€ì¥ ì—¬ë¶€:', isTeamLeader);
                }
            } catch (error) {
                console.error('ì‚¬ìš©ì ì •ë³´ í™•ì¸ ì˜¤ë¥˜:', error);
            }
        }
        
        // ë§¤ë¬¼ ëª©ë¡ ì¡°íšŒ
        async function loadProperties() {
            try {
                const url = `/api/maeiple?sort_by=${currentSortBy}&sort_order=${currentSortOrder}`;
                const response = await fetch(url);
                const data = await response.json();
                
                if (data.success) {
                    properties = data.properties;
                    renderProperties();
                } else {
                    showError('ë§¤ë¬¼ ëª©ë¡ì„ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
                }
            } catch (error) {
                console.error('Error:', error);
                showError('ë§¤ë¬¼ ëª©ë¡ì„ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
            }
        }
        
        // ë§¤ë¬¼ ëª©ë¡ ë Œë”ë§
        function renderProperties() {
            const tableContent = document.getElementById('table-content');
            
            // í•„í„° ì ìš©
            let list = Array.isArray(properties) ? properties.slice() : [];
            
            // í˜„í™© í•„í„°
            if (statusFilter !== 'all') {
                list = list.filter(p => (p.status || '') === statusFilter);
            }
            
            // ì‹¤ê±°ì£¼ í•„í„°
            if (occupiedFilter !== 'all') {
                const want = occupiedFilter === 'O';
                list = list.filter(p => !!p.is_occupied === want);
            }
            
            // ê±°ë˜ìœ í˜• í•„í„° (ê¸ˆì•¡ì´ ì…ë ¥ëœ ê²½ìš°ë§Œ í•´ë‹¹ ê±°ë˜ìœ í˜•ìœ¼ë¡œ ë¶„ë¥˜)
            if (dealTypeFilter !== 'all') {
                list = list.filter(p => {
                    if (dealTypeFilter === 'ì „ì„¸') {
                        const jeonsePrice = parseInt(String(p.jeonse_price || '0').replace(/[^\d]/g, '')) || 0;
                        return jeonsePrice > 0;
                    } else if (dealTypeFilter === 'ì›”ì„¸') {
                        const monthlyRent = parseInt(String(p.monthly_rent || '0').replace(/[^\d]/g, '')) || 0;
                        return monthlyRent > 0;
                    } else if (dealTypeFilter === 'ë§¤ë§¤') {
                        const salePrice = parseInt(String(p.sale_price || '0').replace(/[^\d]/g, '')) || 0;
                        return salePrice > 0;
                    }
                    return true;
                });
            }
            
            // í˜¸ìˆ˜ ê²€ìƒ‰ í•„í„°
            if (roomSearchFilter.trim()) {
                const searchTerm = roomSearchFilter.trim().toLowerCase();
                list = list.filter(p => {
                    const roomNumber = String(p.room_number || '').toLowerCase();
                    return roomNumber.includes(searchTerm);
                });
            }
            
            // íŒ€ í•„í„° (íŒ€ì¥ì¸ ê²½ìš°ë§Œ ì ìš©)
            if (isTeamLeader && teamFilter === 'current' && currentUserTeam) {
                list = list.filter(p => p.employee_team === currentUserTeam);
                console.log(`ğŸ¢ íŒ€ í•„í„° ì ìš©: ${currentUserTeam}íŒ€ ë§¤ë¬¼ ${list.length}ê°œ`);
            }
            
            if (list.length === 0) {
                tableContent.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">ğŸ¢</div>
                        <p>ì¡°ê±´ì— ë§ëŠ” ë§¤ë¬¼ì´ ì—†ìŠµë‹ˆë‹¤.</p>
                        <p>í•„í„°ë¥¼ ë³€ê²½í•˜ê±°ë‚˜ ìƒˆ ë§¤ë¬¼ì„ ì¶”ê°€í•´ë³´ì„¸ìš”.</p>
                    </div>
                `;
                return;
            }
            
            let tableHTML = `
                <table class="maeiple-table">
                    <thead>
                        <tr>
                            <th>
                                <div class="sort-header ${currentSortBy === 'check_date' ? 'active ' + currentSortOrder : ''}" 
                                     onclick="toggleSort('check_date')">
                                    í™•ì¸ë‚ ì§œ
                                    <span class="sort-icon"></span>
                                </div>
                            </th>
                            <th>ë™</th>
                            <th>í˜¸ìˆ˜</th>
                            <th>í˜„í™©</th>
                            <th>ì „ì„¸ (ë§Œì›)</th>
                            <th>ì›”ì„¸ë³´ì¦ê¸ˆ (ë§Œì›)</th>
                            <th>ì›”ì„¸ (ë§Œì›)</th>
                            <th>ë§¤ë§¤ (ë§Œì›)</th>
                            <th>ì‹¤ê±°ì£¼ ì—¬ë¶€</th>
                            <th>ì „í™”ë²ˆí˜¸</th>
                            <th>íŠ¹ì´ì‚¬í•­</th>
                            <th>ì¢‹ì•„ìš”</th>
                            <th>ì‹«ì–´ìš”</th>
                        </tr>
                    </thead>
                    <tbody>
            `;
            
            list.forEach(property => {
                const memoPreview = property.memo ? (property.memo.length > 20 ? property.memo.substring(0, 20) + '...' : property.memo) : '';
                
                tableHTML += `
                    <tr data-property-id="${property.id}">
                        <td class="date-cell" onclick="editDate(${property.id}, '${property.check_date || ''}', this)">${property.check_date || ''}</td>
                        <td class="number-cell" onclick="editNumber(${property.id}, 'building_number', '${property.building_number || ''}', this)">${property.building_number || ''}</td>
                        <td class="number-cell" onclick="editNumber(${property.id}, 'room_number', '${property.room_number || ''}', this)">${property.room_number || ''}</td>
                        <td>
                            <button class="status-toggle ${property.status === 'ê³„ì•½ì™„ë£Œ' ? 'status-completed' : property.status === 'ë³´ë¥˜' ? 'status-hold' : property.status === 'ë¶€ì¬' ? 'status-absent' : 'status-available'}" 
                                    onclick="showStatusOptions(${property.id}, '${property.status || 'ê±°ë˜ê°€ëŠ¥'}', this)">
                                ${property.status || 'ê±°ë˜ê°€ëŠ¥'}
                            </button>
                        </td>
                        <td class="price-cell" onclick="editPrice(${property.id}, 'jeonse_price', '${property.jeonse_price || ''}', this)">
                            ${property.jeonse_price ? formatNumber(property.jeonse_price) + ' ë§Œì›' : '-'}
                        </td>
                        <td class="price-cell" onclick="editPrice(${property.id}, 'deposit', '${property.deposit || ''}', this)">
                            ${property.deposit ? formatNumber(property.deposit) + ' ë§Œì›' : '-'}
                        </td>
                        <td class="price-cell" onclick="editPrice(${property.id}, 'monthly_rent', '${property.monthly_rent || ''}', this)">
                            ${property.monthly_rent ? formatNumber(property.monthly_rent) + ' ë§Œì›' : '-'}
                        </td>
                        <td class="price-cell" onclick="editPrice(${property.id}, 'sale_price', '${property.sale_price || ''}', this)">
                            ${property.sale_price ? formatNumber(property.sale_price) + ' ë§Œì›' : '-'}
                        </td>
                        <td>
                            <button class="occupied-toggle ${property.is_occupied ? 'occupied-yes' : 'occupied-no'}" 
                                    onclick="toggleOccupied(${property.id}, ${property.is_occupied})">
                                ${property.is_occupied ? 'O' : 'X'}
                            </button>
                        </td>
                        <td class="phone-cell" onclick="editPhone(${property.id}, '${property.phone || ''}', this)">
                            ${property.phone || '-'}
                        </td>
                        <td class="memo-preview" onclick="showMemoModal(${property.id}, '${property.memo || ''}')">
                            ${memoPreview || 'ë©”ëª¨ ì¶”ê°€...'}
                        </td>
                        <td>
                            <div class="like-dislike">
                                <div class="like-rating" onclick="showLikeOptions(${property.id}, ${property.likes}, this)">
                                    ${'â¤ï¸'.repeat(property.likes)}${property.likes === 0 ? 'ğŸ¤' : ''}
                                </div>
                            </div>
                        </td>
                        <td>
                            <div class="like-dislike">
                                <div class="dislike-rating" onclick="showDislikeOptions(${property.id}, ${property.dislikes}, this)">
                                    ${'ğŸ‘'.repeat(property.dislikes)}${property.dislikes === 0 ? 'ğŸ¤' : ''}
                                </div>
                            </div>
                        </td>

                    </tr>
                `;
            });
            
            tableHTML += `
                    </tbody>
                </table>
            `;
            
            tableContent.innerHTML = tableHTML;
        }

        // ìˆ«ì 3ìë¦¬ ì½¤ë§ˆ
        function formatNumber(val) {
            const n = typeof val === 'number' ? val : parseInt(String(val).replace(/[^\d-]/g, ''), 10);
            if (isNaN(n)) return '';
            return n.toLocaleString('ko-KR');
        }
        
        // í˜„í™© í† ê¸€
        async function toggleStatus(id, currentStatus) {
            const newStatus = currentStatus === 'ê±°ë˜ê°€ëŠ¥' ? 'ê³„ì•½ì™„ë£Œ' : 'ê±°ë˜ê°€ëŠ¥';
            
            try {
                const response = await fetch('/api/maeiple/update', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        id: id,
                        field: 'status',
                        value: newStatus
                    })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    // ë¡œì»¬ ìƒíƒœ ì—…ë°ì´íŠ¸
                    const property = properties.find(p => p.id === id);
                    if (property) {
                        property.status = newStatus;
                        renderProperties();
                    }
                } else {
                    showError('ìƒíƒœ ì—…ë°ì´íŠ¸ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
                }
            } catch (error) {
                console.error('Error:', error);
                showError('ìƒíƒœ ì—…ë°ì´íŠ¸ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
            }
        }
        
        // íŒ€ í•„í„° ì„¤ì •
        function setTeamFilter(value, button) {
            // ëª¨ë“  íŒ€ í•„í„° ë²„íŠ¼ ë¹„í™œì„±í™”
            document.querySelectorAll('#team-filter-group .filter-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            
            // í´ë¦­ëœ ë²„íŠ¼ í™œì„±í™”
            button.classList.add('active');
            teamFilter = value;
            
            // ë§¤ë¬¼ ëª©ë¡ ë‹¤ì‹œ ë Œë”ë§
            renderProperties();
        }
        
        // ì‹¤ê±°ì£¼ ì—¬ë¶€ í† ê¸€
        async function toggleOccupied(id, currentOccupied) {
            const newOccupied = !currentOccupied;
            
            try {
                const response = await fetch('/api/maeiple/update', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        id: id,
                        field: 'is_occupied',
                        value: newOccupied
                    })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    // ë¡œì»¬ ìƒíƒœ ì—…ë°ì´íŠ¸
                    const property = properties.find(p => p.id === id);
                    if (property) {
                        property.is_occupied = newOccupied;
                        renderProperties();
                    }
                } else {
                    showError('ì‹¤ê±°ì£¼ ì—¬ë¶€ ì—…ë°ì´íŠ¸ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
                }
            } catch (error) {
                console.error('Error:', error);
                showError('ì‹¤ê±°ì£¼ ì—¬ë¶€ ì—…ë°ì´íŠ¸ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
            }
        }
        
        // í•„ë“œ ì—…ë°ì´íŠ¸
        async function updateField(id, field, value) {
            try {
                const response = await fetch('/api/maeiple/update', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        id: id,
                        field: field,
                        value: value
                    })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    // ë¡œì»¬ ìƒíƒœ ì—…ë°ì´íŠ¸
                    const property = properties.find(p => p.id === id);
                    if (property) {
                        property[field] = value;
                        if (field === 'status' || field === 'is_occupied') {
                            // í•„í„° ë°˜ì˜ì„ ìœ„í•´ ì¬ë Œë”
                            renderProperties();
                        }
                    }
                } else {
                    showError('ì—…ë°ì´íŠ¸ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
                }
            } catch (error) {
                console.error('Error:', error);
                showError('ì—…ë°ì´íŠ¸ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
            }
        }
        
        // ì¢‹ì•„ìš” ì—…ë°ì´íŠ¸
        async function updateLikes(id, currentLikes, increment) {
            const newLikes = Math.min(5, Math.max(0, currentLikes + increment));
            
            try {
                const response = await fetch('/api/maeiple/update', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        id: id,
                        field: 'likes',
                        value: newLikes
                    })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    // ë¡œì»¬ ìƒíƒœ ì—…ë°ì´íŠ¸
                    const property = properties.find(p => p.id === id);
                    if (property) {
                        property.likes = newLikes;
                        renderProperties();
                    }
                } else {
                    showError('ì¢‹ì•„ìš” ì—…ë°ì´íŠ¸ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
                }
            } catch (error) {
                console.error('Error:', error);
                showError('ì¢‹ì•„ìš” ì—…ë°ì´íŠ¸ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
            }
        }
        
        // ì‹«ì–´ìš” ì—…ë°ì´íŠ¸
        async function updateDislikes(id, currentDislikes, increment) {
            const newDislikes = Math.min(5, Math.max(0, currentDislikes + increment));
            
            try {
                const response = await fetch('/api/maeiple/update', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        id: id,
                        field: 'dislikes',
                        value: newDislikes
                    })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    // ë¡œì»¬ ìƒíƒœ ì—…ë°ì´íŠ¸
                    const property = properties.find(p => p.id === id);
                    if (property) {
                        property.dislikes = newDislikes;
                        renderProperties();
                    }
                } else {
                    showError('ì‹«ì–´ìš” ì—…ë°ì´íŠ¸ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
                }
            } catch (error) {
                console.error('Error:', error);
                showError('ì‹«ì–´ìš” ì—…ë°ì´íŠ¸ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
            }
        }

        // ì •ë ¬ ê¸°ëŠ¥
        async function toggleSort(field) {
            if (currentSortBy === field) {
                // ê°™ì€ í•„ë“œë¥¼ í´ë¦­í•œ ê²½ìš° ì •ë ¬ ìˆœì„œ ë³€ê²½
                currentSortOrder = currentSortOrder === 'desc' ? 'asc' : 'desc';
            } else {
                // ë‹¤ë¥¸ í•„ë“œë¥¼ í´ë¦­í•œ ê²½ìš° í•´ë‹¹ í•„ë“œë¡œ ë‚´ë¦¼ì°¨ìˆœ ì •ë ¬
                currentSortBy = field;
                currentSortOrder = 'desc';
            }
            
            // ë°ì´í„° ë‹¤ì‹œ ë¡œë“œ
            await loadProperties();
        }
        
        // í•„í„° í•¸ë“¤ëŸ¬
        function setStatusFilter(value, btn) {
            statusFilter = value;
            // ë²„íŠ¼ active ìƒíƒœ
            document.querySelectorAll('#status-filter-group .filter-btn').forEach(b => b.classList.remove('active'));
            btn.classList.add('active');
            renderProperties();
        }
        function setOccupiedFilter(value, btn) {
            occupiedFilter = value;
            document.querySelectorAll('#occupied-filter-group .filter-btn').forEach(b => b.classList.remove('active'));
            btn.classList.add('active');
            renderProperties();
        }
        
        // ê±°ë˜ìœ í˜• í•„í„°
        function setDealTypeFilter(value, btn) {
            dealTypeFilter = value;
            document.querySelectorAll('#deal-type-filter-group .filter-btn').forEach(b => b.classList.remove('active'));
            btn.classList.add('active');
            renderProperties();
        }
        
        // í˜¸ìˆ˜ ê²€ìƒ‰ í•„í„°
        function filterByRoom(searchValue) {
            roomSearchFilter = searchValue;
            renderProperties();
        }
        
        // ë©”ëª¨ ëª¨ë‹¬ í‘œì‹œ
        function showMemoModal(id, memo) {
            currentMemoId = id;
            document.getElementById('memoTextarea').value = memo;
            document.getElementById('memoModal').style.display = 'block';
        }
        
        // ë©”ëª¨ ëª¨ë‹¬ ë‹«ê¸°
        function closeMemoModal() {
            document.getElementById('memoModal').style.display = 'none';
            currentMemoId = null;
        }
        
        // ë©”ëª¨ ì €ì¥
        async function saveMemo() {
            if (!currentMemoId) return;
            
            const memo = document.getElementById('memoTextarea').value;
            
            try {
                const response = await fetch('/api/maeiple/memo', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        id: currentMemoId,
                        memo: memo
                    })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    // ë¡œì»¬ ìƒíƒœ ì—…ë°ì´íŠ¸
                    const property = properties.find(p => p.id === currentMemoId);
                    if (property) {
                        property.memo = memo;
                    }
                    closeMemoModal();
                    showSuccess('ë©”ëª¨ê°€ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.');
                } else {
                    showError('ë©”ëª¨ ì €ì¥ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
                }
            } catch (error) {
                console.error('Error:', error);
                showError('ë©”ëª¨ ì €ì¥ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
            }
        }
        
        // ìƒˆ ë§¤ë¬¼ í–‰ ì¶”ê°€ (ëŒ€ì‹œë³´ë“œì™€ ê°™ì€ ë°©ì‹)
        function addNewPropertyRow() {
            const tbody = document.querySelector('.maeiple-table tbody');
            if (!tbody) return;
            
            // ì˜¤ëŠ˜ ë‚ ì§œ êµ¬í•˜ê¸°
            const today = new Date().toISOString().split('T')[0];
            
            // ìë™ ID ìƒì„± (ì„ì‹œ)
            const tempId = Date.now();
            
            const newRow = document.createElement('tr');
            newRow.className = 'new-row';
            newRow.innerHTML = `
                <td class="date-cell" onclick="editDate(null, '${today}', this)">${today}</td>
                <td class="number-cell" onclick="editNumber(null, 'building_number', '', this)">-</td>
                <td class="number-cell" onclick="editNumber(null, 'room_number', '', this)">-</td>
                <td>
                    <button class="status-toggle status-available" onclick="showStatusOptions(null, 'ê±°ë˜ê°€ëŠ¥', this)">ê±°ë˜ê°€ëŠ¥</button>
                </td>
                <td class="price-cell" onclick="editPrice(null, 'jeonse_price', '', this)">-</td>
                <td class="price-cell" onclick="editPrice(null, 'deposit', '', this)">-</td>
                <td class="price-cell" onclick="editPrice(null, 'monthly_rent', '', this)">-</td>
                <td class="price-cell" onclick="editPrice(null, 'sale_price', '', this)">-</td>
                <td>
                    <button class="occupied-toggle occupied-no" onclick="toggleOccupied(null, false, this)">X</button>
                </td>
                <td class="phone-cell" onclick="editPhone(null, '', this)">-</td>
                <td class="memo-preview" onclick="showMemoModal(null, '', this)">ë©”ëª¨ ì¶”ê°€...</td>
                <td>
                    <div class="like-dislike">
                        <div class="like-rating" onclick="showLikeOptions(null, 0, this)">ğŸ¤</div>
                    </div>
                </td>
                <td>
                    <div class="like-dislike">
                        <div class="dislike-rating" onclick="showDislikeOptions(null, 0, this)">ğŸ¤</div>
                    </div>
                </td>
                <td>
                    <div class="action-buttons">
                        <button class="btn btn-primary btn-sm" onclick="saveNewProperty(this)">ì €ì¥</button>
                        <button class="btn btn-secondary btn-sm" onclick="cancelNewPropertyRow(this)">ì·¨ì†Œ</button>
                    </div>
                </td>
            `;
            
            tbody.insertBefore(newRow, tbody.firstChild);
        }
        
        // ìƒˆ ë§¤ë¬¼ ì €ì¥
        async function saveNewProperty(button) {
            const row = button.closest('tr');
            
            const propertyData = {};
            
            // ë‚ ì§œ ê°€ì ¸ì˜¤ê¸°
            const dateCell = row.querySelector('.date-cell');
            propertyData.check_date = dateCell.textContent.trim();
            if (propertyData.check_date === '-') propertyData.check_date = '';
            
            // ë™/í˜¸ìˆ˜ ê°€ì ¸ì˜¤ê¸°
            const buildingCell = row.querySelector('td:nth-child(2)');
            propertyData.building_number = buildingCell.textContent.trim();
            if (propertyData.building_number === '-') propertyData.building_number = '';
            
            const roomCell = row.querySelector('td:nth-child(3)');
            propertyData.room_number = roomCell.textContent.trim();
            if (propertyData.room_number === '-') propertyData.room_number = '';
            
            // ìƒíƒœ ì •ë³´ ê°€ì ¸ì˜¤ê¸°
            const statusBtn = row.querySelector('.status-toggle');
            propertyData.status = statusBtn.textContent.trim();
            
            // ê°€ê²© ì •ë³´ ê°€ì ¸ì˜¤ê¸°
            const jeonseCell = row.querySelector('td:nth-child(5)');
            let jeonsePrice = jeonseCell.textContent.trim();
            if (jeonsePrice !== '-') {
                jeonsePrice = jeonsePrice.replace(' ë§Œì›', '');
                propertyData.jeonse_price = jeonsePrice;
            }
            
            // ì›”ì„¸ ì •ë³´ ê°€ì ¸ì˜¤ê¸° (ë³´ì¦ê¸ˆ/ì›”ì„¸ ë³„ë„ ì¹¸)
            const depositCell = row.querySelector('td:nth-child(6)');
            if (depositCell) {
                let deposit = depositCell.textContent.trim();
                if (deposit !== '-') propertyData.deposit = deposit;
            }
            const monthlyCell = row.querySelector('td:nth-child(7)');
            if (monthlyCell) {
                let monthlyRent = monthlyCell.textContent.trim();
                if (monthlyRent !== '-') propertyData.monthly_rent = monthlyRent.replace(' ë§Œì›', '');
            }
            
            // ë§¤ë§¤ ê°€ê²© ê°€ì ¸ì˜¤ê¸° (ì—´ ì´ë™ìœ¼ë¡œ ì¸ë±ìŠ¤ +1)
            const salePriceCell = row.querySelector('td:nth-child(8)');
            let salePrice = salePriceCell.textContent.trim();
            if (salePrice !== '-') {
                salePrice = salePrice.replace(' ë§Œì›', '');
                propertyData.sale_price = salePrice;
            }
            
            // ì‹¤ê±°ì£¼ ì—¬ë¶€ ê°€ì ¸ì˜¤ê¸°
            const occupiedBtn = row.querySelector('.occupied-toggle');
            propertyData.is_occupied = occupiedBtn.textContent.trim() === 'O';
            
            // ì „í™”ë²ˆí˜¸ ê°€ì ¸ì˜¤ê¸°
            const phoneCell = row.querySelector('.phone-cell');
            let phone = phoneCell.textContent.trim();
            if (phone !== '-') {
                propertyData.phone = phone;
            }
            
            // ë©”ëª¨ ê°€ì ¸ì˜¤ê¸°
            const memoCell = row.querySelector('.memo-preview');
            let memo = memoCell.textContent.trim();
            if (memo !== 'ë©”ëª¨ ì¶”ê°€...') {
                propertyData.memo = memo;
            }
            
            // ì¢‹ì•„ìš”/ì‹«ì–´ìš” ê°€ì ¸ì˜¤ê¸°
            const likeRating = row.querySelector('.like-rating');
            if (likeRating) {
                const likeText = likeRating.innerHTML;
                propertyData.likes = (likeText.match(/â¤ï¸/g) || []).length;
            }
            
            const dislikeRating = row.querySelector('.dislike-rating');
            if (dislikeRating) {
                const dislikeText = dislikeRating.innerHTML;
                propertyData.dislikes = (dislikeText.match(/ğŸ‘/g) || []).length;
            }
            
            // í•„ìˆ˜ í•­ëª© ê²€ì¦
            if (!propertyData.check_date || !propertyData.building_number || !propertyData.room_number) {
                showError('í™•ì¸ë‚ ì§œ, ë™, í˜¸ìˆ˜ëŠ” í•„ìˆ˜ í•­ëª©ì…ë‹ˆë‹¤.');
                return;
            }
            
            try {
                const response = await fetch('/api/maeiple', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        check_date: propertyData.check_date,
                        building_number: parseInt(propertyData.building_number),
                        room_number: parseInt(propertyData.room_number),
                        status: propertyData.status,
                        jeonse_price: propertyData.jeonse_price ? parseInt(propertyData.jeonse_price) : null,
                        monthly_rent: propertyData.monthly_rent ? parseInt(propertyData.monthly_rent) : null,
                        sale_price: propertyData.sale_price ? parseInt(propertyData.sale_price) : null,
                        is_occupied: propertyData.is_occupied,
                        phone: propertyData.phone,
                        memo: propertyData.memo || '',
                        likes: propertyData.likes,
                        dislikes: propertyData.dislikes
                    })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    showSuccess('ìƒˆ ë§¤ë¬¼ì´ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤.');
                    
                    // ìƒˆ ë§¤ë¬¼ì„ ë¡œì»¬ ë°°ì—´ì— ì¶”ê°€
                    const newProperty = {
                        id: data.id,
                        check_date: propertyData.check_date,
                        building_number: parseInt(propertyData.building_number),
                        room_number: parseInt(propertyData.room_number),
                        status: propertyData.status,
                        jeonse_price: propertyData.jeonse_price ? parseInt(propertyData.jeonse_price) : null,
                        monthly_rent: propertyData.monthly_rent ? parseInt(propertyData.monthly_rent) : null,
                        sale_price: propertyData.sale_price ? parseInt(propertyData.sale_price) : null,
                        is_occupied: propertyData.is_occupied,
                        phone: propertyData.phone,
                        memo: propertyData.memo || '',
                        likes: propertyData.likes,
                        dislikes: propertyData.dislikes
                    };
                    
                    properties.unshift(newProperty);
                    
                    // í–‰ì„ ì •ìƒ í–‰ìœ¼ë¡œ ë³€í™˜
                    row.className = '';
                    row.removeChild(row.querySelector('.action-buttons'));
                    
                    // ì„±ê³µ ë©”ì‹œì§€ í‘œì‹œ
                    showSuccess('ë§¤ë¬¼ì´ ì„±ê³µì ìœ¼ë¡œ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤.');
                } else {
                    showError('ë§¤ë¬¼ ì¶”ê°€ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
                }
            } catch (error) {
                console.error('Error:', error);
                showError('ë§¤ë¬¼ ì¶”ê°€ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
            }
        }
        
        // ìƒˆ ë§¤ë¬¼ í–‰ ì·¨ì†Œ
        function cancelNewPropertyRow(button) {
            const row = button.closest('tr');
            row.remove();
        }
        
        // ë§¤ë¬¼ ì…€ í¸ì§‘
        function editPropertyCell(cell) {
            const field = cell.dataset.field;
            const currentValue = cell.textContent.trim();
            
            if (field === 'check_date') {
                const input = document.createElement('input');
                input.type = 'date';
                input.value = currentValue === '-' ? '' : currentValue;
                input.className = 'input-field input-small';
                
                input.onblur = function() {
                    cell.textContent = this.value || '-';
                    updatePropertyField(cell);
                };
                
                input.onkeypress = function(e) {
                    if (e.key === 'Enter') {
                        this.blur();
                    }
                };
                
                cell.textContent = '';
                cell.appendChild(input);
                input.focus();
            } else if (field === 'phone') {
                const input = document.createElement('input');
                input.type = 'tel';
                input.value = currentValue === '-' ? '' : currentValue;
                input.className = 'input-field';
                input.placeholder = '000-0000-0000';
                
                input.onblur = function() {
                    cell.textContent = this.value || '-';
                    updatePropertyField(cell);
                };
                
                input.onkeypress = function(e) {
                    if (e.key === 'Enter') {
                        this.blur();
                    }
                };
                
                cell.textContent = '';
                cell.appendChild(input);
                input.focus();
            } else {
                const input = document.createElement('input');
                input.type = 'number';
                input.value = currentValue === '-' ? '' : currentValue;
                input.className = 'input-field input-small';
                
                input.onblur = function() {
                    cell.textContent = this.value || '-';
                    updatePropertyField(cell);
                };
                
                input.onkeypress = function(e) {
                    if (e.key === 'Enter') {
                        this.blur();
                    }
                };
                
                cell.textContent = '';
                cell.appendChild(input);
                input.focus();
            }
        }
        
        // ë§¤ë¬¼ ìƒíƒœ í¸ì§‘
        function editPropertyStatus(button) {
            const currentStatus = button.textContent.trim();
            const newStatus = currentStatus === 'ê±°ë˜ê°€ëŠ¥' ? 'ê³„ì•½ì™„ë£Œ' : 'ê±°ë˜ê°€ëŠ¥';
            
            button.textContent = newStatus;
            button.className = `status-toggle ${newStatus === 'ê³„ì•½ì™„ë£Œ' ? 'status-completed' : 'status-trading'}`;
            
            // ìƒíƒœ ì—…ë°ì´íŠ¸
            const row = button.closest('tr');
            const id = row.dataset.propertyId;
            if (id) {
                updatePropertyField(button, 'status', newStatus);
            }
        }
        
        // ë§¤ë¬¼ ì‹¤ê±°ì£¼ ì—¬ë¶€ í¸ì§‘
        function editPropertyOccupied(button) {
            const currentOccupied = button.textContent.trim();
            const newOccupied = currentOccupied === 'O' ? 'X' : 'O';
            
            button.textContent = newOccupied;
            button.className = `occupied-toggle ${newOccupied === 'O' ? 'occupied-yes' : 'occupied-no'}`;
            
            // ìƒíƒœ ì—…ë°ì´íŠ¸
            const row = button.closest('tr');
            const id = row.dataset.propertyId;
            if (id) {
                updatePropertyField(button, 'is_occupied', newOccupied === 'O');
            }
        }
        
        // ë§¤ë¬¼ ì¢‹ì•„ìš”/ì‹«ì–´ìš” í¸ì§‘
        function editPropertyLikes(button, currentLikes, increment) {
            const countSpan = button.nextElementSibling;
            const newLikes = Math.min(5, Math.max(0, currentLikes + increment));
            countSpan.textContent = newLikes;
            
            // ìƒíƒœ ì—…ë°ì´íŠ¸
            const row = button.closest('tr');
            const id = row.dataset.propertyId;
            if (id) {
                updatePropertyField(button, 'likes', newLikes);
            }
        }
        
        function editPropertyDislikes(button, currentDislikes, increment) {
            const countSpan = button.nextElementSibling;
            const newDislikes = Math.min(5, Math.max(0, currentDislikes + increment));
            countSpan.textContent = newDislikes;
            
            // ìƒíƒœ ì—…ë°ì´íŠ¸
            const row = button.closest('tr');
            const id = row.dataset.propertyId;
            if (id) {
                updatePropertyField(button, 'dislikes', newDislikes);
            }
        }
        
        // ë§¤ë¬¼ ë©”ëª¨ í¸ì§‘
        function editPropertyMemo(button) {
            const row = button.closest('tr');
            const id = row.dataset.propertyId;
            
            if (id) {
                // ê¸°ì¡´ ë§¤ë¬¼ì˜ ë©”ëª¨ í¸ì§‘
                const memo = properties.find(p => p.id == id)?.memo || '';
                showMemoModal(id, memo);
            } else {
                // ìƒˆ ë§¤ë¬¼ì˜ ë©”ëª¨ í¸ì§‘
                const memo = prompt('ë©”ëª¨ë¥¼ ì…ë ¥í•˜ì„¸ìš”:');
                if (memo !== null) {
                    // ìƒˆ ë§¤ë¬¼ì˜ ë©”ëª¨ í•„ë“œ ì—…ë°ì´íŠ¸
                    const memoCell = row.querySelector('.memo-icon');
                    memoCell.textContent = memo ? 'ğŸ“' : 'ğŸ“';
                    memoCell.title = memo || 'ë©”ëª¨ ì—†ìŒ';
                }
            }
        }
        
        // ë§¤ë¬¼ í•„ë“œ ì—…ë°ì´íŠ¸
        function updatePropertyField(element, field, value) {
            const row = element.closest('tr');
            const id = row.dataset.propertyId;
            
            if (id) {
                // ê¸°ì¡´ ë§¤ë¬¼ ì—…ë°ì´íŠ¸
                updateField(id, field, value);
            }
        }
        
        // ë‚ ì§œ í¸ì§‘ (ì´ìœ ë‹¬ë ¥)
        function editDate(id, currentValue, cell) {
            // ê¸°ì¡´ ë‚´ìš© ì €ì¥
            const originalContent = cell.innerHTML;
            
            // ë‚ ì§œ ì…ë ¥ í•„ë“œ ìƒì„±
            const input = document.createElement('input');
            input.type = 'date';
            input.value = currentValue || '';
            input.className = 'date-picker';
            input.style.width = '100%';
            input.style.padding = '8px';
            input.style.border = '2px solid #3b82f6';
            input.style.borderRadius = '6px';
            input.style.outline = 'none';
            
            // ì…€ ë‚´ìš© êµì²´
            cell.innerHTML = '';
            cell.appendChild(input);
            
            // í¬ì»¤ìŠ¤ ë° ë‹¬ë ¥ ë°”ë¡œ ì—´ê¸° (ì§€ì›ë˜ëŠ” ë¸Œë¼ìš°ì €)
            input.focus();
            try {
                if (typeof input.showPicker === 'function') {
                    // ì…ë ¥ í•„ë“œê°€ DOMì— ë¶™ê³  í¬ì»¤ìŠ¤ëœ ì§í›„ í˜¸ì¶œí•´ì•¼ ì—´ë¦¼
                    setTimeout(() => {
                        try { input.showPicker(); } catch (e) {}
                    }, 0);
                }
            } catch (e) {}
            
            // ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬
            function handleChange() {
                const newValue = input.value;
                
                // ì›ë˜ ë‚´ìš©ìœ¼ë¡œ ë³µì›
                cell.innerHTML = newValue || '-';
                
                // ê°’ì´ ë³€ê²½ëœ ê²½ìš°ì—ë§Œ ì—…ë°ì´íŠ¸
                if (newValue !== currentValue && newValue) {
                    if (id) {
                        updateField(id, 'check_date', newValue);
                    } else {
                        // ìƒˆ í–‰ì¸ ê²½ìš° ì…€ ê°’ë§Œ ì—…ë°ì´íŠ¸
                        cell.textContent = newValue;
                    }
                } else if (!newValue) {
                    cell.textContent = currentValue || '-';
                }
                
                // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì œê±°
                document.removeEventListener('click', handleOutsideClick);
            }
            
            function handleOutsideClick(e) {
                if (e.target !== input) {
                    handleChange();
                }
            }
            
            // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ë“±ë¡
            input.addEventListener('change', handleChange);
            input.addEventListener('blur', handleChange);
            input.addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    handleChange();
                }
            });
            
            // ì™¸ë¶€ í´ë¦­ ê°ì§€ (ë‹¤ìŒ í´ë¦­ë¶€í„°)
            setTimeout(() => {
                document.addEventListener('click', handleOutsideClick);
            }, 0);
        }
        
        // ìˆ«ì í¸ì§‘ (ë™/í˜¸ìˆ˜)
        function editNumber(id, field, currentValue, cell) {
            // ê¸°ì¡´ ë‚´ìš© ì €ì¥
            const originalContent = cell.innerHTML;
            
            // ì…ë ¥ í•„ë“œ ìƒì„±
            const input = document.createElement('input');
            input.type = 'number';
            input.value = currentValue || '';
            input.className = 'number-input';
            input.style.width = '100%';
            input.style.padding = '8px';
            input.style.border = '2px solid #3b82f6';
            input.style.borderRadius = '6px';
            input.style.outline = 'none';
            input.min = '1';
            
            // ì…€ ë‚´ìš© êµì²´
            cell.innerHTML = '';
            cell.appendChild(input);
            
            // í¬ì»¤ìŠ¤
            input.focus();
            
            // ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬
            function handleChange() {
                const newValue = input.value;
                
                // ì›ë˜ ë‚´ìš©ìœ¼ë¡œ ë³µì›
                cell.innerHTML = newValue || '-';
                
                // ê°’ì´ ë³€ê²½ëœ ê²½ìš°ì—ë§Œ ì—…ë°ì´íŠ¸
                if (newValue !== currentValue) {
                    if (id) {
                        updateField(id, field, newValue);
                    } else {
                        // ìƒˆ í–‰ì¸ ê²½ìš° ì…€ ê°’ë§Œ ì—…ë°ì´íŠ¸
                        cell.textContent = newValue;
                    }
                } else if (!newValue) {
                    cell.textContent = currentValue || '-';
                }
                
                // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì œê±°
                document.removeEventListener('click', handleOutsideClick);
            }
            
            function handleOutsideClick(e) {
                if (e.target !== input) {
                    handleChange();
                }
            }
            
            // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ë“±ë¡
            input.addEventListener('change', handleChange);
            input.addEventListener('blur', handleChange);
            input.addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    handleChange();
                }
            });
            
            // ì™¸ë¶€ í´ë¦­ ê°ì§€ (ë‹¤ìŒ í´ë¦­ë¶€í„°)
            setTimeout(() => {
                document.addEventListener('click', handleOutsideClick);
            }, 0);
        }
        
            // ê°€ê²© í¸ì§‘ (ì „ì„¸/ì›”ì„¸ë³´ì¦ê¸ˆ/ì›”ì„¸/ë§¤ë§¤)
        function editPrice(id, field, currentValue, cell) {
            // ê¸°ì¡´ ë‚´ìš© ì €ì¥
            const originalContent = cell.innerHTML;
            
            // ì…ë ¥ í•„ë“œ ìƒì„±
            const input = document.createElement('input');
            input.type = 'text';
            const rawInit = (currentValue || '').toString().replace(/[^\d]/g, '');
            input.value = rawInit ? formatNumber(rawInit) : '';
            input.className = 'price-input';
            input.style.width = '100%';
            input.style.padding = '8px';
            input.style.border = '2px solid #3b82f6';
            input.style.borderRadius = '6px';
            input.style.outline = 'none';
            input.placeholder = 'ë§Œì› ë‹¨ìœ„';
            
            // ì…€ ë‚´ìš© êµì²´
            cell.innerHTML = '';
            cell.appendChild(input);
            
            // í¬ì»¤ìŠ¤
            input.focus();

                // ì…ë ¥ ì‹œ ì²œë‹¨ìœ„ ì½¤ë§ˆ ë§ˆìŠ¤í‚¹
                input.addEventListener('input', function() {
                    const before = this.value;
                    const raw = before.replace(/[^\d]/g, '');
                    const formatted = raw ? formatNumber(raw) : '';
                    this.value = formatted;
                });
            
            // ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬
            function handleChange() {
                const newValueRaw = input.value.replace(/[^\d]/g, '');
                
                // ì›ë˜ ë‚´ìš©ìœ¼ë¡œ ë³µì›
                if (newValueRaw) {
                    if (field === 'deposit') {
                        cell.innerHTML = formatNumber(newValueRaw) + ' ë§Œì›';
                    } else {
                        cell.innerHTML = formatNumber(newValueRaw) + ' ë§Œì›';
                    }
                } else {
                    cell.innerHTML = '-';
                }
                
                // ê°’ì´ ë³€ê²½ëœ ê²½ìš°ì—ë§Œ ì—…ë°ì´íŠ¸
                const currentNumeric = (currentValue || '').toString().replace(/[^\d]/g, '');
                if (newValueRaw !== currentNumeric) {
                    if (id) {
                        updateField(id, field, newValueRaw || null);
                    }
                }
                
                // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì œê±°
                document.removeEventListener('click', handleOutsideClick);
            }
            
            function handleOutsideClick(e) {
                if (e.target !== input) {
                    handleChange();
                }
            }
            
            // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ë“±ë¡
            input.addEventListener('change', handleChange);
            input.addEventListener('blur', handleChange);
            input.addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    handleChange();
                }
            });
            
            // ì™¸ë¶€ í´ë¦­ ê°ì§€ (ë‹¤ìŒ í´ë¦­ë¶€í„°)
            setTimeout(() => {
                document.addEventListener('click', handleOutsideClick);
            }, 0);
        }
        
        // ì „í™”ë²ˆí˜¸ í¸ì§‘
        function editPhone(id, currentValue, cell) {
            // ê¸°ì¡´ ë‚´ìš© ì €ì¥
            const originalContent = cell.innerHTML;
            
            // ì…ë ¥ í•„ë“œ ìƒì„±
            const input = document.createElement('input');
            input.type = 'tel';
            input.value = currentValue || '';
            input.className = 'phone-input';
            input.style.width = '100%';
            input.style.padding = '8px';
            input.style.border = '2px solid #3b82f6';
            input.style.borderRadius = '6px';
            input.style.outline = 'none';
            input.placeholder = '000-0000-0000';
            input.maxLength = 13;
            
            // ì…€ ë‚´ìš© êµì²´
            cell.innerHTML = '';
            cell.appendChild(input);
            
            // í¬ì»¤ìŠ¤
            input.focus();
            
            // ì „í™”ë²ˆí˜¸ í¬ë§·íŒ… í•¨ìˆ˜
            function formatPhoneNumber(value) {
                if (!value) return '';
                
                // ìˆ«ìë§Œ ì¶”ì¶œ
                const numbers = value.replace(/\D/g, '');
                
                // í¬ë§·íŒ…
                if (numbers.length <= 3) {
                    return numbers;
                } else if (numbers.length <= 7) {
                    return numbers.slice(0, 3) + '-' + numbers.slice(3);
                } else {
                    return numbers.slice(0, 3) + '-' + numbers.slice(3, 7) + '-' + numbers.slice(7, 11);
                }
            }
            
            // ì…ë ¥ ì‹œ ìë™ í¬ë§·íŒ…
            input.addEventListener('input', function() {
                const formatted = formatPhoneNumber(input.value);
                input.value = formatted;
            });
            
            // ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬
            function handleChange() {
                const newValue = input.value;
                
                // ì›ë˜ ë‚´ìš©ìœ¼ë¡œ ë³µì›
                cell.innerHTML = newValue || '-';
                
                // ê°’ì´ ë³€ê²½ëœ ê²½ìš°ì—ë§Œ ì—…ë°ì´íŠ¸
                if (newValue !== currentValue) {
                    if (id) {
                        updateField(id, 'phone', newValue);
                    }
                }
                
                // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì œê±°
                document.removeEventListener('click', handleOutsideClick);
            }
            
            function handleOutsideClick(e) {
                if (e.target !== input) {
                    handleChange();
                }
            }
            
            // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ë“±ë¡
            input.addEventListener('change', handleChange);
            input.addEventListener('blur', handleChange);
            input.addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    handleChange();
                }
            });
            
            // ì™¸ë¶€ í´ë¦­ ê°ì§€ (ë‹¤ìŒ í´ë¦­ë¶€í„°)
            setTimeout(() => {
                document.addEventListener('click', handleOutsideClick);
            }, 0);
        }
        
        // í˜„í™© ì˜µì…˜ í‘œì‹œ
        function showStatusOptions(id, currentStatus, button) {
            // ê¸°ì¡´ íŒì—… ì œê±°
            removeAllPopups();
            
            // íŒì—… ë©”ë‰´ ìƒì„±
            const popup = document.createElement('div');
            popup.className = 'popup-menu';
            popup.style.position = 'absolute';
            popup.style.left = '0';
            popup.style.top = '100%';
            popup.style.zIndex = '1000';
            
            // ì˜µì…˜ ì¶”ê°€
            const statuses = ['ê±°ë˜ê°€ëŠ¥', 'ê³„ì•½ì™„ë£Œ', 'ë³´ë¥˜', 'ë¶€ì¬'];
            statuses.forEach(status => {
                const item = document.createElement('div');
                item.className = 'popup-menu-item' + (status === currentStatus ? ' active' : '');
                item.textContent = status;
                
                item.addEventListener('click', function() {
                    // ë²„íŠ¼ ì—…ë°ì´íŠ¸
                    button.textContent = status;
                    const statusClass = status === 'ê³„ì•½ì™„ë£Œ' ? 'status-completed' : status === 'ë³´ë¥˜' ? 'status-hold' : status === 'ë¶€ì¬' ? 'status-absent' : 'status-available';
                    button.className = `status-toggle ${statusClass}`;
                    
                    // ì„œë²„ ì—…ë°ì´íŠ¸
                    if (id) {
                        updateField(id, 'status', status);
                    }
                    
                    // íŒì—… ë‹«ê¸°
                    document.body.removeChild(popup);
                });
                
                popup.appendChild(item);
            });
            
            // íŒì—… ìœ„ì¹˜ ì¡°ì •
            const rect = button.getBoundingClientRect();
            popup.style.top = (rect.bottom + window.scrollY) + 'px';
            popup.style.left = (rect.left + window.scrollX) + 'px';
            popup.style.minWidth = rect.width + 'px';
            
            // ë¬¸ì„œì— ì¶”ê°€
            document.body.appendChild(popup);
            
            // ì™¸ë¶€ í´ë¦­ ì‹œ ë‹«ê¸°
            setTimeout(() => {
                document.addEventListener('click', function closePopup(e) {
                    if (!popup.contains(e.target) && e.target !== button) {
                        if (document.body.contains(popup)) {
                            document.body.removeChild(popup);
                        }
                        document.removeEventListener('click', closePopup);
                    }
                });
            }, 0);
        }
        
        // ì¢‹ì•„ìš” ì˜µì…˜ í‘œì‹œ
        function showLikeOptions(id, currentValue, element) {
            // ê¸°ì¡´ íŒì—… ì œê±°
            removeAllPopups();
            
            // íŒì—… ìƒì„±
            const popup = document.createElement('div');
            popup.className = 'rating-popup';
            popup.style.position = 'absolute';
            popup.style.background = 'white';
            popup.style.border = '1px solid #e2e8f0';
            popup.style.borderRadius = '8px';
            popup.style.boxShadow = '0 4px 6px rgba(0, 0, 0, 0.1)';
            popup.style.zIndex = '1000';
            
            // ì˜µì…˜ ì¶”ê°€ (0-5)
            for (let i = 0; i <= 5; i++) {
                const option = document.createElement('div');
                option.className = 'rating-option' + (i === currentValue ? ' active' : '');
                option.innerHTML = i === 0 ? 'ğŸ¤' : 'â¤ï¸'.repeat(i);
                option.style.padding = '8px';
                option.style.cursor = 'pointer';
                option.style.borderRadius = '4px';
                
                if (i === currentValue) {
                    option.style.background = '#e0f2fe';
                }
                
                option.addEventListener('mouseenter', function() {
                    this.style.background = '#f0f9ff';
                });
                
                option.addEventListener('mouseleave', function() {
                    if (i !== currentValue) {
                        this.style.background = '';
                    } else {
                        this.style.background = '#e0f2fe';
                    }
                });
                
                option.addEventListener('click', function() {
                    // ì—˜ë¦¬ë¨¼íŠ¸ ì—…ë°ì´íŠ¸
                    element.innerHTML = i === 0 ? 'ğŸ¤' : 'â¤ï¸'.repeat(i);
                    
                    // ì„œë²„ ì—…ë°ì´íŠ¸
                    if (id) {
                        updateField(id, 'likes', i);
                    }
                    
                    // íŒì—… ë‹«ê¸°
                    document.body.removeChild(popup);
                });
                
                popup.appendChild(option);
            }
            
            // íŒì—… ìœ„ì¹˜ ì¡°ì •
            const rect = element.getBoundingClientRect();
            popup.style.top = (rect.bottom + window.scrollY) + 'px';
            popup.style.left = (rect.left + window.scrollX) + 'px';
            
            // ë¬¸ì„œì— ì¶”ê°€
            document.body.appendChild(popup);
            
            // ì™¸ë¶€ í´ë¦­ ì‹œ ë‹«ê¸°
            setTimeout(() => {
                document.addEventListener('click', function closePopup(e) {
                    if (!popup.contains(e.target) && e.target !== element) {
                        if (document.body.contains(popup)) {
                            document.body.removeChild(popup);
                        }
                        document.removeEventListener('click', closePopup);
                    }
                });
            }, 0);
        }
        
        // ì‹«ì–´ìš” ì˜µì…˜ í‘œì‹œ
        function showDislikeOptions(id, currentValue, element) {
            // ê¸°ì¡´ íŒì—… ì œê±°
            removeAllPopups();
            
            // íŒì—… ìƒì„±
            const popup = document.createElement('div');
            popup.className = 'rating-popup';
            popup.style.position = 'absolute';
            popup.style.background = 'white';
            popup.style.border = '1px solid #e2e8f0';
            popup.style.borderRadius = '8px';
            popup.style.boxShadow = '0 4px 6px rgba(0, 0, 0, 0.1)';
            popup.style.zIndex = '1000';
            
            // ì˜µì…˜ ì¶”ê°€ (0-5)
            for (let i = 0; i <= 5; i++) {
                const option = document.createElement('div');
                option.className = 'rating-option' + (i === currentValue ? ' active' : '');
                option.innerHTML = i === 0 ? 'ğŸ¤' : 'ğŸ‘'.repeat(i);
                option.style.padding = '8px';
                option.style.cursor = 'pointer';
                option.style.borderRadius = '4px';
                
                if (i === currentValue) {
                    option.style.background = '#e0f2fe';
                }
                
                option.addEventListener('mouseenter', function() {
                    this.style.background = '#f0f9ff';
                });
                
                option.addEventListener('mouseleave', function() {
                    if (i !== currentValue) {
                        this.style.background = '';
                    } else {
                        this.style.background = '#e0f2fe';
                    }
                });
                
                option.addEventListener('click', function() {
                    // ì—˜ë¦¬ë¨¼íŠ¸ ì—…ë°ì´íŠ¸
                    element.innerHTML = i === 0 ? 'ğŸ¤' : 'ğŸ‘'.repeat(i);
                    
                    // ì„œë²„ ì—…ë°ì´íŠ¸
                    if (id) {
                        updateField(id, 'dislikes', i);
                    }
                    
                    // íŒì—… ë‹«ê¸°
                    document.body.removeChild(popup);
                });
                
                popup.appendChild(option);
            }
            
            // íŒì—… ìœ„ì¹˜ ì¡°ì •
            const rect = element.getBoundingClientRect();
            popup.style.top = (rect.bottom + window.scrollY) + 'px';
            popup.style.left = (rect.left + window.scrollX) + 'px';
            
            // ë¬¸ì„œì— ì¶”ê°€
            document.body.appendChild(popup);
            
            // ì™¸ë¶€ í´ë¦­ ì‹œ ë‹«ê¸°
            setTimeout(() => {
                document.addEventListener('click', function closePopup(e) {
                    if (!popup.contains(e.target) && e.target !== element) {
                        if (document.body.contains(popup)) {
                            document.body.removeChild(popup);
                        }
                        document.removeEventListener('click', closePopup);
                    }
                });
            }, 0);
        }
        
        // ëª¨ë“  íŒì—… ì œê±°
        function removeAllPopups() {
            const popups = document.querySelectorAll('.popup-menu, .rating-popup');
            popups.forEach(popup => {
                if (document.body.contains(popup)) {
                    document.body.removeChild(popup);
                }
            });
        }
        

        
        // ì„±ê³µ ë©”ì‹œì§€ í‘œì‹œ
        function showSuccess(message) {
            alert(message); // ê°„ë‹¨í•œ ì•Œë¦¼ìœ¼ë¡œ ëŒ€ì²´
        }
        
        // ì—ëŸ¬ ë©”ì‹œì§€ í‘œì‹œ
        function showError(message) {
            alert(message); // ê°„ë‹¨í•œ ì•Œë¦¼ìœ¼ë¡œ ëŒ€ì²´
        }
        
        // ëª¨ë‹¬ ì™¸ë¶€ í´ë¦­ ì‹œ ë‹«ê¸°
        window.onclick = function(event) {
            const memoModal = document.getElementById('memoModal');
            const addModal = document.getElementById('addModal');
            
            if (event.target === memoModal) {
                closeMemoModal();
            }
            if (event.target === addModal) {
                closeAddModal();
            }
        }
    </script>
</body>
</html>
