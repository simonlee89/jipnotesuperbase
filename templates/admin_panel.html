<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>관리자 패널 - 집노트 CRM</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap');
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: #f8fafc;
            color: #1a202c;
            line-height: 1.6;
            min-height: 100vh;
        }
        
        .app-container {
            display: flex;
            height: 100vh;
        }
        
        /* 사이드바 */
        .sidebar {
            width: 260px;
            background: #ffffff;
            border-right: 1px solid #e2e8f0;
            display: flex;
            flex-direction: column;
            position: fixed;
            height: 100vh;
            z-index: 1000;
        }
        
        .sidebar-header {
            padding: 24px 20px;
            border-bottom: 1px solid #e2e8f0;
        }
        
        .logo {
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .logo-icon {
            width: 40px;
            height: 40px;
            background: linear-gradient(135deg, #6366f1, #8b5cf6);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
        }
        
        .logo-text {
            font-size: 18px;
            font-weight: 700;
            color: #1a202c;
        }
        
        .sidebar-nav {
            flex: 1;
            padding: 20px 0;
        }
        
        .nav-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px 20px;
            color: #64748b;
            text-decoration: none;
            font-weight: 500;
            font-size: 14px;
            transition: all 0.2s ease;
            border-left: 3px solid transparent;
        }
        
        .nav-item:hover {
            background: #f1f5f9;
            color: #6366f1;
        }
        
        .nav-item.active {
            background: #f1f5f9;
            color: #6366f1;
            border-left-color: #6366f1;
        }
        
        .nav-icon {
            width: 20px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        /* 메이플관리 수정/완료 버튼 스타일 */
        .edit-controls {
            display: flex;
            gap: 4px;
            align-items: center;
        }
        
        .edit-controls .btn {
            font-size: 11px;
            padding: 4px 8px;
            border-radius: 4px;
            border: none;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        /* 탭 버튼 스타일 */
        .tab-btn {
            background: none;
            border: none;
            padding: 12px 16px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            color: #64748b;
            border-bottom: 2px solid transparent;
            transition: all 0.2s ease;
            margin-right: 8px;
        }
        
        .tab-btn:hover {
            color: #1e293b;
            background: rgba(59, 130, 246, 0.05);
        }
        
        .tab-btn.active {
            color: #3b82f6;
            border-bottom-color: #3b82f6;
            background: rgba(59, 130, 246, 0.05);
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        .edit-controls .edit-btn {
            background-color: #3b82f6;
            color: white;
        }
        
        .edit-controls .edit-btn:hover {
            background-color: #2563eb;
        }
        
        .edit-controls .save-btn {
            background-color: #10b981;
            color: white;
        }
        
        .edit-controls .save-btn:hover {
            background-color: #059669;
        }
        
        .edit-controls .cancel-btn {
            background-color: #6b7280;
            color: white;
        }
        
        .edit-controls .cancel-btn:hover {
            background-color: #4b5563;
        }
        
        /* 편집 중인 셀 스타일 */
        .editing {
            background-color: #fef3c7 !important;
            border: 2px solid #f59e0b !important;
            padding: 2px !important;
        }
        
        .editing input, .editing select, .editing textarea {
            border: 1px solid #d97706;
            background-color: #fffbeb;
            font-size: 12px;
        }
        
        .edit-input {
            width: 100%;
            padding: 4px;
            border: 1px solid #d1d5db;
            border-radius: 4px;
        }
        
        .edit-input:focus {
            outline: none;
            border-color: #3b82f6;
            box-shadow: 0 0 0 2px rgba(59, 130, 246, 0.1);
        }
        
        /* 현황 선택 버튼 스타일 (직원페이지 방식) */
        .status-selector {
            padding: 8px;
        }
        
        .status-options {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 6px;
        }
        
        .status-option {
            display: flex;
            align-items: center;
            gap: 6px;
            padding: 8px 12px;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            background: #ffffff;
            cursor: pointer;
            transition: all 0.2s ease;
            font-size: 12px;
        }
        
        .status-option:hover {
            background: #f8fafc;
            border-color: #cbd5e1;
        }
        
        .status-option.active {
            background: #3b82f6;
            color: white;
            border-color: #3b82f6;
        }
        
        .status-icon {
            font-size: 14px;
        }
        
        .status-text {
            font-weight: 500;
        }
        
        /* 편집 중인 셀 스타일 */
        .editing-cell {
            background-color: #fef3c7 !important;
            border: 2px solid #f59e0b !important;
            padding: 2px !important;
        }
        
        /* 수정 모드 활성화된 행 스타일 */
        .edit-mode {
            background-color: #f0f9ff !important;
        }
        
        .edit-mode .editable-cell {
            transition: all 0.2s ease;
        }
        
        .edit-mode .editable-cell:hover {
            background-color: #dbeafe !important;
            transform: scale(1.02);
        }
        
        /* 실거주 여부 선택 버튼 스타일 */
        .occupied-selector {
            padding: 8px;
        }
        
        .occupied-options {
            display: flex;
            gap: 8px;
        }
        
        .occupied-option {
            display: flex;
            align-items: center;
            gap: 6px;
            padding: 8px 12px;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            background: #ffffff;
            cursor: pointer;
            transition: all 0.2s ease;
            font-size: 12px;
            flex: 1;
        }
        
        .occupied-option:hover {
            background: #f8fafc;
            border-color: #cbd5e1;
        }
        
        .occupied-option.active {
            background: #10b981;
            color: white;
            border-color: #10b981;
        }
        
        /* 좋아요/싫어요 선택 버튼 스타일 */
        .likes-selector, .dislikes-selector {
            padding: 8px;
        }
        
        .likes-options, .dislikes-options {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 4px;
        }
        
        .likes-option, .dislikes-option {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 4px;
            padding: 6px 4px;
            border: 1px solid #e2e8f0;
            border-radius: 6px;
            background: #ffffff;
            cursor: pointer;
            transition: all 0.2s ease;
            font-size: 11px;
        }
        
        .likes-option:hover, .dislikes-option:hover {
            background: #f8fafc;
            border-color: #cbd5e1;
        }
        
        .likes-option.active {
            background: #ec4899;
            color: white;
            border-color: #ec4899;
        }
        
        .dislikes-option.active {
            background: #ef4444;
            color: white;
            border-color: #ef4444;
        }
        
        .likes-icon, .dislikes-icon {
            font-size: 14px;
        }
        
        .likes-text, .dislikes-text {
            font-weight: 500;
        }
        
        /* 메모 셀 스타일 */
        .memo-cell:hover {
            background-color: #f8fafc !important;
            border: 1px solid #3b82f6 !important;
        }
        
        .memo-cell:hover .memo-icon {
            transform: scale(1.1);
        }
        
        /* 매물 메모 모달 스타일 (직원페이지와 동일) */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }
        
        .modal-overlay.active {
            opacity: 1;
            visibility: visible;
        }
        
        .modal-overlay .modal-content {
            background: #ffffff;
            border-radius: 16px;
            width: 90%;
            max-width: 500px;
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
            transform: scale(0.9);
            transition: transform 0.3s ease;
        }
        
        .modal-overlay.active .modal-content {
            transform: scale(1);
        }
        
        .modal-overlay .modal-header {
            padding: 20px 24px;
            border-bottom: 1px solid #e2e8f0;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        
        .modal-overlay .modal-title {
            margin: 0;
            font-size: 18px;
            font-weight: 600;
            color: #1f2937;
        }
        
        .modal-overlay .modal-close {
            background: none;
            border: none;
            font-size: 24px;
            color: #6b7280;
            cursor: pointer;
            padding: 4px;
            border-radius: 4px;
            transition: all 0.2s ease;
        }
        
        .modal-overlay .modal-close:hover {
            background: #f1f5f9;
            color: #374151;
        }
        
        .modal-overlay .modal-body {
            padding: 24px;
        }
        
        .memo-textarea {
            width: 100%;
            border: 1px solid #e2e8f0;
            border-radius: 12px;
            padding: 12px 16px;
            font-size: 14px;
            font-family: inherit;
            resize: vertical;
            min-height: 120px;
            transition: all 0.2s ease;
            outline: none;
        }
        
        .memo-textarea:focus {
            border-color: #6366f1;
            box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);
        }
        
        .memo-info {
            margin-bottom: 16px;
            padding: 12px;
            background: #f8fafc;
            border-radius: 8px;
        }
        
        .memo-property-info {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .memo-label {
            font-weight: 500;
            color: #374151;
            font-size: 14px;
        }
        
        .memo-value {
            color: #6366f1;
            font-weight: 600;
            font-size: 14px;
        }
        
        .modal-overlay .modal-footer {
            padding: 16px 24px;
            border-top: 1px solid #e2e8f0;
            display: flex;
            justify-content: flex-end;
            gap: 12px;
        }
        
        .modal-overlay .btn {
            padding: 8px 16px;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            border: none;
            transition: all 0.2s ease;
        }
        
        .modal-overlay .btn-secondary {
            background: #f8fafc;
            color: #64748b;
            border: 1px solid #e2e8f0;
        }
        
        .modal-overlay .btn-secondary:hover {
            background: #e2e8f0;
            color: #475569;
        }
        
        .modal-overlay .btn-primary {
            background: #6366f1;
            color: white;
        }
        
        .modal-overlay .btn-primary:hover {
            background: #5855eb;
        }
        
        /* 메인 컨텐츠 */
        .main-content {
            flex: 1;
            margin-left: 260px;
            display: flex;
            flex-direction: column;
        }
        
        .header {
            background: #ffffff;
            border-bottom: 1px solid #e2e8f0;
            padding: 16px 32px;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        
        .header-left {
            display: flex;
            align-items: center;
            gap: 20px;
        }
        
        .search-box {
            position: relative;
        }
        
        .search-input {
            width: 300px;
            padding: 10px 16px 10px 40px;
            border: 1px solid #e2e8f0;
            border-radius: 12px;
            background: #f8fafc;
            font-size: 14px;
            outline: none;
            transition: all 0.2s ease;
        }
        
        .search-input:focus {
            border-color: #6366f1;
            background: #ffffff;
            box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);
        }
        
        .search-icon {
            position: absolute;
            left: 12px;
            top: 50%;
            transform: translateY(-50%);
            color: #9ca3af;
        }
        
        .header-right {
            display: flex;
            align-items: center;
            gap: 16px;
        }
        
        /* 사이트 전환 드롭다운 */
        .site-switcher {
            position: relative;
        }
        
        .site-switcher-btn {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 10px 16px;
            background: linear-gradient(135deg, #6366f1, #8b5cf6);
            color: white;
            border: none;
            border-radius: 12px;
            font-weight: 600;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.2s ease;
            box-shadow: 0 2px 4px rgba(99, 102, 241, 0.3);
        }
        
        .site-switcher-btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 8px rgba(99, 102, 241, 0.4);
        }
        
        .site-switcher-btn::after {
            content: '▼';
            font-size: 10px;
            margin-left: 4px;
            transition: transform 0.2s ease;
        }
        
        .site-switcher.active .site-switcher-btn::after {
            transform: rotate(180deg);
        }

        /* 대시보드 통계 카드 스타일 */
        .dashboard-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 24px;
            margin-bottom: 32px;
        }

        .stat-card {
            background: #ffffff;
            border: 1px solid #e2e8f0;
            border-radius: 16px;
            padding: 24px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
            transition: all 0.2s ease;
        }

        .stat-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }

        .stat-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
        }

        .stat-title {
            font-size: 16px;
            font-weight: 600;
            color: #64748b;
            margin: 0;
        }

        .stat-icon {
            width: 40px;
            height: 40px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
        }

        .stat-value {
            font-size: 32px;
            font-weight: 700;
            color: #1a202c;
            margin-bottom: 8px;
        }

        .stat-change {
            font-size: 14px;
            color: #64748b;
        }

        /* 모달 스타일 */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
        }
        
        .modal-content {
            background-color: #fefefe;
            margin: 5% auto;
            padding: 0;
            border: 1px solid #888;
            width: 90%;
            max-width: 500px;
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);
        }
        
        .modal-header {
            padding: 20px 24px;
            border-bottom: 1px solid #e2e8f0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .modal-header h3 {
            margin: 0;
            color: #1a202c;
            font-size: 18px;
            font-weight: 600;
        }
        
        .close {
            color: #aaa;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
            line-height: 1;
        }
        
        .close:hover,
        .close:focus {
            color: #000;
        }
        
        .modal-body {
            padding: 24px;
        }
        
        .modal-footer {
            padding: 20px 24px;
            border-top: 1px solid #e2e8f0;
            display: flex;
            justify-content: flex-end;
            gap: 12px;
        }
        
        /* 팀 섹션 스타일 */
        .team-section {
            margin-bottom: 16px;
        }
        
        .team-section h4 {
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 12px;
        }

        /* 필터 섹션 스타일 */
        .filter-section {
            padding: 16px 24px;
            border-bottom: 1px solid #e2e8f0;
            background: #ffffff;
            display: flex;
            gap: 24px;
            flex-wrap: wrap;
            align-items: center;
        }

        .filter-group {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .filter-label {
            font-size: 14px;
            font-weight: 600;
            color: #64748b;
            white-space: nowrap;
        }

        .filter-buttons {
            display: flex;
            gap: 8px;
        }

        .filter-btn {
            padding: 8px 16px;
            border: 1px solid #e2e8f0;
            background: #ffffff;
            color: #64748b;
            border-radius: 20px;
            font-size: 12px;
            cursor: pointer;
            transition: all 0.2s ease;
            font-weight: 500;
        }

        .filter-btn:hover {
            border-color: #6366f1;
            color: #6366f1;
        }

        .filter-btn.active {
            background: #6366f1;
            color: #ffffff;
            border-color: #6366f1;
        }

        /* 테이블 컨테이너 스타일 */
        .table-container {
            overflow-x: auto;
            padding: 0 24px;
        }

        .data-table {
            width: 100%;
            border-collapse: collapse;
            margin: 0;
        }

        .data-table th {
            background: #f8fafc;
            padding: 16px 12px;
            text-align: left;
            font-weight: 600;
            color: #374151;
            border-bottom: 1px solid #e2e8f0;
            font-size: 14px;
        }

        .data-table td {
            padding: 16px 12px;
            border-bottom: 1px solid #f1f5f9;
            color: #374151;
            font-size: 14px;
        }

        .data-table tbody tr:hover {
            background: #f8fafc;
        }

        /* 상태 배지 스타일 */
        .status-badge {
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 500;
            text-align: center;
            display: inline-block;
        }

        .status-badge.progress {
            background: #fef3c7;
            color: #f59e0b;
        }

        .status-badge.completed {
            background: #dcfce7;
            color: #16a34a;
        }

        .status-badge.pending {
            background: #f1f5f9;
            color: #64748b;
        }

        /* 페이지네이션 스타일 */
        .pagination {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 8px;
            margin-top: 24px;
            padding: 20px;
        }

        .pagination .btn {
            padding: 8px 12px;
            border: 1px solid #e2e8f0;
            background: #ffffff;
            color: #64748b;
            border-radius: 8px;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .pagination .btn:hover {
            border-color: #6366f1;
            color: #6366f1;
        }

        .pagination .btn.btn-primary {
            background: #6366f1;
            color: #ffffff;
            border-color: #6366f1;
        }
        
        .site-dropdown {
            position: absolute;
            top: 100%;
            right: 0;
            margin-top: 8px;
            min-width: 220px;
            background: white;
            border: 1px solid #e2e8f0;
            border-radius: 12px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
            opacity: 0;
            visibility: hidden;
            transform: translateY(-10px);
            transition: all 0.2s ease;
            z-index: 1000;
        }
        
        .site-switcher.active .site-dropdown {
            opacity: 1;
            visibility: visible;
            transform: translateY(0);
        }
        
        .dropdown-header {
            padding: 16px;
            border-bottom: 1px solid #e2e8f0;
            font-weight: 600;
            color: #1a202c;
            font-size: 14px;
        }
        
        .dropdown-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px 16px;
            color: #374151;
            text-decoration: none;
            font-size: 14px;
            transition: all 0.2s ease;
            border-left: 3px solid transparent;
        }
        
        .dropdown-item:hover {
            background: #f9fafb;
            color: #6366f1;
            border-left-color: #6366f1;
        }
        
        .dropdown-item .item-icon {
            width: 20px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
        }
        
        .dropdown-item .item-info {
            flex: 1;
        }
        
        .dropdown-item .item-title {
            font-weight: 500;
            margin-bottom: 2px;
        }
        
        .dropdown-item .item-desc {
            font-size: 12px;
            color: #9ca3af;
        }
        
        .dropdown-item .item-badge {
            padding: 2px 8px;
            background: #fef3c7;
            color: #d97706;
            border-radius: 6px;
            font-size: 11px;
            font-weight: 600;
        }
        
        .dropdown-item.residential .item-badge {
            background: #dbeafe;
            color: #2563eb;
        }
        
        .dropdown-item.business .item-badge {
            background: #fef3c7;
            color: #d97706;
        }
        
        .user-profile {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 8px 12px;
            border-radius: 12px;
            background: #f8fafc;
        }
        
        .user-avatar {
            width: 32px;
            height: 32px;
            background: linear-gradient(135deg, #6366f1, #8b5cf6);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 600;
            font-size: 14px;
        }
        
        .user-info {
            display: flex;
            flex-direction: column;
        }
        
        .user-name {
            font-size: 14px;
            font-weight: 600;
            color: #1a202c;
        }
        
        .user-email {
            font-size: 12px;
            color: #64748b;
        }
        
        /* 컨텐츠 영역 */
        .content {
            flex: 1;
            padding: 32px;
            overflow-y: auto;
        }
        
        .page-header {
            margin-bottom: 32px;
        }
        
        .page-title {
            font-size: 28px;
            font-weight: 700;
            color: #1a202c;
            margin-bottom: 8px;
        }
        
        .page-subtitle {
            font-size: 16px;
            color: #64748b;
        }
        
        .card {
            background: #ffffff;
            border-radius: 16px;
            padding: 24px;
            margin-bottom: 24px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
            border: 1px solid #e2e8f0;
        }
        
        .card-header {
            display: flex;
            align-items: center;
            justify-content: between;
            margin-bottom: 20px;
        }
        
        .card-title {
            font-size: 18px;
            font-weight: 600;
            color: #1a202c;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .add-employee-form {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr auto;
            gap: 16px;
            align-items: end;
            margin-bottom: 24px;
        }
        
        .form-group {
            display: flex;
            flex-direction: column;
        }
        
        .form-label {
            font-size: 14px;
            font-weight: 500;
            color: #374151;
            margin-bottom: 6px;
        }
        
        .form-input, .form-select {
            padding: 14px 16px;
            border: 1px solid #e2e8f0;
            border-radius: 12px;
            font-size: 14px;
            background: #ffffff;
            transition: all 0.2s ease;
            outline: none;
        }
        
        .form-input:focus, .form-select:focus {
            border-color: #6366f1;
            box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);
        }
        
        .btn {
            padding: 14px 20px;
            border: none;
            border-radius: 12px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            text-decoration: none;
        }
        
        .btn-primary {
            background: #6366f1;
            color: white;
        }
        
        .btn-primary:hover {
            background: #5855eb;
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(99, 102, 241, 0.3);
        }
        
        .btn-secondary {
            background: #f1f5f9;
            color: #475569;
        }
        
        .btn-secondary:hover {
            background: #e2e8f0;
        }
        
        .btn-danger {
            background: #ef4444;
            color: white;
        }
        
        .btn-danger:hover {
            background: #dc2626;
        }
        
        .btn-success {
            background: #10b981;
            color: white;
        }
        
        .btn-success:hover {
            background: #059669;
        }
        
        .btn-sm {
            padding: 8px 12px;
            font-size: 12px;
        }
        
        .filter-section {
            display: flex;
            gap: 16px;
            align-items: center;
            margin-bottom: 20px;
            padding: 20px;
            background: #f8fafc;
            border-radius: 12px;
            border: 1px solid #e2e8f0;
        }
        
        .filter-group {
            display: flex;
            flex-direction: column;
            gap: 6px;
        }
        
        .filter-label {
            font-size: 12px;
            font-weight: 500;
            color: #64748b;
        }
        
        .employees-table {
            width: 100%;
            border-collapse: collapse;
        }
        
        .employees-table th {
            background: #f8fafc;
            padding: 16px;
            text-align: left;
            font-weight: 600;
            font-size: 14px;
            color: #374151;
            border-bottom: 1px solid #e2e8f0;
        }
        
        .employees-table td {
            padding: 16px;
            border-bottom: 1px solid #f1f5f9;
            font-size: 14px;
        }
        
        .employees-table tr:hover {
            background: #f8fafc;
        }
        
        .status-badge {
            padding: 4px 8px;
            border-radius: 6px;
            font-size: 12px;
            font-weight: 500;
        }
        
        .status-progress {
            background: #fef3c7;
            color: #92400e;
        }
        
        .status-complete {
            background: #dcfce7;
            color: #166534;
        }
        
        .status-hold {
            background: #fecaca;
            color: #991b1b;
        }
        
        .site-link {
            color: #3b82f6;
            text-decoration: none;
            font-size: 12px;
            padding: 2px 6px;
            border: 1px solid #3b82f6;
            border-radius: 4px;
            display: inline-block;
        }
        
        .site-link:hover {
            background: #3b82f6;
            color: white;
        }
        
        .status-active {
            background: #dcfce7;
            color: #166534;
        }
        
        .status-inactive {
            background: #fee2e2;
            color: #991b1b;
        }
        
        .action-buttons {
            display: flex;
            gap: 8px;
        }
        
        .alert {
            padding: 16px;
            border-radius: 12px;
            margin-bottom: 24px;
            font-size: 14px;
            font-weight: 500;
        }
        
        .alert-success {
            background: #dcfce7;
            color: #166534;
            border: 1px solid #bbf7d0;
        }
        
        .alert-error {
            background: #fee2e2;
            color: #991b1b;
            border: 1px solid #fecaca;
        }
        
        .loading {
            position: relative;
            color: transparent;
        }
        
        .loading::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 16px;
            height: 16px;
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top-color: #ffffff;
            animation: spin 1s ease-in-out infinite;
            transform: translate(-50%, -50%);
        }
        
        @keyframes spin {
            to { transform: translate(-50%, -50%) rotate(360deg); }
        }
    </style>
</head>
<body>
    <div class="app-container">
        <!-- 사이드바 -->
        <div class="sidebar">
            <div class="sidebar-header">
                <div class="logo">
                    <div class="logo-icon">🏠</div>
                    <div class="logo-text">집노트 CRM</div>
                </div>
            </div>
            
            <nav class="sidebar-nav">
                <a href="/admin" class="nav-item">
                    <div class="nav-icon">📊</div>
                    관리자 홈
                </a>
                <a href="#employee-section" class="nav-item active" onclick="activateEmployeeTab(event)">
                    <div class="nav-icon">👥</div>
                    직원 관리
                </a>
                <a href="#maeiple-section" class="nav-item" onclick="activateMaeipeTab(event)">
                    <div class="nav-icon">🏢</div>
                    메이플관리
                </a>
                <!-- 팀장메이플관리는 메이플관리 탭으로 통합됨 -->
                <a href="#team-leader-maeiple-section" class="nav-item" onclick="activateTeamLeaderMaeipleTab(event)" style="display:none;" id="team-leader-maeiple-nav">
                    <div class="nav-icon">🏢</div>
                    팀장메이플관리
                </a>
                <a href="#dashboard-section" class="nav-item" onclick="activateDashboardTab(event)">
                    <div class="nav-icon">👥</div>
                    고객 관리
                </a>
                <a href="#team-leader-customer-section" class="nav-item" onclick="activateTeamLeaderCustomerTab(event)" style="display:none;" id="team-leader-customer-nav">
                    <div class="nav-icon">💼</div>
                    팀장고객관리
                </a>
                <a href="#guarantee-section" class="nav-item" onclick="activateGuaranteeTab(event)">
                    <div class="nav-icon">🛡️</div>
                    보증보험 매물
                </a>
                <a href="/logout" class="nav-item">
                    <div class="nav-icon">🚪</div>
                    로그아웃
                </a>
            </nav>
        </div>
        
        <!-- 메인 컨텐츠 -->
        <div class="main-content">
            <!-- 헤더 -->
            <div class="header">
                <div class="header-left">
                    <div class="search-box">
                        <div class="search-icon">🔍</div>
                        <input type="text" class="search-input" placeholder="직원 검색...">
                    </div>
                </div>
                
                <div class="header-right">
                    <!-- 사이트 전환 드롭다운 -->
                    <div class="site-switcher" id="site-switcher">
                        <button class="site-switcher-btn" onclick="toggleSiteSwitcher()">
                            <span>🏢</span>
                            사이트 관리
                        </button>
                        <div class="site-dropdown">
                            <div class="dropdown-header">매물 사이트 전환</div>
                            <a href="{{ residence_site_url }}" target="_blank" class="dropdown-item residence">
                                <div class="item-icon">🏠</div>
                                <div class="item-info">
                                    <div class="item-title">주거 사이트</div>
                                    <div class="item-desc">아파트, 원룸, 오피스텔 등 주거용 매물</div>
                                </div>
                                <div class="item-badge">주거용</div>
                            </a>
                            <a href="{{ business_site_url }}" target="_blank" class="dropdown-item business">
                                <div class="item-icon">🏢</div>
                                <div class="item-info">
                                    <div class="item-title">업무 사이트</div>
                                    <div class="item-desc">오피스, 상가, 업무공간 매물</div>
                                </div>
                                <div class="item-badge">업무용</div>
                            </a>
                        </div>
                    </div>
                    
                    <div class="user-profile">
                        <div class="user-avatar" id="user-avatar">관</div>
                        <div class="user-info">
                            <div class="user-name" id="user-name">관리자</div>
                            <div class="user-role" id="user-role">관리자</div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- 컨텐츠 -->
            <div class="content">
                <div class="page-header">
                    <h1 class="page-title">관리자 패널</h1>
                    <p class="page-subtitle">직원 관리, 보증보험 매물 및 시스템 관리</p>
                </div>
                
                <!-- Flask Flash 메시지 표시 -->
                {% with messages = get_flashed_messages(with_categories=true) %}
                    {% if messages %}
                        {% for category, message in messages %}
                            {% if category == 'success' %}
                                <div class="alert alert-success" style="margin-bottom: 20px; padding: 16px; border-radius: 12px; background: #10b98126; border: 1px solid #10b981; color: #059669;">
                                    {{ message }}
                                </div>
                            {% else %}
                                <div class="alert alert-error" style="margin-bottom: 20px; padding: 16px; border-radius: 12px; background: #ef444426; border: 1px solid #ef4444; color: #dc2626;">
                                    {{ message }}
                                </div>
                            {% endif %}
                        {% endfor %}
                    {% endif %}
                {% endwith %}
                
                <div id="alert-container"></div>

                <!-- 사이드바 메뉴로 탭 기능 대체 -->

                <!-- 직원관리 카드 (탭) -->
                <div id="employee-section">
                    <!-- 새 직원 추가 토글 버튼 -->
                    <button class="btn btn-primary" style="margin-bottom:12px; border-radius:10px; font-size:15px; padding:10px 18px; font-weight:600;" onclick="toggleAddEmployee()">
                        <span style="font-size:18px;">➕</span> 새 직원 추가
                    </button>
                    <!-- 새 직원 추가 카드 (기본 숨김) -->
                    <div class="card" id="add-employee-card" style="display:none; transition: max-height 0.3s; overflow:hidden;">
                        <div class="card-header">
                            <h2 class="card-title">
                                <span>➕</span>
                                새 직원 추가
                            </h2>
                        </div>
                        <form id="add-employee-form" class="add-employee-form">
                            <div class="form-group">
                                <label class="form-label">직원 아이디</label>
                                <input type="text" id="employee_id" class="form-input" placeholder="직원 아이디" required>
                            </div>
                            <div class="form-group">
                                <label class="form-label">직원 이름</label>
                                <input type="text" id="employee_name" class="form-input" placeholder="직원 이름" required>
                            </div>
                            <div class="form-group">
                                <label class="form-label">팀</label>
                                <div style="display: flex; gap: 10px; align-items: end;">
                                    <select id="team" class="form-input" required style="background: white; cursor: pointer; flex: 1;">
                                    <option value="">팀 선택</option>
                                    <option value="빈시트">빈시트</option>
                                    <option value="위플러스">위플러스</option>
                                    <option value="반클리셰">반클리셰</option>
                                    <option value="대표">대표</option>
                                </select>
                                    <button type="button" class="btn btn-outline-primary btn-sm" onclick="showAddTeamModal()" style="white-space: nowrap;">
                                        <span>➕</span> 팀 추가
                                    </button>
                                </div>
                            </div>
                            <div class="form-group">
                                <label class="form-label">역할</label>
                                <select id="employee_role" class="form-input" required style="background: white; cursor: pointer;">
                                    <option value="">역할 선택</option>
                                    <option value="팀장">팀장</option>
                                    <option value="직원">직원</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label class="form-label">상태</label>
                                <select id="employee_status" class="form-input" required style="background: white; cursor: pointer;">
                                    <option value="active">활성</option>
                                    <option value="inactive">비활성</option>
                                </select>
                            </div>
                            <div class="form-group" style="display: flex; gap: 10px;">
                                <button type="submit" class="btn btn-primary" id="add-btn">
                                    <span>➕</span>
                                    직원 추가
                                </button>
                                <button type="button" class="btn btn-secondary" id="cancel-btn" onclick="resetEmployeeForm()" style="display: none;">
                                    <span>❌</span>
                                    취소
                                </button>
                            </div>
                        </form>
                    </div>
                    
                    <!-- 팀 추가/삭제 모달 -->
                    <div id="addTeamModal" class="modal" style="display: none;">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h3>팀 관리</h3>
                                <span class="close" onclick="closeAddTeamModal()">&times;</span>
                            </div>
                            <div class="modal-body">
                                <!-- 팀 추가 섹션 -->
                                <div class="team-section">
                                    <h4 style="margin-bottom: 16px; color: #374151;">➕ 새 팀 추가</h4>
                                    <div class="form-group">
                                        <label for="newTeamName">팀 이름</label>
                                        <input type="text" id="newTeamName" class="form-input" placeholder="팀 이름을 입력하세요" required>
                                    </div>
                                    <div class="form-group">
                                        <label for="newTeamDescription">팀 설명 (선택사항)</label>
                                        <textarea id="newTeamDescription" class="form-input" placeholder="팀에 대한 설명을 입력하세요" rows="3"></textarea>
                                    </div>
                                    <button type="button" class="btn btn-primary" onclick="addNewTeam()" style="margin-bottom: 24px;">팀 추가</button>
                                </div>
                                
                                <hr style="margin: 24px 0; border: 1px solid #e5e7eb;">
                                
                                <!-- 팀 삭제 섹션 -->
                                <div class="team-section">
                                    <h4 style="margin-bottom: 16px; color: #374151;">🗑️ 기존 팀 삭제</h4>
                                    <div class="form-group">
                                        <label for="deleteTeamSelect">삭제할 팀 선택</label>
                                        <select id="deleteTeamSelect" class="form-input" style="background: white; cursor: pointer;">
                                            <option value="">팀을 선택하세요</option>
                                            <option value="빈시트">빈시트</option>
                                            <option value="위플러스">위플러스</option>
                                            <option value="반클리셰">반클리셰</option>
                                            <option value="대표">대표</option>
                                        </select>
                                    </div>
                                    <div class="form-group">
                                        <label for="deleteTeamReason">삭제 사유 (선택사항)</label>
                                        <textarea id="deleteTeamReason" class="form-input" placeholder="팀 삭제 사유를 입력하세요" rows="3"></textarea>
                                    </div>
                                    <button type="button" class="btn btn-danger" onclick="deleteTeam()">팀 삭제</button>
                                </div>
                            </div>
                            <div class="modal-footer">
                                <button type="button" class="btn btn-secondary" onclick="closeAddTeamModal()">닫기</button>
                            </div>
                        </div>
                    </div>
                    
                    <!-- 직원 목록 카드 -->
                    <div class="card">
                        <div class="card-header">
                            <h2 class="card-title">
                                <span>👥</span>
                                직원 목록
                            </h2>
                        </div>
                        <!-- 필터 섹션 -->
                        <div class="filter-section" style="display: flex; align-items: flex-end; gap: 20px; background: #f4f6fb; border-radius: 16px; border: 1px solid #e0e7ef; margin-bottom: 18px; padding: 18px 24px; box-shadow: 0 2px 8px rgba(99,102,241,0.04);">
                            <div class="filter-group" style="min-width: 80px;">
                                <label class="filter-label" style="font-size:13px; font-weight:600; color:#6366f1; margin-bottom:6px; display:flex; align-items:center; gap:6px;">
                                    <span style="font-size:16px;">🔎</span> 상태
                                </label>
                                <select id="status-filter" class="form-select" style="width:80px; border-radius: 10px; border: 1.5px solid #c7d2fe; background: #fff; font-size:14px; padding:10px 14px;">
                                    <option value="">전체</option>
                                    <option value="1">활성</option>
                                    <option value="0">비활성</option>
                                </select>
                            </div>
                            <div class="filter-group" style="min-width: 80px;">
                                <label class="filter-label" style="font-size:13px; font-weight:600; color:#6366f1; margin-bottom:6px; display:flex; align-items:center; gap:6px;">
                                    <span style="font-size:16px;">👥</span> 팀
                                </label>
                                <select id="team-filter" class="form-select" style="width:80px; border-radius: 10px; border: 1.5px solid #c7d2fe; background: #fff; font-size:14px; padding:10px 14px;">
                                    <option value="">전체 팀</option>
                                </select>
                            </div>
                            <div class="form-group" style="margin-left:auto;">
                                <button type="button" class="btn btn-secondary" style="border-radius:10px; font-size:14px; padding:10px 18px; background:#e0e7ff; color:#3730a3; border:1.5px solid #c7d2fe; font-weight:600; display:flex; align-items:center; gap:6px;" onclick="loadEmployees()">
                                    <span style="font-size:16px;">🔄</span>
                                    새로고침
                                </button>
                            </div>
                        </div>
                        <div class="table-container">
                            <table class="employees-table">
                                <thead>
                                    <tr>
                                        <th>직원 아이디</th>
                                        <th>이름</th>
                                        <th>팀</th>
                                        <th>역할</th>
                                        <th>등록일</th>
                                        <th>상태</th>
                                        <th>작업</th>
                                    </tr>
                                </thead>
                                <tbody id="employees-list">
                                    <!-- 직원 목록이 여기에 동적으로 추가됩니다 -->
                                </tbody>
                            </table>
                                                </div>
                        
                        <!-- 페이지네이션 -->
                        <div id="employee-pagination" style="display: flex; justify-content: center; align-items: center; gap: 10px; margin-top: 20px; padding: 20px;">
                            <!-- 페이지네이션 버튼들이 여기에 동적으로 생성됩니다 -->
                        </div>
                    </div>
                </div>
                
                <!-- 보증보험 매물 카드 (탭) -->
                <div id="guarantee-section" style="display:none;">
                    <div class="card">
                        <div class="card-header" style="display: flex; justify-content: space-between; align-items: center;">
                            <h2 class="card-title">
                                <span>🛡️</span>
                                보증보험 매물 리스트
                            </h2>
                            <div style="display: flex; gap: 16px; align-items: center;">
                                <span style="font-size: 14px; color: #64748b;">
                                    총 <strong style="color: #6366f1;">{{ guarantee_list|length if guarantee_list else 0 }}</strong>개의 보증보험 가능 매물
                                </span>
                                <button type="button" class="btn btn-secondary btn-sm" onclick="location.reload()">
                                    <span>🔄</span> 새로고침
                                </button>
                            </div>
                        </div>
                        <div class="table-container">
                            <table class="employees-table">
                                <thead>
                                    <tr>
                                        <th>번호</th>
                                        <th>URL</th>
                                        <th>플랫폼</th>
                                        <th>등록자</th>
                                        <th>등록일</th>
                                        <th>보증보험</th>
                                        <th>메모</th>
                                        <th>작업</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {% if guarantee_list and guarantee_list|length > 0 %}
                                        {% for row in guarantee_list %}
                                        <tr>
                                            <td>{{ loop.revindex }}</td>
                                            <td><a href="{{ row['url'] }}" target="_blank">{{ row['url'][:50] }}{% if row['url']|length > 50 %}...{% endif %}</a></td>
                                            <td>
                                                {% if row['platform'] == 'zigbang' %}
                                                    <span class="badge" style="background:#ff6b6b; color:white;">직방</span>
                                                {% elif row['platform'] == 'naver' %}
                                                    <span class="badge" style="background:#03c75a; color:white;">네이버</span>
                                                {% else %}
                                                    <span class="badge" style="background:#868e96; color:white;">{{ row['platform'] }}</span>
                                                {% endif %}
                                            </td>
                                            <td>{{ row['added_by'] }}</td>
                                            <td>{{ row['date_added'] }}</td>
                                            <td>
                                                <span class="badge" style="background:#22c55e; color:white;">
                                                    🛡️ 보증보험 가능
                                                </span>
                                            </td>
                                            <td>
                                                <form method="POST" action="{{ url_for('guarantee_edit', id=row['id']) }}" style="display:flex; gap:8px; align-items:center;">
                                                    <input type="text" name="memo" value="{{ row['memo'] or '' }}" placeholder="메모 입력..." style="width:200px; padding:6px 10px; border:1px solid #e2e8f0; border-radius:8px; font-size:13px;">
                                                    <button type="submit" class="btn btn-sm btn-primary" style="display: flex; align-items: center; gap: 4px;">
                                                        <span>✏️</span> 수정
                                                    </button>
                                                </form>
                                            </td>
                                            <td>
                                                <div style="display: flex; gap: 8px; align-items: center;">
                                                    <form method="POST" action="{{ url_for('guarantee_delete', id=row['id']) }}" style="display:inline;">
                                                        <button type="submit" class="btn btn-sm btn-danger" style="display: flex; align-items: center; gap: 4px;" onclick="return confirm('정말로 이 보증보험 매물을 삭제하시겠습니까?')">
                                                            <span>🗑️</span> 삭제
                                                        </button>
                                                    </form>
                                                </div>
                                            </td>
                                        </tr>
                                        {% endfor %}
                                    {% else %}
                                        <tr>
                                            <td colspan="8" style="text-align:center; color:#64748b; padding:40px;">
                                                <div style="font-size:16px; margin-bottom:8px;">📋 등록된 보증보험 매물이 없습니다.</div>
                                                <div style="font-size:14px; color:#94a3b8;">주거용 사이트에서 보증보험 가능 매물을 등록하면 여기에 표시됩니다.</div>
                                            </td>
                                        </tr>
                                    {% endif %}
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- 메이플관리 섹션 (탭) -->
                <div id="maeiple-section" style="display:none;">
                    <div class="card">
                        <div class="card-header" style="display: flex; justify-content: space-between; align-items: center; border-bottom: none;">
                            <h2 class="card-title">
                                <span>🏢</span>
                                메이플관리
                            </h2>
                            <button type="button" class="btn btn-secondary" onclick="loadMaeipeProperties(1)" style="font-size: 12px; padding: 6px 12px; background: #e0e7ff; color: #3730a3; border: 1.5px solid #c7d2fe; font-weight: 600;">
                                <span>🔄</span> 새로고침
                            </button>
                        </div>
                        
                        <!-- 탭 네비게이션 -->
                        <div class="tab-navigation" style="border-bottom: 1px solid #e2e8f0; background: #f8fafc;">
                            <div style="display: flex; align-items: center; padding: 0 24px;">
                                <button class="tab-btn active" onclick="switchMaeipleTab('list')" data-tab="list">
                                    아파트목록
                                </button>

                                <div style="margin-left: auto;">
                                    <button class="btn btn-primary" onclick="addNewPropertyRow()" style="font-size: 12px; padding: 6px 12px;">+ 새 매물 추가</button>
                                </div>
                            </div>
                        </div>
                        
                        <!-- 탭 콘텐츠 -->
                        <div id="maeiple-tab-list" class="tab-content active">
                        
                        <!-- 필터 섹션 -->
                        <div class="filter-section" style="padding: 12px 24px; border-bottom: 1px solid #e2e8f0; background: #ffffff; display: flex; gap: 24px; flex-wrap: wrap; align-items: center;">
                            <!-- 호수 검색 -->
                            <div class="filter-group">
                                <span class="filter-label" style="color: #64748b; font-size: 13px; font-weight: 600; margin-right: 4px;">호수 검색:</span>
                                <input type="text" id="room-search-admin" placeholder="호수 입력 (예: 101, 102)" 
                                       style="padding: 6px 12px; border: 1px solid #e2e8f0; border-radius: 6px; font-size: 12px; width: 120px;"
                                       oninput="filterByRoomAdmin(this.value)">
                            </div>
                            
                            <!-- 거래 유형 필터 -->
                            <div class="filter-group" id="deal-type-filter-group-admin">
                                <span class="filter-label" style="color: #64748b; font-size: 13px; font-weight: 600; margin-right: 4px;">거래유형:</span>
                                <div class="filter-buttons" style="display: flex; gap: 6px;">
                                    <button class="filter-btn active" data-value="all" onclick="setDealTypeFilterAdmin('all', this)" style="padding: 6px 10px; border: 1px solid #e2e8f0; background: #e0e7ff; color: #4338ca; border-radius: 20px; font-size: 12px; cursor: pointer; font-weight: 600;">전체</button>
                                    <button class="filter-btn" data-value="전세" onclick="setDealTypeFilterAdmin('전세', this)" style="padding: 6px 10px; border: 1px solid #e2e8f0; background: #ffffff; color: #334155; border-radius: 20px; font-size: 12px; cursor: pointer;">전세</button>
                                    <button class="filter-btn" data-value="월세" onclick="setDealTypeFilterAdmin('월세', this)" style="padding: 6px 10px; border: 1px solid #e2e8f0; background: #ffffff; color: #334155; border-radius: 20px; font-size: 12px; cursor: pointer;">월세</button>
                                    <button class="filter-btn" data-value="매매" onclick="setDealTypeFilterAdmin('매매', this)" style="padding: 6px 10px; border: 1px solid #e2e8f0; background: #ffffff; color: #334155; border-radius: 20px; font-size: 12px; cursor: pointer;">매매</button>
                                </div>
                            </div>
                            
                            <div class="filter-group" id="status-filter-group">
                                <span class="filter-label" style="color: #64748b; font-size: 13px; font-weight: 600; margin-right: 4px;">현황:</span>
                                <div class="filter-buttons" style="display: flex; gap: 6px;">
                                    <button class="filter-btn active" data-value="all" onclick="setStatusFilter('all', this)" style="padding: 6px 10px; border: 1px solid #e2e8f0; background: #e0e7ff; color: #4338ca; border-radius: 20px; font-size: 12px; cursor: pointer; font-weight: 600;">전체</button>
                                    <button class="filter-btn" data-value="거래가능" onclick="setStatusFilter('거래가능', this)" style="padding: 6px 10px; border: 1px solid #e2e8f0; background: #ffffff; color: #334155; border-radius: 20px; font-size: 12px; cursor: pointer;">거래가능</button>
                                    <button class="filter-btn" data-value="계약완료" onclick="setStatusFilter('계약완료', this)" style="padding: 6px 10px; border: 1px solid #e2e8f0; background: #ffffff; color: #334155; border-radius: 20px; font-size: 12px; cursor: pointer;">계약완료</button>
                                    <button class="filter-btn" data-value="보류" onclick="setStatusFilter('보류', this)" style="padding: 6px 10px; border: 1px solid #e2e8f0; background: #ffffff; color: #334155; border-radius: 20px; font-size: 12px; cursor: pointer;">보류</button>
                                    <button class="filter-btn" data-value="부재" onclick="setStatusFilter('부재', this)" style="padding: 6px 10px; border: 1px solid #e2e8f0; background: #ffffff; color: #334155; border-radius: 20px; font-size: 12px; cursor: pointer;">부재</button>
                                </div>
                            </div>
                            <div class="filter-group" id="occupied-filter-group">
                                <span class="filter-label" style="color: #64748b; font-size: 13px; font-weight: 600; margin-right: 4px;">실거주:</span>
                                <div class="filter-buttons" style="display: flex; gap: 6px;">
                                    <button class="filter-btn active" data-value="all" onclick="setOccupiedFilter('all', this)" style="padding: 6px 10px; border: 1px solid #e2e8f0; background: #e0e7ff; color: #4338ca; border-radius: 20px; font-size: 12px; cursor: pointer; font-weight: 600;">전체</button>
                                    <button class="filter-btn" data-value="O" onclick="setOccupiedFilter('O', this)" style="padding: 6px 10px; border: 1px solid #e2e8f0; background: #ffffff; color: #334155; border-radius: 20px; font-size: 12px; cursor: pointer;">O</button>
                                    <button class="filter-btn" data-value="X" onclick="setOccupiedFilter('X', this)" style="padding: 6px 10px; border: 1px solid #e2e8f0; background: #ffffff; color: #334155; border-radius: 20px; font-size: 12px; cursor: pointer;">X</button>
                                </div>
                            </div>
                            
                            <!-- 담당자 검색 -->
                            <div class="filter-group">
                                <span class="filter-label" style="color: #64748b; font-size: 13px; font-weight: 600; margin-right: 4px;">담당자 검색:</span>
                                <input type="text" id="employee-search-admin" placeholder="담당자 이름 입력" 
                                       style="padding: 6px 12px; border: 1px solid #e2e8f0; border-radius: 6px; font-size: 12px; width: 120px;"
                                       oninput="filterByEmployeeAdmin(this.value)">
                            </div>
                            
                            <!-- 팀 필터 -->
                            <div class="filter-group" id="team-filter-group-admin">
                                <span class="filter-label" style="color: #64748b; font-size: 13px; font-weight: 600; margin-right: 4px;">팀:</span>
                                <div class="filter-buttons" style="display: flex; gap: 6px;">
                                    <button class="filter-btn active" data-value="all" onclick="setTeamFilterAdmin('all', this)" style="padding: 6px 10px; border: 1px solid #e2e8f0; background: #e0e7ff; color: #4338ca; border-radius: 20px; font-size: 12px; cursor: pointer; font-weight: 600;">전체</button>
                                </div>
                            </div>
                        </div>
                        
                        <!-- 일괄 처리 컨트롤 -->
                        <div id="bulk-actions-panel" style="display: none; padding: 12px 24px; background: #f8fafc; border-bottom: 1px solid #e2e8f0;">
                            <div style="display: flex; align-items: center; gap: 16px; flex-wrap: wrap;">
                                <div style="display: flex; align-items: center; gap: 8px;">
                                    <span style="font-size: 14px; font-weight: 600; color: #374151;">선택된 매물:</span>
                                    <span id="selected-count" style="font-size: 14px; font-weight: 700; color: #3b82f6;">0개</span>
                                </div>
                                
                                <div style="display: flex; align-items: center; gap: 8px;">
                                    <span style="font-size: 14px; font-weight: 600; color: #374151;">담당자 변경:</span>
                                    <select id="bulk-employee-select" style="padding: 6px 12px; border: 1px solid #d1d5db; border-radius: 6px; font-size: 12px; min-width: 150px;">
                                        <option value="">담당자 선택</option>
                                    </select>
                                    <button onclick="bulkAssignEmployee()" style="padding: 6px 12px; background: #3b82f6; color: white; border: none; border-radius: 6px; font-size: 12px; cursor: pointer;">적용</button>
                                </div>
                                
                                <div style="display: flex; align-items: center; gap: 8px;">
                                    <span style="font-size: 14px; font-weight: 600; color: #374151;">팀 변경:</span>
                                    <select id="bulk-team-select" style="padding: 6px 12px; border: 1px solid #d1d5db; border-radius: 6px; font-size: 12px; min-width: 120px;">
                                        <option value="">팀 선택</option>
                                    </select>
                                    <button onclick="bulkAssignTeam()" style="padding: 6px 12px; background: #059669; color: white; border: none; border-radius: 6px; font-size: 12px; cursor: pointer;">적용</button>
                                </div>
                                
                                <button onclick="clearSelection()" style="padding: 6px 12px; background: #6b7280; color: white; border: none; border-radius: 6px; font-size: 12px; cursor: pointer;">선택 해제</button>
                                <button onclick="bulkDeleteProperties()" style="padding: 6px 12px; background: #dc2626; color: white; border: none; border-radius: 6px; font-size: 12px; cursor: pointer;">🗑️ 삭제</button>
                            </div>
                        </div>
                        
                        <div id="maeiple-table-content">
                            <div class="loading" style="text-align: center; padding: 40px; color: #64748b;">로딩 중...</div>
                            </div>
                            
                        <!-- 페이지네이션 -->
                        <div id="maeiple-pagination" style="display: flex; justify-content: center; align-items: center; gap: 10px; margin-top: 20px; padding: 20px;">
                            <!-- 페이지네이션 버튼들이 여기에 동적으로 생성됩니다 -->
                        </div>
                        </div>
                        

                    </div>
                </div>

                <!-- 팀장메이플관리 섹션 (탭) -->
                <div id="team-maeiple-section" style="display:none;">
                    <!-- 메이플자이 현황 섹션 -->
                    <div class="maeiple-section" style="margin-top: 20px; padding: 16px; background: #ffffff; border-radius: 12px; border: 1px solid #e2e8f0; box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1); margin-bottom: 24px;">
                        <h3 class="section-title" style="font-size: 16px; font-weight: 600; color: #1a202c; margin-bottom: 16px; display: flex; align-items: center; gap: 6px;">메이플자이</h3>
                        
                        <!-- 메이플자이 통계 카드 -->
                        <div class="dashboard-stats" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 16px; margin-bottom: 24px;">
                            <div class="stat-card" style="background: #ffffff; border-radius: 10px; padding: 12px; border: 1px solid #e2e8f0; box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);">
                                <div class="stat-header" style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 8px;">
                                    <h3 class="stat-title" style="font-size: 12px; font-weight: 500; color: #64748b;">총 아파트</h3>
                                    <div class="stat-icon" style="width: 24px; height: 24px; border-radius: 6px; display: flex; align-items: center; justify-content: center; font-size: 12px; background: #f0f9ff; color: #0ea5e9;">🏢</div>
                                </div>
                                <div id="total-maeiple-team" class="stat-value" style="font-size: 20px; font-weight: 700; color: #1a202c; margin-bottom: 4px;">0</div>
                                <div class="stat-change" style="font-size: 11px; font-weight: 500; color: #64748b;">전체 등록</div>
                            </div>
                            <div class="stat-card" style="background: #ffffff; border-radius: 10px; padding: 12px; border: 1px solid #e2e8f0; box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);">
                                <div class="stat-header" style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 8px;">
                                    <h3 class="stat-title" style="font-size: 12px; font-weight: 500; color: #64748b;">거래중</h3>
                                    <div class="stat-icon" style="width: 24px; height: 24px; border-radius: 6px; display: flex; align-items: center; justify-content: center; font-size: 12px; background: #fefce8; color: #ca8a04;">🔄</div>
                                </div>
                                <div id="available-maeiple-team" class="stat-value" style="font-size: 20px; font-weight: 700; color: #1a202c; margin-bottom: 4px;">0</div>
                                <div class="stat-change" style="font-size: 11px; font-weight: 500; color: #64748b;">진행중</div>
                            </div>
                            <div class="stat-card" style="background: #ffffff; border-radius: 10px; padding: 12px; border: 1px solid #e2e8f0; box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);">
                                <div class="stat-header" style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 8px;">
                                    <h3 class="stat-title" style="font-size: 12px; font-weight: 500; color: #64748b;">거래완료</h3>
                                    <div class="stat-icon" style="width: 24px; height: 24px; border-radius: 6px; display: flex; align-items: center; justify-content: center; font-size: 12px; background: #dcfce7; color: #16a34a;">✅</div>
                                </div>
                                <div id="completed-maeiple-team" class="stat-value" style="font-size: 20px; font-weight: 700; color: #1a202c; margin-bottom: 4px;">0</div>
                                <div class="stat-change" style="font-size: 11px; font-weight: 500; color: #64748b;">완료</div>
                            </div>
                            <div class="stat-card" style="background: #ffffff; border-radius: 10px; padding: 12px; border: 1px solid #e2e8f0; box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);">
                                <div class="stat-header" style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 8px;">
                                    <h3 class="stat-title" style="font-size: 12px; font-weight: 500; color: #64748b;">이번 주 신규</h3>
                                    <div class="stat-icon" style="width: 24px; height: 24px; border-radius: 6px; display: flex; align-items: center; justify-content: center; font-size: 12px; background: #fce7f3; color: #ec4899;">📈</div>
                                </div>
                                <div id="new-maeiple-team" class="stat-value" style="font-size: 20px; font-weight: 700; color: #1a202c; margin-bottom: 4px;">0</div>
                                <div class="stat-change" style="font-size: 11px; font-weight: 500; color: #64748b;">신규 등록</div>
                            </div>
                        </div>
                    </div>

                    <div class="card">
                        <div class="card-header" style="display: flex; justify-content: space-between; align-items: center;">
                            <h2 class="card-title">
                                <span>👥🏢</span>
                                팀장메이플관리 - 우리팀 매물목록
                            </h2>
                            <button class="btn btn-primary" onclick="addNewTeamPropertyRow()">+ 새 매물 추가</button>
                        </div>
                        
                        <!-- 필터 섹션 -->
                        <div class="filter-section" style="padding: 12px 24px; border-bottom: 1px solid #e2e8f0; background: #ffffff; display: flex; gap: 24px; flex-wrap: wrap; align-items: center;">
                            <!-- 호수 검색 -->
                            <div class="filter-group">
                                <span class="filter-label" style="color: #64748b; font-size: 13px; font-weight: 600; margin-right: 4px;">호수 검색:</span>
                                <input type="text" id="room-search-team" placeholder="호수 입력 (예: 101, 102)" 
                                       style="padding: 6px 12px; border: 1px solid #e2e8f0; border-radius: 6px; font-size: 12px; width: 120px;"
                                       oninput="filterByRoomTeam(this.value)">
                            </div>
                            
                            <!-- 담당자 검색 -->
                            <div class="filter-group">
                                <span class="filter-label" style="color: #64748b; font-size: 13px; font-weight: 600; margin-right: 4px;">담당자 검색:</span>
                                <input type="text" id="employee-search-team" placeholder="담당자 이름 입력" 
                                       style="padding: 6px 12px; border: 1px solid #e2e8f0; border-radius: 6px; font-size: 12px; width: 120px;"
                                       oninput="filterByEmployeeTeam(this.value)">
                            </div>
                            
                            <!-- 거래 유형 필터 -->
                            <div class="filter-group" id="deal-type-filter-group-team">
                                <span class="filter-label" style="color: #64748b; font-size: 13px; font-weight: 600; margin-right: 4px;">거래유형:</span>
                                <div class="filter-buttons" style="display: flex; gap: 6px;">
                                    <button class="filter-btn active" data-value="all" onclick="setDealTypeFilterTeam('all', this)" style="padding: 6px 10px; border: 1px solid #e2e8f0; background: #e0e7ff; color: #4338ca; border-radius: 20px; font-size: 12px; cursor: pointer; font-weight: 600;">전체</button>
                                    <button class="filter-btn" data-value="전세" onclick="setDealTypeFilterTeam('전세', this)" style="padding: 6px 10px; border: 1px solid #e2e8f0; background: #ffffff; color: #334155; border-radius: 20px; font-size: 12px; cursor: pointer;">전세</button>
                                    <button class="filter-btn" data-value="월세" onclick="setDealTypeFilterTeam('월세', this)" style="padding: 6px 10px; border: 1px solid #e2e8f0; background: #ffffff; color: #334155; border-radius: 20px; font-size: 12px; cursor: pointer;">월세</button>
                                    <button class="filter-btn" data-value="매매" onclick="setDealTypeFilterTeam('매매', this)" style="padding: 6px 10px; border: 1px solid #e2e8f0; background: #ffffff; color: #334155; border-radius: 20px; font-size: 12px; cursor: pointer;">매매</button>
                                </div>
                            </div>
                            
                            <div class="filter-group" id="status-filter-group-team">
                                <span class="filter-label" style="color: #64748b; font-size: 13px; font-weight: 600; margin-right: 4px;">현황:</span>
                                <div class="filter-buttons" style="display: flex; gap: 6px;">
                                    <button class="filter-btn active" data-value="all" onclick="setStatusFilterTeam('all', this)" style="padding: 6px 10px; border: 1px solid #e2e8f0; background: #e0e7ff; color: #4338ca; border-radius: 20px; font-size: 12px; cursor: pointer; font-weight: 600;">전체</button>
                                    <button class="filter-btn" data-value="거래가능" onclick="setStatusFilterTeam('거래가능', this)" style="padding: 6px 10px; border: 1px solid #e2e8f0; background: #ffffff; color: #334155; border-radius: 20px; font-size: 12px; cursor: pointer;">거래가능</button>
                                    <button class="filter-btn" data-value="계약완료" onclick="setStatusFilterTeam('계약완료', this)" style="padding: 6px 10px; border: 1px solid #e2e8f0; background: #ffffff; color: #334155; border-radius: 20px; font-size: 12px; cursor: pointer;">계약완료</button>
                                    <button class="filter-btn" data-value="보류" onclick="setStatusFilterTeam('보류', this)" style="padding: 6px 10px; border: 1px solid #e2e8f0; background: #ffffff; color: #334155; border-radius: 20px; font-size: 12px; cursor: pointer;">보류</button>
                                    <button class="filter-btn" data-value="부재" onclick="setStatusFilterTeam('부재', this)" style="padding: 6px 10px; border: 1px solid #e2e8f0; background: #ffffff; color: #334155; border-radius: 20px; font-size: 12px; cursor: pointer;">부재</button>
                                </div>
                            </div>
                            <div class="filter-group" id="occupied-filter-group-team">
                                <span class="filter-label" style="color: #64748b; font-size: 13px; font-weight: 600; margin-right: 4px;">실거주:</span>
                                <div class="filter-buttons" style="display: flex; gap: 6px;">
                                    <button class="filter-btn active" data-value="all" onclick="setOccupiedFilterTeam('all', this)" style="padding: 6px 10px; border: 1px solid #e2e8f0; background: #e0e7ff; color: #4338ca; border-radius: 20px; font-size: 12px; cursor: pointer; font-weight: 600;">전체</button>
                                    <button class="filter-btn" data-value="O" onclick="setOccupiedFilterTeam('O', this)" style="padding: 6px 10px; border: 1px solid #e2e8f0; background: #ffffff; color: #334155; border-radius: 20px; font-size: 12px; cursor: pointer;">O</button>
                                    <button class="filter-btn" data-value="X" onclick="setOccupiedFilterTeam('X', this)" style="padding: 6px 10px; border: 1px solid #e2e8f0; background: #ffffff; color: #334155; border-radius: 20px; font-size: 12px; cursor: pointer;">X</button>
                                </div>
                            </div>
                        </div>
                        
                        <!-- 테이블 컨테이너 -->
                        <div class="table-container" style="background: white; border-radius: 12px; box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1); overflow: hidden;">
                            <table class="maeiple-table" style="width: 100%; border-collapse: collapse;">
                                <thead>
                                    <tr>
                                        <th style="background: #f8fafc; padding: 16px 12px; text-align: left; font-weight: 600; color: #374151; border-bottom: 1px solid #e2e8f0; font-size: 14px;">
                                            <div class="sort-header" onclick="sortTable('check_date', 'team')" style="display: flex; align-items: center; gap: 4px; cursor: pointer; user-select: none;">
                                                확인일
                                                <span class="sort-icon" style="font-size: 12px; color: #9ca3af; transition: color 0.2s ease;">↕️</span>
                                            </div>
                                        </th>
                                        <th style="background: #f8fafc; padding: 16px 12px; text-align: left; font-weight: 600; color: #374151; border-bottom: 1px solid #e2e8f0; font-size: 14px;">
                                            <div class="sort-header" onclick="sortTable('building_number', 'team')" style="display: flex; align-items: center; gap: 4px; cursor: pointer; user-select: none;">
                                                동
                                                <span class="sort-icon" style="font-size: 12px; color: #9ca3af; transition: color 0.2s ease;">↕️</span>
                                            </div>
                                        </th>
                                        <th style="background: #f8fafc; padding: 16px 12px; text-align: left; font-weight: 600; color: #374151; border-bottom: 1px solid #e2e8f0; font-size: 14px;">
                                            <div class="sort-header" onclick="sortTable('room_number', 'team')" style="display: flex; align-items: center; gap: 4px; cursor: pointer; user-select: none;">
                                                호수
                                                <span class="sort-icon" style="font-size: 12px; color: #9ca3af; transition: color 0.2s ease;">↕️</span>
                                            </div>
                                        </th>
                                        <th style="background: #f8fafc; padding: 16px 12px; text-align: left; font-weight: 600; color: #374151; border-bottom: 1px solid #e2e8f0; font-size: 14px;">상태</th>
                                        <th style="background: #f8fafc; padding: 16px 12px; text-align: left; font-weight: 600; color: #374151; border-bottom: 1px solid #e2e8f0; font-size: 14px;">전세가</th>
                                        <th style="background: #f8fafc; padding: 16px 12px; text-align: left; font-weight: 600; color: #374151; border-bottom: 1px solid #e2e8f0; font-size: 14px;">월세</th>
                                        <th style="background: #f8fafc; padding: 16px 12px; text-align: left; font-weight: 600; color: #374151; border-bottom: 1px solid #e2e8f0; font-size: 14px;">매매가</th>
                                        <th style="background: #f8fafc; padding: 16px 12px; text-align: left; font-weight: 600; color: #374151; border-bottom: 1px solid #e2e8f0; font-size: 14px;">입주여부</th>
                                        <th style="background: #f8fafc; padding: 16px 12px; text-align: left; font-weight: 600; color: #374151; border-bottom: 1px solid #e2e8f0; font-size: 14px;">연락처</th>
                                        <th style="background: #f8fafc; padding: 16px 12px; text-align: left; font-weight: 600; color: #374151; border-bottom: 1px solid #e2e8f0; font-size: 14px;">메모</th>
                                        <th style="background: #f8fafc; padding: 16px 12px; text-align: left; font-weight: 600; color: #374151; border-bottom: 1px solid #e2e8f0; font-size: 14px;">좋아요</th>
                                        <th style="background: #f8fafc; padding: 16px 12px; text-align: left; font-weight: 600; color: #374151; border-bottom: 1px solid #e2e8f0; font-size: 14px;">싫어요</th>
                                        <th style="background: #f8fafc; padding: 16px 12px; text-align: left; font-weight: 600; color: #374151; border-bottom: 1px solid #e2e8f0; font-size: 14px;">담당자</th>
                                        <th style="background: #f8fafc; padding: 16px 12px; text-align: left; font-weight: 600; color: #374151; border-bottom: 1px solid #e2e8f0; font-size: 14px;">작업</th>
                                    </tr>
                                </thead>
                                <tbody id="team-maeiple-table-body">
                                    <!-- 데이터가 여기에 동적으로 로드됩니다 -->
                                </tbody>
                            </table>
                        </div>
                        
                        <!-- 페이지네이션 -->
                        <div id="team-maeiple-pagination" style="display: flex; justify-content: center; align-items: center; gap: 10px; margin-top: 20px; padding: 20px;">
                            <!-- 페이지네이션 버튼들이 여기에 동적으로 생성됩니다 -->
                        </div>
                    </div>
                </div>

                <!-- 직원 대시보드 섹션 (고객 관리) -->
                <div id="dashboard-section" style="display:none;">
                    <!-- 통계 카드 -->
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 24px; margin-bottom: 32px;">
                        <div class="card" style="padding: 24px;">
                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px;">
                                <h3 style="font-size: 16px; font-weight: 600; color: #64748b;">총고객</h3>
                                <div style="width: 40px; height: 40px; background: #eef2ff; color: #6366f1; border-radius: 12px; display: flex; align-items: center; justify-content: center; font-size: 20px;">👥</div>
                            </div>
                            <div id="total-customers-admin" style="font-size: 32px; font-weight: 700; color: #1a202c; margin-bottom: 8px;">0</div>
                            <div style="font-size: 14px; color: #64748b;">전체 직원 고객</div>
                        </div>
                        <div class="card" style="padding: 24px;">
                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px;">
                                <h3 style="font-size: 16px; font-weight: 600; color: #64748b;">진행중</h3>
                                <div style="width: 40px; height: 40px; background: #fef3c7; color: #f59e0b; border-radius: 12px; display: flex; align-items: center; justify-content: center; font-size: 20px;">⏳</div>
                            </div>
                            <div id="progress-customers-admin" style="font-size: 32px; font-weight: 700; color: #1a202c; margin-bottom: 8px;">0</div>
                            <div style="font-size: 14px; color: #64748b;">진행 중인 고객</div>
                        </div>
                        <div class="card" style="padding: 24px;">
                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px;">
                                <h3 style="font-size: 16px; font-weight: 600; color: #64748b;">계약</h3>
                                <div style="width: 40px; height: 40px; background: #dcfce7; color: #16a34a; border-radius: 12px; display: flex; align-items: center; justify-content: center; font-size: 20px;">✅</div>
                            </div>
                            <div id="completed-customers-admin" style="font-size: 32px; font-weight: 700; color: #1a202c; margin-bottom: 8px;">0</div>
                            <div style="font-size: 14px; color: #64748b;">계약 완료 고객</div>
                        </div>
                        <div class="card" style="padding: 24px;">
                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px;">
                                <h3 style="font-size: 16px; font-weight: 600; color: #64748b;">이번 주 신규</h3>
                                <div style="width: 40px; height: 40px; background: #fce7f3; color: #ec4899; border-radius: 12px; display: flex; align-items: center; justify-content: center; font-size: 20px;">📈</div>
                            </div>
                            <div id="new-customers-admin" style="font-size: 32px; font-weight: 700; color: #1a202c; margin-bottom: 8px;">0</div>
                            <div style="font-size: 14px; color: #64748b;">신규 고객</div>
                        </div>
                    </div>

                    <!-- 고객 목록 카드 -->
                    <div class="card">
                        <div class="card-header" style="display: flex; justify-content: space-between; align-items: center;">
                            <h2 class="card-title">
                                <span>👥</span>
                                전체 고객 목록 (모든 직원)
                            </h2>
                            <div style="display: flex; gap: 8px; align-items: center;">
                                <button type="button" class="btn btn-secondary" onclick="loadAllCustomers(1)" style="font-size: 12px; padding: 6px 12px; background: #e0e7ff; color: #3730a3; border: 1.5px solid #c7d2fe; font-weight: 600;">
                                    <span>🔄</span> 새로고침
                                </button>
                                <button class="btn btn-primary" onclick="addNewCustomerRow()">+ 고객 추가</button>
                            </div>
                        </div>
                        
                        <!-- 필터 섹션 -->
                        <div style="padding: 16px 24px; border-bottom: 1px solid #e2e8f0; display: flex; gap: 16px; flex-wrap: wrap; align-items: center;">
                            <div style="display: flex; align-items: center; gap: 8px;">
                                <span style="font-size: 14px; font-weight: 600; color: #64748b;">상태:</span>
                                <div style="display: flex; gap: 6px;">
                                    <button class="customer-filter-btn active" data-status="all" onclick="setCustomerFilter('all', this)" style="padding: 6px 12px; border: 1px solid #e2e8f0; background: #6366f1; color: white; border-radius: 20px; font-size: 12px; cursor: pointer; font-weight: 500;">전체</button>
                                    <button class="customer-filter-btn" data-status="상담중" onclick="setCustomerFilter('상담중', this)" style="padding: 6px 12px; border: 1px solid #e2e8f0; background: white; color: #64748b; border-radius: 20px; font-size: 12px; cursor: pointer;">상담중</button>
                                    <button class="customer-filter-btn" data-status="계약" onclick="setCustomerFilter('계약', this)" style="padding: 6px 12px; border: 1px solid #e2e8f0; background: white; color: #64748b; border-radius: 20px; font-size: 12px; cursor: pointer;">계약</button>
                                    <button class="customer-filter-btn" data-status="보류" onclick="setCustomerFilter('보류', this)" style="padding: 6px 12px; border: 1px solid #e2e8f0; background: white; color: #64748b; border-radius: 20px; font-size: 12px; cursor: pointer;">보류</button>
                                </div>
                            </div>
                            <div style="display: flex; align-items: center; gap: 8px;">
                                <span style="font-size: 14px; font-weight: 600; color: #64748b;">담당자:</span>
                                <select id="employee-filter" onchange="filterByEmployee()" style="padding: 6px 12px; border: 1px solid #e2e8f0; border-radius: 8px; font-size: 12px; background: white;">
                                    <option value="all">전체 직원</option>
                                </select>
                            </div>
                        </div>
                        
                        <div id="customer-table-content">
                            <div class="loading" style="text-align: center; padding: 40px; color: #64748b;">로딩 중...</div>
                        </div>
                        
                        <!-- 페이지네이션 -->
                        <div id="customer-pagination" style="display: flex; justify-content: center; align-items: center; gap: 10px; margin-top: 20px; padding: 20px;">
                            <!-- 페이지네이션 버튼들이 여기에 동적으로 생성됩니다 -->
                        </div>
                    </div>
                </div>

                <!-- 팀장 본인 고객관리 섹션 -->
                <div id="team-leader-customer-section" style="display:none;">
                    <!-- 통계 카드 -->
                    <div class="dashboard-stats" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 16px; margin-bottom: 24px;">
                        <div class="stat-card" style="background: #ffffff; border-radius: 10px; padding: 12px; border: 1px solid #e2e8f0; box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);">
                            <div class="stat-header" style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 8px;">
                                <h3 class="stat-title" style="font-size: 12px; font-weight: 500; color: #64748b;">총 고객</h3>
                                <div class="stat-icon" style="width: 24px; height: 24px; border-radius: 6px; display: flex; align-items: center; justify-content: center; font-size: 12px; background: #eef2ff; color: #6366f1;">👤</div>
                            </div>
                            <div id="total-customers-team-leader" class="stat-value" style="font-size: 20px; font-weight: 700; color: #1a202c; margin-bottom: 4px;">0</div>
                            <div class="stat-change" style="font-size: 11px; font-weight: 500; color: #64748b;">내 담당 고객</div>
                        </div>
                        <div class="stat-card" style="background: #ffffff; border-radius: 10px; padding: 12px; border: 1px solid #e2e8f0; box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);">
                            <div class="stat-header" style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 8px;">
                                <h3 class="stat-title" style="font-size: 12px; font-weight: 500; color: #64748b;">진행중</h3>
                                <div class="stat-icon" style="width: 24px; height: 24px; border-radius: 6px; display: flex; align-items: center; justify-content: center; font-size: 12px; background: #fef3c7; color: #f59e0b;">⏳</div>
                            </div>
                            <div id="progress-customers-team-leader" class="stat-value" style="font-size: 20px; font-weight: 700; color: #1a202c; margin-bottom: 4px;">0</div>
                            <div class="stat-change" style="font-size: 11px; font-weight: 500; color: #64748b;">진행 중인 고객</div>
                        </div>
                        <div class="stat-card" style="background: #ffffff; border-radius: 10px; padding: 12px; border: 1px solid #e2e8f0; box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);">
                            <div class="stat-header" style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 8px;">
                                <h3 class="stat-title" style="font-size: 12px; font-weight: 500; color: #64748b;">계약</h3>
                                <div class="stat-icon" style="width: 24px; height: 24px; border-radius: 6px; display: flex; align-items: center; justify-content: center; font-size: 12px; background: #dcfce7; color: #16a34a;">✅</div>
                            </div>
                            <div id="completed-customers-team-leader" class="stat-value" style="font-size: 20px; font-weight: 700; color: #1a202c; margin-bottom: 4px;">0</div>
                            <div class="stat-change" style="font-size: 11px; font-weight: 500; color: #64748b;">계약 완료 고객</div>
                        </div>
                        <div class="stat-card" style="background: #ffffff; border-radius: 10px; padding: 12px; border: 1px solid #e2e8f0; box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);">
                            <div class="stat-header" style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 8px;">
                                <h3 class="stat-title" style="font-size: 12px; font-weight: 500; color: #64748b;">이번 주 신규</h3>
                                <div class="stat-icon" style="width: 24px; height: 24px; border-radius: 6px; display: flex; align-items: center; justify-content: center; font-size: 12px; background: #fce7f3; color: #ec4899;">📈</div>
                            </div>
                            <div id="new-customers-team-leader" class="stat-value" style="font-size: 20px; font-weight: 700; color: #1a202c; margin-bottom: 4px;">0</div>
                            <div class="stat-change" style="font-size: 11px; font-weight: 500; color: #64748b;">신규 고객</div>
                        </div>
                    </div>

                    <!-- 팀장 본인 고객 목록 카드 -->
                    <div class="card">
                        <div class="card-header" style="display: flex; justify-content: space-between; align-items: center;">
                            <h2 class="card-title">
                                <span>💼</span>
                                팀장 본인 고객 목록
                            </h2>
                            <button class="btn btn-primary" onclick="addNewTeamLeaderCustomerRow()">+ 고객 추가</button>
                        </div>
                        
                        <!-- 필터 섹션 -->
                        <div class="filter-section" style="padding: 12px 24px; border-bottom: 1px solid #e2e8f0; background: #ffffff; display: flex; gap: 24px; flex-wrap: wrap; align-items: center;">
                            <div class="filter-group" style="display: flex; align-items: center; gap: 8px;">
                                <span class="filter-label" style="color: #64748b; font-size: 13px; font-weight: 600; margin-right: 4px;">상태:</span>
                                <div class="filter-buttons" style="display: flex; gap: 6px;">
                                    <button class="filter-btn active" data-status="all" onclick="setTeamLeaderCustomerFilter('all', this)" style="padding: 6px 10px; border: 1px solid #e2e8f0; background: #e0e7ff; color: #4338ca; border-radius: 20px; font-size: 12px; cursor: pointer; font-weight: 600;">전체</button>
                                    <button class="filter-btn" data-status="진행중" onclick="setTeamLeaderCustomerFilter('진행중', this)" style="padding: 6px 10px; border: 1px solid #e2e8f0; background: #ffffff; color: #334155; border-radius: 20px; font-size: 12px; cursor: pointer;">진행중</button>
                                    <button class="filter-btn" data-status="계약" onclick="setTeamLeaderCustomerFilter('계약', this)" style="padding: 6px 10px; border: 1px solid #e2e8f0; background: #ffffff; color: #334155; border-radius: 20px; font-size: 12px; cursor: pointer;">계약</button>
                                    <button class="filter-btn" data-status="보류" onclick="setTeamLeaderCustomerFilter('보류', this)" style="padding: 6px 10px; border: 1px solid #e2e8f0; background: #ffffff; color: #334155; border-radius: 20px; font-size: 12px; cursor: pointer;">보류</button>
                                </div>
                            </div>
                        </div>
                        
                        <!-- 테이블 컨테이너 -->
                        <div class="table-container" style="background: white; border-radius: 12px; box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1); overflow: hidden;">
                            <table class="data-table" style="width: 100%; border-collapse: collapse;">
                                <thead>
                                    <tr>
                                        <th style="background: #f8fafc; padding: 16px 12px; text-align: left; font-weight: 600; color: #374151; border-bottom: 1px solid #e2e8f0; font-size: 14px;">문의일</th>
                                        <th style="background: #f8fafc; padding: 16px 12px; text-align: left; font-weight: 600; color: #374151; border-bottom: 1px solid #e2e8f0; font-size: 14px;">고객명</th>
                                        <th style="background: #f8fafc; padding: 16px 12px; text-align: left; font-weight: 600; color: #374151; border-bottom: 1px solid #e2e8f0; font-size: 14px;">연락처</th>
                                        <th style="background: #f8fafc; padding: 16px 12px; text-align: left; font-weight: 600; color: #374151; border-bottom: 1px solid #e2e8f0; font-size: 14px;">예산</th>
                                        <th style="background: #f8fafc; padding: 16px 12px; text-align: left; font-weight: 600; color: #374151; border-bottom: 1px solid #e2e8f0; font-size: 14px;">방 개수</th>
                                        <th style="background: #f8fafc; padding: 16px 12px; text-align: left; font-weight: 600; color: #374151; border-bottom: 1px solid #e2e8f0; font-size: 14px;">위치</th>
                                        <th style="background: #f8fafc; padding: 16px 12px; text-align: left; font-weight: 600; color: #374151; border-bottom: 1px solid #e2e8f0; font-size: 14px;">대출</th>
                                        <th style="background: #f8fafc; padding: 16px 12px; text-align: left; font-weight: 600; color: #374151; border-bottom: 1px solid #e2e8f0; font-size: 14px;">주차</th>
                                        <th style="background: #f8fafc; padding: 16px 12px; text-align: left; font-weight: 600; color: #374151; border-bottom: 1px solid #e2e8f0; font-size: 14px;">펫</th>
                                        <th style="background: #f8fafc; padding: 16px 12px; text-align: left; font-weight: 600; color: #374151; border-bottom: 1px solid #e2e8f0; font-size: 14px;">메모</th>
                                        <th style="background: #f8fafc; padding: 16px 12px; text-align: left; font-weight: 600; color: #374151; border-bottom: 1px solid #e2e8f0; font-size: 14px;">진행상태</th>
                                        <th style="background: #f8fafc; padding: 16px 12px; text-align: left; font-weight: 600; color: #374151; border-bottom: 1px solid #e2e8f0; font-size: 14px;">담당자</th>
                                        <th style="background: #f8fafc; padding: 16px 12px; text-align: left; font-weight: 600; color: #374151; border-bottom: 1px solid #e2e8f0; font-size: 14px;">작업</th>
                                    </tr>
                                </thead>
                                <tbody id="team-leader-customer-table-body">
                                    <!-- 데이터가 여기에 동적으로 로드됩니다 -->
                                </tbody>
                            </table>
                        </div>
                        
                        <!-- 페이지네이션 -->
                        <div id="team-leader-customer-pagination" style="display: flex; justify-content: center; align-items: center; gap: 10px; margin-top: 20px; padding: 20px;">
                            <!-- 페이지네이션 버튼들이 여기에 동적으로 생성됩니다 -->
                        </div>
                    </div>
                </div>

                <!-- 팀장 본인 메이플관리 섹션 -->
                <div id="team-leader-maeiple-section" style="display:none;">
                    <!-- 통계 카드 -->
                    <div class="dashboard-stats" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 16px; margin-bottom: 24px;">
                        <div class="stat-card" style="background: #ffffff; border-radius: 10px; padding: 12px; border: 1px solid #e2e8f0; box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);">
                            <div class="stat-header" style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 8px;">
                                <h3 class="stat-title" style="font-size: 12px; font-weight: 500; color: #64748b;">총 아파트</h3>
                                <div class="stat-icon" style="width: 24px; height: 24px; border-radius: 6px; display: flex; align-items: center; justify-content: center; font-size: 12px; background: #f0f9ff; color: #0ea5e9;">🏢</div>
                            </div>
                            <div id="total-maeiple-team-leader" class="stat-value" style="font-size: 20px; font-weight: 700; color: #1a202c; margin-bottom: 4px;">0</div>
                            <div class="stat-change" style="font-size: 11px; font-weight: 500; color: #64748b;">내 담당 매물</div>
                        </div>
                        <div class="stat-card" style="background: #ffffff; border-radius: 10px; padding: 12px; border: 1px solid #e2e8f0; box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);">
                            <div class="stat-header" style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 8px;">
                                <h3 class="stat-title" style="font-size: 12px; font-weight: 500; color: #64748b;">거래중</h3>
                                <div class="stat-icon" style="width: 24px; height: 24px; border-radius: 6px; display: flex; align-items: center; justify-content: center; font-size: 12px; background: #fef3c7; color: #f59e0b;">⏳</div>
                            </div>
                            <div id="available-maeiple-team-leader" class="stat-value" style="font-size: 20px; font-weight: 700; color: #1a202c; margin-bottom: 4px;">0</div>
                            <div class="stat-change" style="font-size: 11px; font-weight: 500; color: #64748b;">진행 중인 거래</div>
                        </div>
                        <div class="stat-card" style="background: #ffffff; border-radius: 10px; padding: 12px; border: 1px solid #e2e8f0; box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);">
                            <div class="stat-header" style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 8px;">
                                <h3 class="stat-title" style="font-size: 12px; font-weight: 500; color: #64748b;">거래완료</h3>
                                <div class="stat-icon" style="width: 24px; height: 24px; border-radius: 6px; display: flex; align-items: center; justify-content: center; font-size: 12px; background: #dcfce7; color: #16a34a;">✅</div>
                            </div>
                            <div id="completed-maeiple-team-leader" class="stat-value" style="font-size: 20px; font-weight: 700; color: #1a202c; margin-bottom: 4px;">0</div>
                            <div class="stat-change" style="font-size: 11px; font-weight: 500; color: #64748b;">완료된 거래</div>
                        </div>
                        <div class="stat-card" style="background: #ffffff; border-radius: 10px; padding: 12px; border: 1px solid #e2e8f0; box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);">
                            <div class="stat-header" style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 8px;">
                                <h3 class="stat-title" style="font-size: 12px; font-weight: 500; color: #64748b;">이번 주 신규</h3>
                                <div class="stat-icon" style="width: 24px; height: 24px; border-radius: 6px; display: flex; align-items: center; justify-content: center; font-size: 12px; background: #fce7f3; color: #ec4899;">📈</div>
                            </div>
                            <div id="new-maeiple-team-leader" class="stat-value" style="font-size: 20px; font-weight: 700; color: #1a202c; margin-bottom: 4px;">0</div>
                            <div class="stat-change" style="font-size: 11px; font-weight: 500; color: #64748b;">신규 등록</div>
                        </div>
                    </div>

                    <!-- 팀장 본인 매물 목록 카드 -->
                    <div class="card">
                        <div class="card-header" style="display: flex; justify-content: space-between; align-items: center;">
                            <h2 class="card-title">
                                <span>🏢</span>
                                팀장 본인 매물 목록
                            </h2>
                            <button class="btn btn-primary" onclick="addNewTeamLeaderMaeipleRow()">+ 매물 추가</button>
                        </div>
                        
                        <!-- 필터 섹션 -->
                        <div class="filter-section" style="padding: 12px 24px; border-bottom: 1px solid #e2e8f0; background: #ffffff; display: flex; gap: 24px; flex-wrap: wrap; align-items: center;">
                            <div class="filter-group" style="display: flex; align-items: center; gap: 8px;">
                                <span class="filter-label" style="color: #64748b; font-size: 13px; font-weight: 600; margin-right: 4px;">상태:</span>
                                <div class="filter-buttons" style="display: flex; gap: 6px;">
                                    <button class="filter-btn active" data-status="all" onclick="setTeamLeaderMaeipleFilter('all', this)" style="padding: 6px 10px; border: 1px solid #e2e8f0; background: #e0e7ff; color: #4338ca; border-radius: 20px; font-size: 12px; cursor: pointer; font-weight: 600;">전체</button>
                                    <button class="filter-btn" data-status="거래중" onclick="setTeamLeaderMaeipleFilter('거래중', this)" style="padding: 6px 10px; border: 1px solid #e2e8f0; background: #ffffff; color: #334155; border-radius: 20px; font-size: 12px; cursor: pointer;">거래중</button>
                                    <button class="filter-btn" data-status="거래완료" onclick="setTeamLeaderMaeipleFilter('거래완료', this)" style="padding: 6px 10px; border: 1px solid #e2e8f0; background: #ffffff; color: #334155; border-radius: 20px; font-size: 12px; cursor: pointer;">거래완료</button>
                                    <button class="filter-btn" data-status="보류" onclick="setTeamLeaderMaeipleFilter('보류', this)" style="padding: 6px 10px; border: 1px solid #e2e8f0; background: #ffffff; color: #334155; border-radius: 20px; font-size: 12px; cursor: pointer;">보류</button>
                                </div>
                            </div>
                        </div>
                        
                        <!-- 테이블 컨테이너 -->
                        <div class="table-container" style="background: white; border-radius: 12px; box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1); overflow: hidden;">
                            <table class="maeiple-table" style="width: 100%; border-collapse: collapse;">
                                <thead>
                                    <tr>
                                        <th style="background: #f8fafc; padding: 16px 12px; text-align: left; font-weight: 600; color: #374151; border-bottom: 1px solid #e2e8f0; font-size: 14px;">확인일</th>
                                        <th style="background: #f8fafc; padding: 16px 12px; text-align: left; font-weight: 600; color: #374151; border-bottom: 1px solid #e2e8f0; font-size: 14px;">동</th>
                                        <th style="background: #f8fafc; padding: 16px 12px; text-align: left; font-weight: 600; color: #374151; border-bottom: 1px solid #e2e8f0; font-size: 14px;">호수</th>
                                        <th style="background: #f8fafc; padding: 16px 12px; text-align: left; font-weight: 600; color: #374151; border-bottom: 1px solid #e2e8f0; font-size: 14px;">상태</th>
                                        <th style="background: #f8fafc; padding: 16px 12px; text-align: left; font-weight: 600; color: #374151; border-bottom: 1px solid #e2e8f0; font-size: 14px;">전세가</th>
                                        <th style="background: #f8fafc; padding: 16px 12px; text-align: left; font-weight: 600; color: #374151; border-bottom: 1px solid #e2e8f0; font-size: 14px;">월세</th>
                                        <th style="background: #f8fafc; padding: 16px 12px; text-align: left; font-weight: 600; color: #374151; border-bottom: 1px solid #e2e8f0; font-size: 14px;">매매가</th>
                                        <th style="background: #f8fafc; padding: 16px 12px; text-align: left; font-weight: 600; color: #374151; border-bottom: 1px solid #e2e8f0; font-size: 14px;">입주여부</th>
                                        <th style="background: #f8fafc; padding: 16px 12px; text-align: left; font-weight: 600; color: #374151; border-bottom: 1px solid #e2e8f0; font-size: 14px;">연락처</th>
                                        <th style="background: #f8fafc; padding: 16px 12px; text-align: left; font-weight: 600; color: #374151; border-bottom: 1px solid #e2e8f0; font-size: 14px;">메모</th>
                                        <th style="background: #f8fafc; padding: 16px 12px; text-align: left; font-weight: 600; color: #374151; border-bottom: 1px solid #e2e8f0; font-size: 14px;">좋아요</th>
                                        <th style="background: #f8fafc; padding: 16px 12px; text-align: left; font-weight: 600; color: #374151; border-bottom: 1px solid #e2e8f0; font-size: 14px;">싫어요</th>
                                        <th style="background: #f8fafc; padding: 16px 12px; text-align: left; font-weight: 600; color: #374151; border-bottom: 1px solid #e2e8f0; font-size: 14px;">담당자</th>
                                        <th style="background: #f8fafc; padding: 16px 12px; text-align: left; font-weight: 600; color: #374151; border-bottom: 1px solid #e2e8f0; font-size: 14px;">작업</th>
                                    </tr>
                                </thead>
                                <tbody id="team-leader-maeiple-table-body">
                                    <!-- 데이터가 여기에 동적으로 로드됩니다 -->
                                </tbody>
                            </table>
                        </div>
                        
                        <!-- 페이지네이션 -->
                        <div id="team-leader-maeiple-pagination" style="display: flex; justify-content: center; align-items: center; gap: 10px; margin-top: 20px; padding: 20px;">
                            <!-- 페이지네이션 버튼들이 여기에 동적으로 생성됩니다 -->
                        </div>
                    </div>
                </div>

                <!-- 팀 전체 고객관리 섹션 -->
                <div id="team-customer-section" style="display:none;">
                    <!-- 통계 카드 -->
                    <div class="dashboard-stats" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 16px; margin-bottom: 24px;">
                        <div class="stat-card" style="background: #ffffff; border-radius: 10px; padding: 12px; border: 1px solid #e2e8f0; box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);">
                            <div class="stat-header" style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 8px;">
                                <h3 class="stat-title" style="font-size: 12px; font-weight: 500; color: #64748b;">총 고객</h3>
                                <div class="stat-icon" style="width: 24px; height: 24px; border-radius: 6px; display: flex; align-items: center; justify-content: center; font-size: 12px; background: #eef2ff; color: #6366f1;">👥</div>
                            </div>
                            <div id="total-customers-team" class="stat-value" style="font-size: 20px; font-weight: 700; color: #1a202c; margin-bottom: 4px;">0</div>
                            <div class="stat-change" style="font-size: 11px; font-weight: 500; color: #64748b;">팀 전체 고객</div>
                        </div>
                        <div class="stat-card" style="background: #ffffff; border-radius: 10px; padding: 12px; border: 1px solid #e2e8f0; box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);">
                            <div class="stat-header" style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 8px;">
                                <h3 class="stat-title" style="font-size: 12px; font-weight: 500; color: #64748b;">진행중</h3>
                                <div class="stat-icon" style="width: 24px; height: 24px; border-radius: 6px; display: flex; align-items: center; justify-content: center; font-size: 12px; background: #fef3c7; color: #f59e0b;">⏳</div>
                            </div>
                            <div id="progress-customers-team" class="stat-value" style="font-size: 20px; font-weight: 700; color: #1a202c; margin-bottom: 4px;">0</div>
                            <div class="stat-change" style="font-size: 11px; font-weight: 500; color: #64748b;">진행 중인 고객</div>
                        </div>
                        <div class="stat-card" style="background: #ffffff; border-radius: 10px; padding: 12px; border: 1px solid #e2e8f0; box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);">
                            <div class="stat-header" style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 8px;">
                                <h3 class="stat-title" style="font-size: 12px; font-weight: 500; color: #64748b;">계약</h3>
                                <div class="stat-icon" style="width: 24px; height: 24px; border-radius: 6px; display: flex; align-items: center; justify-content: center; font-size: 12px; background: #dcfce7; color: #16a34a;">✅</div>
                            </div>
                            <div id="completed-customers-team" class="stat-value" style="font-size: 20px; font-weight: 700; color: #1a202c; margin-bottom: 4px;">0</div>
                            <div class="stat-change" style="font-size: 11px; font-weight: 500; color: #64748b;">계약 완료 고객</div>
                        </div>
                        <div class="stat-card" style="background: #ffffff; border-radius: 10px; padding: 12px; border: 1px solid #e2e8f0; box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);">
                            <div class="stat-header" style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 8px;">
                                <h3 class="stat-title" style="font-size: 12px; font-weight: 500; color: #64748b;">이번 주 신규</h3>
                                <div class="stat-icon" style="width: 24px; height: 24px; border-radius: 6px; display: flex; align-items: center; justify-content: center; font-size: 12px; background: #fce7f3; color: #ec4899;">📈</div>
                            </div>
                            <div id="new-customers-team" class="stat-value" style="font-size: 20px; font-weight: 700; color: #1a202c; margin-bottom: 4px;">0</div>
                            <div class="stat-change" style="font-size: 11px; font-weight: 500; color: #64748b;">신규 고객</div>
                        </div>
                    </div>

                    <!-- 팀 전체 고객 목록 카드 -->
                    <div class="card">
                        <div class="card-header" style="display: flex; justify-content: space-between; align-items: center;">
                            <h2 class="card-title">
                                <span>👥</span>
                                팀 전체 고객 목록 (팀장 + 팀원)
                            </h2>
                            <button class="btn btn-primary" onclick="addNewTeamCustomerRow()">+ 고객 추가</button>
                        </div>
                        
                        <!-- 필터 섹션 -->
                        <div class="filter-section" style="padding: 12px 24px; border-bottom: 1px solid #e2e8f0; background: #ffffff; display: flex; gap: 24px; flex-wrap: wrap; align-items: center;">
                            <div class="filter-group" style="display: flex; align-items: center; gap: 8px;">
                                <span class="filter-label" style="color: #64748b; font-size: 13px; font-weight: 600; margin-right: 4px;">상태:</span>
                                <div class="filter-buttons" style="display: flex; gap: 6px;">
                                    <button class="filter-btn active" data-status="all" onclick="setTeamCustomerFilter('all', this)" style="padding: 6px 10px; border: 1px solid #e2e8f0; background: #e0e7ff; color: #4338ca; border-radius: 20px; font-size: 12px; cursor: pointer; font-weight: 600;">전체</button>
                                    <button class="filter-btn" data-status="진행중" onclick="setTeamCustomerFilter('진행중', this)" style="padding: 6px 10px; border: 1px solid #e2e8f0; background: #ffffff; color: #334155; border-radius: 20px; font-size: 12px; cursor: pointer;">진행중</button>
                                    <button class="filter-btn" data-status="계약" onclick="setTeamCustomerFilter('계약', this)" style="padding: 6px 10px; border: 1px solid #e2e8f0; background: #ffffff; color: #334155; border-radius: 20px; font-size: 12px; cursor: pointer;">계약</button>
                                    <button class="filter-btn" data-status="보류" onclick="setTeamCustomerFilter('보류', this)" style="padding: 6px 10px; border: 1px solid #e2e8f0; background: #ffffff; color: #334155; border-radius: 20px; font-size: 12px; cursor: pointer;">보류</button>
                                </div>
                            </div>
                        </div>
                        
                        <!-- 테이블 컨테이너 -->
                        <div class="table-container" style="background: white; border-radius: 12px; box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1); overflow: hidden;">
                            <table class="data-table" style="width: 100%; border-collapse: collapse;">
                                <thead>
                                    <tr>
                                        <th style="background: #f8fafc; padding: 16px 12px; text-align: left; font-weight: 600; color: #374151; border-bottom: 1px solid #e2e8f0; font-size: 14px;">문의일</th>
                                        <th style="background: #f8fafc; padding: 16px 12px; text-align: left; font-weight: 600; color: #374151; border-bottom: 1px solid #e2e8f0; font-size: 14px;">고객명</th>
                                        <th style="background: #f8fafc; padding: 16px 12px; text-align: left; font-weight: 600; color: #374151; border-bottom: 1px solid #e2e8f0; font-size: 14px;">연락처</th>
                                        <th style="background: #f8fafc; padding: 16px 12px; text-align: left; font-weight: 600; color: #374151; border-bottom: 1px solid #e2e8f0; font-size: 14px;">예산</th>
                                        <th style="background: #f8fafc; padding: 16px 12px; text-align: left; font-weight: 600; color: #374151; border-bottom: 1px solid #e2e8f0; font-size: 14px;">방 개수</th>
                                        <th style="background: #f8fafc; padding: 16px 12px; text-align: left; font-weight: 600; color: #374151; border-bottom: 1px solid #e2e8f0; font-size: 14px;">위치</th>
                                        <th style="background: #f8fafc; padding: 16px 12px; text-align: left; font-weight: 600; color: #374151; border-bottom: 1px solid #e2e8f0; font-size: 14px;">대출</th>
                                        <th style="background: #f8fafc; padding: 16px 12px; text-align: left; font-weight: 600; color: #374151; border-bottom: 1px solid #e2e8f0; font-size: 14px;">주차</th>
                                        <th style="background: #f8fafc; padding: 16px 12px; text-align: left; font-weight: 600; color: #374151; border-bottom: 1px solid #e2e8f0; font-size: 14px;">펫</th>
                                        <th style="background: #f8fafc; padding: 16px 12px; text-align: left; font-weight: 600; color: #374151; border-bottom: 1px solid #e2e8f0; font-size: 14px;">메모</th>
                                        <th style="background: #f8fafc; padding: 16px 12px; text-align: left; font-weight: 600; color: #374151; border-bottom: 1px solid #e2e8f0; font-size: 14px;">진행상태</th>
                                        <th style="background: #f8fafc; padding: 16px 12px; text-align: left; font-weight: 600; color: #374151; border-bottom: 1px solid #e2e8f0; font-size: 14px;">담당자</th>
                                        <th style="background: #f8fafc; padding: 16px 12px; text-align: left; font-weight: 600; color: #374151; border-bottom: 1px solid #e2e8f0; font-size: 14px;">작업</th>
                                    </tr>
                                </thead>
                                <tbody id="team-customer-table-body">
                                    <!-- 데이터가 여기에 동적으로 로드됩니다 -->
                                </tbody>
                            </table>
                        </div>
                        
                        <!-- 페이지네이션 -->
                        <div id="team-customer-pagination" style="display: flex; justify-content: center; align-items: center; gap: 10px; margin-top: 20px; padding: 20px;">
                            <!-- 페이지네이션 버튼들이 여기에 동적으로 생성됩니다 -->
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 메모 모달 -->
    <div id="memoModal" class="modal" style="display: none; position: fixed; z-index: 1000; left: 0; top: 0; width: 100%; height: 100%; background-color: rgba(0, 0, 0, 0.5);">
        <div class="modal-content" style="background-color: white; margin: 5% auto; padding: 24px; border-radius: 12px; width: 90%; max-width: 500px; box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1);">
            <div class="modal-header" style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                <h3 class="modal-title" style="font-size: 20px; font-weight: 600; color: #1a202c;">특이사항 메모</h3>
                <button class="close" onclick="closeMemoModal()" style="background: none; border: none; font-size: 24px; cursor: pointer; color: #64748b;">&times;</button>
            </div>
            <textarea id="memoTextarea" class="memo-textarea" placeholder="메모를 입력하세요..." style="width: 100%; height: 120px; padding: 12px; border: 1px solid #d1d5db; border-radius: 8px; font-size: 14px; resize: vertical; font-family: inherit;"></textarea>
            <div class="modal-actions" style="display: flex; justify-content: flex-end; gap: 12px; margin-top: 20px;">
                <button class="btn btn-secondary" onclick="closeMemoModal()" style="padding: 10px 20px; background: #6b7280; color: white; border: none; border-radius: 8px; font-size: 14px; font-weight: 500; cursor: pointer;">취소</button>
                <button class="btn btn-primary" onclick="saveMemo()" style="padding: 10px 20px; background: #6366f1; color: white; border: none; border-radius: 8px; font-size: 14px; font-weight: 500; cursor: pointer;">저장</button>
            </div>
        </div>
    </div>

    <script>
        let employees = [];
        let currentEmployeePage = 1;
        let employeePerPage = 20;
        let employeeTotalPages = 0;
        
        // 메이플관리 관련 변수들
        let properties = [];
        let statusFilter = 'all';
        let occupiedFilter = 'all';
        let currentMaeiplePage = 1;
        let maeipePerPage = 20;
        let maeipleTotalPages = 0;
        let dealTypeFilterAdmin = 'all';
        let roomSearchFilterAdmin = '';
        let employeeSearchFilterAdmin = '';
        let teamFilterAdmin = 'all';
        let currentMemoId = null;
        let currentSortBy = 'check_date';
        let currentSortOrder = 'desc';
        let currentTeamSortBy = 'check_date';
        let currentTeamSortOrder = 'desc';
        
        // 팀장메이플관리 관련 변수들
        let teamProperties = [];
        let statusFilterTeam = 'all';
        let occupiedFilterTeam = 'all';
        let dealTypeFilterTeam = 'all';
        let roomSearchFilterTeam = '';
        let employeeSearchFilterTeam = '';
        let currentTeamMaeiplePage = 1;
        let teamMaeipePerPage = 20;
        let teamMaeipleTotalPages = 0;
        
        // 팀장고객관리 관련 변수들
        let teamCustomers = [];
        let currentTeamCustomerPage = 1;
        let teamCustomerPerPage = 20;
        let teamCustomerTotalPages = 0;
        let teamCustomerStatusFilter = 'all';
        
        // 사이트 전환 드롭다운 토글
        function toggleSiteSwitcher() {
            const switcher = document.getElementById('site-switcher');
            switcher.classList.toggle('active');
        }
        
        // 외부 클릭 시 드롭다운 닫기
        document.addEventListener('click', function(event) {
            const switcher = document.getElementById('site-switcher');
            if (!switcher.contains(event.target)) {
                switcher.classList.remove('active');
            }
        });
        
        // 페이지 로드 시 직원 목록 불러오기
        document.addEventListener('DOMContentLoaded', function() {
            showTab('employee');
            updateUserInfo();
            loadTeams(); // 팀 목록 먼저 로드
            loadEmployees();
            
            // 사용자 역할 확인하여 팀장 탭 표시
            checkUserRoleAndShowTabs();
            
            // 메모 텍스트 영역 이벤트 리스너 설정
            const memoTextarea = document.getElementById('memoTextarea');
            if (memoTextarea) {
                memoTextarea.addEventListener('input', updateMemoCharCount);
            }
        });
        
        // 사용자 정보 업데이트
        async function updateUserInfo() {
            try {
                const response = await fetch('/api/user-info');
                if (response.ok) {
                    const userInfo = await response.json();
                    
                    // 사용자 이름과 역할 업데이트
                    const userNameElement = document.getElementById('user-name');
                    const userRoleElement = document.getElementById('user-role');
                    const userAvatarElement = document.getElementById('user-avatar');
                    
                    if (userNameElement) {
                        userNameElement.textContent = userInfo.name || '사용자';
                    }
                    
                    if (userRoleElement) {
                        userRoleElement.textContent = userInfo.role || '직원';
                    }
                    
                    if (userAvatarElement) {
                        userAvatarElement.textContent = (userInfo.name || '사').charAt(0);
                    }
                }
            } catch (error) {
                console.error('사용자 정보 업데이트 오류:', error);
            }
        }
        
        // 사용자 역할 확인하여 탭 표시
        async function checkUserRoleAndShowTabs() {
            try {
                // 세션 정보를 확인하기 위해 API 호출
                const response = await fetch('/api/user-info');
                if (response.ok) {
                    const userInfo = await response.json();
                    console.log('🔍 사용자 정보 확인:', userInfo);
                    console.log('🔍 userInfo.role:', userInfo.role);
                    console.log('🔍 userInfo.employee_role:', userInfo.employee_role);
                    console.log('🔍 userInfo.role === "팀장":', userInfo.role === '팀장');
                    console.log('🔍 userInfo.employee_role === "팀장":', userInfo.employee_role === '팀장');
                    console.log('🔍 팀장 권한 확인 결과:', userInfo.role === '팀장' || userInfo.employee_role === '팀장');
                    
                    // 팀장인 경우에만 팀장메이플관리와 팀장고객관리 탭과 섹션 표시
                    if (userInfo.role === '팀장' || userInfo.employee_role === '팀장') {
                        const teamLeaderMaeipleNav = document.getElementById('team-leader-maeiple-nav');
                        const teamLeaderCustomerNav = document.getElementById('team-leader-customer-nav');
                        
                        if (teamLeaderMaeipleNav) {
                            teamLeaderMaeipleNav.style.display = 'flex';
                        }
                        if (teamLeaderCustomerNav) {
                            teamLeaderCustomerNav.style.display = 'flex';
                        }
                    } else {
                        // 관리자나 일반 직원인 경우 팀장 탭과 섹션들 숨김
                        const teamLeaderMaeipleNav = document.getElementById('team-leader-maeiple-nav');
                        const teamLeaderCustomerNav = document.getElementById('team-leader-customer-nav');
                        
                        if (teamLeaderMaeipleNav) {
                            teamLeaderMaeipleNav.style.display = 'none';
                        }
                        if (teamLeaderCustomerNav) {
                            teamLeaderCustomerNav.style.display = 'none';
                        }
                    }
                }
            } catch (error) {
                console.error('사용자 정보 확인 오류:', error);
                // 오류 시에도 팀장 탭과 섹션들은 숨김 상태 유지
                const teamLeaderMaeipleNav = document.getElementById('team-leader-maeiple-nav');
                const teamLeaderCustomerNav = document.getElementById('team-leader-customer-nav');
                
                if (teamLeaderMaeipleNav) {
                    teamLeaderMaeipleNav.style.display = 'none';
                }
                if (teamLeaderCustomerNav) {
                    teamLeaderCustomerNav.style.display = 'none';
                }
            }
        }
        
        // 팀 목록 불러오기
        async function loadTeams() {
            try {
                const response = await fetch('/api/teams');
                if (response.ok) {
                    const result = await response.json();
                    const teams = result.teams || [];
                    
                    console.log('✅ 팀 목록 로드 성공:', teams);
                    
                    // 새직원추가 폼의 팀선택 드롭다운 업데이트
                    updateTeamSelect('team', teams);
                    
                    // 팀 관리 모달의 삭제 팀선택 드롭다운 업데이트
                    updateTeamSelect('deleteTeamSelect', teams);
                    
                    // 직원 수정 폼의 팀선택 드롭다운도 업데이트 (동적으로 생성되는 경우)
                    updateTeamSelect('edit-team', teams);
                    
                } else {
                    console.error('❌ 팀 목록 로드 실패:', response.status);
                }
            } catch (error) {
                console.error('❌ 팀 목록 로드 오류:', error);
            }
        }
        
        // 팀선택 드롭다운 업데이트 함수
        function updateTeamSelect(selectId, teams) {
            const selectElement = document.getElementById(selectId);
            if (!selectElement) {
                console.warn(`⚠️ ID "${selectId}"를 가진 select 요소를 찾을 수 없음`);
                return;
            }
            
            // 기존 옵션들 제거 (첫 번째 "팀 선택" 옵션은 유지)
            const firstOption = selectElement.querySelector('option[value=""]');
            selectElement.innerHTML = '';
            
            // 첫 번째 옵션 복원
            if (firstOption) {
                selectElement.appendChild(firstOption);
            } else {
                // 기본 "팀 선택" 옵션 추가
                const defaultOption = document.createElement('option');
                defaultOption.value = '';
                defaultOption.textContent = '팀 선택';
                selectElement.appendChild(defaultOption);
            }
            
            // DB에서 가져온 팀들 추가
            teams.forEach(team => {
                const option = document.createElement('option');
                option.value = team.name;
                option.textContent = team.name;
                selectElement.appendChild(option);
            });
            
            console.log(`✅ "${selectId}" 팀선택 드롭다운 업데이트 완료: ${teams.length}개 팀`);
        }
        
        // 직원 목록 불러오기
        async function loadEmployees(page = 1) {
            console.log(`👥 직원 목록 로드 시작 (페이지 ${page})`);
            try {
                currentEmployeePage = page;
                const response = await fetch(`/api/employees?page=${page}&per_page=${employeePerPage}`);
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                
                const data = await response.json();
                
                if (data.error) {
                    throw new Error(data.error);
                }
                
                employees = Array.isArray(data.employees) ? data.employees : [];
                employeeTotalPages = data.total_pages || 0;
                console.log(`✅ 직원 목록 로드 완료: ${employees.length}개 (페이지 ${page}/${employeeTotalPages})`);
                
                displayEmployees(employees);
                updateTeamFilter();
                renderEmployeePagination();
            } catch (error) {
                console.error('❌ 직원 목록 로드 실패:', error);
                showAlert(`직원 목록을 불러오는데 실패했습니다: ${error.message}`, 'error');
                
                // 빈 테이블 표시
                const tbody = document.querySelector('#employee-table tbody');
                if (tbody) {
                    tbody.innerHTML = '<tr><td colspan="8" style="text-align: center; padding: 40px; color: #64748b;">직원 목록을 불러올 수 없습니다. 새로고침 버튼을 클릭해주세요.</td></tr>';
                }
            }
        }
        
        // 역할별 배지 색상 설정
        function getRoleBadgeColor(role) {
            switch(role) {
                case '팀장': return '#dcfce7';
                case '직원': return '#f1f5f9';
                default: return '#f1f5f9';
            }
        }

        function getRoleTextColor(role) {
            switch(role) {
                case '팀장': return '#166534';
                case '직원': return '#475569';
                default: return '#475569';
            }
        }

        // 팀별 배지 색상 설정
        function getTeamBadgeColor(team) {
            switch(team) {
                case '빈시트': return '#e0f2fe';
                case '위플러스': return '#f0fdf4';
                case '반클리셰': return '#fef7cd';
                case '대표': return '#fce7f3';
                default: return '#f1f5f9';
            }
        }

        function getTeamTextColor(team) {
            switch(team) {
                case '빈시트': return '#0c4a6e';
                case '위플러스': return '#166534';
                case '반클리셰': return '#a16207';
                case '대표': return '#be185d';
                default: return '#475569';
            }
        }

        // 직원 목록 표시
        function displayEmployees(employeeList) {
            const tbody = document.getElementById('employees-list');
            
            if (employeeList.length === 0) {
                tbody.innerHTML = '<tr><td colspan="7" style="text-align: center; padding: 40px; color: #64748b;">등록된 직원이 없습니다.</td></tr>';
                return;
            }
            
            tbody.innerHTML = employeeList.map(emp => `
                <tr data-employee-id="${emp.id}">
                    <td><strong>${emp.employee_id}</strong></td>
                    <td>${emp.employee_name}</td>
                    <td>
                        <span class="status-badge" style="background: ${getTeamBadgeColor(emp.team)}; color: ${getTeamTextColor(emp.team)};">
                            ${emp.team || '미지정'}
                        </span>
                    </td>
                    <td>
                        <span class="status-badge" style="background: ${getRoleBadgeColor(emp.role)}; color: ${getRoleTextColor(emp.role)};">
                            ${emp.role || '직원'}
                        </span>
                    </td>
                    <td>${emp.created_date}</td>
                    <td>
                        <span class="status-badge ${emp.is_active ? 'status-active' : 'status-inactive'}">
                            ${emp.is_active ? '활성' : '비활성'}
                        </span>
                    </td>
                    <td>
                        <div class="action-buttons">
                            ${emp.is_active ? 
                                `<button class="btn btn-danger btn-sm" onclick="deactivateEmployee(${emp.id})">비활성화</button>` :
                                `<button class="btn btn-success btn-sm" onclick="activateEmployee(${emp.id})">활성화</button>`
                            }
                            <button class="btn btn-primary btn-sm" onclick="editEmployee(${emp.id})">수정</button>
                            <button class="btn btn-secondary btn-sm" onclick="resetPassword(${emp.id})">비밀번호 재설정</button>
                            ${!emp.is_active ? 
                                `<button class="btn btn-danger btn-sm" onclick="permanentDelete(${emp.id})">완전삭제</button>` : ''
                            }
                        </div>
                    </td>
                </tr>
            `).join('');
        }
        
        // 팀 필터 업데이트
        function updateTeamFilter() {
            const teamFilter = document.getElementById('team-filter');
            const teams = [...new Set(employees.map(emp => emp.team).filter(team => team))];
            
            teamFilter.innerHTML = '<option value="">전체 팀</option>' + 
                teams.map(team => `<option value="${team}">${team}</option>`).join('');
        }
        
        // 필터 적용
        document.getElementById('status-filter').addEventListener('change', applyFilters);
        document.getElementById('team-filter').addEventListener('change', applyFilters);
        
        function applyFilters() {
            const statusFilter = document.getElementById('status-filter').value;
            const teamFilter = document.getElementById('team-filter').value;
            
            let filteredEmployees = employees;
            
            if (statusFilter !== '') {
                filteredEmployees = filteredEmployees.filter(emp => emp.is_active == statusFilter);
            }
            
            if (teamFilter !== '') {
                filteredEmployees = filteredEmployees.filter(emp => emp.team === teamFilter);
            }
            
            displayEmployees(filteredEmployees);
        }
        
        // 페이지 로드 시 통합 이벤트 리스너 설정 (한 번만 등록)
        document.addEventListener('DOMContentLoaded', function() {
            const form = document.getElementById('add-employee-form');
            if (form) {
                // 폼 제출 이벤트 - 추가/수정 모두 처리
                form.addEventListener('submit', async function(e) {
                    e.preventDefault();
                    
                    const submitBtn = document.getElementById('add-btn');
                    const isEditMode = form.dataset.editMode === 'true';
                    const empId = form.dataset.employeeId;
                    
                    // 버튼 로딩 상태
                    submitBtn.classList.add('loading');
                    submitBtn.disabled = true;
                    
                    const formData = {
                        employee_id: document.getElementById('employee_id').value,
                        employee_name: document.getElementById('employee_name').value,
                        team: document.getElementById('team').value,
                        employee_role: document.getElementById('employee_role').value,
                        employee_status: document.getElementById('employee_status').value
                    };
                    
                    try {
                        let response;
                        if (isEditMode && empId) {
                            // 수정 모드
                            response = await fetch(`/api/employees/${empId}/update`, {
                                method: 'PUT',
                                headers: { 'Content-Type': 'application/json' },
                                body: JSON.stringify(formData)
                            });
                        } else {
                            // 추가 모드
                            response = await fetch('/api/employees', {
                                method: 'POST',
                                headers: { 'Content-Type': 'application/json' },
                                body: JSON.stringify(formData)
                            });
                        }
                        
                        const result = await response.json();
                        
                        if (result.success) {
                            showAlert(isEditMode ? '직원 정보가 수정되었습니다.' : '직원이 성공적으로 추가되었습니다.', 'success');
                            resetEmployeeForm();
                            loadEmployees(currentEmployeePage);
                            
                            // 폼 숨기기
                            const addCard = document.getElementById('add-employee-card');
                            addCard.style.display = 'none';
                        } else {
                            showAlert(result.message || (isEditMode ? '직원 수정에 실패했습니다.' : '직원 추가에 실패했습니다.'), 'error');
                        }
                    } catch (error) {
                        console.error('직원 저장 오류:', error);
                        showAlert('서버 오류가 발생했습니다.', 'error');
                    } finally {
                        submitBtn.classList.remove('loading');
                        submitBtn.disabled = false;
                    }
                });
            }
        });
        
        // 직원 비활성화
        async function deactivateEmployee(empId) {
            if (!confirm('이 직원을 비활성화하시겠습니까?\n\n⚠️ 주의: 비활성화된 직원은 즉시 로그아웃되며 재접속이 불가능합니다.')) return;
            
            try {
                const response = await fetch(`/api/employees/${empId}`, {
                    method: 'DELETE'
                });
                
                const result = await response.json();
                
                if (result.success) {
                    showAlert(`✅ ${result.message}`, 'success');
                    
                    // 강제 로그아웃 알림
                    if (result.employee_name) {
                        setTimeout(() => {
                            showAlert(`🚫 ${result.employee_name} 직원이 강제 로그아웃되었습니다.`, 'warning');
                        }, 1000);
                    }
                    
                    loadEmployees();
                } else {
                    showAlert(result.message || '비활성화에 실패했습니다.', 'error');
                }
            } catch (error) {
                showAlert('서버 오류가 발생했습니다.', 'error');
            }
        }
        
        // 직원 활성화
        async function activateEmployee(empId) {
            try {
                const response = await fetch(`/api/employees/${empId}/activate`, {
                    method: 'PUT'
                });
                
                const result = await response.json();
                
                if (result.success) {
                    showAlert('직원이 활성화되었습니다.', 'success');
                    loadEmployees();
                } else {
                    showAlert('활성화에 실패했습니다.', 'error');
                }
            } catch (error) {
                showAlert('서버 오류가 발생했습니다.', 'error');
            }
        }
        
        // 비밀번호 재설정
        async function resetPassword(empId) {
            const newPassword = prompt('새 비밀번호를 입력하세요 (기본값: 1234):', '1234');
            if (!newPassword) return;
            
            try {
                const response = await fetch(`/api/employees/${empId}/reset-password`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ new_password: newPassword })
                });
                
                const result = await response.json();
                
                if (result.success) {
                    showAlert('비밀번호가 재설정되었습니다.', 'success');
                } else {
                    showAlert(result.message || '비밀번호 재설정에 실패했습니다.', 'error');
                }
            } catch (error) {
                showAlert('서버 오류가 발생했습니다.', 'error');
            }
        }
        
        // 직원 수정 - 직원추가 형식으로 표시
        async function editEmployee(empId) {
            const employee = employees.find(emp => emp.id === empId);
            if (!employee) {
                showAlert('직원을 찾을 수 없습니다.', 'error');
                return;
            }
            
            // 직원추가 폼을 수정 모드로 변경
            const addForm = document.getElementById('add-employee-form');
            const formTitle = document.querySelector('#employee-section h2');
            const submitBtn = document.getElementById('add-btn');
            
            // 폼 필드에 기존 값 설정
            document.getElementById('employee_id').value = employee.employee_id || '';
            document.getElementById('employee_id').readOnly = true; // ID는 수정 불가
            document.getElementById('employee_name').value = employee.employee_name || '';
            document.getElementById('team').value = employee.team || '';
            document.getElementById('employee_role').value = employee.role || '';
            document.getElementById('employee_status').value = employee.status || 'active';
            
            // 제목과 버튼 텍스트 변경
            formTitle.textContent = '직원 정보 수정';
            submitBtn.textContent = '수정 완료';
            submitBtn.classList.remove('btn-primary');
            submitBtn.classList.add('btn-warning');
            
            // 취소 버튼 표시
            const cancelBtn = document.getElementById('cancel-btn');
            if (cancelBtn) {
                cancelBtn.style.display = 'inline-flex';
            }
            
            // 폼을 수정 모드로 설정
            addForm.dataset.editMode = 'true';
            addForm.dataset.employeeId = empId;  // employeeId로 통일
            
            // 직원추가 폼 표시
            const addCard = document.getElementById('add-employee-card');
            addCard.style.display = 'block';
            
            // 직원추가 섹션으로 스크롤
            document.getElementById('employee-section').scrollIntoView({ behavior: 'smooth', block: 'start' });
            
            // 이벤트 리스너는 이미 DOMContentLoaded에서 한 번만 등록되므로 재등록 불필요
        }
        
        // [삭제됨] setupEditFormEventListeners - 통합 이벤트 핸들러로 대체됨
        
        // 직원 폼 초기화
        function resetEmployeeForm() {
            const form = document.getElementById('add-employee-form');
            const formTitle = document.querySelector('#employee-section h2');
            const submitBtn = document.getElementById('add-btn');
            
            // 폼 초기화
            form.reset();
            document.getElementById('employee_id').readOnly = false;
            document.getElementById('employee_status').value = 'active'; // 상태 필드 초기화
            
            // 제목과 버튼 원래대로 복원
            formTitle.textContent = '직원 추가';
            submitBtn.textContent = '직원 추가';
            submitBtn.classList.remove('btn-warning');
            submitBtn.classList.add('btn-primary');
            
            // 취소 버튼 숨기기
            const cancelBtn = document.getElementById('cancel-btn');
            if (cancelBtn) {
                cancelBtn.style.display = 'none';
            }
            
            // 수정 모드 해제
            delete form.dataset.editMode;
            delete form.dataset.employeeId;
            
            // 폼 숨기기 (필요시)
            // const addCard = document.getElementById('add-employee-card');
            // addCard.style.display = 'none';
        }
        
        // [삭제됨] setupAddEmployeeEventListeners - 통합 이벤트 핸들러로 대체됨
        
        // 직원 수정 모달 닫기 (더 이상 사용하지 않음)
        function closeEditEmployeeModal() {
            // 이 함수는 더 이상 사용되지 않습니다.
            // resetEmployeeForm() 함수를 사용하세요.
        }
        
        // 팀 추가 모달 표시
        function showAddTeamModal() {
            document.getElementById('addTeamModal').style.display = 'block';
            document.getElementById('newTeamName').value = '';
            document.getElementById('newTeamDescription').value = '';
            document.getElementById('newTeamName').focus();
        }
        
        // 팀 추가 모달 닫기
        function closeAddTeamModal() {
            document.getElementById('addTeamModal').style.display = 'none';
        }
        
        // 새 팀 추가
        async function addNewTeam() {
            const teamName = document.getElementById('newTeamName').value.trim();
            const teamDescription = document.getElementById('newTeamDescription').value.trim();
            
            if (!teamName) {
                showAlert('팀 이름을 입력해주세요.', 'error');
                return;
            }
            
            try {
                const response = await fetch('/api/teams', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        name: teamName,
                        description: teamDescription
                    })
                });
                
                const result = await response.json();
                
                if (result.success) {
                    // 팀 선택 드롭다운에 새 팀 추가
                    const teamSelect = document.getElementById('team');
                    if (teamSelect) {
                        const newOption = document.createElement('option');
                        newOption.value = teamName;
                        newOption.textContent = teamName;
                        teamSelect.appendChild(newOption);
                        console.log(`✅ 팀 선택 드롭다운에 "${teamName}" 추가됨`);
                } else {
                        console.warn('⚠️ team ID를 찾을 수 없음');
                    }
                    
                    // 삭제 팀 선택 드롭다운에도 추가
                    const deleteTeamSelect = document.getElementById('deleteTeamSelect');
                    if (deleteTeamSelect) {
                        const deleteOption = document.createElement('option');
                        deleteOption.value = teamName;
                        deleteOption.textContent = teamName;
                        deleteTeamSelect.appendChild(deleteOption);
                        console.log(`✅ 삭제 팀 선택 드롭다운에 "${teamName}" 추가됨`);
                    } else {
                        console.warn('⚠️ deleteTeamSelect ID를 찾을 수 없음');
                    }
                    
                    // 새로 추가된 팀 선택
                    if (teamSelect) {
                        teamSelect.value = teamName;
                    }
                    
                    // 입력 필드 초기화
                    document.getElementById('newTeamName').value = '';
                    document.getElementById('newTeamDescription').value = '';
                    
                    // 성공 메시지 표시
                    showAlert(`"${teamName}" 팀이 성공적으로 추가되었습니다!`, 'success');
                    
                    // 팀 목록 새로고침하여 모든 팀선택 드롭다운 업데이트
                    try {
                        await loadTeams();
                        console.log('✅ 팀 목록 새로고침 완료');
                    } catch (error) {
                        console.warn('⚠️ 팀 목록 새로고침 실패:', error);
                    }
                    
                    // 직원 목록도 새로고침하여 새 팀 반영
                    try {
                        await loadEmployees();
                        console.log('✅ 직원 목록 새로고침 완료');
                    } catch (error) {
                        console.warn('⚠️ 직원 목록 새로고침 실패:', error);
                    }
                    
                    // 2초 후 모달 자동 닫기 (선택사항)
                    setTimeout(() => {
                        if (confirm('팀이 추가되었습니다. 팀 관리 모달을 닫으시겠습니까?')) {
                            closeAddTeamModal();
                        }
                    }, 2000);
                } else {
                    showAlert(result.message || '팀 추가에 실패했습니다.', 'error');
                }
            } catch (error) {
                showAlert('서버 오류가 발생했습니다.', 'error');
            }
        }
        
        // 팀 삭제
        async function deleteTeam() {
            const teamName = document.getElementById('deleteTeamSelect').value;
            const deleteReason = document.getElementById('deleteTeamReason').value.trim();
            
            if (!teamName) {
                showAlert('삭제할 팀을 선택해주세요.', 'error');
                return;
            }
            
            if (!confirm(`정말로 "${teamName}" 팀을 삭제하시겠습니까?\n\n⚠️ 주의: 이 팀에 속한 직원들은 팀이 "미지정"으로 변경됩니다.\n\n이 작업은 되돌릴 수 없습니다.`)) {
                return;
            }
            
            try {
                const response = await fetch(`/api/teams/${encodeURIComponent(teamName)}`, {
                    method: 'DELETE',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        reason: deleteReason
                    })
                });
                
                const result = await response.json();
                
                if (result.success) {
                    showAlert(`"${teamName}" 팀이 삭제되었습니다.`, 'success');
                    
                    // 팀 목록 새로고침하여 모든 팀선택 드롭다운 업데이트
                    try {
                        await loadTeams();
                        console.log('✅ 팀 목록 새로고침 완료');
                    } catch (error) {
                        console.warn('⚠️ 팀 목록 새로고침 실패:', error);
                    }
                    
                    // 입력 필드 초기화
                    document.getElementById('deleteTeamSelect').value = '';
                    document.getElementById('deleteTeamReason').value = '';
                    
                    // 직원 목록 새로고침 (팀이 변경된 직원들 반영)
                    loadEmployees();
                    
                    // 팀 관리 모달 닫기 (선택사항)
                    setTimeout(() => {
                        if (confirm('팀이 삭제되었습니다. 팀 관리 모달을 닫으시겠습니까?')) {
                            closeAddTeamModal();
                        }
                    }, 1500);
                } else {
                    showAlert(result.message || '팀 삭제에 실패했습니다.', 'error');
                }
            } catch (error) {
                showAlert('서버 오류가 발생했습니다.', 'error');
            }
        }
        
        // 완전 삭제
        async function permanentDelete(empId) {
            if (!confirm('이 직원을 완전히 삭제하시겠습니까?\n\n⚠️ 주의: 삭제된 직원은 즉시 로그아웃되며 재접속이 불가능합니다.\n\n이 작업은 되돌릴 수 없습니다.')) return;
            
            try {
                const response = await fetch(`/api/employees/${empId}/permanent-delete`, {
                    method: 'DELETE'
                });
                
                const result = await response.json();
                
                if (result.success) {
                    showAlert(`✅ ${result.message}`, 'success');
                    
                    // 강제 로그아웃 알림
                    if (result.employee_name) {
                        setTimeout(() => {
                            showAlert(`🚫 ${result.employee_name} 직원이 강제 로그아웃되었습니다.`, 'warning');
                        }, 1000);
                    }
                    
                    // 직원 목록에서 즉시 제거
                    const employeesList = document.getElementById('employees-list');
                    const rowToRemove = employeesList.querySelector(`tr[data-employee-id="${empId}"]`);
                    if (rowToRemove) {
                        rowToRemove.remove();
                    }
                    
                    // 직원 목록 새로고침
                    loadEmployees();
                } else {
                    showAlert(result.message || '삭제에 실패했습니다.', 'error');
                }
            } catch (error) {
                showAlert('서버 오류가 발생했습니다.', 'error');
            }
        }
        
        // 알림 표시
        function showAlert(message, type) {
            const alertContainer = document.getElementById('alert-container');
            const alertDiv = document.createElement('div');
            alertDiv.className = `alert alert-${type}`;
            alertDiv.textContent = message;
            
            alertContainer.innerHTML = '';
            alertContainer.appendChild(alertDiv);
            
            setTimeout(() => {
                alertDiv.remove();
            }, 5000);
        }

        function activateEmployeeTab(e) {
            e.preventDefault();
            showTab('employee');
            
            // 사이드바 active 상태 업데이트
            document.querySelectorAll('.nav-item').forEach(item => item.classList.remove('active'));
            e.target.closest('.nav-item').classList.add('active');
            
            const section = document.getElementById('employee-section');
            if (section) {
                section.scrollIntoView({ behavior: 'smooth', block: 'start' });
            }
        }

        function activateMaeipeTab(e) {
            e.preventDefault();
            showTab('maeiple');
            
            // 사이드바 active 상태 업데이트
            document.querySelectorAll('.nav-item').forEach(item => item.classList.remove('active'));
            e.target.closest('.nav-item').classList.add('active');
            
            const section = document.getElementById('maeiple-section');
            if (section) {
                section.scrollIntoView({ behavior: 'smooth', block: 'start' });
            }
            
            // 메이플관리 데이터 로드 (오류 처리 강화)
            console.log('🏢 메이플관리 탭 활성화');
            try {
                loadMaeipeProperties();
            } catch (error) {
                console.error('❌ 메이플 데이터 로드 실패:', error);
                showAlert('메이플 데이터를 불러오는데 실패했습니다. 새로고침 버튼을 클릭해주세요.', 'error');
            }
            
            // 기본적으로 아파트목록 탭 활성화
            switchMaeipleTab('list');
        }
        
        function switchMaeipleTab(tabName) {
            // 모든 탭 버튼에서 active 클래스 제거
            document.querySelectorAll('#maeiple-section .tab-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            
            // 모든 탭 콘텐츠 숨기기
            document.querySelectorAll('#maeiple-section .tab-content').forEach(content => {
                content.classList.remove('active');
            });
            
            // 선택된 탭 버튼 활성화
            const activeBtn = document.querySelector(`#maeiple-section .tab-btn[data-tab="${tabName}"]`);
            if (activeBtn) {
                activeBtn.classList.add('active');
            }
            
            // 선택된 탭 콘텐츠 표시
            const activeContent = document.getElementById(`maeiple-tab-${tabName}`);
            if (activeContent) {
                activeContent.classList.add('active');
            }
            
            // 탭에 따라 데이터 로드
            if (tabName === 'list') {
                loadMaeipeProperties();
            }
        }
        


        function activateTeamMaeipeTab(e) {
            e.preventDefault();
            showTab('team-maeiple');
            
            // 사이드바 active 상태 업데이트
            document.querySelectorAll('.nav-item').forEach(item => item.classList.remove('active'));
            e.target.closest('.nav-item').classList.add('active');
            
            const section = document.getElementById('team-maeiple-section');
            if (section) {
                section.scrollIntoView({ behavior: 'smooth', block: 'start' });
            }
            
            // 팀장메이플관리 데이터 로드
            loadTeamMaeipeProperties();
        }

        function activateDashboardTab(e) {
            e.preventDefault();
            showTab('dashboard');
            
            // 사이드바 active 상태 업데이트
            document.querySelectorAll('.nav-item').forEach(item => item.classList.remove('active'));
            e.target.closest('.nav-item').classList.add('active');
            
            const section = document.getElementById('dashboard-section');
            if (section) {
                section.scrollIntoView({ behavior: 'smooth', block: 'start' });
            }
            
            // 고객 데이터 로드 (오류 처리 강화)
            console.log('👥 고객관리 탭 활성화');
            try {
                loadAllCustomers();
            } catch (error) {
                console.error('❌ 고객 데이터 로드 실패:', error);
                showAlert('고객 데이터를 불러오는데 실패했습니다. 새로고침 후 다시 시도해주세요.', 'error');
            }
        }

        function activateTeamLeaderCustomerTab(e) {
            e.preventDefault();
            showTab('team-leader-customer');
            
            // 사이드바 active 상태 업데이트
            document.querySelectorAll('.nav-item').forEach(item => item.classList.remove('active'));
            e.target.closest('.nav-item').classList.add('active');
            
            const section = document.getElementById('team-leader-customer-section');
            if (section) {
                section.scrollIntoView({ behavior: 'smooth', block: 'start' });
            }
            
            // 팀장 본인 고객 데이터 로드
            loadTeamLeaderCustomers();
        }

        function activateTeamLeaderMaeipleTab(e) {
            e.preventDefault();
            showTab('team-leader-maeiple');
            
            // 사이드바 active 상태 업데이트
            document.querySelectorAll('.nav-item').forEach(item => item.classList.remove('active'));
            e.target.closest('.nav-item').classList.add('active');
            
            const section = document.getElementById('team-leader-maeiple-section');
            if (section) {
                section.scrollIntoView({ behavior: 'smooth', block: 'start' });
            }
            
            // 팀장 본인 매물 데이터 로드
            loadTeamLeaderMaeiple();
        }

        function activateTeamCustomerTab(e) {
            e.preventDefault();
            showTab('team-customer');
            
            // 사이드바 active 상태 업데이트
            document.querySelectorAll('.nav-item').forEach(item => item.classList.remove('active'));
            e.target.closest('.nav-item').classList.add('active');
            
            const section = document.getElementById('team-customer-section');
            if (section) {
                section.scrollIntoView({ behavior: 'smooth', block: 'start' });
            }
            
            // 팀 전체 고객 데이터 로드
            loadTeamCustomers();
        }

        function activateGuaranteeTab(e) {
            e.preventDefault();
            showTab('guarantee');
            
            // 사이드바 active 상태 업데이트
            document.querySelectorAll('.nav-item').forEach(item => item.classList.remove('active'));
            e.target.closest('.nav-item').classList.add('active');
            
            const section = document.getElementById('guarantee-section');
            if (section) {
                section.scrollIntoView({ behavior: 'smooth', block: 'start' });
            }
            
            // 보증보험 매물 데이터는 서버 렌더링으로 이미 로드되어 있음
            console.log('🛡️ 보증보험매물 탭 활성화');
        }

        function showTab(tab) {
            console.log(`🎯 탭 전환: ${tab}`);
            
            const emp = document.getElementById('employee-section');
            const guar = document.getElementById('guarantee-section');
            const maeiple = document.getElementById('maeiple-section');
            const teamMaeiple = document.getElementById('team-maeiple-section');
            const dashboard = document.getElementById('dashboard-section');
            const teamCustomer = document.getElementById('team-customer-section');
            const teamLeaderCustomer = document.getElementById('team-leader-customer-section');
            const teamLeaderMaeiple = document.getElementById('team-leader-maeiple-section');
            
            // 섹션 존재 여부 확인
            const sections = {
                'employee': emp,
                'guarantee': guar,
                'maeiple': maeiple,
                'team-maeiple': teamMaeiple,
                'dashboard': dashboard,
                'team-customer': teamCustomer,
                'team-leader-customer': teamLeaderCustomer,
                'team-leader-maeiple': teamLeaderMaeiple
            };
            
            // 누락된 섹션 확인
            Object.entries(sections).forEach(([key, element]) => {
                if (!element) {
                    console.error(`❌ 섹션 누락: ${key}-section`);
                }
            });
            
            // 모든 섹션 숨기기
            Object.values(sections).forEach(section => {
                if (section) section.style.display = 'none';
            });
            
            // 선택된 탭만 표시
            const targetSection = sections[tab];
            if (targetSection) {
                targetSection.style.display = '';
                console.log(`✅ 탭 표시 완료: ${tab}`);
            } else {
                console.error(`❌ 알 수 없는 탭: ${tab}`);
                // 기본적으로 직원 탭 표시
                if (emp) emp.style.display = '';
            }
        }

        function toggleAddEmployee() {
            const card = document.getElementById('add-employee-card');
            const form = document.getElementById('add-employee-form');
            
            // 수정 모드일 때는 폼을 숨기지 않음
            if (form.dataset.editMode === 'true') {
                return;
            }
            
            if (card.style.display === 'none' || card.style.display === '') {
                card.style.display = 'block';
            } else {
                card.style.display = 'none';
            }
        }

        // ==================== 메이플관리 관련 함수들 ====================
        
        // 매물 목록 조회
        async function loadMaeipeProperties(page = 1) {
            try {
                currentMaeiplePage = page;
                const url = `/api/maeiple?sort_by=${currentSortBy}&sort_order=${currentSortOrder}&page=${page}&per_page=${maeipePerPage}`;
                const response = await fetch(url);
                const data = await response.json();
                
                if (data.success) {
                    properties = data.properties;
                    maeipleTotalPages = data.total_pages || 0;
                    console.log(`메이플관리 매물 로드: ${properties.length}개 (페이지 ${page}/${maeipleTotalPages})`);
                    await updateAdminFilters(); // 담당자 및 팀 필터 업데이트 (DB에서 전체 목록 가져오기)
                    renderMaeipeProperties();
                    renderMaeipePagination();
                } else {
                    showMaeipeError('매물 목록을 불러오는데 실패했습니다.');
                }
            } catch (error) {
                console.error('Error:', error);
                showMaeipeError('매물 목록을 불러오는데 실패했습니다.');
            }
        }

        // 매물 목록 렌더링
        function renderMaeipeProperties() {
            const tableContent = document.getElementById('maeiple-table-content');
            
            // 필터 적용
            let list = Array.isArray(properties) ? properties.slice() : [];
            
            // 현황 필터
            if (statusFilter !== 'all') {
                list = list.filter(p => (p.status || '') === statusFilter);
            }
            
            // 실거주 필터
            if (occupiedFilter !== 'all') {
                const want = occupiedFilter === 'O';
                list = list.filter(p => !!p.is_occupied === want);
            }
            
            // 거래유형 필터 (관리자용)
            if (dealTypeFilterAdmin !== 'all') {
                list = list.filter(p => {
                    if (dealTypeFilterAdmin === '전세') {
                        const jeonsePrice = parseInt(String(p.jeonse_price || '0').replace(/[^\d]/g, '')) || 0;
                        return jeonsePrice > 0;
                    } else if (dealTypeFilterAdmin === '월세') {
                        const monthlyRent = parseInt(String(p.monthly_rent || '0').replace(/[^\d]/g, '')) || 0;
                        return monthlyRent > 0;
                    } else if (dealTypeFilterAdmin === '매매') {
                        const salePrice = parseInt(String(p.sale_price || '0').replace(/[^\d]/g, '')) || 0;
                        return salePrice > 0;
                    }
                    return true;
                });
            }
            
            // 호수 검색 필터 (관리자용)
            if (roomSearchFilterAdmin.trim()) {
                const searchTerm = roomSearchFilterAdmin.trim().toLowerCase();
                list = list.filter(p => {
                    const roomNumber = String(p.room_number || '').toLowerCase();
                    return roomNumber.includes(searchTerm);
                });
            }
            
            // 담당자 검색 필터 (관리자용)
            if (employeeSearchFilterAdmin.trim()) {
                const searchTerm = employeeSearchFilterAdmin.trim().toLowerCase();
                list = list.filter(p => {
                    const employeeName = String(p.employee_name || '').toLowerCase();
                    return employeeName.includes(searchTerm);
                });
            }
            
            // 팀 필터 (관리자용)
            if (teamFilterAdmin !== 'all') {
                list = list.filter(p => (p.employee_team || '') === teamFilterAdmin);
            }
            
            if (list.length === 0) {
                tableContent.innerHTML = `
                    <div style="text-align: center; padding: 60px 20px; color: #64748b;">
                        <div style="font-size: 48px; margin-bottom: 16px; opacity: 0.5;">🏢</div>
                        <p>조건에 맞는 매물이 없습니다.</p>
                        <p>필터를 변경하거나 새 매물을 추가해보세요.</p>
                    </div>
                `;
                return;
            }
            
            let tableHTML = `
                <table class="employees-table">
                    <thead>
                        <tr>
                            <th style="width: 50px;">
                                <input type="checkbox" id="select-all-properties" onchange="toggleSelectAll(this)" 
                                       style="width: 16px; height: 16px; cursor: pointer;">
                            </th>
                            <th>
                                <div style="display: flex; align-items: center; gap: 4px; cursor: pointer; user-select: none;" onclick="toggleSort('check_date')">
                                    확인날짜
                                    <span style="font-size: 12px; color: #9ca3af;">${currentSortBy === 'check_date' ? (currentSortOrder === 'desc' ? '▼' : '▲') : '↕️'}</span>
                                </div>
                            </th>
                            <th>동</th>
                            <th>호수</th>
                            <th>현황</th>
                            <th>전세 (만원)</th>
                            <th>월세보증금 (만원)</th>
                            <th>월세 (만원)</th>
                            <th>매매 (만원)</th>
                            <th>실거주 여부</th>
                            <th>전화번호</th>
                            <th>특이사항</th>
                            <th>담당자</th>
                            <th>팀</th>
                            <th>좋아요</th>
                            <th>싫어요</th>
                            <th>수정</th>
                        </tr>
                    </thead>
                    <tbody>
            `;
            
            list.forEach(property => {
                const memoPreview = property.memo ? (property.memo.length > 20 ? property.memo.substring(0, 20) + '...' : property.memo) : '';
                
                tableHTML += `
                    <tr data-property-id="${property.id}">
                        <td style="text-align: center;">
                            <input type="checkbox" class="property-checkbox" value="${property.id}" 
                                   onchange="updateSelectionCount()" style="width: 16px; height: 16px; cursor: pointer;">
                        </td>
                        <td class="editable-cell" data-field="check_date" data-type="date" onclick="editPropertyCell(this)" style="cursor: pointer;">${property.check_date || ''}</td>
                        <td class="editable-cell" data-field="building_number" data-type="text" onclick="editPropertyCell(this)" style="cursor: pointer;">${property.building_number || ''}</td>
                        <td class="editable-cell" data-field="room_number" data-type="text" onclick="editPropertyCell(this)" style="cursor: pointer;">${property.room_number || ''}</td>
                        <td class="editable-cell" data-field="status" data-type="select" onclick="editPropertyCell(this)" style="cursor: pointer;">
                            <span class="badge" style="${property.status === '계약완료' ? 'background: #d1fae5; color: #065f46;' : property.status === '보류' ? 'background: #fef3c7; color: #92400e;' : property.status === '부재' ? 'background: #ede9fe; color: #5b21b6;' : 'background: #e0f2fe; color: #0369a1;'}; padding: 4px 8px; border-radius: 4px; font-size: 12px; font-weight: 500;">
                                ${property.status || '거래가능'}
                            </span>
                        </td>
                        <td class="editable-cell" data-field="jeonse_price" data-type="number" onclick="editPropertyCell(this)" style="cursor: pointer; color: #2563eb; font-weight: 500;">
                            ${property.jeonse_price ? formatNumber(property.jeonse_price) + ' 만원' : '-'}
                        </td>
                        <td class="editable-cell" data-field="deposit" data-type="number" onclick="editPropertyCell(this)" style="cursor: pointer; color: #2563eb; font-weight: 500;">
                            ${property.deposit ? formatNumber(property.deposit) + ' 만원' : '-'}
                        </td>
                        <td class="editable-cell" data-field="monthly_rent" data-type="number" onclick="editPropertyCell(this)" style="cursor: pointer; color: #2563eb; font-weight: 500;">
                            ${property.monthly_rent ? formatNumber(property.monthly_rent) + ' 만원' : '-'}
                        </td>
                        <td class="editable-cell" data-field="sale_price" data-type="number" onclick="editPropertyCell(this)" style="cursor: pointer; color: #2563eb; font-weight: 500;">
                            ${property.sale_price ? formatNumber(property.sale_price) + ' 만원' : '-'}
                        </td>
                        <td class="editable-cell" data-field="is_occupied" data-type="select" onclick="editPropertyCell(this)" style="cursor: pointer;">
                            <span class="badge" style="${property.is_occupied ? 'background: #d1fae5; color: #065f46;' : 'background: #fecaca; color: #dc2626;'}; padding: 4px 8px; border-radius: 4px; font-size: 12px; font-weight: 500;">
                                ${property.is_occupied ? 'O' : 'X'}
                            </span>
                        </td>
                        <td class="editable-cell" data-field="phone" data-type="text" onclick="editPropertyCell(this)" style="cursor: pointer; font-family: monospace; letter-spacing: 0.5px; max-width: 120px; overflow: hidden; text-overflow: ellipsis;">
                            ${property.phone || '-'}
                        </td>
                        <td class="memo-cell" onclick="openPropertyMemoModal(${property.id}, '${(property.memo || '').replace(/'/g, "\\'")}', '${property.building_number || ''}', '${property.room_number || ''}')" style="color: #64748b; font-style: italic; max-width: 150px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; cursor: pointer;">
                            ${property.memo ? (property.memo.length > 20 ? property.memo.substring(0, 20) + '...' : property.memo) : '-'}
                        </td>
                        <td class="editable-cell" data-field="employee_id" data-type="select" onclick="editPropertyCell(this)" style="cursor: pointer;">
                            <span style="color: #4f46e5; font-weight: 500;">
                                ${property.employee_name || '미지정'}
                            </span>
                        </td>
                        <td class="editable-cell" data-field="employee_team" data-type="select" onclick="editPropertyCell(this)" style="cursor: pointer;">
                            <span class="status-badge" style="background: ${getTeamBadgeColor(property.employee_team)}; color: ${getTeamTextColor(property.employee_team)};">
                                ${property.employee_team || '미지정'}
                            </span>
                        </td>
                        <td class="editable-cell" data-field="likes" data-type="number" onclick="editPropertyCell(this)" style="cursor: pointer;">
                            <div>
                                ${'❤️'.repeat(property.likes)}${property.likes === 0 ? '🤍' : ''}
                            </div>
                        </td>
                        <td class="editable-cell" data-field="dislikes" data-type="number" onclick="editPropertyCell(this)" style="cursor: pointer;">
                            <div>
                                ${'👎'.repeat(property.dislikes)}${property.dislikes === 0 ? '🤍' : ''}
                            </div>
                        </td>
                        <td>
                            <div class="edit-controls" data-property-id="${property.id}">
                                <button class="btn btn-outline-primary btn-sm edit-btn" onclick="enableRowEdit(${property.id})" style="font-size: 11px; padding: 4px 8px;">
                                    ✏️ 수정
                                </button>
                                <button class="btn btn-success btn-sm complete-btn" onclick="completeRowEdit(${property.id})" style="display: none; font-size: 11px; padding: 4px 8px;">
                                    ✅ 완료
                                </button>
                            </div>
                        </td>

                    </tr>
                `;
            });
            
            tableHTML += `
                    </tbody>
                </table>
            `;
            
            tableContent.innerHTML = tableHTML;
        }

        // ==================== 메이플관리 직원페이지 방식 수정 기능 ====================
        
        // 행 수정 활성화 (수정 버튼 클릭 시)
        function enableRowEdit(propertyId) {
            const row = document.querySelector(`tr[data-property-id="${propertyId}"]`);
            if (!row) return;
            
            // 행에 수정 모드 표시
            row.classList.add('edit-mode');
            
            // 모든 셀에 수정 가능 표시 추가
            const editableCells = row.querySelectorAll('.editable-cell');
            editableCells.forEach(cell => {
                cell.style.border = '2px dashed #3b82f6';
                cell.style.backgroundColor = '#eff6ff';
            });
            
            // 버튼 상태 변경
            const editControls = row.querySelector('.edit-controls');
            if (editControls) {
                editControls.querySelector('.edit-btn').style.display = 'none';
                editControls.querySelector('.complete-btn').style.display = 'inline-block';
            }
            
            showAlert(`매물 ${propertyId}번 수정 모드가 활성화되었습니다. 원하는 셀을 클릭하여 수정하세요.`, 'info');
        }
        
        // 행 수정 완료 (완료 버튼 클릭 시)
        function completeRowEdit(propertyId) {
            const row = document.querySelector(`tr[data-property-id="${propertyId}"]`);
            if (!row) return;
            
            // 수정 모드 해제
            row.classList.remove('edit-mode');
            
            // 모든 셀의 수정 가능 표시 제거
            const editableCells = row.querySelectorAll('.editable-cell');
            editableCells.forEach(cell => {
                cell.style.border = '';
                cell.style.backgroundColor = '';
            });
            
            // 버튼 상태 복원
            const editControls = row.querySelector('.edit-controls');
            if (editControls) {
                editControls.querySelector('.edit-btn').style.display = 'inline-block';
                editControls.querySelector('.complete-btn').style.display = 'none';
            }
            
            showAlert(`매물 ${propertyId}번 수정이 완료되었습니다.`, 'success');
        }
        
        // 매물 셀 편집 (직원페이지 방식)
        async function editPropertyCell(cell) {
            // 이미 편집 중이면 편집 모드 종료
            if (cell.classList.contains('editing-cell')) {
                const existingSelector = cell.querySelector('.status-selector');
                if (existingSelector) {
                    existingSelector.remove();
                }
                cell.classList.remove('editing-cell');
                return;
            }
            
            const field = cell.dataset.field;
            const type = cell.dataset.type;
            let currentValue = cell.textContent.trim();
            
            // 배지에서 실제 값 추출
            if (field === 'status') {
                const badge = cell.querySelector('.badge');
                currentValue = badge ? badge.textContent.trim() : currentValue;
            } else if (field === 'is_occupied') {
                const badge = cell.querySelector('.badge');
                currentValue = badge ? badge.textContent.trim() : currentValue;
            }
            
            console.log(`매물 셀 편집 시작: ${field}, 타입: ${type}, 현재값: "${currentValue}"`);
            
            cell.classList.add('editing-cell');
            
            let inputElement;
            
            // 현황 선택 (버튼 형태)
            if (type === 'select' && field === 'status') {
                const statusContainer = document.createElement('div');
                statusContainer.className = 'status-selector';
                statusContainer.innerHTML = `
                    <div class="status-options">
                        <button type="button" class="status-option ${currentValue === '거래가능' ? 'active' : ''}" data-value="거래가능">
                            <span class="status-icon">🔄</span>
                            <span class="status-text">거래가능</span>
                        </button>
                        <button type="button" class="status-option ${currentValue === '계약완료' ? 'active' : ''}" data-value="계약완료">
                            <span class="status-icon">✅</span>
                            <span class="status-text">계약완료</span>
                        </button>
                        <button type="button" class="status-option ${currentValue === '보류' ? 'active' : ''}" data-value="보류">
                            <span class="status-icon">⏸️</span>
                            <span class="status-text">보류</span>
                        </button>
                        <button type="button" class="status-option ${currentValue === '부재' ? 'active' : ''}" data-value="부재">
                            <span class="status-icon">❌</span>
                            <span class="status-text">부재</span>
                        </button>
                    </div>
                `;
                
                cell.innerHTML = '';
                cell.appendChild(statusContainer);
                
                // 버튼 클릭 이벤트 처리
                const buttons = statusContainer.querySelectorAll('.status-option');
                buttons.forEach(btn => {
                    btn.addEventListener('click', async (e) => {
                        e.preventDefault();
                        e.stopPropagation();
                        
                        const selectedValue = btn.dataset.value;
                        
                        // 편집 모드 종료 및 UI 정리
                        cell.classList.remove('editing-cell');
                        
                        // UI 즉시 업데이트
                        const statusStyle = selectedValue === '계약완료' ? 'background: #d1fae5; color: #065f46;' : 
                                          selectedValue === '보류' ? 'background: #fef3c7; color: #92400e;' : 
                                          selectedValue === '부재' ? 'background: #ede9fe; color: #5b21b6;' : 
                                          'background: #e0f2fe; color: #0369a1;';
                        cell.innerHTML = `<span class="badge" style="${statusStyle}; padding:4px 8px; border-radius:4px; font-size:12px; font-weight:500;">${selectedValue}</span>`;
                        
                        // 서버에 저장
                        const row = cell.closest('tr');
                        const propertyId = row.dataset.propertyId;
                        if (propertyId) {
                            await savePropertyFieldQuiet(propertyId, field, selectedValue);
                        }
                    });
                });
                
                return;
                
            // 실거주 여부 선택 (토글 방식)
            } else if (type === 'select' && field === 'is_occupied') {
                const occupiedContainer = document.createElement('div');
                occupiedContainer.className = 'occupied-selector';
                occupiedContainer.innerHTML = `
                    <div class="occupied-options">
                        <button type="button" class="occupied-option ${currentValue === 'X' ? 'active' : ''}" data-value="false">
                            <span class="occupied-icon">🏠</span>
                            <span class="occupied-text">X (빈집)</span>
                        </button>
                        <button type="button" class="occupied-option ${currentValue === 'O' ? 'active' : ''}" data-value="true">
                            <span class="occupied-icon">👥</span>
                            <span class="occupied-text">O (입주중)</span>
                        </button>
                    </div>
                `;
                
                cell.innerHTML = '';
                cell.appendChild(occupiedContainer);
                
                // 버튼 클릭 이벤트 처리
                const buttons = occupiedContainer.querySelectorAll('.occupied-option');
                buttons.forEach(btn => {
                    btn.addEventListener('click', async (e) => {
                        e.preventDefault();
                        e.stopPropagation();
                        
                        const selectedValue = btn.dataset.value === 'true';
                        const displayValue = selectedValue ? 'O' : 'X';
                        
                        // 편집 모드 종료 및 UI 정리
                        cell.classList.remove('editing-cell');
                        
                        // UI 즉시 업데이트
                        const occupiedStyle = selectedValue ? 'background: #d1fae5; color: #065f46;' : 'background: #fecaca; color: #dc2626;';
                        cell.innerHTML = `<span class="badge" style="${occupiedStyle}; padding:4px 8px; border-radius:4px; font-size:12px; font-weight:500;">${displayValue}</span>`;
                        
                        // 서버에 저장
                        const row = cell.closest('tr');
                        const propertyId = row.dataset.propertyId;
                        if (propertyId) {
                            await savePropertyFieldQuiet(propertyId, field, selectedValue);
                        }
                    });
                });
                
                return;
                
            // 담당자 선택
            } else if (type === 'select' && field === 'employee_id') {
                // 현재 담당자 이름 추출
                const employeeSpan = cell.querySelector('span');
                const currentEmployeeName = employeeSpan ? employeeSpan.textContent.trim() : currentValue;
                await loadEmployeeSelectForCell(cell, currentEmployeeName);
                return;
                
            // 팀 선택
            } else if (type === 'select' && field === 'employee_team') {
                await loadTeamSelectForCell(cell, currentValue);
                return;
                
            // 메모 (textarea) - 별도 모달 처리로 제외
            } else if (type === 'textarea') {
                // 메모는 직접 셀 클릭으로 처리하므로 여기서는 아무것도 하지 않음
                return;
                
            // 일반 입력
            } else {
                inputElement = document.createElement('input');
                inputElement.type = type;
                
                // 숫자 필드인 경우 '만원' 제거
                if (type === 'number' && currentValue.includes('만원')) {
                    inputElement.value = currentValue.replace(/[^0-9]/g, '') || '';
                } else if (type === 'number' && field === 'likes') {
                    // 좋아요 선택 (버튼 방식)
                    const likesContainer = document.createElement('div');
                    likesContainer.className = 'likes-selector';
                    const currentCount = parseInt(currentValue.match(/\d+/)?.[0]) || 0;
                    
                    let likesHTML = '<div class="likes-options">';
                    for (let i = 0; i <= 5; i++) {
                        likesHTML += `
                            <button type="button" class="likes-option ${currentCount === i ? 'active' : ''}" data-value="${i}">
                                <span class="likes-icon">${'❤️'.repeat(i)}${i === 0 ? '🤍' : ''}</span>
                                <span class="likes-text">${i}</span>
                            </button>
                        `;
                    }
                    likesHTML += '</div>';
                    likesContainer.innerHTML = likesHTML;
                    
                    cell.innerHTML = '';
                    cell.appendChild(likesContainer);
                    
                    // 버튼 클릭 이벤트 처리
                    const buttons = likesContainer.querySelectorAll('.likes-option');
                    buttons.forEach(btn => {
                        btn.addEventListener('click', async (e) => {
                            e.preventDefault();
                            e.stopPropagation();
                            
                            const selectedValue = parseInt(btn.dataset.value);
                            
                            // 편집 모드 종료 및 UI 정리
                            cell.classList.remove('editing-cell');
                            
                            // UI 즉시 업데이트
                            cell.innerHTML = `<div>${'❤️'.repeat(selectedValue)}${selectedValue === 0 ? '🤍' : ''}</div>`;
                            
                            // 서버에 저장
                            const row = cell.closest('tr');
                            const propertyId = row.dataset.propertyId;
                            if (propertyId) {
                                await savePropertyFieldQuiet(propertyId, field, selectedValue);
                            }
                        });
                    });
                    
                    return;
                    
                } else if (type === 'number' && field === 'dislikes') {
                    // 싫어요 선택 (버튼 방식)
                    const dislikesContainer = document.createElement('div');
                    dislikesContainer.className = 'dislikes-selector';
                    const currentCount = parseInt(currentValue.match(/\d+/)?.[0]) || 0;
                    
                    let dislikesHTML = '<div class="dislikes-options">';
                    for (let i = 0; i <= 5; i++) {
                        dislikesHTML += `
                            <button type="button" class="dislikes-option ${currentCount === i ? 'active' : ''}" data-value="${i}">
                                <span class="dislikes-icon">${'👎'.repeat(i)}${i === 0 ? '🤍' : ''}</span>
                                <span class="dislikes-text">${i}</span>
                            </button>
                        `;
                    }
                    dislikesHTML += '</div>';
                    dislikesContainer.innerHTML = dislikesHTML;
                    
                    cell.innerHTML = '';
                    cell.appendChild(dislikesContainer);
                    
                    // 버튼 클릭 이벤트 처리
                    const buttons = dislikesContainer.querySelectorAll('.dislikes-option');
                    buttons.forEach(btn => {
                        btn.addEventListener('click', async (e) => {
                            e.preventDefault();
                            e.stopPropagation();
                            
                            const selectedValue = parseInt(btn.dataset.value);
                            
                            // 편집 모드 종료 및 UI 정리
                            cell.classList.remove('editing-cell');
                            
                            // UI 즉시 업데이트
                            cell.innerHTML = `<div>${'👎'.repeat(selectedValue)}${selectedValue === 0 ? '🤍' : ''}</div>`;
                            
                            // 서버에 저장
                            const row = cell.closest('tr');
                            const propertyId = row.dataset.propertyId;
                            if (propertyId) {
                                await savePropertyFieldQuiet(propertyId, field, selectedValue);
                            }
                        });
                    });
                    
                    return;
                    
                } else {
                    inputElement.value = currentValue === '-' ? '' : currentValue;
                }
                
                // 날짜 필드이고 값이 비어있으면 오늘 날짜로 자동 입력
                if (type === 'date' && !inputElement.value) {
                    const now = new Date();
                    now.setHours(now.getHours() + 9);
                    inputElement.value = now.toISOString().slice(0, 10);
                }
            }
            
            // 공통 스타일 적용
            inputElement.style.cssText = 'width: 100%; padding: 4px; border: 1px solid #d1d5db; border-radius: 4px; font-size: 12px;';
            
            cell.innerHTML = '';
            cell.appendChild(inputElement);
            inputElement.focus();
            
            // 저장 함수
            const saveCell = async (moveNext = false) => {
                const newValue = inputElement.value.trim();
                
                // 편집 모드 종료
                cell.classList.remove('editing-cell');
                
                // UI 즉시 업데이트
                if (field === 'is_occupied') {
                    const occupiedDisplay = newValue === 'true' ? 'O' : 'X';
                    const occupiedStyle = newValue === 'true' ? 'background: #d1fae5; color: #065f46;' : 'background: #fecaca; color: #dc2626;';
                    cell.innerHTML = `<span class="badge" style="${occupiedStyle}; padding:4px 8px; border-radius:4px; font-size:12px; font-weight:500;">${occupiedDisplay}</span>`;
                } else if (type === 'number' && ['jeonse_price', 'deposit', 'monthly_rent', 'sale_price'].includes(field)) {
                    // 가격 필드는 '만원' 추가
                    cell.textContent = newValue ? parseInt(newValue).toLocaleString() + ' 만원' : '-';
                } else if (type === 'number' && ['likes', 'dislikes'].includes(field)) {
                    // 좋아요/싫어요는 이모지로 표시
                    const count = parseInt(newValue) || 0;
                    if (field === 'likes') {
                        cell.innerHTML = `<div>${'❤️'.repeat(count)}${count === 0 ? '🤍' : ''}</div>`;
                    } else {
                        cell.innerHTML = `<div>${'👎'.repeat(count)}${count === 0 ? '🤍' : ''}</div>`;
                    }
                } else if (field === 'memo') {
                    const preview = newValue.length > 20 ? newValue.substring(0, 20) + '...' : newValue;
                    cell.textContent = preview || '메모 추가...';
                } else {
                    cell.textContent = newValue || '-';
                }
                
                // 서버에 저장
                const row = cell.closest('tr');
                const propertyId = row.dataset.propertyId;
                if (propertyId) {
                    let saveValue = newValue;
                    if (field === 'is_occupied') {
                        saveValue = newValue === 'true';
                    } else if (['likes', 'dislikes'].includes(field)) {
                        saveValue = parseInt(newValue) || 0;
                    } else if (['jeonse_price', 'deposit', 'monthly_rent', 'sale_price'].includes(field)) {
                        saveValue = newValue ? parseInt(newValue) : null;
                    }
                    
                    await savePropertyFieldQuiet(propertyId, field, saveValue);
                }
                
                // 엔터로 저장 후 옆 셀로 이동
                if (moveNext) {
                    const editableCells = Array.from(cell.parentElement.querySelectorAll('.editable-cell'));
                    const idx = editableCells.indexOf(cell);
                    if (idx !== -1 && idx < editableCells.length - 1) {
                        setTimeout(() => editPropertyCell(editableCells[idx + 1]), 50);
                    }
                }
            };
            
            // 이벤트 리스너
            inputElement.addEventListener('keydown', (e) => {
                if (e.key === 'Enter') {
                    e.preventDefault();
                    saveCell(true); // 엔터키로 다음 셀로 이동
                } else if (e.key === 'Escape') {
                    e.preventDefault();
                    cancelPropertyCellEdit(cell, currentValue);
                } else if (e.key === 'Tab') {
                    e.preventDefault();
                    saveCell(true); // 탭키로 다음 셀로 이동
                }
            });
            
            inputElement.addEventListener('blur', () => {
                saveCell();
            });
        }
        
        // 담당자 선택을 위한 셀 처리
        async function loadEmployeeSelectForCell(cell, currentEmployeeName) {
            try {
                const response = await fetch('/api/employees?per_page=1000');
                if (response.ok) {
                    const data = await response.json();
                    const employees = data.employees || [];
                    
                    const selectElement = document.createElement('select');
                    selectElement.style.cssText = 'width: 100%; padding: 4px; border: 1px solid #d1d5db; border-radius: 4px; font-size: 12px;';
                    selectElement.innerHTML = '<option value="">담당자 선택</option>';
                    
                    employees.forEach(emp => {
                        const selected = emp.employee_name === currentEmployeeName ? 'selected' : '';
                        selectElement.innerHTML += `<option value="${emp.id}" ${selected}>${emp.employee_name} (${emp.team || '미지정'})</option>`;
                    });
                    
                    cell.innerHTML = '';
                    cell.appendChild(selectElement);
                    selectElement.focus();
                    
                    // 저장 함수
                    const saveCell = async () => {
                        const selectedOption = selectElement.options[selectElement.selectedIndex];
                        const employeeId = selectElement.value;
                        const employeeName = selectedOption ? selectedOption.text.split(' (')[0] : '';
                        
                        console.log('담당자 변경:', { employeeId, employeeName });
                        
                        cell.classList.remove('editing-cell');
                        cell.innerHTML = `<span style="color: #4f46e5; font-weight: 500;">${employeeName || '미지정'}</span>`;
                        
                        // 서버에 저장
                        const row = cell.closest('tr');
                        const propertyId = row.dataset.propertyId;
                        if (propertyId) {
                            try {
                                // 담당자 ID와 이름을 동시에 저장
                                const updateData = {
                                    employee_id: employeeId || null,
                                    employee_name: employeeName || null
                                };
                                
                                const response = await fetch(`/api/maeiple/${propertyId}/update`, {
                                    method: 'PUT',
                                    headers: {
                                        'Content-Type': 'application/json'
                                    },
                                    body: JSON.stringify(updateData)
                                });
                                
                                if (response.ok) {
                                    console.log('담당자 저장 완료:', { employeeId, employeeName });
                                    
                                    // 로컬 데이터도 업데이트 (순서 유지)
                                    const property = properties.find(p => p.id == propertyId);
                                    if (property) {
                                        property.employee_id = employeeId;
                                        property.employee_name = employeeName;
                                    }
                                } else {
                                    throw new Error('담당자 저장 실패');
                                }
                            } catch (error) {
                                console.error('담당자 저장 오류:', error);
                                showAlert('담당자 저장 중 오류가 발생했습니다.', 'error');
                            }
                        }
                    };
                    
                    selectElement.addEventListener('change', saveCell);
                    selectElement.addEventListener('blur', saveCell);
                    selectElement.addEventListener('keydown', (e) => {
                        if (e.key === 'Enter' || e.key === 'Tab') {
                            e.preventDefault();
                            saveCell();
                        } else if (e.key === 'Escape') {
                            e.preventDefault();
                            cancelPropertyCellEdit(cell, currentEmployeeName);
                        }
                    });
                }
            } catch (error) {
                console.error('직원 목록 로드 오류:', error);
            }
        }
        
        // 팀 선택을 위한 셀 처리
        async function loadTeamSelectForCell(cell, currentTeam) {
            try {
                const response = await fetch('/api/teams');
                if (response.ok) {
                    const data = await response.json();
                    const teams = data.teams || [];
                    
                    const selectElement = document.createElement('select');
                    selectElement.style.cssText = 'width: 100%; padding: 4px; border: 1px solid #d1d5db; border-radius: 4px; font-size: 12px;';
                    selectElement.innerHTML = '<option value="">팀 선택</option>';
                    
                    teams.forEach(team => {
                        const selected = team.name === currentTeam ? 'selected' : '';
                        selectElement.innerHTML += `<option value="${team.name}" ${selected}>${team.name}</option>`;
                    });
                    
                    cell.innerHTML = '';
                    cell.appendChild(selectElement);
                    selectElement.focus();
                    
                    // 저장 함수
                    const saveCell = async () => {
                        const teamName = selectElement.value;
                        
                        cell.classList.remove('editing-cell');
                        cell.innerHTML = `<span class="status-badge" style="background: ${getTeamBadgeColor(teamName)}; color: ${getTeamTextColor(teamName)};">${teamName || '미지정'}</span>`;
                        
                        // 서버에 저장
                        const row = cell.closest('tr');
                        const propertyId = row.dataset.propertyId;
                        if (propertyId) {
                            await savePropertyFieldQuiet(propertyId, 'employee_team', teamName);
                            
                            // 로컬 데이터도 업데이트 (순서 유지)
                            const property = properties.find(p => p.id == propertyId);
                            if (property) {
                                property.employee_team = teamName;
                            }
                        }
                    };
                    
                    selectElement.addEventListener('change', saveCell);
                    selectElement.addEventListener('blur', saveCell);
                    selectElement.addEventListener('keydown', (e) => {
                        if (e.key === 'Enter' || e.key === 'Tab') {
                            e.preventDefault();
                            saveCell();
                        } else if (e.key === 'Escape') {
                            e.preventDefault();
                            cancelPropertyCellEdit(cell, currentTeam);
                        }
                    });
                }
            } catch (error) {
                console.error('팀 목록 로드 오류:', error);
            }
        }
        
        // 셀 편집 취소
        function cancelPropertyCellEdit(cell, originalValue) {
            cell.classList.remove('editing-cell');
            
            const field = cell.dataset.field;
            
            if (field === 'status') {
                const statusStyle = originalValue === '계약완료' ? 'background: #d1fae5; color: #065f46;' : 
                                   originalValue === '보류' ? 'background: #fef3c7; color: #92400e;' : 
                                   originalValue === '부재' ? 'background: #ede9fe; color: #5b21b6;' : 
                                   'background: #e0f2fe; color: #0369a1;';
                cell.innerHTML = `<span class="badge" style="${statusStyle}; padding:4px 8px; border-radius:4px; font-size:12px; font-weight:500;">${originalValue}</span>`;
            } else if (field === 'is_occupied') {
                const occupiedDisplay = originalValue === 'O' ? 'O' : 'X';
                const occupiedStyle = originalValue === 'O' ? 'background: #d1fae5; color: #065f46;' : 'background: #fecaca; color: #dc2626;';
                cell.innerHTML = `<span class="badge" style="${occupiedStyle}; padding:4px 8px; border-radius:4px; font-size:12px; font-weight:500;">${occupiedDisplay}</span>`;
            } else {
                cell.textContent = originalValue;
            }
        }
        
        // 수정 모드 시작 (수정 버튼 클릭 시)
        function startEditProperty(propertyId) {
            const row = document.querySelector(`tr[data-property-id="${propertyId}"]`);
            if (!row) return;
            
            // 현재 매물 데이터 찾기
            const property = properties.find(p => p.id === propertyId);
            if (!property) {
                showAlert('매물 정보를 찾을 수 없습니다.', 'error');
                return;
            }
            
            // 모든 셀을 수정 가능한 input으로 변경
            const cells = row.querySelectorAll('td');
            
            // 각 필드별로 적절한 input 생성
            cells[0].innerHTML = `<input type="date" value="${property.check_date || ''}" class="edit-input" data-field="check_date" style="width: 100%; padding: 4px;">`;
            cells[1].innerHTML = `<input type="text" value="${property.building_number || ''}" class="edit-input" data-field="building_number" placeholder="동" style="width: 100%; padding: 4px;">`;
            cells[2].innerHTML = `<input type="text" value="${property.room_number || ''}" class="edit-input" data-field="room_number" placeholder="호수" style="width: 100%; padding: 4px;">`;
            
            // 현황 선택
            cells[3].innerHTML = `
                <select class="edit-input" data-field="status" style="width: 100%; padding: 4px;">
                    <option value="거래가능" ${(property.status || '거래가능') === '거래가능' ? 'selected' : ''}>거래가능</option>
                    <option value="계약완료" ${property.status === '계약완료' ? 'selected' : ''}>계약완료</option>
                    <option value="보류" ${property.status === '보류' ? 'selected' : ''}>보류</option>
                    <option value="부재" ${property.status === '부재' ? 'selected' : ''}>부재</option>
                </select>
            `;
            
            // 가격 필드들
            cells[4].innerHTML = `<input type="number" value="${property.jeonse_price || ''}" class="edit-input" data-field="jeonse_price" placeholder="전세가" style="width: 100%; padding: 4px;">`;
            cells[5].innerHTML = `<input type="number" value="${property.deposit || ''}" class="edit-input" data-field="deposit" placeholder="보증금" style="width: 100%; padding: 4px;">`;
            cells[6].innerHTML = `<input type="number" value="${property.monthly_rent || ''}" class="edit-input" data-field="monthly_rent" placeholder="월세" style="width: 100%; padding: 4px;">`;
            cells[7].innerHTML = `<input type="number" value="${property.sale_price || ''}" class="edit-input" data-field="sale_price" placeholder="매매가" style="width: 100%; padding: 4px;">`;
            
            // 실거주 여부
            cells[8].innerHTML = `
                <select class="edit-input" data-field="is_occupied" style="width: 100%; padding: 4px;">
                    <option value="true" ${property.is_occupied ? 'selected' : ''}>O</option>
                    <option value="false" ${!property.is_occupied ? 'selected' : ''}>X</option>
                </select>
            `;
            
            // 전화번호, 메모
            cells[9].innerHTML = `<input type="tel" value="${property.phone || ''}" class="edit-input" data-field="phone" placeholder="전화번호" style="width: 100%; padding: 4px;">`;
            cells[10].innerHTML = `<textarea class="edit-input" data-field="memo" placeholder="특이사항" style="width: 100%; padding: 4px; min-height: 60px;">${property.memo || ''}</textarea>`;
            
            // 담당자 선택 (비동기)
            loadEmployeeSelectForEdit(cells[11], property.employee_id, property.employee_name);
            
            // 팀 선택 (비동기)
            loadTeamSelectForEdit(cells[12], property.employee_team);
            
            // 좋아요, 싫어요
            cells[13].innerHTML = `<input type="number" value="${property.likes || 0}" class="edit-input" data-field="likes" min="0" style="width: 100%; padding: 4px;">`;
            cells[14].innerHTML = `<input type="number" value="${property.dislikes || 0}" class="edit-input" data-field="dislikes" min="0" style="width: 100%; padding: 4px;">`;
            
            // 편집 중인 셀들에 스타일 추가
            for (let i = 0; i <= 14; i++) {
                if (cells[i]) {
                    cells[i].classList.add('editing');
                }
            }
            
            // 버튼 상태 변경
            const editControls = row.querySelector('.edit-controls');
            if (editControls) {
                editControls.querySelector('.edit-btn').style.display = 'none';
                editControls.querySelector('.save-btn').style.display = 'inline-block';
                editControls.querySelector('.cancel-btn').style.display = 'inline-block';
            }
            
            console.log(`✅ 매물 ${propertyId} 수정 모드 시작`);
        }
        
        // 담당자 선택을 위한 input 생성
        async function loadEmployeeSelectForEdit(cell, currentEmployeeId, currentEmployeeName) {
            try {
                const response = await fetch('/api/employees?per_page=1000');
                if (response.ok) {
                    const data = await response.json();
                    const employees = data.employees || [];
                    
                    let selectHTML = '<select class="edit-input" data-field="employee_id" style="width: 100%; padding: 4px;">';
                    selectHTML += '<option value="">담당자 선택</option>';
                    
                    employees.forEach(emp => {
                        const selected = emp.id === currentEmployeeId ? 'selected' : '';
                        selectHTML += `<option value="${emp.id}" ${selected}>${emp.employee_name} (${emp.team || '미지정'})</option>`;
                    });
                    
                    selectHTML += '</select>';
                    cell.innerHTML = selectHTML;
                    cell.classList.add('editing');
                }
            } catch (error) {
                console.error('직원 목록 로드 오류:', error);
                cell.innerHTML = `<input type="text" value="${currentEmployeeName || ''}" class="edit-input" data-field="employee_name" placeholder="담당자명" style="width: 100%; padding: 4px;">`;
                cell.classList.add('editing');
            }
        }
        
        // 팀 선택을 위한 input 생성
        async function loadTeamSelectForEdit(cell, currentTeam) {
            try {
                const response = await fetch('/api/teams');
                if (response.ok) {
                    const data = await response.json();
                    const teams = data.teams || [];
                    
                    let selectHTML = '<select class="edit-input" data-field="employee_team" style="width: 100%; padding: 4px;">';
                    selectHTML += '<option value="">팀 선택</option>';
                    
                    teams.forEach(team => {
                        const selected = team.name === currentTeam ? 'selected' : '';
                        selectHTML += `<option value="${team.name}" ${selected}>${team.name}</option>`;
                    });
                    
                    selectHTML += '</select>';
                    cell.innerHTML = selectHTML;
                    cell.classList.add('editing');
                }
            } catch (error) {
                console.error('팀 목록 로드 오류:', error);
                cell.innerHTML = `<input type="text" value="${currentTeam || ''}" class="edit-input" data-field="employee_team" placeholder="팀명" style="width: 100%; padding: 4px;">`;
                cell.classList.add('editing');
            }
        }
        
        // 수정 내용 저장 (완료 버튼 클릭 시)
        async function savePropertyChanges(propertyId) {
            const row = document.querySelector(`tr[data-property-id="${propertyId}"]`);
            if (!row) return;
            
            try {
                // 수정된 데이터 수집
                const updatedData = {};
                const editInputs = row.querySelectorAll('.edit-input');
                
                editInputs.forEach(input => {
                    const fieldName = input.dataset.field;
                    let value = input.value.trim();
                    
                    // 특별한 처리가 필요한 필드들
                    if (fieldName === 'is_occupied') {
                        value = value === 'true';
                    } else if (['likes', 'dislikes'].includes(fieldName)) {
                        value = parseInt(value) || 0;
                    } else if (['jeonse_price', 'deposit', 'monthly_rent', 'sale_price'].includes(fieldName)) {
                        value = value ? parseInt(value) : null;
                    }
                    
                    updatedData[fieldName] = value;
                });
                
                console.log('수정될 데이터:', updatedData);
                
                // API 호출하여 데이터 업데이트
                const response = await fetch(`/api/maeiple/${propertyId}/update`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(updatedData)
                });
                
                const result = await response.json();
                
                if (result.success) {
                    showAlert('매물 정보가 성공적으로 수정되었습니다.', 'success');
                    
                    // 수정 모드 종료
                    finishEditProperty(propertyId);
                    
                    // 매물 목록 새로고침
                    loadMaeipleProperties();
                } else {
                    showAlert(result.message || '매물 수정에 실패했습니다.', 'error');
                }
                
            } catch (error) {
                console.error('매물 수정 오류:', error);
                showAlert('매물 수정 중 오류가 발생했습니다.', 'error');
            }
        }
        
        // 수정 취소
        function cancelPropertyEdit(propertyId) {
            const row = document.querySelector(`tr[data-property-id="${propertyId}"]`);
            if (!row) return;
            
            // 수정 모드 종료
            finishEditProperty(propertyId);
            
            // 매물 목록 새로고침 (원래 데이터로 복원)
            loadMaeipleProperties();
            
            showAlert('수정이 취소되었습니다.', 'info');
        }
        
        // 수정 모드 종료
        function finishEditProperty(propertyId) {
            const row = document.querySelector(`tr[data-property-id="${propertyId}"]`);
            if (!row) return;
            
            // 편집 중인 셀들 정리
            const editingCells = row.querySelectorAll('td.editing');
            editingCells.forEach(cell => {
                cell.classList.remove('editing');
            });
            
            // 버튼 상태 복원
            const editControls = row.querySelector('.edit-controls');
            if (editControls) {
                editControls.querySelector('.edit-btn').style.display = 'inline-block';
                editControls.querySelector('.save-btn').style.display = 'none';
                editControls.querySelector('.cancel-btn').style.display = 'none';
            }
        }
        
        // 개별 필드 저장 (조용히, 메시지 없음)
        async function savePropertyFieldQuiet(propertyId, field, value) {
            try {
                const response = await fetch('/api/maeiple/update', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        id: propertyId,
                        field: field,
                        value: value
                    })
                });
                
                const result = await response.json();
                
                if (result.success) {
                    console.log(`✅ 매물 ${propertyId} ${field} 업데이트 성공:`, value);
                    
                    // 로컬 데이터도 업데이트 (순서 유지)
                    const property = properties.find(p => p.id == propertyId);
                    if (property) {
                        property[field] = value;
                    }
                } else {
                    console.error(`❌ 매물 ${propertyId} ${field} 업데이트 실패:`, result.message);
                }
            } catch (error) {
                console.error(`❌ 매물 ${propertyId} ${field} 업데이트 오류:`, error);
            }
        }
        

        
        // ==================== 정렬 기능 ====================

        // 정렬 기능
        async function toggleSort(field) {
            if (currentSortBy === field) {
                currentSortOrder = currentSortOrder === 'desc' ? 'asc' : 'desc';
            } else {
                currentSortBy = field;
                currentSortOrder = 'desc';
            }
            await loadMaeipeProperties();
        }
        
        // 팀장용 정렬 기능
        async function toggleTeamSort(field) {
            if (currentTeamSortBy === field) {
                currentTeamSortOrder = currentTeamSortOrder === 'desc' ? 'asc' : 'desc';
            } else {
                currentTeamSortBy = field;
                currentTeamSortOrder = 'desc';
            }
            await loadTeamMaeipeProperties();
        }

        // 숫자 3자리 콤마
        function formatNumber(val) {
            const n = typeof val === 'number' ? val : parseInt(String(val).replace(/[^\d-]/g, ''), 10);
            if (isNaN(n)) return '';
            return n.toLocaleString('ko-KR');
        }

        // ==================== 체크박스 및 일괄 처리 기능 ====================
        
        // 전체 선택/해제
        function toggleSelectAll(selectAllCheckbox) {
            const propertyCheckboxes = document.querySelectorAll('.property-checkbox');
            propertyCheckboxes.forEach(checkbox => {
                checkbox.checked = selectAllCheckbox.checked;
            });
            updateSelectionCount();
        }
        
        // 선택 개수 업데이트 및 일괄 처리 패널 표시/숨김
        function updateSelectionCount() {
            const selectedCheckboxes = document.querySelectorAll('.property-checkbox:checked');
            const count = selectedCheckboxes.length;
            
            // 선택 개수 표시
            const countElement = document.getElementById('selected-count');
            if (countElement) {
                countElement.textContent = `${count}개`;
            }
            
            // 일괄 처리 패널 표시/숨김
            const bulkPanel = document.getElementById('bulk-actions-panel');
            if (bulkPanel) {
                bulkPanel.style.display = count > 0 ? 'block' : 'none';
            }
            
            // 전체 선택 체크박스 상태 업데이트
            const selectAllCheckbox = document.getElementById('select-all-properties');
            const totalCheckboxes = document.querySelectorAll('.property-checkbox');
            if (selectAllCheckbox && totalCheckboxes.length > 0) {
                selectAllCheckbox.checked = count === totalCheckboxes.length;
                selectAllCheckbox.indeterminate = count > 0 && count < totalCheckboxes.length;
            }
        }
        
        // 선택 해제
        function clearSelection() {
            const allCheckboxes = document.querySelectorAll('.property-checkbox, #select-all-properties');
            allCheckboxes.forEach(checkbox => {
                checkbox.checked = false;
            });
            updateSelectionCount();
        }
        
        // 일괄 담당자 변경
        async function bulkAssignEmployee() {
            const selectedCheckboxes = document.querySelectorAll('.property-checkbox:checked');
            const employeeSelect = document.getElementById('bulk-employee-select');
            
            if (selectedCheckboxes.length === 0) {
                showAlert('선택된 매물이 없습니다.', 'warning');
                return;
            }
            
            if (!employeeSelect.value) {
                showAlert('담당자를 선택해주세요.', 'warning');
                return;
            }
            
            const selectedIds = Array.from(selectedCheckboxes).map(cb => cb.value);
            const employeeId = employeeSelect.value;
            const employeeName = employeeSelect.options[employeeSelect.selectedIndex].text.split(' (')[0];
            
            if (!confirm(`선택된 ${selectedIds.length}개 매물의 담당자를 "${employeeName}"으로 변경하시겠습니까?`)) {
                return;
            }
            
            try {
                const response = await fetch('/api/maeiple/bulk-assign', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        property_ids: selectedIds,
                        employee_id: employeeId,
                        employee_name: employeeName
                    })
                });
                
                const result = await response.json();
                
                if (result.success) {
                    showAlert(`${selectedIds.length}개 매물의 담당자가 변경되었습니다.`, 'success');
                    console.log('✅ 서버에서 일괄 담당자 변경 성공 응답 받음');
                    
                    // 로컬 데이터 업데이트 (순서 유지를 위해 전체 새로고침 대신)
                    selectedIds.forEach(propertyId => {
                        const property = properties.find(p => p.id == propertyId);
                        if (property) {
                            console.log(`🔄 로컬 데이터 업데이트: 매물 ${propertyId} 담당자 ${property.employee_name} → ${employeeName}`);
                            property.employee_id = employeeId;
                            property.employee_name = employeeName;
                        }
                    });
                    
                    // UI 즉시 업데이트
                    renderMaeipeProperties();
                    clearSelection();
                    
                    // 5초 후 서버에서 다시 확인 (디버깅용)
                    setTimeout(async () => {
                        console.log('🔍 5초 후 서버 데이터 확인 중...');
                        const checkResponse = await fetch(`/api/maeiple?sort_by=${currentSortBy}&sort_order=${currentSortOrder}&page=${currentMaeiplePage}&per_page=${maeipePerPage}`);
                        const checkData = await checkResponse.json();
                        if (checkData.success && checkData.properties) {
                            const updatedProperties = checkData.properties.filter(p => selectedIds.includes(String(p.id)));
                            updatedProperties.forEach(prop => {
                                console.log(`📊 서버 확인: 매물 ${prop.id} 담당자 = ${prop.employee_name} (${prop.employee_id})`);
                            });
                        }
                    }, 5000);
                } else {
                    showAlert('담당자 변경에 실패했습니다: ' + (result.message || result.error), 'error');
                }
            } catch (error) {
                console.error('일괄 담당자 변경 오류:', error);
                showAlert('담당자 변경 중 오류가 발생했습니다.', 'error');
            }
        }
        
        // 일괄 팀 변경
        async function bulkAssignTeam() {
            const selectedCheckboxes = document.querySelectorAll('.property-checkbox:checked');
            const teamSelect = document.getElementById('bulk-team-select');
            
            if (selectedCheckboxes.length === 0) {
                showAlert('선택된 매물이 없습니다.', 'warning');
                return;
            }
            
            if (!teamSelect.value) {
                showAlert('팀을 선택해주세요.', 'warning');
                return;
            }
            
            const selectedIds = Array.from(selectedCheckboxes).map(cb => cb.value);
            const teamName = teamSelect.value;
            
            if (!confirm(`선택된 ${selectedIds.length}개 매물의 팀을 "${teamName}"으로 변경하시겠습니까?`)) {
                return;
            }
            
            try {
                const response = await fetch('/api/maeiple/bulk-assign-team', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        property_ids: selectedIds,
                        team_name: teamName
                    })
                });
                
                const result = await response.json();
                
                if (result.success) {
                    showAlert(`${selectedIds.length}개 매물의 팀이 변경되었습니다.`, 'success');
                    console.log('✅ 서버에서 일괄 팀 변경 성공 응답 받음');
                    
                    // 로컬 데이터 업데이트 (순서 유지를 위해 전체 새로고침 대신)
                    selectedIds.forEach(propertyId => {
                        const property = properties.find(p => p.id == propertyId);
                        if (property) {
                            console.log(`🔄 로컬 데이터 업데이트: 매물 ${propertyId} 팀 ${property.employee_team} → ${teamName}`);
                            property.employee_team = teamName;
                        }
                    });
                    
                    // UI 즉시 업데이트
                    renderMaeipeProperties();
                    clearSelection();
                    
                    // 5초 후 서버에서 다시 확인 (디버깅용)
                    setTimeout(async () => {
                        console.log('🔍 5초 후 서버 데이터 확인 중...');
                        const checkResponse = await fetch(`/api/maeiple?sort_by=${currentSortBy}&sort_order=${currentSortOrder}&page=${currentMaeiplePage}&per_page=${maeipePerPage}`);
                        const checkData = await checkResponse.json();
                        if (checkData.success && checkData.properties) {
                            const updatedProperties = checkData.properties.filter(p => selectedIds.includes(String(p.id)));
                            updatedProperties.forEach(prop => {
                                console.log(`📊 서버 확인: 매물 ${prop.id} 팀 = ${prop.employee_team}`);
                            });
                        }
                    }, 5000);
                } else {
                    showAlert('팀 변경에 실패했습니다: ' + (result.message || result.error), 'error');
                }
            } catch (error) {
                console.error('일괄 팀 변경 오류:', error);
                showAlert('팀 변경 중 오류가 발생했습니다.', 'error');
            }
        }

        // 일괄 삭제
        async function bulkDeleteProperties() {
            const selectedCheckboxes = document.querySelectorAll('.property-checkbox:checked');
            
            if (selectedCheckboxes.length === 0) {
                showAlert('선택된 매물이 없습니다.', 'warning');
                return;
            }
            
            const selectedIds = Array.from(selectedCheckboxes).map(cb => cb.value);
            
            if (!confirm(`선택된 ${selectedIds.length}개 매물을 삭제하시겠습니까?\n\n⚠️ 이 작업은 되돌릴 수 없습니다.`)) {
                return;
            }
            
            try {
                const response = await fetch('/api/maeiple/bulk-delete', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        property_ids: selectedIds
                    })
                });
                
                const result = await response.json();
                
                if (result.success) {
                    showAlert(`${selectedIds.length}개 매물이 삭제되었습니다.`, 'success');
                    console.log('✅ 서버에서 일괄 삭제 성공 응답 받음');
                    
                    // 로컬 데이터에서 삭제된 매물 제거
                    selectedIds.forEach(propertyId => {
                        const index = properties.findIndex(p => p.id == propertyId);
                        if (index !== -1) {
                            properties.splice(index, 1);
                        }
                    });
                    
                    // UI 즉시 업데이트
                    renderMaeipeProperties();
                    clearSelection();
                    
                    // 선택된 매물 수 업데이트
                    updateSelectionCount();
                } else {
                    showAlert('매물 삭제에 실패했습니다: ' + (result.message || result.error), 'error');
                }
            } catch (error) {
                console.error('일괄 삭제 오류:', error);
                showAlert('매물 삭제 중 오류가 발생했습니다.', 'error');
            }
        }

        // 필터 핸들러
        function setStatusFilter(value, btn) {
            statusFilter = value;
            document.querySelectorAll('#status-filter-group .filter-btn').forEach(b => {
                b.classList.remove('active');
                b.style.background = '#ffffff';
                b.style.color = '#334155';
                b.style.fontWeight = 'normal';
            });
            btn.classList.add('active');
            btn.style.background = '#e0e7ff';
            btn.style.color = '#4338ca';
            btn.style.fontWeight = '600';
            renderMaeipeProperties();
        }

        function setOccupiedFilter(value, btn) {
            occupiedFilter = value;
            document.querySelectorAll('#occupied-filter-group .filter-btn').forEach(b => {
                b.classList.remove('active');
                b.style.background = '#ffffff';
                b.style.color = '#334155';
                b.style.fontWeight = 'normal';
            });
            btn.classList.add('active');
            btn.style.background = '#e0e7ff';
            btn.style.color = '#4338ca';
            btn.style.fontWeight = '600';
            renderMaeipeProperties();
        }
        
        // 관리자용 거래유형 필터
        function setDealTypeFilterAdmin(value, btn) {
            dealTypeFilterAdmin = value;
            document.querySelectorAll('#deal-type-filter-group-admin .filter-btn').forEach(b => {
                b.classList.remove('active');
                b.style.background = '#ffffff';
                b.style.color = '#334155';
                b.style.fontWeight = 'normal';
            });
            btn.classList.add('active');
            btn.style.background = '#e0e7ff';
            btn.style.color = '#4338ca';
            btn.style.fontWeight = '600';
            renderMaeipeProperties();
        }
        
        // 관리자용 호수 검색 필터
        function filterByRoomAdmin(searchValue) {
            roomSearchFilterAdmin = searchValue;
            renderMaeipeProperties();
        }
        
        // 관리자용 담당자 검색 필터
        function filterByEmployeeAdmin(searchValue) {
            employeeSearchFilterAdmin = searchValue;
            renderMaeipeProperties();
        }
        
        // 관리자용 팀 필터
        function setTeamFilterAdmin(value, btn) {
            teamFilterAdmin = value;
            document.querySelectorAll('#team-filter-group-admin .filter-btn').forEach(b => {
                b.classList.remove('active');
                b.style.background = '#ffffff';
                b.style.color = '#334155';
                b.style.fontWeight = 'normal';
            });
            btn.classList.add('active');
            btn.style.background = '#e0e7ff';
            btn.style.color = '#4338ca';
            btn.style.fontWeight = '600';
            renderMaeipeProperties();
        }
        
        // 관리자용 팀 필터 업데이트
        async function updateAdminFilters() {
            // 팀 필터 업데이트
            const teamFilterGroup = document.getElementById('team-filter-group-admin');
            const teamFilterButtons = teamFilterGroup.querySelector('.filter-buttons');
            
            // 현재 매물 목록에서 팀들 추출
            const teams = [...new Set(properties.map(p => p.employee_team).filter(team => team))];
            
            // 전체 버튼 + 개별 팀 버튼들
            let teamButtonsHTML = `
                <button class="filter-btn ${teamFilterAdmin === 'all' ? 'active' : ''}" data-value="all" onclick="setTeamFilterAdmin('all', this)" 
                        style="padding: 6px 10px; border: 1px solid #e2e8f0; background: ${teamFilterAdmin === 'all' ? '#e0e7ff' : '#ffffff'}; color: ${teamFilterAdmin === 'all' ? '#4338ca' : '#334155'}; border-radius: 20px; font-size: 12px; cursor: pointer; font-weight: ${teamFilterAdmin === 'all' ? '600' : 'normal'};">전체</button>
            `;
            
            teams.forEach(team => {
                const isActive = teamFilterAdmin === team;
                teamButtonsHTML += `
                    <button class="filter-btn ${isActive ? 'active' : ''}" data-value="${team}" onclick="setTeamFilterAdmin('${team}', this)"
                            style="padding: 6px 10px; border: 1px solid #e2e8f0; background: ${isActive ? '#e0e7ff' : '#ffffff'}; color: ${isActive ? '#4338ca' : '#334155'}; border-radius: 20px; font-size: 12px; cursor: pointer; font-weight: ${isActive ? '600' : 'normal'};">${team}</button>
                `;
            });
            
            teamFilterButtons.innerHTML = teamButtonsHTML;
            
            // 일괄 처리 컨트롤 업데이트 (DB에서 전체 목록 가져오기)
            await updateBulkActionControls();
        }
        
        // 일괄 처리 컨트롤의 드롭다운 업데이트
        async function updateBulkActionControls() {
            // 직원 목록을 DB에서 가져와서 업데이트
            const employeeSelect = document.getElementById('bulk-employee-select');
            if (employeeSelect) {
                await loadEmployeesForBulkSelect(employeeSelect);
            }
            
            // 팀 목록을 DB에서 가져와서 업데이트
            const teamSelect = document.getElementById('bulk-team-select');
            if (teamSelect) {
                await loadTeamsForBulkSelect(teamSelect);
            }
        }
        
        // DB에서 전체 직원 목록을 가져와서 일괄 처리 드롭다운 업데이트
        async function loadEmployeesForBulkSelect(selectElement) {
            try {
                const response = await fetch('/api/employees?per_page=1000');
                if (response.ok) {
                    const data = await response.json();
                    const employees = data.employees || [];
                    
                    let employeeOptionsHTML = '<option value="">담당자 선택</option>';
                    employees.forEach(emp => {
                        employeeOptionsHTML += `<option value="${emp.id}">${emp.employee_name} (${emp.team || '미지정'})</option>`;
                    });
                    selectElement.innerHTML = employeeOptionsHTML;
                    
                    console.log(`✅ DB에서 ${employees.length}명의 직원 목록을 일괄 처리 드롭다운에 로드했습니다.`);
                } else {
                    console.error('직원 목록 로드 실패:', response.status);
                    selectElement.innerHTML = '<option value="">직원 목록 로드 실패</option>';
                }
            } catch (error) {
                console.error('직원 목록 로드 오류:', error);
                selectElement.innerHTML = '<option value="">직원 목록 로드 오류</option>';
            }
        }
        
        // DB에서 전체 팀 목록을 가져와서 일괄 처리 드롭다운 업데이트
        async function loadTeamsForBulkSelect(selectElement) {
            try {
                const response = await fetch('/api/teams');
                if (response.ok) {
                    const data = await response.json();
                    const teams = data.teams || [];
                    
                    let teamOptionsHTML = '<option value="">팀 선택</option>';
                    teams.forEach(team => {
                        teamOptionsHTML += `<option value="${team.name}">${team.name}</option>`;
                    });
                    selectElement.innerHTML = teamOptionsHTML;
                    
                    console.log(`✅ DB에서 ${teams.length}개의 팀 목록을 일괄 처리 드롭다운에 로드했습니다.`);
                } else {
                    console.error('팀 목록 로드 실패:', response.status);
                    selectElement.innerHTML = '<option value="">팀 목록 로드 실패</option>';
                }
            } catch (error) {
                console.error('팀 목록 로드 오류:', error);
                selectElement.innerHTML = '<option value="">팀 목록 로드 오류</option>';
            }
        }
        
        // 팀장용 매물 로드
        async function loadTeamMaeipeProperties(page = 1) {
            try {
                currentTeamMaeiplePage = page;
                const url = `/api/maeiple/team?sort_by=${currentTeamSortBy}&sort_order=${currentTeamSortOrder}&page=${page}&per_page=${teamMaeipePerPage}`;
                const response = await fetch(url);
                const data = await response.json();
                
                if (data.success) {
                    teamProperties = data.properties;
                    teamMaeipleTotalPages = data.total_pages || 0;
                    console.log(`팀장용 매물 로드: ${teamProperties.length}개 (페이지 ${page}/${teamMaeipleTotalPages})`);
                    
                    // 팀장용 메이플관리 통계 업데이트
                    updateTeamMaeipleStats(data);
                    
                    renderTeamMaeipeProperties();
                    updateTeamEmployeeFilter(); // 담당자 필터 업데이트
                    renderTeamMaeipePagination();
                } else {
                    showTeamMaeipeError('팀 매물 목록을 불러오는데 실패했습니다.');
                }
            } catch (error) {
                console.error('Error:', error);
                showTeamMaeipeError('팀 매물 목록을 불러오는데 실패했습니다.');
            }
        }
        
        // 팀장용 매물 렌더링
        function renderTeamMaeipeProperties() {
            const tableContent = document.getElementById('team-maeiple-table-content');
            
            // 필터 적용
            let list = Array.isArray(teamProperties) ? teamProperties.slice() : [];
            
            // 현황 필터
            if (statusFilterTeam !== 'all') {
                list = list.filter(p => (p.status || '') === statusFilterTeam);
            }
            
            // 실거주 필터
            if (occupiedFilterTeam !== 'all') {
                const want = occupiedFilterTeam === 'O';
                list = list.filter(p => !!p.is_occupied === want);
            }
            
            // 거래유형 필터
            if (dealTypeFilterTeam !== 'all') {
                list = list.filter(p => {
                    if (dealTypeFilterTeam === '전세') {
                        const jeonsePrice = parseInt(String(p.jeonse_price || '0').replace(/[^\d]/g, '')) || 0;
                        return jeonsePrice > 0;
                    } else if (dealTypeFilterTeam === '월세') {
                        const monthlyRent = parseInt(String(p.monthly_rent || '0').replace(/[^\d]/g, '')) || 0;
                        return monthlyRent > 0;
                    } else if (dealTypeFilterTeam === '매매') {
                        const salePrice = parseInt(String(p.sale_price || '0').replace(/[^\d]/g, '')) || 0;
                        return salePrice > 0;
                    }
                    return true;
                });
            }
            
            // 호수 검색 필터
            if (roomSearchFilterTeam.trim()) {
                const searchTerm = roomSearchFilterTeam.trim().toLowerCase();
                list = list.filter(p => {
                    const roomNumber = String(p.room_number || '').toLowerCase();
                    return roomNumber.includes(searchTerm);
                });
            }
            
            // 담당자 검색 필터
            if (employeeSearchFilterTeam.trim()) {
                const searchTerm = employeeSearchFilterTeam.trim().toLowerCase();
                list = list.filter(p => {
                    const employeeName = String(p.employee_name || '').toLowerCase();
                    return employeeName.includes(searchTerm);
                });
            }
            
            if (list.length === 0) {
                tableContent.innerHTML = `
                    <div style="text-align: center; padding: 60px 20px; color: #64748b;">
                        <div style="font-size: 48px; margin-bottom: 16px; opacity: 0.5;">👥🏢</div>
                        <div style="font-size: 18px; font-weight: 600; margin-bottom: 8px;">우리팀 매물이 없습니다</div>
                        <div style="font-size: 14px; opacity: 0.7;">새 매물을 추가해보세요.</div>
                    </div>
                `;
                return;
            }
            
            let tableHTML = `
                <table class="employees-table">
                    <thead>
                        <tr>
                            <th>
                                <div style="display: flex; align-items: center; gap: 4px; cursor: pointer; user-select: none;" onclick="toggleTeamSort('check_date')">
                                    확인날짜
                                    <span style="font-size: 12px; color: #9ca3af;">${currentTeamSortBy === 'check_date' ? (currentTeamSortOrder === 'desc' ? '▼' : '▲') : '↕️'}</span>
                                </div>
                            </th>
                            <th>동</th>
                            <th>호수</th>
                            <th>현황</th>
                            <th>전세 (만원)</th>
                            <th>월세보증금 (만원)</th>
                            <th>월세 (만원)</th>
                            <th>매매 (만원)</th>
                            <th>실거주 여부</th>
                            <th>전화번호</th>
                            <th>특이사항</th>
                            <th>담당자</th>
                            <th>팀</th>
                            <th>좋아요</th>
                            <th>싫어요</th>
                            <th>수정</th>
                        </tr>
                    </thead>
                    <tbody>
            `;
            
            list.forEach(property => {
                const memoPreview = property.memo ? (property.memo.length > 20 ? property.memo.substring(0, 20) + '...' : property.memo) : '';
                
                tableHTML += `
                    <tr data-property-id="${property.id}">
                        <td style="cursor: pointer;" onclick="editTeamDate(${property.id}, '${property.check_date || ''}', this)">${property.check_date || ''}</td>
                        <td style="cursor: pointer;" onclick="editTeamNumber(${property.id}, 'building_number', '${property.building_number || ''}', this)">${property.building_number || ''}</td>
                        <td style="cursor: pointer;" onclick="editTeamNumber(${property.id}, 'room_number', '${property.room_number || ''}', this)">${property.room_number || ''}</td>
                        <td>
                            <button style="padding: 6px 12px; border: none; border-radius: 6px; font-size: 12px; font-weight: 500; cursor: pointer; ${property.status === '계약완료' ? 'background: #d1fae5; color: #065f46;' : property.status === '보류' ? 'background: #fef3c7; color: #92400e;' : property.status === '부재' ? 'background: #ede9fe; color: #5b21b6;' : 'background: #e0f2fe; color: #0369a1;'}" 
                                    onclick="showTeamStatusOptions(${property.id}, '${property.status || '거래가능'}', this)">
                                ${property.status || '거래가능'}
                            </button>
                        </td>
                        <td style="cursor: pointer; color: #2563eb; font-weight: 500;" onclick="editTeamPrice(${property.id}, 'jeonse_price', '${property.jeonse_price || ''}', this)">
                            ${property.jeonse_price ? formatNumber(property.jeonse_price) + ' 만원' : '-'}
                        </td>
                        <td style="cursor: pointer; color: #2563eb; font-weight: 500;" onclick="editTeamPrice(${property.id}, 'deposit', '${property.deposit || ''}', this)">
                            ${property.deposit ? formatNumber(property.deposit) + ' 만원' : '-'}
                        </td>
                        <td style="cursor: pointer; color: #2563eb; font-weight: 500;" onclick="editTeamPrice(${property.id}, 'monthly_rent', '${property.monthly_rent || ''}', this)">
                            ${property.monthly_rent ? formatNumber(property.monthly_rent) + ' 만원' : '-'}
                        </td>
                        <td style="cursor: pointer; color: #2563eb; font-weight: 500;" onclick="editTeamPrice(${property.id}, 'sale_price', '${property.sale_price || ''}', this)">
                            ${property.sale_price ? formatNumber(property.sale_price) + ' 만원' : '-'}
                        </td>
                        <td>
                            <button style="background: none; border: none; cursor: pointer; font-size: 18px; padding: 4px; border-radius: 4px; color: ${property.is_occupied ? '#059669' : '#dc2626'};" 
                                    onclick="toggleTeamOccupied(${property.id}, ${property.is_occupied})">
                                ${property.is_occupied ? 'O' : 'X'}
                            </button>
                        </td>
                        <td style="cursor: pointer; font-family: monospace; letter-spacing: 0.5px; max-width: 120px; overflow: hidden; text-overflow: ellipsis;" onclick="editTeamPhone(${property.id}, '${property.phone || ''}', this)">
                            ${property.phone || '-'}
                        </td>
                        <td style="cursor: pointer; color: #64748b; font-style: italic; max-width: 150px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;" onclick="showMemoModal(${property.id}, '${property.memo || ''}')">
                            ${memoPreview || '메모 추가...'}
                        </td>
                        <td>
                            <span style="color: #4f46e5; font-weight: 500;">
                                ${property.employee_name || '미지정'}
                            </span>
                        </td>
                        <td>
                            <span class="status-badge" style="background: ${getTeamBadgeColor(property.employee_team)}; color: ${getTeamTextColor(property.employee_team)};">
                                ${property.employee_team || '미지정'}
                            </span>
                        </td>
                        <td>
                            <div style="cursor: pointer;" onclick="showLikeOptions(${property.id}, ${property.likes}, this)">
                                ${'❤️'.repeat(property.likes)}${property.likes === 0 ? '🤍' : ''}
                            </div>
                        </td>
                        <td>
                            <div style="cursor: pointer;" onclick="showDislikeOptions(${property.id}, ${property.dislikes}, this)">
                                ${'👎'.repeat(property.dislikes)}${property.dislikes === 0 ? '🤍' : ''}
                            </div>
                        </td>
                    </tr>
                `;
            });
            
            tableHTML += `
                    </tbody>
                </table>
            `;
            
            tableContent.innerHTML = tableHTML;
        }
        

        
        // 팀장용 필터 함수들
        function setStatusFilterTeam(value, btn) {
            statusFilterTeam = value;
            document.querySelectorAll('#status-filter-group-team .filter-btn').forEach(b => {
                b.classList.remove('active');
                b.style.background = '#ffffff';
                b.style.color = '#334155';
                b.style.fontWeight = 'normal';
            });
            btn.classList.add('active');
            btn.style.background = '#e0e7ff';
            btn.style.color = '#4338ca';
            btn.style.fontWeight = '600';
            renderTeamMaeipeProperties();
        }
        
        function setOccupiedFilterTeam(value, btn) {
            occupiedFilterTeam = value;
            document.querySelectorAll('#occupied-filter-group-team .filter-btn').forEach(b => {
                b.classList.remove('active');
                b.style.background = '#ffffff';
                b.style.color = '#334155';
                b.style.fontWeight = 'normal';
            });
            btn.classList.add('active');
            btn.style.background = '#e0e7ff';
            btn.style.color = '#4338ca';
            btn.style.fontWeight = '600';
            renderTeamMaeipeProperties();
        }
        
        function setDealTypeFilterTeam(value, btn) {
            dealTypeFilterTeam = value;
            document.querySelectorAll('#deal-type-filter-group-team .filter-btn').forEach(b => {
                b.classList.remove('active');
                b.style.background = '#ffffff';
                b.style.color = '#334155';
                b.style.fontWeight = 'normal';
            });
            btn.classList.add('active');
            btn.style.background = '#e0e7ff';
            btn.style.color = '#4338ca';
            btn.style.fontWeight = '600';
            renderTeamMaeipeProperties();
        }
        
        function filterByRoomTeam(searchValue) {
            roomSearchFilterTeam = searchValue;
            renderTeamMaeipeProperties();
        }
        
        // 팀장용 담당자 검색 필터
        function filterByEmployeeTeam(searchValue) {
            employeeSearchFilterTeam = searchValue;
            renderTeamMaeipeProperties();
        }
        
        function showTeamMaeipeError(message) {
            const tableContent = document.getElementById('team-maeiple-table-content');
            tableContent.innerHTML = `
                <div style="text-align: center; padding: 40px; color: #ef4444;">
                    <div style="font-size: 48px; margin-bottom: 16px;">⚠️</div>
                    <div style="font-size: 16px; font-weight: 600;">${message}</div>
                </div>
            `;
        }
        
        // 고객관리 페이지네이션 렌더링
        function renderCustomerPagination() {
            const paginationDiv = document.getElementById('customer-pagination');
            if (!paginationDiv || customerTotalPages <= 1) {
                if (paginationDiv) paginationDiv.style.display = 'none';
                return;
            }
            
            paginationDiv.style.display = 'flex';
            let paginationHTML = '';
            
            // 이전 페이지 버튼
            if (currentCustomerPage > 1) {
                paginationHTML += `<button onclick="loadAllCustomers(${currentCustomerPage - 1})" style="padding: 8px 12px; border: 1px solid #d1d5db; background: #f9fafb; border-radius: 6px; cursor: pointer; color: #374151;">이전</button>`;
            }
            
            // 페이지 번호 버튼들 (최대 7개 표시)
            const startPage = Math.max(1, currentCustomerPage - 3);
            const endPage = Math.min(customerTotalPages, startPage + 6);
            
            for (let i = startPage; i <= endPage; i++) {
                const isActive = i === currentCustomerPage;
                paginationHTML += `
                    <button onclick="loadAllCustomers(${i})" 
                            style="padding: 8px 12px; border: 1px solid ${isActive ? '#3b82f6' : '#d1d5db'}; 
                                   background: ${isActive ? '#3b82f6' : '#f9fafb'}; color: ${isActive ? 'white' : '#374151'}; 
                                   border-radius: 6px; cursor: pointer; font-weight: ${isActive ? '600' : 'normal'};">
                        ${i}
                    </button>
                `;
            }
            
            // 다음 페이지 버튼
            if (currentCustomerPage < customerTotalPages) {
                paginationHTML += `<button onclick="loadAllCustomers(${currentCustomerPage + 1})" style="padding: 8px 12px; border: 1px solid #d1d5db; background: #f9fafb; border-radius: 6px; cursor: pointer; color: #374151;">다음</button>`;
            }
            
            paginationDiv.innerHTML = paginationHTML;
        }
        
        // 직원관리 페이지네이션 렌더링
        function renderEmployeePagination() {
            const paginationDiv = document.getElementById('employee-pagination');
            if (!paginationDiv || employeeTotalPages <= 1) {
                if (paginationDiv) paginationDiv.style.display = 'none';
                return;
            }
            
            paginationDiv.style.display = 'flex';
            let paginationHTML = '';
            
            // 이전 페이지 버튼
            if (currentEmployeePage > 1) {
                paginationHTML += `<button onclick="loadEmployees(${currentEmployeePage - 1})" style="padding: 8px 12px; border: 1px solid #d1d5db; background: #f9fafb; border-radius: 6px; cursor: pointer; color: #374151;">이전</button>`;
            }
            
            // 페이지 번호 버튼들 (최대 7개 표시)
            const startPage = Math.max(1, currentEmployeePage - 3);
            const endPage = Math.min(employeeTotalPages, startPage + 6);
            
            for (let i = startPage; i <= endPage; i++) {
                const isActive = i === currentEmployeePage;
                paginationHTML += `
                    <button onclick="loadEmployees(${i})" 
                            style="padding: 8px 12px; border: 1px solid ${isActive ? '#3b82f6' : '#d1d5db'}; 
                                   background: ${isActive ? '#3b82f6' : '#f9fafb'}; color: ${isActive ? 'white' : '#374151'}; 
                                   border-radius: 6px; cursor: pointer; font-weight: ${isActive ? '600' : 'normal'};">
                        ${i}
                    </button>
                `;
            }
            
            // 다음 페이지 버튼
            if (currentEmployeePage < employeeTotalPages) {
                paginationHTML += `<button onclick="loadEmployees(${currentEmployeePage + 1})" style="padding: 8px 12px; border: 1px solid #d1d5db; background: #f9fafb; border-radius: 6px; cursor: pointer; color: #374151;">다음</button>`;
            }
            
            paginationDiv.innerHTML = paginationHTML;
        }
        
        // 메이플관리 페이지네이션 렌더링
        function renderMaeipePagination() {
            const paginationDiv = document.getElementById('maeiple-pagination');
            if (!paginationDiv || maeipleTotalPages <= 1) {
                if (paginationDiv) paginationDiv.style.display = 'none';
                return;
            }
            
            paginationDiv.style.display = 'flex';
            let paginationHTML = '';
            
            // 이전 페이지 버튼
            if (currentMaeiplePage > 1) {
                paginationHTML += `<button onclick="loadMaeipeProperties(${currentMaeiplePage - 1})" style="padding: 8px 12px; border: 1px solid #d1d5db; background: #f9fafb; border-radius: 6px; cursor: pointer; color: #374151;">이전</button>`;
            }
            
            // 페이지 번호 버튼들 (최대 7개 표시)
            const startPage = Math.max(1, currentMaeiplePage - 3);
            const endPage = Math.min(maeipleTotalPages, startPage + 6);
            
            for (let i = startPage; i <= endPage; i++) {
                const isActive = i === currentMaeiplePage;
                paginationHTML += `
                    <button onclick="loadMaeipeProperties(${i})" 
                            style="padding: 8px 12px; border: 1px solid ${isActive ? '#3b82f6' : '#d1d5db'}; 
                                   background: ${isActive ? '#3b82f6' : '#f9fafb'}; color: ${isActive ? 'white' : '#374151'}; 
                                   border-radius: 6px; cursor: pointer; font-weight: ${isActive ? '600' : 'normal'};">
                        ${i}
                    </button>
                `;
            }
            
            // 다음 페이지 버튼
            if (currentMaeiplePage < maeipleTotalPages) {
                paginationHTML += `<button onclick="loadMaeipeProperties(${currentMaeiplePage + 1})" style="padding: 8px 12px; border: 1px solid #d1d5db; background: #f9fafb; border-radius: 6px; cursor: pointer; color: #374151;">다음</button>`;
            }
            
            paginationDiv.innerHTML = paginationHTML;
        }
        
        // 팀장용 메이플관리 페이지네이션 렌더링
        function renderTeamMaeipePagination() {
            const paginationDiv = document.getElementById('team-maeiple-pagination');
            if (!paginationDiv || teamMaeipleTotalPages <= 1) {
                if (paginationDiv) paginationDiv.style.display = 'none';
                return;
            }
            
            paginationDiv.style.display = 'flex';
            let paginationHTML = '';
            
            // 이전 페이지 버튼
            if (currentTeamMaeiplePage > 1) {
                paginationHTML += `<button onclick="loadTeamMaeipeProperties(${currentTeamMaeiplePage - 1})" style="padding: 8px 12px; border: 1px solid #d1d5db; background: #f9fafb; border-radius: 6px; cursor: pointer; color: #374151;">이전</button>`;
            }
            
            // 페이지 번호 버튼들 (최대 7개 표시)
            const startPage = Math.max(1, currentTeamMaeiplePage - 3);
            const endPage = Math.min(teamMaeipleTotalPages, startPage + 6);
            
            for (let i = startPage; i <= endPage; i++) {
                const isActive = i === currentTeamMaeiplePage;
                paginationHTML += `
                    <button onclick="loadTeamMaeipeProperties(${i})" 
                            style="padding: 8px 12px; border: 1px solid ${isActive ? '#3b82f6' : '#d1d5db'}; 
                                   background: ${isActive ? '#3b82f6' : '#f9fafb'}; color: ${isActive ? 'white' : '#374151'}; 
                                   border-radius: 6px; cursor: pointer; font-weight: ${isActive ? '600' : 'normal'};">
                        ${i}
                    </button>
                `;
            }
            
            // 다음 페이지 버튼
            if (currentTeamMaeiplePage < teamMaeipleTotalPages) {
                paginationHTML += `<button onclick="loadTeamMaeipeProperties(${currentTeamMaeiplePage + 1})" style="padding: 8px 12px; border: 1px solid #d1d5db; background: #f9fafb; border-radius: 6px; cursor: pointer; color: #374151;">다음</button>`;
            }
            
            paginationDiv.innerHTML = paginationHTML;
        }

        // 메모 모달 관련 함수들
        function showMemoModal(id, memo) {
            currentMemoId = id;
            document.getElementById('memoTextarea').value = memo;
            document.getElementById('memoModal').style.display = 'block';
        }

        function closeMemoModal() {
            document.getElementById('memoModal').style.display = 'none';
            currentMemoId = null;
        }

        async function saveMemo() {
            if (!currentMemoId) return;
            
            const memo = document.getElementById('memoTextarea').value;
            
            try {
                const response = await fetch('/api/maeiple/memo', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        id: currentMemoId,
                        memo: memo
                    })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    const property = properties.find(p => p.id === currentMemoId);
                    if (property) {
                        property.memo = memo;
                    }
                    closeMemoModal();
                    renderMaeipeProperties();
                    showMaeipeSuccess('메모가 저장되었습니다.');
                } else {
                    showMaeipeError('메모 저장에 실패했습니다.');
                }
            } catch (error) {
                console.error('Error:', error);
                showMaeipeError('메모 저장에 실패했습니다.');
            }
        }

        // 에러/성공 메시지 표시
        function showMaeipeError(message) {
            alert('❌ ' + message);
        }

        function showMaeipeSuccess(message) {
            alert('✅ ' + message);
        }

        // ==================== 메이플 관리 수정 기능 구현 ====================
        
        // 날짜 편집
        async function editDate(id, value, cell) {
            const newDate = prompt('새 날짜를 입력하세요 (YYYY-MM-DD):', value);
            if (newDate && newDate !== value) {
                await updateMaeipeProperty(id, 'check_date', newDate, cell);
            }
        }
        
        // 숫자 편집 (룸넘버, 빌딩넘버 등)
        async function editNumber(id, field, value, cell) {
            const newValue = prompt(`새 ${field}을(를) 입력하세요:`, value);
            if (newValue && newValue !== value) {
                await updateMaeipeProperty(id, field, newValue, cell);
            }
        }
        
        // 가격 편집 (전세, 월세, 매매가)
        async function editPrice(id, field, value, cell) {
            const fieldNames = {
                'jeonse_price': '전세가',
                'monthly_rent': '월세',
                'sale_price': '매매가'
            };
            const fieldName = fieldNames[field] || field;
            const newValue = prompt(`새 ${fieldName}를 입력하세요 (만원):`, value);
            if (newValue && newValue !== value) {
                await updateMaeipeProperty(id, field, newValue, cell);
            }
        }
        
        // 전화번호 편집
        async function editPhone(id, value, cell) {
            const newPhone = prompt('새 전화번호를 입력하세요:', value);
            if (newPhone && newPhone !== value) {
                await updateMaeipeProperty(id, 'phone', newPhone, cell);
            }
        }
        
        // 상태 변경
        async function showStatusOptions(id, status, btn) {
            const statusOptions = ['대기', '진행중', '완료', '보류'];
            const newStatus = prompt('새 상태를 선택하세요:\n' + statusOptions.map((s, i) => `${i+1}. ${s}`).join('\n'), status);
            if (newStatus && statusOptions.includes(newStatus) && newStatus !== status) {
                await updateMaeipeProperty(id, 'status', newStatus, btn.closest('td'));
                btn.textContent = newStatus;
                btn.className = `btn btn-sm status-${newStatus}`;
            }
        }
        
        // 실거주 토글
        async function toggleOccupied(id, occupied) {
            const newOccupied = !occupied;
            await updateMaeipeProperty(id, 'is_occupied', newOccupied, null);
            
            // 로컬 데이터 업데이트 (순서 유지)
            const property = properties.find(p => p.id == id);
            if (property) {
                property.is_occupied = newOccupied;
            }
            
            // UI만 업데이트 (전체 리로드 없이)
            const occupiedCell = document.querySelector(`[onclick*="toggleOccupied(${id},"]`);
            if (occupiedCell) {
                const occupiedDisplay = newOccupied ? 'O' : 'X';
                const occupiedStyle = newOccupied ? 'background: #d1fae5; color: #065f46;' : 'background: #fecaca; color: #dc2626;';
                occupiedCell.innerHTML = `<span class="badge" style="${occupiedStyle}; padding:4px 8px; border-radius:4px; font-size:12px; font-weight:500;">${occupiedDisplay}</span>`;
                occupiedCell.setAttribute('onclick', `toggleOccupied(${id}, ${newOccupied})`);
            }
        }
        
        // 좋아요 편집
        async function showLikeOptions(id, likes, element) {
            const newLikes = prompt('좋아요 수를 입력하세요:', likes || 0);
            if (newLikes !== null && newLikes !== String(likes)) {
                await updateMaeipeProperty(id, 'likes', parseInt(newLikes) || 0, element.closest('td'));
                element.textContent = `👍 ${newLikes}`;
            }
        }
        
        // 싫어요 편집
        async function showDislikeOptions(id, dislikes, element) {
            const newDislikes = prompt('싫어요 수를 입력하세요:', dislikes || 0);
            if (newDislikes !== null && newDislikes !== String(dislikes)) {
                await updateMaeipeProperty(id, 'dislikes', parseInt(newDislikes) || 0, element.closest('td'));
                element.textContent = `👎 ${newDislikes}`;
            }
        }
        
        // 매물 삭제
        async function deleteProperty(id) {
            if (!confirm('정말로 이 매물을 삭제하시겠습니까?')) {
                return;
            }
            
            try {
                const response = await fetch(`/api/maeiple/${id}`, {
                    method: 'DELETE'
                });
                
                const result = await response.json();
                
                if (result.success) {
                    showMaeipeSuccess('매물이 삭제되었습니다.');
                    
                    // 로컬 데이터에서 제거 (순서 유지)
                    const propertyIndex = properties.findIndex(p => p.id == id);
                    if (propertyIndex > -1) {
                        properties.splice(propertyIndex, 1);
                    }
                    
                    // UI에서 해당 행 제거
                    const row = document.querySelector(`tr[data-property-id="${id}"]`);
                    if (row) {
                        row.remove();
                    }
                    
                    // 전체 리로드 없이 렌더링 업데이트
                    renderMaeipeProperties();
                } else {
                    showMaeipeError('삭제 실패: ' + (result.error || '알 수 없는 오류'));
                }
            } catch (error) {
                console.error('매물 삭제 실패:', error);
                showMaeipeError('삭제 중 오류가 발생했습니다.');
            }
        }
        
        // 메이플 매물 업데이트 공통 함수
        async function updateMaeipeProperty(id, field, value, cell) {
            try {
                const response = await fetch('/api/maeiple/update', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        id: id,
                        field: field,
                        value: value
                    })
                });
                
                const result = await response.json();
                
                if (result.success) {
                    showMaeipeSuccess(`${field} 수정 완료`);
                    if (cell) {
                        cell.textContent = value;
                    }
                } else {
                    showMaeipeError('수정 실패: ' + (result.error || '알 수 없는 오류'));
                }
            } catch (error) {
                console.error('매물 업데이트 실패:', error);
                showMaeipeError('수정 중 오류가 발생했습니다.');
            }
        }
        
        // 새 매물 추가 (직원페이지와 동일한 방식)
        function addNewPropertyRow() {
            console.log('관리자 새 매물 행 추가 시작...');
            
            const tbody = document.querySelector('#maeiple-table-content table tbody');
            if (!tbody) {
                console.error('매물 테이블 tbody를 찾을 수 없습니다.');
                showAlert('테이블을 찾을 수 없습니다. 메이플관리 섹션이 제대로 로드되지 않았습니다.', 'error');
                return;
            }
            
            console.log('테이블 tbody 찾음:', tbody);
            
            // 오늘 날짜 구하기 (한국시간 기준)
            const now = new Date();
            now.setHours(now.getHours() + 9);
            const today = now.toISOString().slice(0, 10);
            
            const newRow = document.createElement('tr');
            newRow.className = 'new-property-row';
            newRow.innerHTML = `
                <td style="text-align: center;">
                    <input type="checkbox" class="property-checkbox" style="width: 16px; height: 16px;" title="매물 선택">
                </td>
                <td class="editable-cell" data-field="check_date" data-type="date" onclick="editAdminPropertyCell(this)">${today}</td>
                <td class="editable-cell" data-field="building_number" data-type="number" onclick="editAdminPropertyCell(this)" style="color: #64748b;">동 번호 (선택)</td>
                <td class="editable-cell" data-field="room_number" data-type="number" onclick="editAdminPropertyCell(this)" style="color: #64748b;">호수 (선택)</td>
                <td class="editable-cell" data-field="status" data-type="select" onclick="editAdminPropertyCell(this)">
                    <span class="badge" style="background: #e0f2fe; color: #0369a1; padding:4px 8px; border-radius:4px; font-size:12px; font-weight:500;">거래가능</span>
                </td>
                <td class="editable-cell" data-field="jeonse_price" data-type="number" onclick="editAdminPropertyCell(this)" style="color: #64748b;">전세가 입력</td>
                <td class="editable-cell" data-field="monthly_deposit" data-type="number" onclick="editAdminPropertyCell(this)" style="color: #64748b;">월세보증금 입력</td>
                <td class="editable-cell" data-field="monthly_rent" data-type="number" onclick="editAdminPropertyCell(this)" style="color: #64748b;">월세 입력</td>
                <td class="editable-cell" data-field="sale_price" data-type="number" onclick="editAdminPropertyCell(this)" style="color: #64748b;">매매가 입력</td>
                <td class="editable-cell" data-field="is_occupied" data-type="select" onclick="editAdminPropertyCell(this)">
                    <span class="badge" style="background: #fecaca; color: #dc2626; padding:4px 8px; border-radius:4px; font-size:12px; font-weight:500;">X</span>
                </td>
                <td class="editable-cell" data-field="phone" data-type="text" onclick="editAdminPropertyCell(this)" style="color: #64748b;">연락처 입력</td>
                <td class="memo-cell" onclick="openNewAdminPropertyMemoModal(this)" style="color: #64748b; cursor: pointer;">메모 입력</td>
                <td class="editable-cell" data-field="employee_name" data-type="text" onclick="editAdminPropertyCell(this)" style="color: #64748b;">담당자 입력</td>
                <td class="editable-cell" data-field="employee_team" data-type="team" onclick="editAdminPropertyCell(this)">
                    <span class="status-badge" style="background: #f1f5f9; color: #64748b; padding: 4px 8px; border-radius: 4px; font-size: 12px; font-weight: 500;">
                        팀 입력
                    </span>
                </td>
                <td>
                    <div style="cursor: pointer; user-select: none; display: flex; align-items: center; justify-content: center; gap: 2px;" onclick="editNewAdminPropertyLikes(this, 'like')" data-count="0">
                        <span style="color: #9ca3af; font-size: 14px;">❤️ 0</span>
                    </div>
                </td>
                <td>
                    <div style="cursor: pointer; user-select: none; display: flex; align-items: center; justify-content: center; gap: 2px;" onclick="editNewAdminPropertyLikes(this, 'dislike')" data-count="0">
                        <span style="color: #9ca3af; font-size: 14px;">👎 0</span>
                    </div>
                </td>
                <td>
                    <div class="action-buttons">
                        <!-- 저장/취소 버튼 제거 - 행만 추가 -->
                    </div>
                </td>
            `;
            
            tbody.insertBefore(newRow, tbody.firstChild);
            console.log('새 행이 테이블에 추가됨');
            
            // 자동 포커스 제거 - 사용자가 원하는 셀을 직접 클릭하도록 함
            console.log('새 매물 행 추가 완료 - 원하는 셀을 클릭하여 편집하세요');
            
            console.log('새 매물 행이 추가되었습니다.');
            showAlert('새 매물 행이 추가되었습니다. 셀을 편집하면 자동으로 저장됩니다.', 'success');
        }

        // ==================== 고객 관리 관련 함수들 ====================
        
        let allCustomers = [];
        let filteredCustomers = [];
        let currentCustomerFilter = 'all';
        let currentEmployeeFilter = 'all';
        let currentCustomerPage = 1;
        let customerPerPage = 20;
        let customerTotalPages = 0;

        // 모든 고객 목록 조회 (관리자용 - 모든 직원의 고객 통합)
        async function loadAllCustomers(page = 1) {
            console.log(`👥 전체 고객 목록 로드 시작 (페이지 ${page})`);
            try {
                currentCustomerPage = page;
                const response = await fetch(`/api/customers?all_employees=true&page=${page}&per_page=${customerPerPage}`);
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                
                const data = await response.json();
                
                if (data.error) {
                    throw new Error(data.error);
                }
                
                allCustomers = Array.isArray(data.customers) ? data.customers : [];
                customerTotalPages = data.total_pages || 0;
                console.log(`✅ 전체 고객 목록 로드 완료: ${allCustomers.length}개 (페이지 ${page}/${customerTotalPages})`);
                
                // 직원 필터 옵션 업데이트
                updateEmployeeFilter();
                
                // 고객 목록 렌더링
                applyCustomerFilters();
                updateCustomerStats();
                renderCustomerPagination();
                
            } catch (error) {
                console.error('❌ 고객 목록 로드 실패:', error);
                showCustomerError(`고객 목록을 불러오는데 실패했습니다: ${error.message}`);
                
                // 빈 테이블 표시
                const tbody = document.querySelector('#customer-table-admin tbody');
                if (tbody) {
                    tbody.innerHTML = '<tr><td colspan="10" style="text-align: center; padding: 40px; color: #64748b;">고객 목록을 불러올 수 없습니다. 새로고침 버튼을 클릭해주세요.</td></tr>';
                }
            }
        }

        // 직원 필터 옵션 업데이트
        function updateEmployeeFilter() {
            const select = document.getElementById('employee-filter');
            const employees = [...new Set(allCustomers.map(c => c.employee_name || c.employee_id).filter(Boolean))];
            
            select.innerHTML = '<option value="all">전체 직원</option>';
            employees.forEach(emp => {
                const option = document.createElement('option');
                option.value = emp;
                option.textContent = emp;
                select.appendChild(option);
            });
        }

        // 고객 필터 적용
        function applyCustomerFilters() {
            filteredCustomers = allCustomers.slice();
            
            // 상태 필터 (progress_status 필드 사용)
            if (currentCustomerFilter !== 'all') {
                filteredCustomers = filteredCustomers.filter(c => (c.progress_status || '상담중') === currentCustomerFilter);
            }
            
            // 직원 필터
            if (currentEmployeeFilter !== 'all') {
                filteredCustomers = filteredCustomers.filter(c => 
                    (c.employee_name || c.employee_id) === currentEmployeeFilter
                );
            }
            
            renderCustomerTable();
        }

        // 고객 테이블 렌더링
        function renderCustomerTable() {
            const tableContent = document.getElementById('customer-table-content');
            
            if (filteredCustomers.length === 0) {
                tableContent.innerHTML = `
                    <div style="text-align: center; padding: 60px 20px; color: #64748b;">
                        <div style="font-size: 48px; margin-bottom: 16px; opacity: 0.5;">👥</div>
                        <p>조건에 맞는 고객이 없습니다.</p>
                        <p>필터를 변경하거나 새 고객을 추가해보세요.</p>
                    </div>
                `;
                return;
            }

            let tableHTML = `
                <table class="employees-table">
                    <thead>
                        <tr>
                            <th>날짜</th>
                            <th>입주</th>
                            <th>고객</th>
                            <th>고객번호</th>
                            <th>금액</th>
                            <th>룸수</th>
                            <th>위치</th>
                            <th>대출여부</th>
                            <th>주차</th>
                            <th>애완</th>
                            <th>메모</th>
                            <th>진행여부</th>
                            <th>주거사이트</th>
                            <th>업무사이트</th>
                            <th>담당자</th>
                            <th>작업</th>
                        </tr>
                    </thead>
                    <tbody>
            `;

            filteredCustomers.forEach(customer => {
                const statusClass = customer.progress_status === '계약' ? 'status-complete' : 
                                   customer.progress_status === '보류' ? 'status-hold' : 'status-progress';
                
                tableHTML += `
                    <tr>
                        <td>${customer.inquiry_date || '-'}</td>
                        <td>${customer.move_in_date || '-'}</td>
                        <td style="font-weight: 600;">${customer.customer_name || '-'}</td>
                        <td style="font-family: monospace;">${customer.customer_phone || customer.phone || '-'}</td>
                        <td style="font-weight: 600; color: #059669;">${customer.amount || customer.budget ? (customer.amount || customer.budget) + '만원' : '-'}</td>
                        <td>${customer.room_count || customer.rooms || '-'}</td>
                        <td>${customer.location || '-'}</td>
                        <td>${customer.loan_info || '-'}</td>
                        <td>${customer.parking || '-'}</td>
                        <td>${customer.pets || '-'}</td>
                        <td style="max-width: 150px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;" title="${customer.memo || ''}">${customer.memo || '-'}</td>
                        <td>
                            <span class="status-badge ${statusClass}">
                                ${customer.progress_status || '상담중'}
                            </span>
                        </td>
                        <td>
                            ${customer.management_site_id ? `<a href="https://web-production-d2f49.up.railway.app/customer/${customer.management_site_id}" target="_blank" class="site-link">주거사이트</a>` : '-'}
                        </td>
                        <td>
                            ${customer.management_site_id ? `<a href="http://localhost:5001/customer/${customer.management_site_id}" target="_blank" class="site-link">업무사이트</a>` : '-'}
                        </td>
                        <td style="font-weight: 500; color: #6366f1;">${customer.employee_name || customer.employee_id || '-'}</td>
                        <td>
                            <div class="action-buttons">
                                <button class="btn btn-primary btn-sm" onclick="editCustomer(${customer.id})">수정</button>
                                <button class="btn btn-danger btn-sm" onclick="deleteCustomer(${customer.id})">삭제</button>
                            </div>
                        </td>
                    </tr>
                `;
            });

            tableHTML += `
                    </tbody>
                </table>
            `;

            tableContent.innerHTML = tableHTML;
        }

        // 고객 통계 업데이트
        function updateCustomerStats() {
            const total = allCustomers.length;
            const progress = allCustomers.filter(c => (c.progress_status || '상담중') === '상담중').length;
            const completed = allCustomers.filter(c => (c.progress_status || '') === '계약').length;
            
            // 이번 주 신규 고객 (7일 이내)
            const weekAgo = new Date();
            weekAgo.setDate(weekAgo.getDate() - 7);
            const newCustomers = allCustomers.filter(c => {
                if (!c.inquiry_date && !c.created_date) return false;
                const customerDate = new Date(c.inquiry_date || c.created_date);
                return customerDate >= weekAgo;
            }).length;

            document.getElementById('total-customers-admin').textContent = total;
            document.getElementById('progress-customers-admin').textContent = progress;
            document.getElementById('completed-customers-admin').textContent = completed;
            document.getElementById('new-customers-admin').textContent = newCustomers;
        }

        // 고객 상태 필터
        function setCustomerFilter(status, btn) {
            currentCustomerFilter = status;
            
            // 버튼 스타일 업데이트
            document.querySelectorAll('.customer-filter-btn').forEach(b => {
                b.style.background = 'white';
                b.style.color = '#64748b';
            });
            btn.style.background = '#6366f1';
            btn.style.color = 'white';
            
            applyCustomerFilters();
        }

        // 직원 필터
        function filterByEmployee() {
            const select = document.getElementById('employee-filter');
            currentEmployeeFilter = select.value;
            applyCustomerFilters();
        }

        // 고객 관리 페이지네이션 렌더링
        function renderCustomerPagination() {
            const paginationContainer = document.getElementById('customer-pagination');
            if (!paginationContainer) return;
            
            if (customerTotalPages <= 1) {
                paginationContainer.innerHTML = '';
                return;
            }
            
            let paginationHTML = '<div class="pagination">';
            
            // 이전 페이지 버튼
            if (currentCustomerPage > 1) {
                paginationHTML += `<button class="pagination-btn" onclick="loadAllCustomers(${currentCustomerPage - 1})">&lt;</button>`;
            }
            
            // 페이지 번호들
            const startPage = Math.max(1, currentCustomerPage - 2);
            const endPage = Math.min(customerTotalPages, currentCustomerPage + 2);
            
            for (let i = startPage; i <= endPage; i++) {
                const isActive = i === currentCustomerPage;
                paginationHTML += `<button class="pagination-btn ${isActive ? 'active' : ''}" onclick="loadAllCustomers(${i})">${i}</button>`;
            }
            
            // 다음 페이지 버튼
            if (currentCustomerPage < customerTotalPages) {
                paginationHTML += `<button class="pagination-btn" onclick="loadAllCustomers(${currentCustomerPage + 1})">&gt;</button>`;
            }
            
            paginationHTML += '</div>';
            paginationContainer.innerHTML = paginationHTML;
        }

        // 에러 메시지 표시
        function showCustomerError(message) {
            alert('❌ ' + message);
        }

        // ==================== 고객 수정/삭제 기능 구현 ====================
        
        // 고객 수정 모달
        function editCustomer(customerId) {
            const customer = allCustomers.find(c => c.id === customerId);
            if (!customer) {
                showCustomerError('고객을 찾을 수 없습니다.');
                return;
            }
            
            // 모달 HTML 생성
            const modalHTML = `
                <div id="edit-customer-modal" class="modal" style="display: block;">
                    <div class="modal-content" style="max-width: 800px;">
                        <div class="modal-header">
                            <h3 class="modal-title">고객 정보 수정</h3>
                            <button class="close-btn" onclick="closeEditCustomerModal()">&times;</button>
                        </div>
                        <form id="edit-customer-form">
                            <div class="form-grid" style="grid-template-columns: repeat(2, 1fr); gap: 16px; margin-bottom: 20px;">
                                <div class="form-group">
                                    <label>날짜</label>
                                    <input type="date" name="inquiry_date" value="${customer.inquiry_date || ''}" required>
                                </div>
                                <div class="form-group">
                                    <label>입주일</label>
                                    <input type="date" name="move_in_date" value="${customer.move_in_date || ''}">
                                </div>
                                <div class="form-group">
                                    <label>고객명</label>
                                    <input type="text" name="customer_name" value="${customer.customer_name || ''}" required>
                                </div>
                                <div class="form-group">
                                    <label>고객번호</label>
                                    <input type="tel" name="customer_phone" value="${customer.customer_phone || customer.phone || ''}">
                                </div>
                                <div class="form-group">
                                    <label>금액</label>
                                    <input type="text" name="amount" value="${customer.amount || customer.budget || ''}">
                                </div>
                                <div class="form-group">
                                    <label>룸수</label>
                                    <input type="text" name="room_count" value="${customer.room_count || customer.rooms || ''}">
                                </div>
                                <div class="form-group">
                                    <label>위치</label>
                                    <input type="text" name="location" value="${customer.location || ''}">
                                </div>
                                <div class="form-group">
                                    <label>진행여부</label>
                                    <select name="progress_status">
                                        <option value="상담중" ${(customer.progress_status || '상담중') === '상담중' ? 'selected' : ''}>상담중</option>
                                        <option value="계약" ${customer.progress_status === '계약' ? 'selected' : ''}>계약</option>
                                        <option value="보류" ${customer.progress_status === '보류' ? 'selected' : ''}>보류</option>
                                    </select>
                                </div>
                            </div>
                                <div class="form-group">
                                    <label>대출여부</label>
                                    <input type="text" name="loan_info" value="${customer.loan_info || ''}">
                                </div>
                                <div class="form-group">
                                    <label>주차</label>
                                    <input type="text" name="parking" value="${customer.parking || ''}">
                                </div>
                                <div class="form-group">
                                    <label>애완동물</label>
                                    <input type="text" name="pets" value="${customer.pets || ''}">
                                </div>
                            </div>
                            <div class="form-group" style="grid-column: 1 / -1;">
                                <label>메모</label>
                                <textarea name="memo" rows="4" style="width: 100%; resize: vertical;">${customer.memo || ''}</textarea>
                            </div>
                            <div style="display: flex; gap: 12px; justify-content: flex-end; margin-top: 24px;">
                                <button type="button" class="btn btn-secondary" onclick="closeEditCustomerModal()">취소</button>
                                <button type="submit" class="btn btn-primary">저장</button>
                            </div>
                        </form>
                    </div>
                </div>
            `;
            
            // 모달을 body에 추가
            document.body.insertAdjacentHTML('beforeend', modalHTML);
            
            // 폼 제출 이벤트 리스너 추가
            document.getElementById('edit-customer-form').addEventListener('submit', async (e) => {
                e.preventDefault();
                await saveCustomerChanges(customerId, e.target);
            });
        }
        
        // 고객 수정 모달 닫기
        function closeEditCustomerModal() {
            const modal = document.getElementById('edit-customer-modal');
            if (modal) {
                modal.remove();
            }
        }
        
        // 고객 정보 저장
        async function saveCustomerChanges(customerId, form) {
            const formData = new FormData(form);
            const data = {};
            
            // FormData를 객체로 변환
            for (let [key, value] of formData.entries()) {
                data[key] = value || null;
            }
            
            try {
                const response = await fetch(`/api/customers/${customerId}`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(data)
                });
                
                const result = await response.json();
                
                if (result.success) {
                    alert('✅ 고객 정보가 수정되었습니다.');
                    closeEditCustomerModal();
                    loadAllCustomers(currentCustomerPage);
                } else {
                    showCustomerError('수정 실패: ' + (result.message || '알 수 없는 오류'));
                }
            } catch (error) {
                console.error('고객 수정 실패:', error);
                showCustomerError('수정 중 오류가 발생했습니다.');
            }
        }
        
        // 고객 삭제
        async function deleteCustomer(customerId) {
            const customer = allCustomers.find(c => c.id === customerId);
            const customerName = customer ? customer.customer_name : '알 수 없음';
            
            if (!confirm(`정말로 "${customerName}" 고객을 삭제하시겠습니까?\\n\\n이 작업은 되돌릴 수 없습니다.`)) {
                return;
            }
            
            try {
                const response = await fetch(`/api/customers/${customerId}`, {
                    method: 'DELETE'
                });
                
                const result = await response.json();
                
                if (result.success) {
                    alert('✅ 고객이 삭제되었습니다.');
                    loadAllCustomers(currentCustomerPage);
                } else {
                    showCustomerError('삭제 실패: ' + (result.message || '알 수 없는 오류'));
                }
            } catch (error) {
                console.error('고객 삭제 실패:', error);
                showCustomerError('삭제 중 오류가 발생했습니다.');
            }
        }

        // 새 고객 행 추가
        function addNewCustomerRow() {
            const tableContent = document.getElementById('customer-table-content');
            const table = tableContent.querySelector('table');
            
            if (!table) {
                // 테이블이 없으면 먼저 생성
                tableContent.innerHTML = `
                    <table class="employees-table">
                        <thead>
                            <tr>
                                <th>날짜</th>
                                <th>입주</th>
                                <th>고객</th>
                                <th>고객번호</th>
                                <th>금액</th>
                                <th>룸수</th>
                                <th>위치</th>
                                <th>대출여부</th>
                                <th>주차</th>
                                <th>애완</th>
                                <th>메모</th>
                                <th>진행여부</th>
                                <th>주거사이트</th>
                                <th>업무사이트</th>
                                <th>담당자</th>
                                <th>작업</th>
                            </tr>
                        </thead>
                        <tbody></tbody>
                    </table>
                `;
            }
            
            const tbody = tableContent.querySelector('tbody');
            const today = new Date().toISOString().split('T')[0];
            
            // 새 행 생성
            const newRow = document.createElement('tr');
            newRow.className = 'new-customer-row';
            newRow.style.backgroundColor = '#f0f9ff';
            
            newRow.innerHTML = `
                <td><input type="date" class="form-input" value="${today}" style="width:100px; font-size:12px;"></td>
                <td><input type="date" class="form-input" style="width:100px; font-size:12px;"></td>
                <td><input type="text" class="form-input" placeholder="고객명" style="width:80px; font-size:12px;"></td>
                <td><input type="text" class="form-input" placeholder="010-0000-0000" style="width:110px; font-size:12px;"></td>
                <td><input type="number" class="form-input" placeholder="예산" style="width:80px; font-size:12px;"></td>
                <td><input type="text" class="form-input" placeholder="2룸" style="width:60px; font-size:12px;"></td>
                <td><input type="text" class="form-input" placeholder="지역" style="width:80px; font-size:12px;"></td>
                <td>
                    <select class="form-input" style="width:60px; font-size:12px;">
                        <option value="false">X</option>
                        <option value="true">O</option>
                    </select>
                </td>
                <td>
                    <select class="form-input" style="width:60px; font-size:12px;">
                        <option value="false">X</option>
                        <option value="true">O</option>
                    </select>
                </td>
                <td><input type="text" class="form-input" placeholder="펫여부" style="width:60px; font-size:12px;"></td>
                <td><input type="text" class="form-input" placeholder="메모" style="width:150px; font-size:12px;"></td>
                <td>
                    <select class="form-input" style="width:80px; font-size:12px;">
                        <option value="진행중">진행중</option>
                        <option value="계약">계약</option>
                        <option value="보류">보류</option>
                    </select>
                </td>
                <td>-</td>
                <td>-</td>
                <td>관리자</td>
                <td>
                    <button onclick="saveNewCustomer(this)" class="btn btn-sm btn-primary" style="padding:4px 8px; font-size:11px;">저장</button>
                    <button onclick="cancelNewCustomer(this)" class="btn btn-sm btn-secondary" style="padding:4px 8px; font-size:11px;">취소</button>
                </td>
            `;
            
            tbody.insertBefore(newRow, tbody.firstChild);
        }
        
        // 새 고객 저장
        async function saveNewCustomer(button) {
            const row = button.closest('tr');
            const inputs = row.querySelectorAll('input, select');
            
            const customerData = {
                inquiry_date: inputs[0].value,
                move_in_date: inputs[1].value,
                customer_name: inputs[2].value,
                customer_phone: inputs[3].value,
                budget: inputs[4].value ? parseInt(inputs[4].value) : null,
                rooms: inputs[5].value,
                location: inputs[6].value,
                loan_needed: inputs[7].value === 'true',
                parking_needed: inputs[8].value === 'true',
                pets: inputs[9].value,
                memo: inputs[10].value,
                status: inputs[11].value
            };
            
            // 필수 필드 확인
            if (!customerData.customer_name) {
                alert('고객명을 입력해주세요.');
                return;
            }
            
            try {
                const response = await fetch('/api/customers', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(customerData)
                });
                
                const result = await response.json();
                
                if (result.success) {
                    alert('고객이 추가되었습니다.');
                    row.remove();
                    loadAllCustomers(1); // 목록 새로고침
                } else {
                    alert(result.message || '고객 추가에 실패했습니다.');
                }
            } catch (error) {
                console.error('고객 추가 오류:', error);
                alert('서버 오류가 발생했습니다.');
            }
        }
        
        // 새 고객 취소
        function cancelNewCustomer(button) {
            const row = button.closest('tr');
            row.remove();
        }

        // 팀장용 메이플관리 통계 업데이트
        function updateTeamMaeipleStats(data) {
            const properties = data.properties || [];
            const total = properties.length;
            
            // 상태별 개수 계산
            const statusCounts = {
                '거래중': 0,
                '거래완료': 0,
                '보류': 0,
                '부재': 0
            };
            
            properties.forEach(property => {
                const status = property.status || '보류';
                if (statusCounts.hasOwnProperty(status)) {
                    statusCounts[status]++;
                }
            });
            
            // 이번 주 신규 등록 계산 (현재 날짜 기준으로 7일 이내)
            const now = new Date();
            const weekAgo = new Date(now.getTime() - 7 * 24 * 60 * 60 * 1000);
            const newThisWeek = properties.filter(property => {
                const createdDate = new Date(property.created_at || property.date_added || now);
                return createdDate >= weekAgo;
            }).length;
            
            // 통계 카드 업데이트
            document.getElementById('total-maeiple-team').textContent = total;
            document.getElementById('available-maeiple-team').textContent = statusCounts['거래중'];
            document.getElementById('completed-maeiple-team').textContent = statusCounts['거래완료'];
            document.getElementById('new-maeiple-team').textContent = newThisWeek;
            
            console.log('팀장용 메이플관리 통계 업데이트 완료:', statusCounts);
        }

        // ==================== 팀장 전용 함수들 ====================
        
        // 팀장 본인 고객 조회
        async function loadTeamLeaderCustomers(page = 1) {
            try {
                const url = `/api/team-leader/customers?page=${page}&per_page=20`;
                const response = await fetch(url);
                const data = await response.json();
                
                if (data.customers) {
                    console.log(`팀장 본인 고객 로드: ${data.customers.length}개 (페이지 ${page}/${data.total_pages})`);
                    renderTeamLeaderCustomers(data.customers);
                    renderTeamLeaderCustomerPagination(data.total_pages, page);
                    updateTeamLeaderCustomerStats(data.customers);
                } else {
                    console.error('팀장 본인 고객 데이터 오류:', data.error);
                    alert('팀장 본인 고객을 불러오는데 실패했습니다.');
                }
            } catch (error) {
                console.error('팀장 본인 고객 로드 오류:', error);
                alert('팀장 본인 고객을 불러오는데 실패했습니다.');
            }
        }

        // 팀장 본인 매물 조회
        async function loadTeamLeaderMaeiple(page = 1) {
            try {
                const url = `/api/team-leader/maeiple?page=${page}&per_page=20`;
                const response = await fetch(url);
                const data = await response.json();
                
                if (data.success) {
                    console.log(`팀장 본인 매물 로드: ${data.properties.length}개 (페이지 ${page}/${data.total_pages})`);
                    renderTeamLeaderMaeiple(data.properties);
                    renderTeamLeaderMaeiplePagination(data.total_pages, page);
                    updateTeamLeaderMaeipleStats(data.properties);
                } else {
                    console.error('팀장 본인 매물 데이터 오류:', data.error);
                    alert('팀장 본인 매물을 불러오는데 실패했습니다.');
                }
            } catch (error) {
                console.error('팀장 본인 매물 로드 오류:', error);
                alert('팀장 본인 매물을 불러오는데 실패했습니다.');
            }
        }

        // 팀 전체 고객 조회
        async function loadTeamCustomers(page = 1) {
            try {
                const url = `/api/team/customers?page=${page}&per_page=20`;
                const response = await fetch(url);
                const data = await response.json();
                
                if (data.customers) {
                    console.log(`팀 전체 고객 로드: ${data.customers.length}개 (페이지 ${page}/${data.total_pages})`);
                    renderTeamCustomers(data.customers);
                    renderTeamCustomerPagination(data.total_pages, page);
                    updateTeamCustomerStats(data.customers);
                } else {
                    console.error('팀 전체 고객 데이터 오류:', data.error);
                    alert('팀 전체 고객을 불러오는데 실패했습니다.');
                }
            } catch (error) {
                console.error('팀 전체 고객 로드 오류:', error);
                alert('팀 전체 고객을 불러오는데 실패했습니다.');
            }
        }

        // 팀 전체 매물 조회
        async function loadTeamMaeiple(page = 1) {
            try {
                const url = `/api/team/maeiple?page=${page}&per_page=20`;
                const response = await fetch(url);
                const data = await response.json();
                
                if (data.success) {
                    console.log(`팀 전체 매물 로드: ${data.properties.length}개 (페이지 ${page}/${data.total_pages})`);
                    renderTeamMaeiple(data.properties);
                    renderTeamMaeiplePagination(data.total_pages, page);
                    updateTeamMaeipleStats(data.properties);
                } else {
                    console.error('팀 전체 매물 데이터 오류:', data.error);
                    alert('팀 전체 매물을 불러오는데 실패했습니다.');
                }
            } catch (error) {
                console.error('팀 전체 매물 로드 오류:', error);
                alert('팀 전체 매물을 불러오는데 실패했습니다.');
            }
        }

        // 팀장 본인 고객 렌더링
        function renderTeamLeaderCustomers(customers) {
            const tableContent = document.getElementById('team-leader-customer-table-body');
            if (!tableContent) return;
            
            let tableHTML = '';
            customers.forEach(customer => {
                tableHTML += `
                    <tr>
                        <td>${customer.inquiry_date || ''}</td>
                        <td>${customer.customer_name || ''}</td>
                        <td>${customer.phone || ''}</td>
                        <td>${customer.amount || ''}</td>
                        <td>${customer.room_count || ''}</td>
                        <td>${customer.location || ''}</td>
                        <td>${customer.loan_info || ''}</td>
                        <td>${customer.parking || ''}</td>
                        <td>${customer.pets || ''}</td>
                        <td>${customer.memo || ''}</td>
                        <td>
                            <span class="status-badge ${customer.progress_status === '진행중' ? 'progress' : customer.progress_status === '계약' ? 'completed' : 'pending'}">
                                ${customer.progress_status || '상담중'}
                            </span>
                        </td>
                        <td>${customer.employee_name || ''}</td>
                        <td>
                            <button class="btn btn-sm btn-primary" onclick="editTeamLeaderCustomer(${customer.id})">수정</button>
                            <button class="btn btn-sm btn-danger" onclick="deleteTeamLeaderCustomer(${customer.id})">삭제</button>
                        </td>
                    </tr>
                `;
            });
            
            tableContent.innerHTML = tableHTML;
        }

        // 팀장 본인 매물 렌더링
        function renderTeamLeaderMaeiple(properties) {
            const tableContent = document.getElementById('team-leader-maeiple-table-body');
            if (!tableContent) return;
            
            let tableHTML = '';
            properties.forEach(property => {
                tableHTML += `
                    <tr>
                        <td>${property.check_date || ''}</td>
                        <td>${property.building_number || ''}</td>
                        <td>${property.room_number || ''}</td>
                        <td>
                            <span class="status-badge ${property.status === '거래중' ? 'progress' : property.status === '거래완료' ? 'completed' : 'pending'}">
                                ${property.status || '보류'}
                            </span>
                        </td>
                        <td>${property.jeonse_price || ''}</td>
                        <td>${property.monthly_rent || ''}</td>
                        <td>${property.sale_price || ''}</td>
                        <td>${property.is_occupied ? '입주중' : '빈방'}</td>
                        <td>${property.phone || ''}</td>
                        <td>${property.memo || ''}</td>
                        <td>${property.likes || 0}</td>
                        <td>${property.dislikes || 0}</td>
                        <td>${property.employee_name || ''}</td>
                        <td>
                            <button class="btn btn-sm btn-primary" onclick="editTeamLeaderMaeiple(${property.id})">수정</button>
                            <button class="btn btn-sm btn-danger" onclick="deleteTeamLeaderMaeiple(${property.id})">삭제</button>
                        </td>
                    </tr>
                `;
            });
            
            tableContent.innerHTML = tableHTML;
        }

        // 팀 전체 고객 렌더링
        function renderTeamCustomers(customers) {
            const tableContent = document.getElementById('team-customer-table-body');
            if (!tableContent) return;
            
            let tableHTML = '';
            customers.forEach(customer => {
                tableHTML += `
                    <tr>
                        <td>${customer.inquiry_date || ''}</td>
                        <td>${customer.customer_name || ''}</td>
                        <td>${customer.phone || ''}</td>
                        <td>${customer.amount || ''}</td>
                        <td>${customer.room_count || ''}</td>
                        <td>${customer.location || ''}</td>
                        <td>${customer.loan_info || ''}</td>
                        <td>${customer.parking || ''}</td>
                        <td>${customer.pets || ''}</td>
                        <td>${customer.memo || ''}</td>
                        <td>
                            <span class="status-badge ${customer.progress_status === '진행중' ? 'progress' : customer.progress_status === '계약' ? 'completed' : 'pending'}">
                                ${customer.progress_status || '상담중'}
                            </span>
                        </td>
                        <td>${customer.employee_name || ''}</td>
                        <td>
                            <button class="btn btn-sm btn-primary" onclick="editTeamCustomer(${customer.id})">수정</button>
                            <button class="btn btn-sm btn-danger" onclick="deleteTeamCustomer(${customer.id})">삭제</button>
                        </td>
                    </tr>
                `;
            });
            
            tableContent.innerHTML = tableHTML;
        }

        // 팀 전체 매물 렌더링
        function renderTeamMaeiple(properties) {
            const tableContent = document.getElementById('team-maeiple-table-body');
            if (!tableContent) return;
            
            let tableHTML = '';
            properties.forEach(property => {
                tableHTML += `
                    <tr>
                        <td>${property.check_date || ''}</td>
                        <td>${property.building_number || ''}</td>
                        <td>${property.room_number || ''}</td>
                        <td>
                            <span class="status-badge ${property.status === '거래중' ? 'progress' : property.status === '거래완료' ? 'completed' : 'pending'}">
                                ${property.status || '보류'}
                            </span>
                        </td>
                        <td>${property.jeonse_price || ''}</td>
                        <td>${property.monthly_rent || ''}</td>
                        <td>${property.sale_price || ''}</td>
                        <td>${property.is_occupied ? '입주중' : '빈방'}</td>
                        <td>${property.phone || ''}</td>
                        <td>${property.memo || ''}</td>
                        <td>${property.likes || 0}</td>
                        <td>${property.dislikes || 0}</td>
                        <td>${property.employee_name || ''}</td>
                        <td>
                            <button class="btn btn-sm btn-primary" onclick="editTeamMaeiple(${property.id})">수정</button>
                            <button class="btn btn-sm btn-danger" onclick="deleteTeamMaeiple(${property.id})">삭제</button>
                        </td>
                    </tr>
                `;
            });
            
            tableContent.innerHTML = tableHTML;
        }

        // 통계 업데이트 함수들
        function updateTeamLeaderCustomerStats(customers) {
            const total = customers.length;
            const progress = customers.filter(c => (c.progress_status || '상담중') === '진행중').length;
            const completed = customers.filter(c => (c.progress_status || '') === '계약').length;
            
            const weekAgo = new Date();
            weekAgo.setDate(weekAgo.getDate() - 7);
            const newCustomers = customers.filter(c => {
                if (!c.inquiry_date) return false;
                const customerDate = new Date(c.inquiry_date);
                return customerDate >= weekAgo;
            }).length;

            // 통계 카드 업데이트 (팀장 본인 고객)
            const totalElement = document.getElementById('total-customers-team-leader');
            const progressElement = document.getElementById('progress-customers-team-leader');
            const completedElement = document.getElementById('completed-customers-team-leader');
            const newElement = document.getElementById('new-customers-team-leader');
            
            if (totalElement) totalElement.textContent = total;
            if (progressElement) progressElement.textContent = progress;
            if (completedElement) completedElement.textContent = completed;
            if (newElement) newElement.textContent = newCustomers;
        }

        function updateTeamLeaderMaeipleStats(properties) {
            const total = properties.length;
            const progress = properties.filter(p => p.status === '거래중').length;
            const completed = properties.filter(p => p.status === '거래완료').length;
            
            const now = new Date();
            const weekAgo = new Date(now.getTime() - 7 * 24 * 60 * 60 * 1000);
            const newThisWeek = properties.filter(property => {
                const createdDate = new Date(property.created_at || property.date_added || now);
                return createdDate >= weekAgo;
            }).length;

            // 통계 카드 업데이트 (팀장 본인 매물)
            const totalElement = document.getElementById('total-maeiple-team-leader');
            const progressElement = document.getElementById('available-maeiple-team-leader');
            const completedElement = document.getElementById('completed-maeiple-team-leader');
            const newElement = document.getElementById('new-maeiple-team-leader');
            
            if (totalElement) totalElement.textContent = total;
            if (progressElement) progressElement.textContent = progress;
            if (completedElement) completedElement.textContent = completed;
            if (newElement) newElement.textContent = newThisWeek;
        }

        function updateTeamCustomerStats(customers) {
            const total = customers.length;
            const progress = customers.filter(c => (c.progress_status || '상담중') === '진행중').length;
            const completed = customers.filter(c => (c.progress_status || '') === '계약').length;
            
            const weekAgo = new Date();
            weekAgo.setDate(weekAgo.getDate() - 7);
            const newCustomers = customers.filter(c => {
                if (!c.inquiry_date) return false;
                const customerDate = new Date(c.inquiry_date);
                return customerDate >= weekAgo;
            }).length;

            // 통계 카드 업데이트 (팀 전체 고객)
            const totalElement = document.getElementById('total-customers-team');
            const progressElement = document.getElementById('progress-customers-team');
            const completedElement = document.getElementById('completed-customers-team');
            const newElement = document.getElementById('new-customers-team');
            
            if (totalElement) totalElement.textContent = total;
            if (progressElement) progressElement.textContent = progress;
            if (completedElement) completedElement.textContent = completed;
            if (newElement) newElement.textContent = newCustomers;
        }

        // 페이지네이션 렌더링 함수들
        function renderTeamLeaderCustomerPagination(totalPages, currentPage) {
            const pagination = document.getElementById('team-leader-customer-pagination');
            if (!pagination) return;
            
            let paginationHTML = '';
            for (let i = 1; i <= totalPages; i++) {
                paginationHTML += `
                    <button class="btn btn-sm ${i === currentPage ? 'btn-primary' : 'btn-outline-primary'}" 
                            onclick="loadTeamLeaderCustomers(${i})">${i}</button>
                `;
            }
            pagination.innerHTML = paginationHTML;
        }

        function renderTeamLeaderMaeiplePagination(totalPages, currentPage) {
            const pagination = document.getElementById('team-leader-maeiple-pagination');
            if (!pagination) return;
            
            let paginationHTML = '';
            for (let i = 1; i <= totalPages; i++) {
                paginationHTML += `
                    <button class="btn btn-sm ${i === currentPage ? 'btn-primary' : 'btn-outline-primary'}" 
                            onclick="loadTeamLeaderMaeiple(${i})">${i}</button>
                `;
            }
            pagination.innerHTML = paginationHTML;
        }

        function renderTeamCustomerPagination(totalPages, currentPage) {
            const pagination = document.getElementById('team-customer-pagination');
            if (!pagination) return;
            
            let paginationHTML = '';
            for (let i = 1; i <= totalPages; i++) {
                paginationHTML += `
                    <button class="btn btn-sm ${i === currentPage ? 'btn-primary' : 'btn-outline-primary'}" 
                            onclick="loadTeamCustomers(${i})">${i}</button>
                `;
            }
            pagination.innerHTML = paginationHTML;
        }

        function renderTeamMaeiplePagination(totalPages, currentPage) {
            const pagination = document.getElementById('team-maeiple-pagination');
            if (!pagination) return;
            
            let paginationHTML = '';
            for (let i = 1; i <= totalPages; i++) {
                paginationHTML += `
                    <button class="btn btn-sm ${i === currentPage ? 'btn-primary' : 'btn-outline-primary'}" 
                            onclick="loadTeamMaeiple(${i})">${i}</button>
                `;
            }
            pagination.innerHTML = paginationHTML;
        }

        // 필터 함수들
        function setTeamLeaderCustomerFilter(status, btn) {
            // 버튼 스타일 업데이트
            document.querySelectorAll('.filter-btn[data-status]').forEach(b => {
                b.classList.remove('active');
            });
            btn.classList.add('active');
            
            // 필터링 로직 (필요시 구현)
            console.log('팀장 본인 고객 필터:', status);
        }

        function setTeamLeaderMaeipleFilter(status, btn) {
            // 버튼 스타일 업데이트
            document.querySelectorAll('.filter-btn[data-status]').forEach(b => {
                b.classList.remove('active');
            });
            btn.classList.add('active');
            
            // 필터링 로직 (필요시 구현)
            console.log('팀장 본인 매물 필터:', status);
        }

        function setTeamCustomerFilter(status, btn) {
            // 버튼 스타일 업데이트
            document.querySelectorAll('.filter-btn[data-status]').forEach(b => {
                b.classList.remove('active');
            });
            btn.classList.add('active');
            
            // 필터링 로직 (필요시 구현)
            console.log('팀 전체 고객 필터:', status);
        }

        function setTeamMaeipleFilter(status, btn) {
            // 버튼 스타일 업데이트
            document.querySelectorAll('.filter-btn[data-status]').forEach(b => {
                b.classList.remove('active');
            });
            btn.classList.add('active');
            
            // 필터링 로직 (필요시 구현)
            console.log('팀 전체 매물 필터:', status);
        }

        // 편집/삭제 함수들 (임시 구현)
        function editTeamLeaderCustomer(id) { alert('팀장 본인 고객 수정 기능은 준비 중입니다.'); }
        function deleteTeamLeaderCustomer(id) { alert('팀장 본인 고객 삭제 기능은 준비 중입니다.'); }
        function editTeamLeaderMaeiple(id) { alert('팀장 본인 매물 수정 기능은 준비 중입니다.'); }
        function deleteTeamLeaderMaeiple(id) { alert('팀장 본인 매물 삭제 기능은 준비 중입니다.'); }
        function editTeamCustomer(id) { alert('팀 고객 수정 기능은 준비 중입니다.'); }
        function deleteTeamCustomer(id) { alert('팀 고객 삭제 기능은 준비 중입니다.'); }
        function editTeamMaeiple(id) { alert('팀 매물 수정 기능은 준비 중입니다.'); }
        function deleteTeamMaeiple(id) { alert('팀 매물 삭제 기능은 준비 중입니다.'); }

        // 추가 함수들 (임시 구현)
        function addNewTeamLeaderCustomerRow() { alert('팀장 본인 고객 추가 기능은 준비 중입니다.'); }
        function addNewTeamLeaderMaeipleRow() { alert('팀장 본인 매물 추가 기능은 준비 중입니다.'); }
        function addNewTeamCustomerRow() { alert('팀 고객 추가 기능은 준비 중입니다.'); }
        function addNewTeamMaeipleRow() { alert('팀 매물 추가 기능은 준비 중입니다.'); }
        
        // ==================== 매물 메모 모달 관련 함수 (직원페이지와 동일) ====================
        
        // 매물 메모 모달 열기
        function openPropertyMemoModal(propertyId, currentMemo, buildingNumber, roomNumber) {
            const modal = document.getElementById('property-memo-modal');
            const textarea = document.getElementById('property-memo-textarea');
            const propertyInfo = document.getElementById('property-memo-info');
            
            // 매물 정보 표시
            const propertyDisplay = `${buildingNumber || '동'}${roomNumber ? '-' + roomNumber + '호' : ''}`;
            propertyInfo.textContent = propertyDisplay;
            
            // 현재 메모 내용 설정
            textarea.value = currentMemo || '';
            
            // 모달 표시
            modal.classList.add('active');
            
            // 텍스트 영역에 포커스
            setTimeout(() => {
                textarea.focus();
                textarea.setSelectionRange(textarea.value.length, textarea.value.length);
            }, 100);
            
            // 전역 변수에 현재 편집 중인 매물 정보 저장
            window.currentPropertyMemo = {
                id: propertyId,
                element: null
            };
        }
        
        // 매물 메모 모달 닫기
        function closePropertyMemoModal() {
            const modal = document.getElementById('property-memo-modal');
            modal.classList.remove('active');
            window.currentPropertyMemo = null;
        }
        
        // 매물 메모 저장
        async function savePropertyMemo() {
            const textarea = document.getElementById('property-memo-textarea');
            const memo = textarea.value.trim();
            
            if (!window.currentPropertyMemo) {
                console.error('저장할 매물 정보가 없습니다.');
                return;
            }
            
            const propertyId = window.currentPropertyMemo.id;
            
            try {
                // 서버에 저장
                const response = await fetch('/api/maeiple/update', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        id: propertyId,
                        field: 'memo',
                        value: memo
                    })
                });
                
                if (response.ok) {
                    console.log('메모 저장 성공:', { propertyId, memo });
                    
                    // 로컬 데이터도 업데이트 (순서 유지)
                    const property = properties.find(p => p.id == propertyId);
                    if (property) {
                        property.memo = memo;
                    }
                    
                    // UI 업데이트
                    updateMemoInUI(propertyId, memo);
                    
                    // 모달 닫기
                    closePropertyMemoModal();
                    
                    showAlert('메모가 저장되었습니다.', 'success');
                } else {
                    const errorData = await response.json();
                    throw new Error(errorData.error || '저장 실패');
                }
                
            } catch (error) {
                console.error('메모 저장 오류:', error);
                showAlert(`메모 저장 중 오류가 발생했습니다: ${error.message}`, 'error');
            }
        }
        
        // 메모 UI만 업데이트 (순서 유지)
        function updateMemoInUI(propertyId, memo) {
            // 해당 매물의 메모 셀 찾기
            const memoCell = document.querySelector(`[onclick*="openPropertyMemoModal(${propertyId},"]`);
            if (memoCell) {
                // 메모 내용 업데이트
                const displayText = memo ? (memo.length > 20 ? memo.substring(0, 20) + '...' : memo) : '-';
                memoCell.textContent = displayText;
                memoCell.style.color = memo ? '#374151' : '#64748b';
                memoCell.style.fontStyle = memo ? 'normal' : 'italic';
                
                // onclick 속성도 업데이트하여 새로운 메모 내용을 반영
                const row = memoCell.closest('tr');
                const buildingNumber = row.querySelector('[data-field="building_number"]')?.textContent || '';
                const roomNumber = row.querySelector('[data-field="room_number"]')?.textContent || '';
                const escapedMemo = (memo || '').replace(/'/g, "\\'").replace(/"/g, '\\"');
                
                memoCell.setAttribute('onclick', `openPropertyMemoModal(${propertyId}, '${escapedMemo}', '${buildingNumber}', '${roomNumber}')`);
            }
        }
        
        // ESC 키로 모달 닫기
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape') {
                closePropertyMemoModal();
            }
        });
        
        // 메모 텍스트 영역 이벤트 리스너 (기존 DOMContentLoaded에 통합됨)
        
        // ==================== 관리자용 매물 추가 관련 함수들 ====================
        
        // 새 매물 자동저장 함수
        async function autoSaveNewProperty(cell) {
            const row = cell.closest('tr');
            if (!row || !row.classList.contains('new-property-row')) {
                return; // 새 매물 행이 아니면 저장하지 않음
            }
            
            console.log('🔄 새 매물 자동저장 시작...');
            
            try {
                // 데이터 수집
                const propertyData = {};
                const cells = row.querySelectorAll('.editable-cell');
                
                cells.forEach(cell => {
                    const field = cell.dataset.field;
                    let value = cell.textContent.trim();
                    
                    // 배지에서 값 추출
                    if (field === 'status') {
                        const badge = cell.querySelector('.badge');
                        value = badge ? badge.textContent.trim() : '거래가능';
                    } else if (field === 'is_occupied') {
                        const badge = cell.querySelector('.badge');
                        value = badge && badge.textContent.trim() === 'O';
                    } else if (field === 'employee_team') {
                        // 팀 필드에서 status-badge 값 추출
                        const badge = cell.querySelector('.status-badge');
                        value = badge ? badge.textContent.trim() : '';
                        // 플레이스홀더 텍스트 제거
                        if (value === '팀 입력') {
                            value = '';
                        }
                    } else if (field.includes('price') || field.includes('deposit') || field.includes('rent')) {
                        // 가격 필드 처리
                        const numValue = value.replace(/[^0-9]/g, '');
                        value = numValue ? parseInt(numValue) : null;
                    } else if (field === 'building_number' || field === 'room_number') {
                        // 동/호수 처리 (선택사항)
                        value = value.replace(/[^0-9]/g, '');
                        // 필수 검증 제거 - 빈 값도 허용
                    }
                    
                    // 플레이스홀더 텍스트 제거 (담당자 필드)
                    if (field === 'employee_name' && typeof value === 'string' && value.includes('입력')) {
                        value = '';
                    }
                    
                    propertyData[field] = value;
                });
                
                // 메모 처리
                const memoCell = row.querySelector('.memo-cell');
                propertyData.memo = memoCell.dataset.memo || '';
                
                // 담당자와 팀 정보 (공란일 수 있음)
                propertyData.employee_name = propertyData.employee_name || '';
                propertyData.employee_team = propertyData.employee_team || '';
                
                console.log('자동저장할 매물 데이터:', propertyData);
                
                // API 호출
                const response = await fetch('/api/maeiple', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(propertyData)
                });
                
                if (!response.ok) {
                    const errorText = await response.text();
                    throw new Error(`HTTP ${response.status}: ${errorText}`);
                }
                
                const result = await response.json();
                
                if (result && result.success === true) {
                    console.log('✅ 새 매물 자동저장 성공:', result);
                    
                    // 성공적으로 저장된 경우 새 행을 제거하고 테이블에 추가
                    if (result.created_property) {
                        await addNewPropertyToTable(result.created_property);
                        row.remove();
                        
                        // 성공 메시지 표시
                        showAlert('매물이 자동으로 저장되었습니다.', 'success');
                    }
                } else {
                    const errorMsg = result?.error || result?.message || '자동저장에 실패했습니다.';
                    console.warn('자동저장 실패:', errorMsg);
                    // 오류가 발생해도 사용자에게는 알리지 않음 (자동저장이므로)
                }
                
            } catch (error) {
                console.error('자동저장 오류:', error);
                // 오류가 발생해도 사용자에게는 알리지 않음 (자동저장이므로)
            }
        }

        // 관리자용 매물 셀 편집
        function editAdminPropertyCell(cell) {
            // 이미 편집 중이어도 강제로 편집 진입
            if (cell.classList.contains('editing-cell')) {
                const existingSelector = cell.querySelector('.status-selector');
                if (existingSelector) {
                    existingSelector.remove();
                }
                cell.classList.remove('editing-cell');
                return; // 편집 모드 종료
            }
            
            const field = cell.dataset.field;
            const type = cell.dataset.type;
            let currentValue = cell.textContent.trim();
            
            // 배지에서 실제 값 추출
            if (field === 'status') {
                const badge = cell.querySelector('.badge');
                currentValue = badge ? badge.textContent.trim() : '거래가능';
            } else if (field === 'is_occupied') {
                const badge = cell.querySelector('.badge');
                currentValue = badge && badge.textContent.trim() === 'O' ? true : false;
            }
            
            // 플레이스홀더 텍스트 제거
            if (currentValue.includes('입력')) {
                currentValue = '';
            }
            
            console.log('관리자 매물 셀 편집:', { field, type, currentValue });
            
            cell.classList.add('editing-cell');
            
            if (type === 'select') {
                if (field === 'status') {
                    // 상태 선택 드롭다운
                    const statusOptions = ['거래가능', '계약완료', '보류', '부재'];
                    const selector = document.createElement('select');
                    selector.className = 'status-selector';
                    selector.style.cssText = 'width: 100%; padding: 4px; border: 2px solid #3b82f6; border-radius: 4px; background: white; font-size: 12px;';
                    
                    statusOptions.forEach(option => {
                        const optionElement = document.createElement('option');
                        optionElement.value = option;
                        optionElement.textContent = option;
                        if (option === currentValue) {
                            optionElement.selected = true;
                        }
                        selector.appendChild(optionElement);
                    });
                    
                    selector.addEventListener('change', () => {
                        const selectedValue = selector.value;
                        const statusColors = {
                            '거래가능': { bg: '#e0f2fe', color: '#0369a1' },
                            '계약완료': { bg: '#dcfce7', color: '#16a34a' },
                            '보류': { bg: '#fef3c7', color: '#d97706' },
                            '부재': { bg: '#fecaca', color: '#dc2626' }
                        };
                        const colors = statusColors[selectedValue] || statusColors['거래가능'];
                        
                        cell.innerHTML = `<span class="badge" style="background: ${colors.bg}; color: ${colors.color}; padding:4px 8px; border-radius:4px; font-size:12px; font-weight:500;">${selectedValue}</span>`;
                        cell.classList.remove('editing-cell');
                        
                        // 자동저장 실행
                        autoSaveNewProperty(cell);
                    });
                    
                    selector.addEventListener('blur', () => {
                        const selectedValue = selector.value;
                        const statusColors = {
                            '거래가능': { bg: '#e0f2fe', color: '#0369a1' },
                            '계약완료': { bg: '#dcfce7', color: '#16a34a' },
                            '보류': { bg: '#fef3c7', color: '#d97706' },
                            '부재': { bg: '#fecaca', color: '#dc2626' }
                        };
                        const colors = statusColors[selectedValue] || statusColors['거래가능'];
                        
                        cell.innerHTML = `<span class="badge" style="background: ${colors.bg}; color: ${colors.color}; padding:4px 8px; border-radius:4px; font-size:12px; font-weight:500;">${selectedValue}</span>`;
                        cell.classList.remove('editing-cell');
                        
                        // 자동저장 실행
                        autoSaveNewProperty(cell);
                    });
                    
                    cell.innerHTML = '';
                    cell.appendChild(selector);
                    selector.focus();
                    
                } else if (field === 'is_occupied') {
                    // 거주 여부 선택
                    const occupiedOptions = [
                        { value: false, text: 'X', bg: '#fecaca', color: '#dc2626' },
                        { value: true, text: 'O', bg: '#dcfce7', color: '#16a34a' }
                    ];
                    
                    const selector = document.createElement('select');
                    selector.className = 'status-selector';
                    selector.style.cssText = 'width: 100%; padding: 4px; border: 2px solid #3b82f6; border-radius: 4px; background: white; font-size: 12px;';
                    
                    occupiedOptions.forEach(option => {
                        const optionElement = document.createElement('option');
                        optionElement.value = option.value;
                        optionElement.textContent = option.text;
                        if (option.value === currentValue) {
                            optionElement.selected = true;
                        }
                        selector.appendChild(optionElement);
                    });
                    
                    selector.addEventListener('change', () => {
                        const selectedValue = selector.value === 'true';
                        const option = occupiedOptions.find(opt => opt.value === selectedValue);
                        
                        cell.innerHTML = `<span class="badge" style="background: ${option.bg}; color: ${option.color}; padding:4px 8px; border-radius:4px; font-size:12px; font-weight:500;">${option.text}</span>`;
                        cell.classList.remove('editing-cell');
                        
                        // 자동저장 실행
                        autoSaveNewProperty(cell);
                    });
                    
                    selector.addEventListener('blur', () => {
                        const selectedValue = selector.value === 'true';
                        const option = occupiedOptions.find(opt => opt.value === selectedValue);
                        
                        cell.innerHTML = `<span class="badge" style="background: ${option.bg}; color: ${option.color}; padding:4px 8px; border-radius:4px; font-size:12px; font-weight:500;">${option.text}</span>`;
                        cell.classList.remove('editing-cell');
                        
                        // 자동저장 실행
                        autoSaveNewProperty(cell);
                    });
                    
                    cell.innerHTML = '';
                    cell.appendChild(selector);
                    selector.focus();
                    
                } else if (field === 'employee_team' && type === 'team') {
                    // 팀 선택 드롭다운
                    const teamOptions = ['1팀', '2팀', '3팀', '4팀', '5팀', '관리자'];
                    const selector = document.createElement('select');
                    selector.className = 'status-selector';
                    selector.style.cssText = 'width: 100%; padding: 4px; border: 2px solid #3b82f6; border-radius: 4px; background: white; font-size: 12px;';
                    
                    teamOptions.forEach(option => {
                        const optionElement = document.createElement('option');
                        optionElement.value = option;
                        optionElement.textContent = option;
                        if (option === currentValue || (currentValue === '팀 입력' && option === '1팀')) {
                            optionElement.selected = true;
                        }
                        selector.appendChild(optionElement);
                    });
                    
                    selector.addEventListener('change', () => {
                        const selectedValue = selector.value;
                        const teamColors = {
                            '1팀': { bg: '#e0e7ff', color: '#4338ca' },
                            '2팀': { bg: '#dcfce7', color: '#16a34a' },
                            '3팀': { bg: '#fef3c7', color: '#d97706' },
                            '4팀': { bg: '#fce7f3', color: '#ec4899' },
                            '5팀': { bg: '#f0f9ff', color: '#0ea5e9' },
                            '관리자': { bg: '#f1f5f9', color: '#64748b' }
                        };
                        const colors = teamColors[selectedValue] || teamColors['1팀'];
                        
                        cell.innerHTML = `<span class="status-badge" style="background: ${colors.bg}; color: ${colors.color}; padding: 4px 8px; border-radius: 4px; font-size: 12px; font-weight: 500;">${selectedValue}</span>`;
                        cell.classList.remove('editing-cell');
                        
                        // 자동저장 실행
                        autoSaveNewProperty(cell);
                    });
                    
                    selector.addEventListener('blur', () => {
                        const selectedValue = selector.value;
                        const teamColors = {
                            '1팀': { bg: '#e0e7ff', color: '#4338ca' },
                            '2팀': { bg: '#dcfce7', color: '#16a34a' },
                            '3팀': { bg: '#fef3c7', color: '#d97706' },
                            '4팀': { bg: '#fce7f3', color: '#ec4899' },
                            '5팀': { bg: '#f0f9ff', color: '#0ea5e9' },
                            '관리자': { bg: '#f1f5f9', color: '#64748b' }
                        };
                        const colors = teamColors[selectedValue] || teamColors['1팀'];
                        
                        cell.innerHTML = `<span class="status-badge" style="background: ${colors.bg}; color: ${colors.color}; padding: 4px 8px; border-radius: 4px; font-size: 12px; font-weight: 500;">${selectedValue}</span>`;
                        cell.classList.remove('editing-cell');
                        
                        // 자동저장 실행
                        autoSaveNewProperty(cell);
                    });
                    
                    cell.innerHTML = '';
                    cell.appendChild(selector);
                    selector.focus();
                }
            } else {
                // 일반 입력 필드
                const input = document.createElement('input');
                input.type = type === 'date' ? 'date' : (type === 'number' ? 'number' : 'text');
                input.value = currentValue;
                input.style.cssText = 'width: 100%; padding: 4px; border: 2px solid #3b82f6; border-radius: 4px; font-size: 12px;';
                
                input.addEventListener('blur', () => {
                    let newValue = input.value.trim();
                    
                    // 숫자 필드 포맷팅
                    if (type === 'number' && newValue) {
                        const num = parseInt(newValue.replace(/[^0-9]/g, ''));
                        if (!isNaN(num) && num > 0) {
                            newValue = num.toLocaleString();
                        }
                    }
                    
                    cell.textContent = newValue || (field.includes('price') || field.includes('deposit') || field.includes('rent') ? '0' : '');
                    cell.style.color = newValue ? '#1f2937' : '#64748b';
                    cell.classList.remove('editing-cell');
                    
                    // 자동저장 실행
                    autoSaveNewProperty(cell);
                });
                
                input.addEventListener('keypress', (e) => {
                    if (e.key === 'Enter') {
                        input.blur();
                    }
                });
                
                cell.innerHTML = '';
                cell.appendChild(input);
                input.focus();
                input.select();
            }
        }

        // 새 매물 행 취소 (사용하지 않음 - 저장/취소 버튼 제거됨)
        /*
        function cancelNewAdminPropertyRow(button) {
            const row = button.closest('tr');
            row.remove();
            showAlert('매물 추가가 취소되었습니다.', 'info');
        }
        */

        // 새 매물 저장 (사용하지 않음 - 저장/취소 버튼 제거됨)
        /*
        async function saveNewAdminProperty(button) {
            const row = button.closest('tr');
            console.log('관리자 새 매물 저장 시작...');
            
            try {
                // 데이터 수집
                const propertyData = {};
                const cells = row.querySelectorAll('.editable-cell');
                
                cells.forEach(cell => {
                    const field = cell.dataset.field;
                    let value = cell.textContent.trim();
                    
                    // 배지에서 값 추출
                    if (field === 'status') {
                        const badge = cell.querySelector('.badge');
                        value = badge ? badge.textContent.trim() : '거래가능';
                    } else if (field === 'is_occupied') {
                        const badge = cell.querySelector('.badge');
                        value = badge && badge.textContent.trim() === 'O';
                    } else if (field.includes('price') || field.includes('deposit') || field.includes('rent')) {
                        // 가격 필드 처리
                        const numValue = value.replace(/[^0-9]/g, '');
                        value = numValue ? parseInt(numValue) : null;
                    } else if (field === 'building_number' || field === 'room_number') {
                        // 동/호수 처리 (선택사항)
                        value = value.replace(/[^0-9]/g, '');
                        // 필수 검증 제거 - 빈 값도 허용
                    }
                    
                    // 플레이스홀더 텍스트 제거
                    if (typeof value === 'string' && value.includes('입력')) {
                        value = '';
                    }
                    
                    propertyData[field] = value;
                });
                
                // 메모 처리
                const memoCell = row.querySelector('.memo-cell');
                propertyData.memo = memoCell.dataset.memo || '';
                
                // 관리자 정보 추가
                propertyData.employee_id = 'admin';
                propertyData.employee_name = '관리자';
                propertyData.employee_team = '관리자';
                
                console.log('최종 매물 데이터:', propertyData);
                
                // API 호출
                const response = await fetch('/api/maeiple', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(propertyData)
                });
                
                if (!response.ok) {
                    const errorText = await response.text();
                    throw new Error(`HTTP ${response.status}: ${errorText}`);
                }
                
                const result = await response.json();
                
                if (result && result.success === true) {
                    const successMsg = result.message || '매물이 성공적으로 추가되었습니다.';
                    showAlert(successMsg, 'success');
                    
                    console.log('✅ 매물 추가 성공:', result);
                    
                    // 새로 추가된 매물을 테이블에 즉시 표시 (새로고침 없이)
                    if (result.created_property) {
                        await addNewPropertyToTable(result.created_property);
                    }
                    
                    // 테이블 새로고침 (백그라운드에서)
                    setTimeout(async () => {
                        await loadMaeipeProperties(1);
                    }, 500);
                    
                    // 새 행 제거
                    row.remove();
                } else {
                    const errorMsg = result?.error || result?.message || '매물 추가에 실패했습니다.';
                    throw new Error(errorMsg);
                }
                
            } catch (error) {
                console.error('관리자 매물 저장 오류:', error);
                showAlert(`저장 실패: ${error.message}`, 'error');
            }
        }
        */

        // 새로 추가된 매물을 테이블에 즉시 표시
        async function addNewPropertyToTable(property) {
            console.log('🔄 새 매물을 테이블에 즉시 추가:', property);
            
            const tbody = document.querySelector('#maeiple-table-content table tbody');
            if (!tbody) {
                console.error('매물 테이블 tbody를 찾을 수 없습니다.');
                return;
            }
            
            // 새 행 생성
            const newRow = document.createElement('tr');
            newRow.className = 'property-row';
            newRow.dataset.propertyId = property.id;
            
            // 상태에 따른 배지 색상 설정
            const statusBadge = getStatusBadge(property.status);
            const occupiedBadge = getOccupiedBadge(property.is_occupied);
            
            newRow.innerHTML = `
                <td style="text-align: center;">
                    <input type="checkbox" class="property-checkbox" value="${property.id}">
                </td>
                <td>${property.check_date || '-'}</td>
                <td>${property.building_number || '-'}</td>
                <td>${property.room_number || '-'}</td>
                <td>${statusBadge}</td>
                <td>${property.jeonse_price ? property.jeonse_price + '만원' : '-'}</td>
                <td>${property.monthly_deposit ? property.monthly_deposit + '만원' : '-'}</td>
                <td>${property.monthly_rent ? property.monthly_rent + '만원' : '-'}</td>
                <td>${property.sale_price ? property.sale_price + '만원' : '-'}</td>
                <td>${occupiedBadge}</td>
                <td>${property.phone || '-'}</td>
                <td class="memo-cell" onclick="openAdminPropertyMemoModal(this)" data-memo="${property.memo || ''}" style="cursor: pointer;">
                    ${property.memo ? property.memo.substring(0, 20) + (property.memo.length > 20 ? '...' : '') : '-'}
                </td>
                <td>${property.employee_name || '관리자'}</td>
                <td>
                    <span class="status-badge" style="background: #e0e7ff; color: #4338ca; padding: 4px 8px; border-radius: 4px; font-size: 12px; font-weight: 500;">
                        ${property.employee_team || '관리자'}
                    </span>
                </td>
                <td>
                    <div style="cursor: pointer; user-select: none; display: flex; align-items: center; justify-content: center; gap: 2px;" onclick="editAdminPropertyLikes(this, 'like')" data-count="${property.likes || 0}">
                        <span style="color: #9ca3af; font-size: 14px;">❤️ ${property.likes || 0}</span>
                    </div>
                </td>
                <td>
                    <div style="cursor: pointer; user-select: none; display: flex; align-items: center; justify-content: center; gap: 2px;" onclick="editAdminPropertyLikes(this, 'dislike')" data-count="${property.dislikes || 0}">
                        <span style="color: #9ca3af; font-size: 14px;">👎 ${property.dislikes || 0}</span>
                    </div>
                </td>
                <td>
                    <div class="action-buttons">
                        <button class="btn btn-secondary btn-sm" onclick="editAdminProperty(this)">✏️ 수정</button>
                        <button class="btn btn-danger btn-sm" onclick="deleteAdminProperty(${property.id})">🗑️ 삭제</button>
                    </div>
                </td>
            `;
            
            // 테이블 맨 위에 새 행 추가
            tbody.insertBefore(newRow, tbody.firstChild);
            
            // 새로 추가된 행에 하이라이트 효과 적용
            newRow.style.backgroundColor = '#f0f9ff';
            newRow.style.transition = 'background-color 0.5s ease';
            
            setTimeout(() => {
                newRow.style.backgroundColor = '';
            }, 2000);
            
            console.log('✅ 새 매물이 테이블에 즉시 추가됨');
        }
        
        // 상태에 따른 배지 생성
        function getStatusBadge(status) {
            const statusColors = {
                '거래가능': 'background: #dcfce7; color: #166534;',
                '거래중': 'background: #fef3c7; color: #92400e;',
                '계약완료': 'background: #dbeafe; color: #1e40af;',
                '보류': 'background: #fecaca; color: #dc2626;',
                '부재': 'background: #f3f4f6; color: #374151;'
            };
            
            const color = statusColors[status] || statusColors['거래가능'];
            return `<span class="badge" style="${color} padding:4px 8px; border-radius:4px; font-size:12px; font-weight:500;">${status}</span>`;
        }
        
        // 실거주 여부에 따른 배지 생성
        function getOccupiedBadge(isOccupied) {
            if (isOccupied === true || isOccupied === 'O') {
                return '<span class="badge" style="background: #dcfce7; color: #166534; padding:4px 8px; border-radius:4px; font-size:12px; font-weight:500;">O</span>';
            } else {
                return '<span class="badge" style="background: #fecaca; color: #dc2626; padding:4px 8px; border-radius:4px; font-size:12px; font-weight:500;">X</span>';
            }
        }

        // 새 매물 메모 모달
        function openNewAdminPropertyMemoModal(cell) {
            const currentMemo = cell.dataset.memo || '';
            
            const modal = document.createElement('div');
            modal.className = 'modal-overlay';
            modal.style.cssText = 'position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); display: flex; align-items: center; justify-content: center; z-index: 1000;';
            
            modal.innerHTML = `
                <div class="modal-content" style="background: white; padding: 24px; border-radius: 12px; width: 90%; max-width: 500px; box-shadow: 0 10px 25px rgba(0,0,0,0.15);">
                    <h3 style="margin: 0 0 16px 0; font-size: 18px; font-weight: 600; color: #1f2937;">매물 메모 입력</h3>
                    <textarea id="memo-input" placeholder="매물에 대한 메모를 입력하세요..." 
                              style="width: 100%; height: 120px; padding: 12px; border: 1px solid #d1d5db; border-radius: 8px; font-size: 14px; resize: vertical;">${currentMemo}</textarea>
                    <div style="display: flex; gap: 8px; justify-content: flex-end; margin-top: 16px;">
                        <button onclick="this.closest('.modal-overlay').remove()" 
                                style="padding: 8px 16px; border: 1px solid #d1d5db; background: white; border-radius: 6px; cursor: pointer;">취소</button>
                        <button onclick="saveNewAdminPropertyMemo(this, cell)" 
                                style="padding: 8px 16px; border: none; background: #3b82f6; color: white; border-radius: 6px; cursor: pointer;">저장</button>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
            modal.querySelector('#memo-input').focus();
            
            // 모달 외부 클릭 시 닫기
            modal.addEventListener('click', (e) => {
                if (e.target === modal) {
                    modal.remove();
                }
            });
        }

        // 새 매물 메모 저장
        function saveNewAdminPropertyMemo(button, memoCell) {
            const modal = button.closest('.modal-overlay');
            const memoInput = modal.querySelector('#memo-input');
            const memo = memoInput.value.trim();
            
            // 메모를 셀에 저장
            if (memoCell) {
                memoCell.dataset.memo = memo;
                memoCell.textContent = memo || '메모 입력';
                memoCell.style.color = memo ? '#1f2937' : '#64748b';
            }
            
            modal.remove();
            showAlert('메모가 저장되었습니다.', 'success');
        }

        // 새 매물 좋아요/싫어요 (임시)
        function editNewAdminPropertyLikes(element, type) {
            // 새 매물에서는 좋아요/싫어요 편집 불가
            showAlert('매물을 먼저 저장한 후 좋아요/싫어요를 사용할 수 있습니다.', 'info');
        }
        
    </script>

    <!-- 매물 메모 모달 (직원페이지 스타일) -->
    <div id="property-memo-modal" class="modal-overlay" onclick="closePropertyMemoModal()">
        <div class="modal-content" onclick="event.stopPropagation()">
            <div class="modal-header">
                <h3 class="modal-title">📝 매물 특이사항 편집</h3>
                <button class="modal-close" onclick="closePropertyMemoModal()">×</button>
            </div>
            <div class="modal-body">
                <div class="memo-info">
                    <div class="memo-property-info">
                        <span class="memo-label">매물:</span>
                        <span id="property-memo-info" class="memo-value">동-호수</span>
                    </div>
                </div>
                <textarea id="property-memo-textarea" class="memo-textarea" placeholder="매물의 특이사항을 입력하세요..." rows="8"></textarea>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closePropertyMemoModal()">취소</button>
                <button class="btn btn-primary" onclick="savePropertyMemo()">저장</button>
            </div>
        </div>
    </div>
</body>
</html> 