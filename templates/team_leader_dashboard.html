<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <title>팀장 대시보드 - 집노트</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap');
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: #f8fafc;
            color: #1a202c;
            line-height: 1.6;
            min-height: 100vh;
        }
        
        .app-container {
            display: flex;
            height: 100vh;
        }
        
        /* 사이드바 */
        .sidebar {
            width: 260px;
            background: #ffffff;
            border-right: 1px solid #e2e8f0;
            display: flex;
            flex-direction: column;
            position: fixed;
            height: 100vh;
            z-index: 1000;
        }
        
        .sidebar-header {
            padding: 24px 20px;
            border-bottom: 1px solid #e2e8f0;
        }
        
        .sidebar-nav {
            flex: 1;
            padding: 20px 0;
        }
        
        .nav-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px 20px;
            color: #64748b;
            text-decoration: none;
            font-weight: 500;
            font-size: 14px;
            transition: all 0.2s ease;
            border-left: 3px solid transparent;
        }
        
        .nav-item:hover {
            background: #fef3c7;
            color: #f59e0b;
        }
        
        .nav-item.active {
            background: #fef3c7;
            color: #f59e0b;
            border-left-color: #f59e0b;
        }
        
        .nav-icon {
            width: 20px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .logo {
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .logo-icon {
            width: 40px;
            height: 40px;
            background: linear-gradient(135deg, #f59e0b, #d97706);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
        }
        
        .logo-text {
            font-size: 18px;
            font-weight: 600;
            color: #1a202c;
        }
        
        /* 탭 네비게이션 스타일 */
        .tab-navigation {
            background: #f8fafc;
            border-bottom: 1px solid #e2e8f0;
        }

        .tab-btn {
            background: transparent;
            border: none;
            padding: 12px 20px;
            font-size: 14px;
            font-weight: 500;
            color: #64748b;
            cursor: pointer;
            border-bottom: 2px solid transparent;
            transition: all 0.2s ease;
        }

        .tab-btn:hover {
            color: #f59e0b;
            background: rgba(245, 158, 11, 0.05);
        }

        .tab-btn.active {
            color: #f59e0b;
            border-bottom-color: #f59e0b;
            background: rgba(245, 158, 11, 0.05);
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }
        
        /* 메인 컨텐츠 */
        .main-content {
            flex: 1;
            margin-left: 260px;
            display: flex;
            flex-direction: column;
        }
        
        .header {
            background: #ffffff;
            border-bottom: 1px solid #e2e8f0;
            padding: 8px 32px;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        
        .header-left {
            display: flex;
            align-items: center;
            gap: 20px;
        }
        
        .search-box {
            position: relative;
        }
        
        .search-input {
            width: 300px;
            padding: 10px 16px 10px 40px;
            border: 1px solid #e2e8f0;
            border-radius: 12px;
            background: #f8fafc;
            font-size: 14px;
            outline: none;
            transition: all 0.2s ease;
        }
        
        .search-input:focus {
            border-color: #f59e0b;
            background: #ffffff;
            box-shadow: 0 0 0 3px rgba(245, 158, 11, 0.1);
        }
        
        .search-icon {
            position: absolute;
            left: 12px;
            top: 50%;
            transform: translateY(-50%);
            color: #9ca3af;
        }
        
        .header-right {
            display: flex;
            align-items: center;
            gap: 16px;
        }
        
        .user-profile {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 8px 12px;
            border-radius: 12px;
            background: #f8fafc;
        }
        
        .user-avatar {
            width: 32px;
            height: 32px;
            background: linear-gradient(135deg, #f59e0b, #d97706);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 600;
            font-size: 14px;
        }
        
        .user-info {
            display: flex;
            flex-direction: column;
        }
        
        .user-name {
            font-size: 14px;
            font-weight: 600;
            color: #1a202c;
        }
        
        .user-role {
            font-size: 12px;
            color: #64748b;
        }
        
        .logout-btn {
            padding: 8px 16px;
            background: #ef4444;
            color: white;
            border: none;
            border-radius: 8px;
            text-decoration: none;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.2s ease;
        }
        
        .logout-btn:hover {
            background: #dc2626;
            box-shadow: 0 0 20px rgba(239, 68, 68, 0.4), 0 4px 12px rgba(239, 68, 68, 0.3);
        }
        
        /* 컨텐츠 영역 */
        .content {
            flex: 1;
            padding: 32px;
            overflow-y: auto;
        }
        
        .page-header {
            margin-bottom: 16px;
        }
        
        .header-content {
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 40px;
        }
        
        .header-text {
            text-align: left;
            flex: 1;
        }
        
        .page-title {
            font-size: 20px;
            font-weight: 700;
            color: #1a202c;
            margin-bottom: 4px;
        }
        
        .page-subtitle {
            font-size: 14px;
            color: #64748b;
        }
        
        .card {
            background: #ffffff;
            border-radius: 16px;
            padding: 24px;
            margin-bottom: 24px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
            border: 1px solid #e2e8f0;
        }
        
        .card-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 20px;
        }
        
        .card-title {
            font-size: 18px;
            font-weight: 600;
            color: #1a202c;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .btn {
            padding: 12px 20px;
            border: none;
            border-radius: 12px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            text-decoration: none;
        }
        
        .btn-primary {
            background: #f59e0b;
            color: white;
        }
        
        .btn-primary:hover {
            background: #d97706;
            transform: translateY(-1px);
            box-shadow: 0 0 20px rgba(245, 158, 11, 0.4), 0 4px 12px rgba(245, 158, 11, 0.3);
        }
        
        .btn-sm {
            padding: 8px 12px;
            font-size: 12px;
        }
        
        /* 필터 섹션 스타일 */
        .filter-section {
            padding: 12px 24px;
            border-bottom: 1px solid #e2e8f0;
            background: #ffffff;
            display: flex;
            gap: 24px;
            flex-wrap: wrap;
            align-items: center;
        }
        
        .filter-group {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .filter-label {
            color: #64748b;
            font-size: 13px;
            font-weight: 600;
            margin-right: 4px;
            white-space: nowrap;
        }
        
        .filter-buttons {
            display: flex;
            gap: 6px;
        }
        
        .filter-btn {
            padding: 6px 10px;
            border: 1px solid #e2e8f0;
            background: #ffffff;
            color: #334155;
            border-radius: 20px;
            font-size: 12px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.2s ease;
        }
        
        .filter-btn:hover {
            border-color: #f59e0b;
            background: #fef3c7;
            color: #f59e0b;
        }
        
        .filter-btn.active {
            background: #f59e0b;
            color: white;
            border-color: #f59e0b;
            font-weight: 600;
        }
        
        .loading {
            text-align: center;
            padding: 40px;
            color: #64748b;
        }
        
        /* 관리자 패널과 동일한 테이블 스타일 */
        .employees-table {
            width: 100%;
            border-collapse: collapse;
        }
        
        .employees-table th {
            background: #f8fafc;
            padding: 16px;
            text-align: left;
            font-weight: 600;
            font-size: 14px;
            color: #374151;
            border-bottom: 1px solid #e2e8f0;
        }
        
        .employees-table td {
            padding: 16px;
            border-bottom: 1px solid #f1f5f9;
            font-size: 14px;
        }
        
        .employees-table tr:hover {
            background: #f8fafc;
        }
        
        .status-badge {
            padding: 4px 8px;
            border-radius: 6px;
            font-size: 12px;
            font-weight: 500;
        }
        
        .status-progress {
            background: #fef3c7;
            color: #92400e;
        }
        
        .status-complete {
            background: #dcfce7;
            color: #166534;
        }
        
        .status-hold {
            background: #fecaca;
            color: #991b1b;
        }
        
        .action-buttons {
            display: flex;
            gap: 8px;
            align-items: center;
        }
        
        .btn-sm {
            padding: 6px 12px;
            font-size: 12px;
            border-radius: 6px;
        }
        
        .btn-primary {
            background: #3b82f6;
            color: white;
            border: 1px solid #3b82f6;
        }
        
        .btn-primary:hover {
            background: #2563eb;
            border-color: #2563eb;
        }
        
        .btn-outline-primary {
            background: transparent;
            color: #3b82f6;
            border: 1px solid #3b82f6;
        }
        
        .btn-outline-primary:hover {
            background: #3b82f6;
            color: white;
        }
        
        .btn-danger {
            background: #ef4444;
            color: white;
            border: 1px solid #ef4444;
        }
        
        .btn-danger:hover {
            background: #dc2626;
            border-color: #dc2626;
        }
        
        /* 편집 관련 스타일 */
        .editing-cell {
            background-color: #fef3c7 !important;
        }

        .new-property-row {
            background-color: #ecfdf5 !important;
            border: 2px solid #10b981 !important;
        }

        /* 페이지네이션 스타일 */
        .pagination {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 8px;
            margin-top: 20px;
            padding: 20px 0;
        }
        
        .pagination .btn {
            text-decoration: none;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .pagination .btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }

        /* 고객목록 스타일 */
        .customers-table {
            width: 100%;
            border-collapse: collapse;
            position: relative;
            overflow: visible;
        }
        
        .table-container {
            position: relative;
            overflow: visible;
        }
        
        /* 날짜 입력 필드 스타일 */
        .customers-table .editing-cell {
            position: relative;
            z-index: 1000;
        }
        
        .customers-table input[type="date"] {
            background: white;
            border: 2px solid #3b82f6;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }
        
        .customers-table th {
            background: #f8fafc;
            padding: 16px;
            text-align: left;
            font-weight: 600;
            font-size: 14px;
            color: #374151;
            border-bottom: 1px solid #e2e8f0;
        }
        
        .customers-table td {
            padding: 16px;
            border-bottom: 1px solid #f1f5f9;
            font-size: 14px;
        }
        
        .customers-table tr:hover {
            background: #f8fafc;
        }
        
        .status-badge {
            padding: 4px 8px;
            border-radius: 6px;
            font-size: 12px;
            font-weight: 500;
        }
        
        .status-progress {
            background: #fef3c7;
            color: #92400e;
        }
        
        .status-completed, .status-complete {
            background: #dcfce7;
            color: #166534;
        }
        
        .status-cancelled, .status-hold {
            background: #fee2e2;
            color: #991b1b;
        }

        /* 필터 섹션 */
        .filter-section {
            background: #f8fafc;
            border-radius: 8px;
            border: 1px solid #e2e8f0;
            padding: 16px;
            margin-bottom: 20px;
            display: flex;
            gap: 32px;
            align-items: center;
            flex-wrap: wrap;
        }
        
        .filter-group {
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .filter-label {
            font-size: 13px;
            font-weight: 600;
            color: #374151;
        }
        
        .filter-btn {
            padding: 6px 12px;
            border: 1px solid #e2e8f0;
            background: #ffffff;
            border-radius: 8px;
            font-size: 13px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
            color: #64748b;
        }
        
        .filter-btn:hover {
            border-color: #6366f1;
            color: #6366f1;
            background: #f8fafc;
        }
        
        .filter-btn.active {
            background: #6366f1;
            color: white;
            border-color: #6366f1;
        }
        
        .filter-select {
            padding: 6px 12px;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            font-size: 13px;
            background: #ffffff;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        /* 메모 모달 */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }
        
        .modal-overlay.active {
            opacity: 1;
            visibility: visible;
        }
        
        .modal-content {
            background: #ffffff;
            border-radius: 16px;
            width: 90%;
            max-width: 500px;
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
            transform: scale(0.9);
            transition: transform 0.3s ease;
        }
        
        .modal-overlay.active .modal-content {
            transform: scale(1);
        }
        
        .modal-header {
            padding: 20px 24px;
            border-bottom: 1px solid #e2e8f0;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        
        .modal-title {
            font-size: 18px;
            font-weight: 600;
            color: #1a202c;
            margin: 0;
        }
        
        .modal-close {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: #64748b;
            padding: 4px;
        }
        
        .modal-body {
            padding: 20px 24px;
        }
        
        .modal-footer {
            padding: 16px 24px;
            border-top: 1px solid #e2e8f0;
            display: flex;
            gap: 8px;
            justify-content: flex-end;
        }
        
        .memo-textarea {
            width: 100%;
            min-height: 200px;
            padding: 12px;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            font-size: 14px;
            line-height: 1.5;
            resize: vertical;
            font-family: inherit;
        }

        /* 직원관리 스타일 */
        .employees-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 16px;
        }
        
        .employees-table th,
        .employees-table td {
            padding: 12px 16px;
            text-align: left;
            border-bottom: 1px solid #e2e8f0;
        }
        
        .employees-table th {
            background: #f8fafc;
            font-weight: 600;
            color: #374151;
            font-size: 14px;
        }
        
        .employees-table tr:hover {
            background: #f8fafc;
        }

        .add-employee-form {
            padding: 20px;
        }
        
        .form-group {
            margin-bottom: 16px;
        }
        
        .form-label {
            display: block;
            margin-bottom: 6px;
            font-weight: 600;
            color: #374151;
            font-size: 14px;
        }
        
        .form-input {
            width: 100%;
            padding: 10px 12px;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            font-size: 14px;
            transition: all 0.2s ease;
        }
        
        .form-input:focus {
            outline: none;
            border-color: #f59e0b;
            box-shadow: 0 0 0 3px rgba(245, 158, 11, 0.1);
        }
        
        /* 직원 추가 폼 스타일 */
        .add-employee-form .form-input:hover {
            border-color: #d1d5db;
            background: #ffffff;
        }
        
        .add-employee-form .form-input:focus {
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
            background: #ffffff;
        }
        
        .add-employee-form select.form-input:hover {
            border-color: #d1d5db;
        }
        
        .add-employee-form select.form-input:focus {
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }
        
        .add-employee-form .btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.15);
        }
        
        .add-employee-form .btn:active {
            transform: translateY(0);
        }
        
        .add-employee-form .btn-outline-primary:hover {
            background: #3b82f6;
            color: white;
            border-color: #3b82f6;
        }
        
        /* 모달 스타일 */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 9999;
            display: flex;
            align-items: center;
            justify-content: center;
            animation: modalFadeIn 0.3s ease;
        }
        
        .modal-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(4px);
        }
        
        .modal-content {
            position: relative;
            background: white;
            border-radius: 16px;
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
            max-width: 500px;
            width: 90%;
            max-height: 90vh;
            overflow: hidden;
            animation: modalSlideIn 0.3s ease;
        }
        
        .modal-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px 24px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .modal-title {
            margin: 0;
            font-size: 18px;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .modal-close {
            background: none;
            border: none;
            color: white;
            font-size: 18px;
            cursor: pointer;
            padding: 4px;
            border-radius: 4px;
            transition: all 0.2s;
        }
        
        .modal-close:hover {
            background: rgba(255, 255, 255, 0.2);
        }
        
        .modal-body {
            padding: 24px;
        }
        
        .modal .form-label {
            font-size: 13px;
            font-weight: 600;
            color: #374151;
            margin-bottom: 6px;
            display: block;
        }
        
        .modal .form-input {
            padding: 10px 12px;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            font-size: 14px;
            transition: all 0.2s;
            background: #f9fafb;
            width: 100%;
        }
        
        .modal .form-input:hover {
            border-color: #d1d5db;
            background: #ffffff;
        }
        
        .modal .form-input:focus {
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
            background: #ffffff;
            outline: none;
        }
        
        .modal .btn {
            padding: 10px 20px;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            border: none;
            cursor: pointer;
            transition: all 0.2s;
            display: inline-flex;
            align-items: center;
            gap: 6px;
        }
        
        .modal .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .modal .btn-primary:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.15);
        }
        
        .modal .btn-secondary {
            background: white;
            color: #6b7280;
            border: 2px solid #6b7280;
        }
        
        .modal .btn-secondary:hover {
            background: #6b7280;
            color: white;
            transform: translateY(-1px);
        }
        
        .modal-footer {
            padding: 16px 24px;
            border-top: 1px solid #e5e7eb;
            display: flex;
            gap: 12px;
            justify-content: flex-end;
            background: #f9fafb;
        }
        
        @keyframes modalFadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        @keyframes modalSlideIn {
            from { 
                opacity: 0;
                transform: translateY(-20px) scale(0.95);
            }
            to { 
                opacity: 1;
                transform: translateY(0) scale(1);
            }
        }
        
        /* 고객 테이블 관련 스타일 */
        .customers-table {
            width: 100%;
            border-collapse: collapse;
        }
        
        .customers-table th {
            background: #f8fafc;
            padding: 16px;
            text-align: left;
            font-weight: 600;
            font-size: 14px;
            color: #374151;
            border-bottom: 1px solid #e2e8f0;
        }
        
        .customers-table td {
            padding: 16px;
            border-bottom: 1px solid #f1f5f9;
            font-size: 14px;
        }
        
        .customers-table tr:hover {
            background: #f8fafc;
        }
        
        .status-badge {
            padding: 4px 8px;
            border-radius: 6px;
            font-size: 12px;
            font-weight: 500;
        }
        
        .status-progress {
            background: #fef3c7;
            color: #92400e;
        }
        
        .status-completed, .status-complete {
            background: #dcfce7;
            color: #166534;
        }
        
        .status-cancelled, .status-hold {
            background: #fee2e2;
            color: #991b1b;
        }
        
        .management-link {
            color: #6366f1;
            text-decoration: none;
            font-weight: 500;
            font-size: 13px;
        }
        
        .management-link:hover {
            color: #5855eb;
            text-decoration: underline;
        }
        
        .property-link-placeholder {
            color: #94a3b8;
            font-style: italic;
            font-size: 12px;
        }
        
        .editable-cell {
            cursor: pointer;
            position: relative;
            transition: all 0.3s ease;
        }
        
        .editable-cell:hover {
            background-color: #f8fafc;
            transform: scale(1.02);
        }
        
        .editing-cell {
            padding: 2px !important;
            background-color: #ffffff;
            transform: scale(1.05);
            box-shadow: 0 0 0 2px #6366f1, 0 4px 12px rgba(99, 102, 241, 0.15);
            border-radius: 6px;
            transition: all 0.3s ease;
        }
        
        .editing-cell input, .editing-cell select {
            width: 100%;
            border: none;
            padding: 8px;
            font-size: 14px;
            background: transparent;
            border-radius: 4px;
            outline: none;
        }
        
        .memo-cell {
            cursor: pointer;
            max-width: 150px;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
            transition: all 0.2s ease;
            padding: 4px 8px;
            border-radius: 4px;
            position: relative;
        }
        
        .memo-cell:hover {
            background-color: #f1f5f9;
            transform: scale(1.02);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }
        
        /* 메모 셀 툴팁 개선 - 브라우저 기본 툴팁 사용 */
        .memo-cell[title] {
            cursor: help;
        }
        
        .memo-cell[title]:hover {
            cursor: pointer;
        }
        
        /* 필터 섹션 */
        .filter-section {
            padding: 16px 0;
            border-bottom: 1px solid #e2e8f0;
            margin-bottom: 20px;
            display: flex;
            gap: 32px;
            align-items: center;
            flex-wrap: wrap;
        }
        
        .filter-group {
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .filter-label {
            font-size: 14px;
            font-weight: 500;
            color: #374151;
            white-space: nowrap;
        }
        
        .filter-buttons {
            display: flex;
            gap: 8px;
        }
        
        .filter-btn {
            padding: 6px 12px;
            border: 1px solid #e2e8f0;
            background: #ffffff;
            border-radius: 8px;
            font-size: 13px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
            color: #64748b;
        }
        
        .filter-btn:hover {
            border-color: #6366f1;
            color: #6366f1;
            background: #f8fafc;
        }
        
        .filter-btn.active {
            background: #6366f1;
            color: white;
            border-color: #6366f1;
        }
        
        .filter-select {
            padding: 6px 12px;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            font-size: 13px;
            background: #ffffff;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        /* 모달 관련 스타일 */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }
        
        .modal-content {
            background: white;
            border-radius: 12px;
            width: 90%;
            max-width: 500px;
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1);
        }
        
        .modal-header {
            padding: 20px 24px;
            border-bottom: 1px solid #e2e8f0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .modal-title {
            font-size: 18px;
            font-weight: 600;
            color: #1a202c;
            margin: 0;
        }
        
        .modal-close {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: #64748b;
            padding: 0;
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 8px;
            transition: all 0.2s ease;
        }
        
        .modal-close:hover {
            background: #f1f5f9;
            color: #374151;
        }
        
        .modal-body {
            padding: 20px 24px;
        }
        
        .modal-footer {
            padding: 16px 24px;
            border-top: 1px solid #e2e8f0;
            display: flex;
            justify-content: flex-end;
            gap: 12px;
        }
        
        .memo-textarea {
            width: 100%;
            min-height: 200px;
            padding: 12px;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            font-size: 14px;
            font-family: inherit;
            resize: vertical;
            outline: none;
            transition: all 0.2s ease;
        }
        
        .memo-textarea:focus {
            border-color: #6366f1;
            box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);
        }
        
        /* 빈 상태 스타일 */
        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #64748b;
        }
        
        .empty-state-icon {
            font-size: 48px;
            margin-bottom: 16px;
            opacity: 0.5;
        }
        
        .empty-state-title {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 8px;
            color: #374151;
        }
        
        .empty-state-description {
            font-size: 14px;
            color: #64748b;
        }
        
        /* 좋아요 알림 애니메이션 */
        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }
        
        .like-alarm {
            animation: pulse 2s infinite;
        }
    </style>
</head>
<body>
    <div class="app-container">
        <!-- 사이드바 -->
        <div class="sidebar">
            <div class="sidebar-header">
                <div class="logo">
                    <div class="logo-icon">👑</div>
                    <div class="logo-text">집노트</div>
                </div>
            </div>
            
            <nav class="sidebar-nav">
                <a href="#" class="nav-item active" data-tab="dashboard">
                    <div class="nav-icon">📊</div>
                    대시보드
                </a>
                <a href="#" class="nav-item" data-tab="maeiple">
                    <div class="nav-icon">🏢</div>
                    매물관리
                </a>
                <a href="#" class="nav-item" data-tab="customers">
                    <div class="nav-icon">👥</div>
                    고객목록
                </a>
                <a href="#" class="nav-item" data-tab="employees">
                    <div class="nav-icon">👤</div>
                    직원관리
                </a>
                <a href="/logout" class="nav-item">
                    <div class="nav-icon">🚪</div>
                    로그아웃
                </a>
            </nav>
        </div>
        
        <!-- 메인 컨텐츠 -->
        <div class="main-content">
            <!-- 헤더 -->
            <div class="header">
                <div class="header-left">
                    <div class="search-box">
                        <div class="search-icon">🔍</div>
                        <input type="text" class="search-input" placeholder="매물 및 고객 검색..." id="search-input">
                    </div>
                </div>
                
                <div class="header-right">
                    <div class="user-profile">
                        <div class="user-avatar" id="user-avatar">{{ employee_name[0] if employee_name else '팀' }}</div>
                        <div class="user-info">
                            <div class="user-name" id="user-name">{{ employee_name or '팀장' }}</div>
                            <div class="user-role">팀장</div>
                        </div>
                    </div>
                    <a href="/logout" class="logout-btn">로그아웃</a>
                </div>
            </div>
            
            <!-- 컨텐츠 -->
            <div class="content">
                <div class="page-header">
                    <div class="header-content">
                        <div class="header-text">
                            <h1 class="page-title">팀장 대시보드</h1>
                            <p class="page-subtitle">팀 관리 및 현황 조회</p>
                        </div>
                    </div>
                </div>
                
                <!-- 메이플관리 섹션 -->
                <div id="maeiple-section" style="display:none;">
                    <div class="card">
                        <div class="card-header" style="display: flex; justify-content: space-between; align-items: center; border-bottom: none;">
                            <h2 class="card-title">
                                <span>🏢</span>
                                메이플관리
                            </h2>
                            <div style="display: flex; gap: 8px;">
                                <button type="button" class="btn btn-secondary" onclick="loadMaeipeProperties(1)" style="font-size: 12px; padding: 6px 12px; background: #e0e7ff; color: #3730a3; border: 1.5px solid #c7d2fe; font-weight: 600;">
                                    <span>🔄</span> 새로고침
                                </button>
                            </div>
                        </div>
                        
                        <!-- 탭 네비게이션 -->
                        <div class="tab-navigation" style="border-bottom: 1px solid #e2e8f0; background: #f8fafc;">
                            <div style="display: flex; align-items: center; padding: 0 24px;">
                                <button class="tab-btn active" onclick="switchMaeipleTab('list')" data-tab="list">
                                    아파트목록
                                </button>
                                <button class="tab-btn" onclick="switchMaeipleTab('stats')" data-tab="stats">
                                    개인매물관리
                                </button>
                                <div style="margin-left: auto;">
                                    <!-- 탭별 버튼은 각 탭 콘텐츠 내부로 이동 -->
                                </div>
                            </div>
                        </div>
                        
                        <!-- 탭 콘텐츠 - 아파트목록 (admin_panel에서 이식) -->
                        <div id="maeiple-tab-list" class="tab-content active">
                            <!-- 아파트목록 탭 헤더 -->
                            <div style="display: flex; justify-content: between; align-items: center; padding: 16px 24px; border-bottom: 1px solid #e2e8f0;">
                                <h3 style="margin: 0; font-size: 16px; font-weight: 600; color: #1f2937;">전체 아파트 목록</h3>
                                <button class="btn btn-primary" onclick="addNewPropertyRow()" style="font-size: 12px; padding: 6px 12px; margin-left: auto;">+ 새 매물 추가</button>
                            </div>
                            
                            <!-- 필터 섹션 -->
                            <div class="filter-section">
                                <!-- 호수 검색 -->
                                <div class="filter-group">
                                    <span class="filter-label">호수 검색:</span>
                                    <input type="text" id="room-search-admin" placeholder="호수 입력 (예: 101, 102)" 
                                           style="padding: 6px 12px; border: 1px solid #e2e8f0; border-radius: 6px; font-size: 12px; width: 120px;"
                                           oninput="filterByRoomAdmin(this.value)">
                                </div>
                                
                                <!-- 거래 유형 필터 -->
                                <div class="filter-group" id="deal-type-filter-group-admin">
                                    <span class="filter-label">거래유형:</span>
                                    <div class="filter-buttons">
                                        <button class="filter-btn active" data-value="all" onclick="setDealTypeFilterAdmin('all', this)">전체</button>
                                        <button class="filter-btn" data-value="전세" onclick="setDealTypeFilterAdmin('전세', this)">전세</button>
                                        <button class="filter-btn" data-value="월세" onclick="setDealTypeFilterAdmin('월세', this)">월세</button>
                                        <button class="filter-btn" data-value="매매" onclick="setDealTypeFilterAdmin('매매', this)">매매</button>
                                    </div>
                                </div>
                                
                                <div class="filter-group" id="status-filter-group">
                                    <span class="filter-label">현황:</span>
                                    <div class="filter-buttons">
                                        <button class="filter-btn active" data-value="all" onclick="setStatusFilter('all', this)">전체</button>
                                        <button class="filter-btn" data-value="거래가능" onclick="setStatusFilter('거래가능', this)">거래가능</button>
                                        <button class="filter-btn" data-value="계약완료" onclick="setStatusFilter('계약완료', this)">계약완료</button>
                                        <button class="filter-btn" data-value="보류" onclick="setStatusFilter('보류', this)">보류</button>
                                        <button class="filter-btn" data-value="부재" onclick="setStatusFilter('부재', this)">부재</button>
                                    </div>
                                </div>
                                
                                <div class="filter-group" id="occupied-filter-group">
                                    <span class="filter-label">실거주:</span>
                                    <div class="filter-buttons">
                                        <button class="filter-btn active" data-value="all" onclick="setOccupiedFilter('all', this)">전체</button>
                                        <button class="filter-btn" data-value="O" onclick="setOccupiedFilter('O', this)">O</button>
                                        <button class="filter-btn" data-value="X" onclick="setOccupiedFilter('X', this)">X</button>
                                    </div>
                                </div>
                                
                                <!-- 담당자 검색 -->
                                <div class="filter-group">
                                    <span class="filter-label">담당자 검색:</span>
                                    <input type="text" id="employee-search-admin" placeholder="담당자 이름 입력" 
                                           style="padding: 6px 12px; border: 1px solid #e2e8f0; border-radius: 6px; font-size: 12px; width: 120px;"
                                           oninput="filterByEmployeeAdmin(this.value)">
                                </div>
                                
                                <!-- 팀 필터 -->
                                <div class="filter-group" id="team-filter-group-admin">
                                    <span class="filter-label">팀:</span>
                                    <div class="filter-buttons">
                                        <button class="filter-btn active" data-value="all" onclick="setTeamFilterAdmin('all', this)">전체</button>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- 일괄 처리 패널 (팀장: 자신의 팀 담당자 변경만 가능) -->
                            <div id="bulk-actions-panel" style="display: none; padding: 12px 24px; background: #f8fafc; border-bottom: 1px solid #e2e8f0;">
                                <div style="display: flex; align-items: center; gap: 16px; flex-wrap: wrap;">
                                    <div style="display: flex; align-items: center; gap: 8px;">
                                        <span style="font-size: 14px; font-weight: 600; color: #374151;">선택된 매물:</span>
                                        <span id="selected-count" style="font-size: 14px; font-weight: 700; color: #3b82f6;">0개</span>
                                    </div>

                                    <div style="display: flex; align-items: center; gap: 8px;">
                                        <span style="font-size: 14px; font-weight: 600; color: #374151;">담당자 변경:</span>
                                        <select id="bulk-employee-select" style="padding: 6px 12px; border: 1px solid #d1d5db; border-radius: 6px; font-size: 12px; min-width: 150px;">
                                            <option value="">담당자 선택</option>
                                        </select>
                                        <button onclick="bulkAssignEmployeeTeamLeader()" style="padding: 6px 12px; background: #3b82f6; color: white; border: none; border-radius: 6px; font-size: 12px; cursor: pointer;">적용</button>
                                    </div>

                                    <button onclick="clearSelection()" style="padding: 6px 12px; background: #6b7280; color: white; border: none; border-radius: 6px; font-size: 12px; cursor: pointer;">선택 해제</button>
                                </div>
                            </div>
                            
                            <div id="maeiple-table-content">
                                <div class="loading">로딩 중...</div>
                            </div>
                            
                                        <!-- 페이지네이션 -->
            <div id="maeiple-pagination" class="pagination">
                <!-- 페이지네이션 버튼들이 여기에 동적으로 생성됩니다 -->
            </div>
                        </div>
                        
                        <!-- 탭 콘텐츠 - 팀장메이플관리 (admin_panel에서 이식) -->
                        <div id="maeiple-tab-stats" class="tab-content" style="display: none;">
                            <!-- 개인매물관리 탭 헤더 -->
                            <div style="display: flex; justify-content: between; align-items: center; padding: 16px 24px; border-bottom: 1px solid #e2e8f0;">
                                <h3 style="margin: 0; font-size: 16px; font-weight: 600; color: #1f2937;">팀장 개인 매물 관리</h3>
                                <button class="btn btn-primary" onclick="addNewPersonalPropertyRow()" style="font-size: 12px; padding: 6px 12px; margin-left: auto;">+ 개인 매물 추가</button>
                            </div>
                            
                            <!-- 필터 섹션 -->
                            <div class="filter-section">
                                <!-- 호수 검색 -->
                                <div class="filter-group">
                                    <span class="filter-label">호수 검색:</span>
                                    <input type="text" id="room-search-team-leader" placeholder="호수 입력 (예: 101, 102)" 
                                           style="padding: 6px 12px; border: 1px solid #e2e8f0; border-radius: 6px; font-size: 12px; width: 120px;"
                                           oninput="filterByRoomTeamLeader(this.value)">
                                </div>
                                
                                <!-- 거래 유형 필터 -->
                                <div class="filter-group" id="deal-type-filter-group-team-leader">
                                    <span class="filter-label">거래유형:</span>
                                    <div class="filter-buttons">
                                        <button class="filter-btn active" data-value="all" onclick="setDealTypeFilterTeamLeader('all', this)">전체</button>
                                        <button class="filter-btn" data-value="전세" onclick="setDealTypeFilterTeamLeader('전세', this)">전세</button>
                                        <button class="filter-btn" data-value="월세" onclick="setDealTypeFilterTeamLeader('월세', this)">월세</button>
                                        <button class="filter-btn" data-value="매매" onclick="setDealTypeFilterTeamLeader('매매', this)">매매</button>
                                    </div>
                                </div>
                                
                                <div class="filter-group" id="status-filter-group-team-leader">
                                    <span class="filter-label">현황:</span>
                                    <div class="filter-buttons">
                                        <button class="filter-btn active" data-value="all" onclick="setStatusFilterTeamLeader('all', this)">전체</button>
                                        <button class="filter-btn" data-value="거래가능" onclick="setStatusFilterTeamLeader('거래가능', this)">거래가능</button>
                                        <button class="filter-btn" data-value="계약완료" onclick="setStatusFilterTeamLeader('계약완료', this)">계약완료</button>
                                        <button class="filter-btn" data-value="보류" onclick="setStatusFilterTeamLeader('보류', this)">보류</button>
                                        <button class="filter-btn" data-value="부재" onclick="setStatusFilterTeamLeader('부재', this)">부재</button>
                                    </div>
                                </div>
                                
                                <div class="filter-group" id="occupied-filter-group-team-leader">
                                    <span class="filter-label">실거주:</span>
                                    <div class="filter-buttons">
                                        <button class="filter-btn active" data-value="all" onclick="setOccupiedFilterTeamLeader('all', this)">전체</button>
                                        <button class="filter-btn" data-value="O" onclick="setOccupiedFilterTeamLeader('O', this)">O</button>
                                        <button class="filter-btn" data-value="X" onclick="setOccupiedFilterTeamLeader('X', this)">X</button>
                                    </div>
                                </div>
                                
                                <!-- 담당자 검색 -->
                                <div class="filter-group">
                                    <span class="filter-label">담당자 검색:</span>
                                    <input type="text" id="employee-search-team-leader" placeholder="담당자 이름 입력" 
                                           style="padding: 6px 12px; border: 1px solid #e2e8f0; border-radius: 6px; font-size: 12px; width: 120px;"
                                           oninput="filterByEmployeeTeamLeader(this.value)">
                                </div>
                                
                                <!-- 팀 필터 -->
                                <div class="filter-group" id="team-filter-group-team-leader">
                                    <span class="filter-label">팀:</span>
                                    <div class="filter-buttons">
                                        <button class="filter-btn active" data-value="all" onclick="setTeamFilterTeamLeader('all', this)">전체</button>
                                    </div>
                                </div>
                            </div>
                            
                            <div id="maeiple-table-content-team-leader">
                                <div class="loading">로딩 중...</div>
                            </div>
                            
                            <!-- 페이지네이션 -->
                            <div id="maeiple-pagination-team-leader" class="pagination">
                                <!-- 페이지네이션 버튼들이 여기에 동적으로 생성됩니다 -->
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- 기본 대시보드 -->
                <div style="padding: 40px; text-align: center; color: #64748b;" id="default-content">
                    <div style="font-size: 20px; margin-bottom: 12px;">👑 팀장 대시보드</div>
                    <div style="font-size: 16px; margin-bottom: 24px;">팀장 전용 기능들을 준비 중입니다.</div>
                    <div style="font-size: 14px; color: #94a3b8;">
                        • 메이플관리: 아파트목록 + 개인매물관리 탭<br>
                        • 고객목록: 팀 전체 고객 관리<br>
                        • 직원관리: 팀 전체 직원 관리<br>
                        • 통계 및 리포트 기능
                    </div>
                    

                </div>

                <!-- 고객목록 섹션 -->
                <div id="customers-section" style="display: none;">
                    <!-- 고객 목록 카드 -->
                    <div class="card">
                        <div class="card-header">
                            <h2 class="card-title">
                                <span>👥</span>
                                고객 목록
                            </h2>
                            <button class="btn btn-primary" onclick="addNewRow()">
                                <span>➕</span>
                                고객추가
                            </button>
                        </div>
                        
                        <!-- 필터 섹션 -->
                        <div class="filter-section">
                            <div class="filter-group">
                                <label class="filter-label">상태별 필터:</label>
                                <div class="filter-buttons">
                                    <button class="filter-btn active" data-filter="all" onclick="filterCustomers('all')">전체</button>
                                    <button class="filter-btn" data-filter="진행중" onclick="filterCustomers('진행중')">진행중</button>
                                    <button class="filter-btn" data-filter="완료" onclick="filterCustomers('완료')">완료</button>
                                    <button class="filter-btn" data-filter="계약" onclick="filterCustomers('계약')">계약</button>
                                    <button class="filter-btn" data-filter="보류" onclick="filterCustomers('보류')">보류</button>
                                </div>
                            </div>
                            
                            <div class="filter-group">
                                <label class="filter-label">날짜 필터:</label>
                                <select class="filter-select" id="date-filter-customers" onchange="filterByDate(this.value)">
                                    <option value="all">전체 기간</option>
                                    <option value="today">오늘</option>
                                    <option value="week">이번 주</option>
                                    <option value="month">이번 달</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="table-container">
                            <table class="customers-table">
                                <thead>
                                    <tr>
                                        <th>날짜</th>
                                        <th>입주</th>
                                        <th>고객</th>
                                        <th>고객번호</th>
                                        <th>금액</th>
                                        <th>룸수</th>
                                        <th>위치</th>
                                        <th>대출여부</th>
                                        <th>주차</th>
                                        <th>애완</th>
                                        <th>메모</th>
                                        <th>진행여부</th>
                                        <th>주거사이트</th>
                                        <th>업무사이트</th>
                                        <th>관리</th>
                                    </tr>
                                </thead>
                                <tbody id="customers-list">
                                    <!-- 고객 목록이 여기에 동적으로 추가됩니다 -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- 고객 메모 모달 -->
                <div id="customer-memo-modal" class="modal-overlay" style="display: none;" onclick="closeCustomerMemoModal()">
                    <div class="modal-content" onclick="event.stopPropagation()">
                        <div class="modal-header">
                            <h3 class="modal-title">📝 메모 편집</h3>
                            <button class="modal-close" onclick="closeCustomerMemoModal()">×</button>
                        </div>
                        <div class="modal-body">
                            <textarea id="customer-memo-textarea" class="memo-textarea" placeholder="메모를 입력하세요..." rows="12" maxlength="5000"></textarea>
                        </div>
                        <div class="modal-footer">
                            <button class="btn btn-secondary" onclick="closeCustomerMemoModal()">취소</button>
                            <button class="btn btn-primary" onclick="saveCustomerMemo()">저장</button>
                        </div>
                    </div>
                </div>

                <!-- 직원관리 섹션 -->
                <div id="employees-section" style="display: none;">
                    <!-- 새 직원 추가 버튼 -->
                    <button class="btn btn-primary" style="margin-bottom:12px; border-radius:10px; font-size:15px; padding:10px 18px; font-weight:600;" onclick="openAddEmployeeModal()">
                        <span style="font-size:18px;">➕</span> 새 직원 추가
                                </button>
                    
                    <!-- 직원 목록 카드 -->
                    <div class="card">
                        <div class="card-header" style="display: flex; justify-content: space-between; align-items: center;">
                            <h2 class="card-title">
                                <span>👤</span>
                                직원 목록
                            </h2>
                            <div style="display: flex; gap: 10px;">
                                <button type="button" class="btn btn-secondary" onclick="loadTeamLeaderEmployees()">
                                    <span>🔄</span>
                                    새로고침
                                </button>
                            </div>
                        </div>
                        <div class="table-container">
                            <table class="employees-table">
                                <thead>
                                    <tr>
                                        <th>직원 아이디</th>
                                        <th>직원 이름</th>
                                        <th>팀</th>
                                        <th>역할</th>
                                        <th>상태</th>
                                        <th>등록일</th>
                                        <th>작업</th>
                                    </tr>
                                </thead>
                                <tbody id="employees-list">
                                    <!-- 직원 목록이 여기에 동적으로 추가됩니다 -->
                                </tbody>
                            </table>
                        </div>
                        
                        <!-- 페이지네이션 -->
                        <div id="employee-pagination" style="display: flex; justify-content: center; align-items: center; gap: 10px; margin-top: 20px; padding: 20px;">
                            <!-- 페이지네이션 버튼들이 여기에 동적으로 생성됩니다 -->
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 메모 모달 -->
    <div id="memo-modal" class="modal-overlay" onclick="closeMemoModal()">
        <div class="modal-content" onclick="event.stopPropagation()">
            <div class="modal-header">
                <h3 class="modal-title">📝 메모 편집</h3>
                <button class="modal-close" onclick="closeMemoModal()">×</button>
            </div>
            <div class="modal-body">
                <textarea id="memo-textarea" class="memo-textarea" placeholder="메모를 입력하세요..." rows="6"></textarea>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeMemoModal()">취소</button>
                <button class="btn btn-primary" onclick="saveMemo()">저장</button>
            </div>
        </div>
    </div>

    <!-- 팀 추가/삭제 모달 -->
    <div id="addTeamModal" class="modal-overlay" style="display: none;" onclick="closeAddTeamModal()">
        <div class="modal-content" onclick="event.stopPropagation()">
            <div class="modal-header">
                <h3 class="modal-title">팀 관리</h3>
                <button class="modal-close" onclick="closeAddTeamModal()">×</button>
            </div>
            <div class="modal-body">
                <!-- 팀 추가 섹션 -->
                <div class="team-section">
                    <h4 style="margin-bottom: 16px; color: #374151;">➕ 새 팀 추가</h4>
                    <div class="form-group">
                        <label for="newTeamName" class="form-label">팀 이름</label>
                        <input type="text" id="newTeamName" class="form-input" placeholder="팀 이름을 입력하세요" required>
                    </div>
                    <div class="form-group">
                        <label for="newTeamDescription" class="form-label">팀 설명 (선택사항)</label>
                        <textarea id="newTeamDescription" class="form-input" placeholder="팀에 대한 설명을 입력하세요" rows="3"></textarea>
                    </div>
                    <button type="button" class="btn btn-primary" onclick="addNewTeam()" style="margin-bottom: 24px;">팀 추가</button>
                </div>
                
                <hr style="margin: 24px 0; border: 1px solid #e5e7eb;">
                
                <!-- 팀 삭제 섹션 -->
                <div class="team-section">
                    <h4 style="margin-bottom: 16px; color: #374151;">🗑️ 기존 팀 삭제</h4>
                    <div class="form-group">
                        <label for="deleteTeamSelect" class="form-label">삭제할 팀 선택</label>
                        <select id="deleteTeamSelect" class="form-input" style="background: white; cursor: pointer;">
                            <option value="">팀을 선택하세요</option>
                            <option value="빈시트">빈시트</option>
                            <option value="위플러스">위플러스</option>
                            <option value="반클리셰">반클리셰</option>
                            <option value="대표">대표</option>
                        </select>
                    </div>
                    <button type="button" class="btn" style="background: #dc2626; color: white;" onclick="deleteSelectedTeam()">팀 삭제</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // 탭 전환 함수
        function showTab(tabName, event) {
            console.log('탭 전환:', tabName);
            
            // 모든 섹션 숨기기
            const defaultContent = document.getElementById('default-content');
            const maeipleSection = document.getElementById('maeiple-section');
            const customersSection = document.getElementById('customers-section');
            const employeesSection = document.getElementById('employees-section');
            
            if (defaultContent) defaultContent.style.display = 'none';
            if (maeipleSection) maeipleSection.style.display = 'none';
            if (customersSection) customersSection.style.display = 'none';
            if (employeesSection) employeesSection.style.display = 'none';
            
            // 선택된 탭에 따라 해당 섹션 표시
            if (tabName === 'dashboard') {
                if (defaultContent) defaultContent.style.display = 'block';
            } else if (tabName === 'maeiple') {
                if (maeipleSection) {
                    maeipleSection.style.display = 'block';
                    // 매물관리 탭 활성화 시 아파트 목록 로드
                    console.log('🏠 매물관리 탭 활성화');
                    loadMaeipeProperties(); // 아파트 목록 로드
                }
            } else if (tabName === 'customers') {
                if (customersSection) {
                customersSection.style.display = 'block';
                loadCustomers(); // 고객 목록 로드
                }
            } else if (tabName === 'employees') {
                if (employeesSection) {
                employeesSection.style.display = 'block';
                    loadTeamLeaderEmployees(); // 직원 목록 로드 (수정된 함수명)
                }
            }
            
            // 사이드바 네비게이션 업데이트
            document.querySelectorAll('.nav-item').forEach(item => item.classList.remove('active'));
            if (event && event.target) {
                const navItem = event.target.closest('.nav-item');
                if (navItem) navItem.classList.add('active');
            }
        }

        // DOM이 로드된 후 이벤트 리스너 등록
        document.addEventListener('DOMContentLoaded', function() {
            console.log('🚀 팀장 대시보드 JavaScript 초기화 시작');
            
            // 사이드바 네비게이션 이벤트 리스너 등록
            document.querySelectorAll('.nav-item[data-tab]').forEach(navItem => {
                navItem.addEventListener('click', function(event) {
                    event.preventDefault();
                    const tabName = this.getAttribute('data-tab');
                    showTab(tabName, event);
                });
            });
            
            console.log('✅ 이벤트 리스너 등록 완료');
        });

    // ========== 고객 관련 함수들 ==========
    
    // 전역 변수
    let customers = [];
    let filteredCustomers = [];
    let currentEditingCustomerId = null;

    // 고객 목록 불러오기 (팀장용 - 팀장 본인의 고객만)
    async function loadCustomers() {
        console.log('--- loadCustomers() 시작 (팀장) ---');
        try {
            // 팀장 본인의 고객만 조회
            const response = await fetch('/api/customers');
            const data = await response.json();
            // API 응답 형식 처리: { customers: [...], total_count, ... } 혹은 [] 형태 모두 지원
            customers = Array.isArray(data) ? data : (data.customers || []);
            console.log('서버에서 받아온 팀장 본인 고객 목록:', customers);
            filteredCustomers = [...customers];

            displayCustomers(customers);
            
            // 필터 초기화
            document.querySelectorAll('.filter-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            document.querySelector('[data-filter="all"]').classList.add('active');
            const dateFilter = document.getElementById('date-filter-customers');
            if (dateFilter) dateFilter.value = 'all';
        } catch (error) {
            console.error('loadCustomers()에서 오류 발생:', error);
            showAlert('고객 목록을 불러오는데 실패했습니다.', 'error');
        }
    }
    

    
    // 고객 목록 표시
    async function displayCustomers(customerList) {
        console.log('--- displayCustomers() 시작 ---');
        console.log('표시할 고객 수:', customerList.length);
        
        const tbody = document.getElementById('customers-list');
        
                    if (customerList.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="15">
                            <div class="empty-state">
                                <div class="empty-state-icon">👥</div>
                                <div class="empty-state-title">등록된 고객이 없습니다</div>
                                <div class="empty-state-description">새 고객을 추가해보세요</div>
                            </div>
                        </td>
                    </tr>
                `;
                return;
            }
        
        // 각 고객의 미확인 좋아요 수를 실시간으로 계산
        const customersWithLikes = await Promise.all(customerList.map(async (customer) => {
            if (!customer.management_site_id) {
                return { ...customer, unchecked_likes_residence: 0, unchecked_likes_business: 0 };
            }
            
            try {
                // 주거사이트 미확인 좋아요 수 조회
                const residenceResponse = await fetch(`/api/employee/unchecked-likes?management_site_id=${customer.management_site_id}&type=residence`);
                const residenceData = await residenceResponse.json();
                const unchecked_residence_count = residenceData.success ? residenceData.count : 0;
                
                // 업무사이트 미확인 좋아요 수 조회
                const businessResponse = await fetch(`/api/employee/unchecked-likes?management_site_id=${customer.management_site_id}&type=business`);
                const businessData = await businessResponse.json();
                const unchecked_business_count = businessData.success ? businessData.count : 0;
                
                return {
                    ...customer,
                    unchecked_likes_residence: unchecked_residence_count,
                    unchecked_likes_business: unchecked_business_count
                };
            } catch (error) {
                console.error(`고객 ${customer.customer_name}의 좋아요 수 조회 실패:`, error);
                return { ...customer, unchecked_likes_residence: 0, unchecked_likes_business: 0 };
            }
        }));
        
        tbody.innerHTML = customersWithLikes.map(customer => {
            const statusClass = customer.status === '계약' ? 'status-complete' : 
                               customer.status === '보류' ? 'status-hold' : 'status-progress';
            const memoText = customer.memo || '';
            const memoDisplay = memoText ? (memoText.length > 10 ? memoText.substring(0, 10) + '...' : memoText) : '클릭하여 메모 추가';
            // 미확인 좋아요 알림 텍스트 (실시간 계산된 값 사용)
            const residenceAlarm = customer.unchecked_likes_residence > 0 ? 
                `<div class='like-alarm' style="background:linear-gradient(135deg, #4caf50, #45a049); color:white; border-radius:12px; padding:4px 10px; margin:4px 0; font-weight:700; font-size:12px; display:inline-block; box-shadow:0 2px 8px rgba(76,175,80,0.3); animation:pulse 2s infinite;">❤️ ${customer.unchecked_likes_residence}건 신규</div>` : '';
            const businessAlarm = customer.unchecked_likes_business > 0 ? 
                `<div class='like-alarm' style="background:linear-gradient(135deg, #ff9800, #f57c00); color:white; border-radius:12px; padding:4px 10px; margin:4px 0; font-weight:700; font-size:12px; display:inline-block; box-shadow:0 2px 8px rgba(255,152,0,0.3); animation:pulse 2s infinite;">💼 ${customer.unchecked_likes_business}건 신규</div>` : '';
            return `
                <tr data-customer-id="${customer.id}">
                    <td class="editable-cell" data-field="inquiry_date" data-type="date" onclick="editCell(this)">${customer.inquiry_date || '-'}</td>
                    <td class="editable-cell" data-field="move_in_date" data-type="date" onclick="editCell(this)">${customer.move_in_date || '-'}</td>
                    <td class="editable-cell" data-field="customer_name" data-type="text" onclick="editCell(this)"><strong>${customer.customer_name || '-'}</strong>${customer.employee_id ? `<br><small style="color: #6366f1;">(${customer.employee_id})</small>` : ''}</td>
                    <td class="editable-cell" data-field="customer_phone" data-type="tel" onclick="editCell(this)" style="font-family: monospace; letter-spacing: 0.5px;">${customer.customer_phone ? formatPhoneNumber(customer.customer_phone) : '-'}</td>
                    <td class="editable-cell" data-field="budget" data-type="text" onclick="editCell(this)">${customer.budget || '-'}</td>
                    <td class="editable-cell" data-field="rooms" data-type="text" onclick="editCell(this)">${customer.rooms || '-'}</td>
                    <td class="editable-cell" data-field="location" data-type="text" onclick="editCell(this)">${customer.location || '-'}</td>
                    <td class="editable-cell" data-field="loan_needed" data-type="text" onclick="editCell(this)">${customer.loan_needed === false ? '-' : (customer.loan_needed || '-')}</td>
                    <td class="editable-cell" data-field="parking_needed" data-type="text" onclick="editCell(this)">${customer.parking_needed === false ? '-' : (customer.parking_needed || '-')}</td>
                    <td class="editable-cell" data-field="pets" data-type="text" onclick="editCell(this)">${customer.pets || '-'}</td>
                    <td class="memo-cell" onclick="editMemo(this)" data-memo="${memoText || ''}" ${memoText && memoText.trim() ? `title="${memoText}"` : ''} style="cursor: pointer; color: ${memoText ? '#4b5563' : '#9ca3af'};">${memoDisplay}</td>
                    <td class="editable-cell" data-field="status" data-type="select" onclick="editCell(this)">
                        <span class="status-badge ${statusClass}">
                            ${customer.status || '진행중'}
                        </span>
                    </td>
                    <td>
                        ${customer.management_site_id ? 
                            `<a href="/residence/customer/${customer.management_site_id}" target="_blank" class="management-link" onclick="markResidenceLikesChecked('${customer.management_site_id}')">주거사이트</a> ${residenceAlarm}` :
                            '<span class="property-link-placeholder">주거사이트 없음</span>'
                        }
                    </td>
                    <td>
                        ${customer.management_site_id ? 
                            `<a href="/business/customer/${customer.management_site_id}" target="_blank" class="management-link" onclick="markBusinessLikesChecked('${customer.management_site_id}')">업무사이트</a> ${businessAlarm}` :
                            '<span class="property-link-placeholder">업무사이트 없음</span>'
                        }
                    </td>
                    <td>
                        <div class="action-buttons">
                            <button class="btn btn-danger btn-sm" onclick="deleteCustomer(${customer.id}, '${customer.customer_name}')" title="고객 삭제">
                                🗑️ 삭제
                            </button>
                        </div>
                    </td>
                </tr>
            `;
        }).join('');
    }

    // 고객명 자동 생성 함수
    function generateCustomerName() {
        const now = new Date();
        const year = now.getFullYear().toString().slice(-2);
        const month = String(now.getMonth() + 1).padStart(2, '0');
        const day = String(now.getDate()).padStart(2, '0');
        const hour = String(now.getHours()).padStart(2, '0');
        const minute = String(now.getMinutes()).padStart(2, '0');
        const second = String(now.getSeconds()).padStart(2, '0');
        
        return `고객_${year}${month}${day}_${hour}${minute}${second}`;
    }

    // 새 행 추가
    function addNewRow() {
        const tbody = document.getElementById('customers-list');
        // 오늘 날짜 구하기 (한국시간 기준)
        const now = new Date();
        now.setHours(now.getHours() + 9);
        const today = now.toISOString().slice(0, 10);
        
        // 자동 고객명 생성
        const autoCustomerName = generateCustomerName();

        const newRow = document.createElement('tr');
        newRow.className = 'new-row';
        newRow.innerHTML = `
            <td class="editable-cell" data-field="inquiry_date" data-type="date" onclick="editCell(this)">${today}</td>
            <td class="editable-cell" data-field="move_in_date" data-type="date" onclick="editCell(this)">-</td>
            <td class="editable-cell" data-field="customer_name" data-type="text" onclick="editCell(this)"><strong>${autoCustomerName}</strong></td>
            <td class="editable-cell" data-field="customer_phone" data-type="tel" onclick="editCell(this)">-</td>
            <td class="editable-cell" data-field="budget" data-type="text" onclick="editCell(this)">-</td>
            <td class="editable-cell" data-field="rooms" data-type="text" onclick="editCell(this)">-</td>
            <td class="editable-cell" data-field="location" data-type="text" onclick="editCell(this)">-</td>
            <td class="editable-cell" data-field="loan_needed" data-type="text" onclick="editCell(this)">-</td>
            <td class="editable-cell" data-field="parking_needed" data-type="text" onclick="editCell(this)">-</td>
            <td class="editable-cell" data-field="pets" data-type="text" onclick="editCell(this)">-</td>
            <td class="memo-cell" onclick="editMemo(this)" title="" style="cursor: pointer; color: #9ca3af;">클릭하여 메모 추가</td>
            <td class="editable-cell" data-field="status" data-type="select" onclick="editCell(this)">
                <span class="status-badge status-progress">진행중</span>
            </td>
            <td><span class="property-link-placeholder">주거사이트 생성 중...</span></td>
            <td><span class="property-link-placeholder">업무사이트 생성 중...</span></td>
            <td>
                <div class="action-buttons">
                    <button class="btn btn-primary btn-sm" onclick="saveNewCustomer(this)">저장</button>
                    <button class="btn btn-secondary btn-sm" onclick="cancelNewRow(this)">취소</button>
                </div>
            </td>
        `;
        tbody.insertBefore(newRow, tbody.firstChild);
    }
    
    // 새 고객 저장
    async function saveNewCustomer(button) {
        const row = button.closest('tr');
        const cells = row.querySelectorAll('.editable-cell, .memo-cell');
        
        // 디버깅: 세션 정보 확인
        console.log('🔍 세션 정보 확인 중...');
        try {
            const sessionResponse = await fetch('/api/employee/session-info');
            const sessionData = await sessionResponse.json();
            console.log('📋 현재 세션 정보:', sessionData);
            
            if (!sessionData.employee_id) {
                showAlert('로그인이 필요합니다. 다시 로그인해주세요.', 'error');
                return;
            }
            
            if (sessionData.employee_role !== '팀장') {
                showAlert('팀장 권한이 필요합니다.', 'error');
                return;
            }
            
            if (!sessionData.employee_team) {
                showAlert('팀 정보가 설정되지 않았습니다. 관리자에게 문의하세요.', 'error');
                return;
            }
        } catch (error) {
            console.error('❌ 세션 정보 확인 실패:', error);
            showAlert('세션 정보를 확인할 수 없습니다.', 'error');
            return;
        }
        
        const customerData = {};
        cells.forEach(cell => {
            const field = cell.dataset.field;
            if (field) {
                let value = cell.textContent.trim();
                // 빈 값이나 기본 플레이스홀더 제외
                if (value === '-' || value === '클릭하여 입력') {
                    value = '';
                }
                customerData[field] = value;
            }
        });
        
        // 메모 셀 처리 - dataset 우선, textContent는 백업
        const memoCell = row.querySelector('.memo-cell');
        if (memoCell) {
            let memoValue = memoCell.dataset.memo || memoCell.textContent.trim();
            if (memoValue === '-' || memoValue === '클릭하여 메모 추가') {
                memoValue = '';
            }
            customerData.memo = memoValue;
        } else {
            customerData.memo = '';
        }
        
        // 임시로 저장된 진행여부가 있으면 포함
        if (row.dataset.tempStatus) {
            customerData.status = row.dataset.tempStatus;
        } else if (!customerData.status) {
            customerData.status = '진행중';
        }
        
        // 임시로 저장된 대출여부와 주차 정보가 있으면 포함
        if (row.dataset.temploan_needed) {
            customerData.loan_needed = row.dataset.temploan_needed === '필요' ? true : null;
        }
        if (row.dataset.tempparking_needed) {
            customerData.parking_needed = row.dataset.tempparking_needed === '필요' ? true : null;
        }
        
        // budget를 숫자로 변환
        if (customerData.budget) {
            const budgetNum = parseInt(customerData.budget.replace(/[^0-9]/g, ''));
            customerData.budget = isNaN(budgetNum) ? null : budgetNum;
        } else {
            customerData.budget = null;
        }
        
        // 필수 필드 확인
        if (!customerData.customer_name) {
            showAlert('고객명을 입력해주세요.', 'error');
            return;
        }
        
        // integer 필드 기본값 설정 (미확인 좋아요 개수)
        customerData.unchecked_likes_residence = 0;
        customerData.unchecked_likes_business = 0;
        
        // loan_needed와 parking_needed는 값이 없으면 필드 자체를 제거
        if (customerData.loan_needed === undefined || customerData.loan_needed === '' || customerData.loan_needed === null) {
            delete customerData.loan_needed;
        }
        if (customerData.parking_needed === undefined || customerData.parking_needed === '' || customerData.parking_needed === null) {
            delete customerData.parking_needed;
        }
        
        console.log('새 고객 저장 데이터:', customerData);
        
        try {
            console.log('📤 API 요청 전송 중...');
            console.log('📋 요청 데이터:', customerData);
            
            const response = await fetch('/api/customers', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(customerData)
            });
            
            console.log('📥 API 응답 상태:', response.status, response.statusText);
            
            if (!response.ok) {
                const errorText = await response.text();
                console.error('API 오류 응답:', errorText);
                throw new Error(`HTTP ${response.status}: ${response.statusText}`);
            }
            
            const result = await response.json();
            console.log('📥 고객 추가 API 응답:', result);

            if (result.success && result.customer) {
                console.log('✅ 고객 추가 성공:', result.customer);
                showAlert(result.message || '고객이 성공적으로 추가되었습니다.', 'success');

                // 최신 서버 상태를 다시 불러와 동기화
                await loadCustomers();
            } else {
                console.error('❌ 고객 추가 실패:', result);
                const errorMessage = result.message || result.error || '고객 추가에 실패했습니다.';
                showAlert(`고객 추가 실패: ${errorMessage}`, 'error');
            }
        } catch (error) {
            console.error('❌ 고객 추가 오류:', error);
            let errorMessage = '서버 오류가 발생했습니다.';
            
            if (error.name === 'TypeError' && error.message.includes('fetch')) {
                errorMessage = '네트워크 오류가 발생했습니다. 서버 연결을 확인해주세요.';
            } else if (error.message.includes('HTTP')) {
                errorMessage = `서버 오류 (${error.message})`;
            } else {
                errorMessage = `오류: ${error.message}`;
            }
            
            showAlert(errorMessage, 'error');
        }
    }
    
    // 새 행 취소
    function cancelNewRow(button) {
        const row = button.closest('tr');
        row.remove();
    }
    
    // 고객 삭제 함수
    async function deleteCustomer(customerId, customerName) {
        if (!confirm(`정말로 "${customerName}" 고객을 삭제하시겠습니까?\n\n⚠️ 이 작업은 되돌릴 수 없습니다.`)) {
            return;
        }
        
        try {
            const response = await fetch(`/api/customers/${customerId}`, {
                method: 'DELETE',
                headers: { 'Content-Type': 'application/json' }
            });
            
            const result = await response.json();
            
            if (result.success) {
                showAlert(`"${customerName}" 고객이 삭제되었습니다.`, 'success');
                // 고객 목록 새로고침
                await loadCustomers();
            } else {
                showAlert('고객 삭제에 실패했습니다: ' + (result.message || '알 수 없는 오류'), 'error');
            }
        } catch (error) {
            console.error('고객 삭제 오류:', error);
            showAlert('서버 오류가 발생했습니다.', 'error');
        }
    }

    // 셀 편집
    function editCell(cell) {
        // 이미 편집 중인 경우 기존 편집 UI 제거
        if (cell.classList.contains('editing-cell')) {
            const existingSelector = cell.querySelector('.status-selector');
            if (existingSelector) {
                existingSelector.remove();
            }
            const existingInput = cell.querySelector('input, select');
            if (existingInput) {
                existingInput.remove();
            }
            cell.classList.remove('editing-cell');
        }

        const field = cell.dataset.field;
        const type = cell.dataset.type;
        let currentValue = cell.textContent.trim();

        // 상태 필드의 경우 배지 텍스트만 가져오기
        if (field === 'status') {
            const badge = cell.querySelector('.status-badge');
            if (badge) {
                currentValue = badge.textContent.trim();
            }
        }

        if (type === 'select') {
            // 상태 또는 boolean 필드 선택 메뉴
            const existingMenu = document.querySelector('.customer-status-menu');
            if (existingMenu) {
                existingMenu.remove();
                return;
            }
            
            const menu = document.createElement('div');
            menu.className = 'customer-status-menu';
            menu.style.cssText = `
                position: absolute;
                background: white;
                border: 1px solid #e2e8f0;
                border-radius: 6px;
                box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
                z-index: 1000;
                min-width: 100px;
            `;
            
            // 필드에 따라 옵션 설정
            let options = [];
            if (field === 'status') {
                options = ['진행중', '완료', '계약', '보류'];
            } else if (field === 'loan_needed' || field === 'parking_needed') {
                options = ['필요', '불필요'];
            }
            
            options.forEach(status => {
                const option = document.createElement('button');
                option.textContent = status;
                option.style.cssText = `
                    width: 100%;
                    padding: 8px 12px;
                    border: none;
                    background: ${status === currentValue ? '#f1f5f9' : 'transparent'};
                    text-align: left;
                    cursor: pointer;
                    font-size: 12px;
                `;
                
                option.onmouseenter = () => option.style.background = '#f1f5f9';
                option.onmouseleave = () => option.style.background = status === currentValue ? '#f1f5f9' : 'transparent';
                
                option.onclick = async () => {
                    const customerId = cell.closest('tr').dataset.customerId;
                    
                    if (customerId) {
                        // 기존 고객 수정
                        if (field === 'status') {
                            await saveCustomerField(customerId, 'status', status);
                        } else {
                            await saveCustomerField(customerId, field, status);
                        }
                    } else {
                        // 새 행의 경우 임시 저장
                        if (field === 'status') {
                            cell.closest('tr').dataset.tempStatus = status;
                        } else {
                            cell.closest('tr').dataset[`temp${field}`] = status;
                        }
                    }
                    
                    // UI 즉시 업데이트
                    if (field === 'status') {
                        const statusClass = status === '계약' ? 'status-complete' : 
                                           status === '완료' ? 'status-complete' :
                                           status === '보류' ? 'status-hold' : 'status-progress';
                        
                        cell.innerHTML = `<span class="status-badge ${statusClass}">${status}</span>`;
                    } else {
                        cell.textContent = status;
                    }
                    
                    // 로컬 데이터 업데이트
                    const customer = customers.find(c => c.id === parseInt(customerId));
                    if (customer) {
                        customer[field] = status;
                    }
                    
                    menu.remove();
                };
                
                menu.appendChild(option);
            });
            
            // 메뉴 위치 설정
            const rect = cell.getBoundingClientRect();
            menu.style.left = rect.left + 'px';
            menu.style.top = (rect.bottom + window.scrollY) + 'px';
            
            document.body.appendChild(menu);
            
            // 외부 클릭 시 메뉴 닫기
            setTimeout(() => {
                document.addEventListener('click', function closeMenu(e) {
                    if (!menu.contains(e.target) && e.target !== cell) {
                        menu.remove();
                        document.removeEventListener('click', closeMenu);
                    }
                });
            }, 100);

        } else if (type === 'date') {
            // 날짜 입력 - 달력 즉시 표시
            const input = document.createElement('input');
            input.type = 'date';
            input.value = currentValue === '-' ? '' : currentValue;
            
            // 셀의 위치를 정확하게 계산
            const rect = cell.getBoundingClientRect();
            const tableContainer = cell.closest('.table-container');
            const containerRect = tableContainer ? tableContainer.getBoundingClientRect() : null;
            
            // 달력이 제대로 보이도록 스타일 조정
            input.style.cssText = `
                width: 150px;
                padding: 6px;
                border: 2px solid #3b82f6;
                border-radius: 4px;
                background: white;
                font-size: 13px;
                position: fixed;
                z-index: 9999;
                box-shadow: 0 4px 12px rgba(0,0,0,0.2);
                left: ${rect.left}px;
                top: ${rect.top}px;
            `;
            
            // 입력 필드를 body에 추가하여 테이블의 overflow에 영향받지 않도록
            document.body.appendChild(input);
            cell.classList.add('editing-cell');
            
            // 즉시 달력 표시
            setTimeout(() => {
                input.focus();
                input.click();
                if (input.showPicker) {
                    try {
                        input.showPicker();
                    } catch (e) {
                        console.log('달력 표시 실패:', e);
                    }
                }
            }, 10);
            
            // change 이벤트로 저장
            input.addEventListener('change', async function() {
                const newValue = this.value || '-';
                const customerId = cell.closest('tr').dataset.customerId;
                
                if (customerId) {
                    await saveCustomerField(customerId, field, newValue === '-' ? '' : newValue);
                }
                
                cell.textContent = newValue;
                cell.classList.remove('editing-cell');
                input.remove(); // body에서 입력 필드 제거
            });
            
            // ESC 키로 취소
            input.addEventListener('keydown', function(e) {
                if (e.key === 'Escape') {
                    cell.textContent = currentValue;
                    cell.classList.remove('editing-cell');
                    input.remove(); // body에서 입력 필드 제거
                }
            });
            
            // blur 이벤트는 달력이 닫힐 때만 처리
            input.addEventListener('blur', function() {
                setTimeout(() => {
                    if (!input.value && currentValue !== '-') {
                        cell.textContent = currentValue;
                    }
                    cell.classList.remove('editing-cell');
                    input.remove(); // body에서 입력 필드 제거
                }, 300);
            });
            
            // Enter 키로 저장 및 다음 셀로 이동
            input.addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    e.preventDefault();
                    // 값이 있으면 change 이벤트 트리거
                    if (input.value) {
                        input.dispatchEvent(new Event('change'));
                    } else {
                        input.blur();
                    }
                    // 다음 편집 가능한 셀로 이동
                    const nextCell = cell.nextElementSibling;
                    if (nextCell && nextCell.onclick) {
                        setTimeout(() => nextCell.click(), 100);
                    }
                }
            });


        } else if (type === 'select-bool') {
            // 불린 선택 (대출여부, 주차)
            const selectElement = document.createElement('select');
            selectElement.className = 'bool-selector';
            
            if (field === 'loan_needed') {
                selectElement.innerHTML = `
                    <option value="-" ${currentValue === '-' ? 'selected' : ''}>선택</option>
                    <option value="O" ${currentValue === 'O' || currentValue === '예' || currentValue === 'true' ? 'selected' : ''}>필요</option>
                    <option value="X" ${currentValue === 'X' || currentValue === '아니오' || currentValue === 'false' ? 'selected' : ''}>불필요</option>
                `;
            } else if (field === 'parking_needed') {
                selectElement.innerHTML = `
                    <option value="-" ${currentValue === '-' ? 'selected' : ''}>선택</option>
                    <option value="O" ${currentValue === 'O' || currentValue === '필요' || currentValue === 'true' ? 'selected' : ''}>필요</option>
                    <option value="X" ${currentValue === 'X' || currentValue === '불필요' || currentValue === 'false' ? 'selected' : ''}>불필요</option>
                `;
            }

            selectElement.addEventListener('change', async function() {
                const newValue = this.value;
                const customerId = cell.closest('tr').dataset.customerId;
                
                if (customerId) {
                    await saveCustomerField(customerId, field, newValue);
                }
                
                cell.textContent = newValue;
                cell.classList.remove('editing-cell');
            });

            selectElement.addEventListener('blur', function() {
                cell.textContent = currentValue;
                cell.classList.remove('editing-cell');
            });

            // Enter/Tab 키로 다음 셀로 이동
            selectElement.addEventListener('keydown', function(e) {
                if (e.key === 'Enter' || e.key === 'Tab') {
                    e.preventDefault();
                    const newValue = this.value;
                    cell.textContent = newValue;
                    cell.classList.remove('editing-cell');
                    
                    // 값 저장
                    const customerId = cell.closest('tr').dataset.customerId;
                    if (customerId) {
                        saveCustomerField(customerId, field, newValue);
                    }
                    
                    // 다음 편집 가능한 셀로 이동
                    const nextCell = cell.nextElementSibling;
                    if (nextCell && nextCell.classList.contains('editable-cell')) {
                        setTimeout(() => nextCell.click(), 100);
                    }
                }
            });

            cell.innerHTML = '';
            cell.appendChild(selectElement);
            cell.classList.add('editing-cell');
            selectElement.focus();

        } else {
            // 텍스트 입력
            const input = document.createElement('input');
            input.type = type === 'tel' ? 'tel' : 'text';
            input.value = currentValue === '-' ? '' : currentValue;
            
            input.addEventListener('blur', async function() {
                const newValue = this.value.trim() || '-';
                const customerId = cell.closest('tr').dataset.customerId;
                
                if (customerId) {
                    await saveCustomerField(customerId, field, newValue === '-' ? '' : newValue);
                }
                
                // 전화번호 포맷팅
                if (type === 'tel' && newValue !== '-') {
                    cell.innerHTML = `<span style="font-family: monospace; letter-spacing: 0.5px;">${formatPhoneNumber(newValue)}</span>`;
                } else if (field === 'customer_name' && newValue !== '-') {
                    cell.innerHTML = `<strong>${newValue}</strong>`;
                } else if (field === 'loan_needed' || field === 'parking_needed') {
                    // 대출여부, 주차 필드는 필요/불필요로 표시 (공란은 '-')
                    if (newValue === '-' || newValue === '') {
                        cell.textContent = '-';
                    } else if (newValue === 'O' || newValue === '필요' || newValue === 'true') {
                        cell.textContent = '필요';
                    } else if (newValue === 'X' || newValue === '불필요' || newValue === 'false') {
                        cell.textContent = '불필요';
                    } else {
                        cell.textContent = newValue;
                    }
                } else {
                    cell.textContent = newValue;
                }
                cell.classList.remove('editing-cell');
            });

            input.addEventListener('keydown', function(e) {
                if (e.key === 'Enter' || e.key === 'Tab') {
                    e.preventDefault();
                    this.blur();
                    
                    // 다음 편집 가능한 셀로 이동
                    const currentCell = this.closest('.editable-cell');
                    const nextCell = currentCell.nextElementSibling;
                    if (nextCell && nextCell.classList.contains('editable-cell')) {
                        setTimeout(() => nextCell.click(), 100);
                    }
                }
            });

            cell.innerHTML = '';
            cell.appendChild(input);
            cell.classList.add('editing-cell');
            input.focus();
        }
    }

    // 고객 필드 저장
    async function saveCustomerField(customerId, field, value) {
        try {
            // 필드별 데이터 타입 변환
            let processedValue = value;
            
            if (field === 'budget' && value !== '' && value !== '-') {
                // budget를 숫자로 변환
                processedValue = parseInt(value.replace(/[^0-9]/g, '')) || null;
            } else if (field === 'rooms' && value !== '' && value !== '-') {
                // rooms를 문자열로 저장 (숫자이지만 텍스트 필드로 처리)
                processedValue = value.toString();
            } else if (field === 'loan_needed') {
                // loan_needed를 boolean으로 변환 (공란은 null로 처리)
                if (value === '-' || value === '') {
                    processedValue = null;
                } else {
                    processedValue = value === 'O' || value === '필요' || value === '예' || value === 'true';
                }
            } else if (field === 'parking_needed') {
                // parking_needed를 boolean으로 변환 (공란은 null로 처리)
                if (value === '-' || value === '') {
                    processedValue = null;
                } else {
                    processedValue = value === 'O' || value === '필요' || value === 'true';
                }
            } else if (value === '-' || value === '') {
                processedValue = '';
            }
            
            const response = await fetch(`/api/customers/${customerId}/field`, {
                method: 'PUT',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ [field]: processedValue })
            });

            const result = await response.json();
            if (result.success) {
                console.log(`${field} 업데이트 성공:`, processedValue);
            } else {
                showAlert(result.message || '업데이트에 실패했습니다.', 'error');
            }
        } catch (error) {
            console.error('필드 업데이트 오류:', error);
            showAlert('서버 오류가 발생했습니다.', 'error');
        }
    }

    // 전화번호 포맷팅
    function formatPhoneNumber(phone) {
        if (!phone) return '';
        const cleaned = phone.replace(/\D/g, '');
        if (cleaned.length === 11) {
            return cleaned.replace(/(\d{3})(\d{4})(\d{4})/, '$1-$2-$3');
        } else if (cleaned.length === 10) {
            return cleaned.replace(/(\d{3})(\d{3})(\d{4})/, '$1-$2-$3');
        }
        return phone;
    }

    // 필터링 함수들
    function filterCustomers(status) {
        console.log('필터링 상태:', status);
        
        // 필터 버튼 활성화 상태 업데이트
        document.querySelectorAll('.filter-btn').forEach(btn => {
            btn.classList.remove('active');
        });
        document.querySelector(`[data-filter="${status}"]`).classList.add('active');
        
        if (status === 'all') {
            filteredCustomers = [...customers];
        } else {
            filteredCustomers = customers.filter(customer => customer.status === status);
        }
        
        displayCustomers(filteredCustomers);
    }

    function filterByDate(period) {
        console.log('날짜 필터링:', period);
        
        const now = new Date();
        let filteredByDate = [...customers];
        
        if (period !== 'all') {
            filteredByDate = customers.filter(customer => {
                if (!customer.inquiry_date) return false;
                
                const inquiryDate = new Date(customer.inquiry_date);
                
                switch(period) {
                    case 'today':
                        return inquiryDate.toDateString() === now.toDateString();
                    case 'week':
                        const weekAgo = new Date();
                        weekAgo.setDate(weekAgo.getDate() - 7);
                        return inquiryDate >= weekAgo;
                    case 'month':
                        const startOfMonth = new Date(now.getFullYear(), now.getMonth(), 1);
                        return inquiryDate >= startOfMonth;
                    default:
                        return true;
                }
            });
        }
        
        filteredCustomers = filteredByDate;
        displayCustomers(filteredCustomers);
    }

    // 고객 메모 편집 (기존 고객과 새 고객 모두 처리)
    function editMemo(cell) {
        const row = cell.closest('tr');
        const customerId = row?.dataset?.customerId;
        
        // 전체 메모 내용을 가져오기: data-memo 속성 우선, 없으면 title, 마지막으로 textContent
        let fullMemo = '';
        if (cell.getAttribute('data-memo')) {
            fullMemo = cell.getAttribute('data-memo');
        } else if (cell.getAttribute('title')) {
            fullMemo = cell.getAttribute('title');
        } else if (cell.dataset.memo) {
            fullMemo = cell.dataset.memo;
        } else {
            const currentMemo = cell.textContent.trim();
            fullMemo = (currentMemo === '-' || currentMemo === '클릭하여 메모 추가') ? '' : currentMemo;
        }
        
        console.log('editMemo 호출:', { customerId, fullMemo });
        
        if (customerId) {
            // 기존 고객: 기존 모달 사용
            openCustomerMemoModal(customerId, fullMemo);
        } else {
            // 새 고객: 새 고객용 모달 사용
            editNewCustomerMemo(cell);
        }
    }

    // 고객 메모 모달 관련 함수들
    function openCustomerMemoModal(customerId, currentMemo) {
        console.log('openCustomerMemoModal 호출:', { customerId, currentMemo });
        currentEditingCustomerId = customerId;
        const modal = document.getElementById('customer-memo-modal');
        const textarea = document.getElementById('customer-memo-textarea');
        console.log('모달 요소들:', { modal: !!modal, textarea: !!textarea });
        if (modal && textarea) {
            textarea.value = currentMemo || '';
            modal.style.display = 'flex';
            modal.style.opacity = '1';
            modal.style.visibility = 'visible';
            console.log('모달 표시됨');
            setTimeout(() => textarea.focus(), 100);
        } else {
            console.error('모달 또는 textarea 요소를 찾을 수 없음');
        }
    }

    function closeCustomerMemoModal() {
        const modal = document.getElementById('customer-memo-modal');
        if (modal) {
            modal.style.display = 'none';
            modal.style.opacity = '0';
            modal.style.visibility = 'hidden';
        }
        currentEditingCustomerId = null;
    }

    // 메모 모달 테스트 함수
    function testMemoModal() {
        console.log('메모 모달 테스트 시작');
        const modal = document.getElementById('customer-memo-modal');
        const textarea = document.getElementById('customer-memo-textarea');
        console.log('테스트 - 모달 요소들:', { modal: !!modal, textarea: !!textarea });
        if (modal) {
            modal.style.display = 'flex';
            modal.style.opacity = '1';
            modal.style.visibility = 'visible';
            console.log('테스트 - 모달 표시됨');
        }
    }
    
    // 새 고객 메모 편집
    function editNewCustomerMemo(cell) {
        const currentMemo = cell.dataset.memo || '';
        const modal = document.getElementById('customer-memo-modal');
        const textarea = document.getElementById('customer-memo-textarea');
        if (modal && textarea) {
            textarea.value = currentMemo;
            modal.style.display = 'flex';
            modal.style.opacity = '1';
            modal.style.visibility = 'visible';
            setTimeout(() => textarea.focus(), 100);
            
            // 임시로 새 고객 셀 저장
            window.tempNewCustomerMemoCell = cell;
        }
    }


    async function saveCustomerMemo() {
        // 새 고객 메모인 경우
        if (window.tempNewCustomerMemoCell) {
            const memo = document.getElementById('customer-memo-textarea').value.trim();
            window.tempNewCustomerMemoCell.dataset.memo = memo;
            window.tempNewCustomerMemoCell.setAttribute('data-memo', memo || '');
            window.tempNewCustomerMemoCell.textContent = memo ? 
                (memo.length > 30 ? memo.substring(0, 30) + '...' : memo) : 
                '클릭하여 메모 추가';
            if (memo && memo.trim()) {
                window.tempNewCustomerMemoCell.setAttribute('title', memo);
            } else {
                window.tempNewCustomerMemoCell.removeAttribute('title');
            }
            window.tempNewCustomerMemoCell.style.color = memo ? '#4b5563' : '#9ca3af';
            window.tempNewCustomerMemoCell = null;
            closeCustomerMemoModal();
            return;
        }
        
        if (!currentEditingCustomerId) return;
        
        const memo = document.getElementById('customer-memo-textarea').value.trim();
        
        try {
            console.log('메모 저장 시작:', { customerId: currentEditingCustomerId, memo });
            const response = await fetch(`/api/customers/${currentEditingCustomerId}/field`, {
                method: 'PUT',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ memo: memo })
            });

            const result = await response.json();
            console.log('메모 저장 응답:', result);
            if (result.success) {
                // 메모 셀만 즉시 업데이트
                const customerRow = document.querySelector(`tr[data-customer-id="${currentEditingCustomerId}"]`);
                if (customerRow) {
                    const memoCell = customerRow.querySelector('.memo-cell');
                    if (memoCell) {
                        const memoDisplay = memo ? 
                            (memo.length > 10 ? memo.substring(0, 10) + '...' : memo) : 
                            '클릭하여 메모 추가';
                        memoCell.textContent = memoDisplay;
                        memoCell.setAttribute('data-memo', memo || '');
                        if (memo && memo.trim()) {
                            memoCell.setAttribute('title', memo);
                        } else {
                            memoCell.removeAttribute('title');
                        }
                        memoCell.style.color = memo ? '#4b5563' : '#9ca3af';
                    }
                }
                
                // 로컬 데이터 업데이트
                const customer = customers.find(c => c.id === currentEditingCustomerId);
                if (customer) {
                    customer.memo = memo;
                }
                
                console.log('메모가 성공적으로 저장됨');
                showAlert('메모가 저장되었습니다.', 'success');
                closeCustomerMemoModal();
            } else {
                console.error('메모 저장 실패:', result);
                showAlert(result.message || '메모 저장에 실패했습니다.', 'error');
            }
        } catch (error) {
            console.error('메모 저장 오류:', error);
            showAlert('서버 오류가 발생했습니다.', 'error');
        }
    }

    // 좋아요 확인 처리 함수들
    async function markResidenceLikesChecked(managementSiteId) {
        try {
            const response = await fetch('/api/employee/mark-likes-checked', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    management_site_id: managementSiteId,
                    type: 'residence'
                })
            });
            
            const result = await response.json();
            if (result.success) {
                console.log('주거사이트 좋아요 확인 처리 완료');
            }
        } catch (error) {
            console.error('주거사이트 좋아요 확인 처리 오류:', error);
        }
    }

    async function markBusinessLikesChecked(managementSiteId) {
        try {
            const response = await fetch('/api/employee/mark-likes-checked', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    management_site_id: managementSiteId,
                    type: 'business'
                })
            });
            
            const result = await response.json();
            if (result.success) {
                console.log('업무사이트 좋아요 확인 처리 완료');
            }
        } catch (error) {
            console.error('업무사이트 좋아요 확인 처리 오류:', error);
        }
    }

    // 알림 표시 함수
    function showAlert(message, type = 'info') {
        // 기존 알림이 있으면 제거
        const existingAlert = document.querySelector('.alert-notification');
        if (existingAlert) {
            existingAlert.remove();
        }

        const alert = document.createElement('div');
        alert.className = `alert-notification alert-${type}`;
        alert.style.cssText = `
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 16px 20px;
            border-radius: 8px;
            color: white;
            font-weight: 500;
            z-index: 10000;
            max-width: 400px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            transform: translateX(100%);
            transition: transform 0.3s ease;
        `;

        // 타입별 배경색 설정
        switch(type) {
            case 'success':
                alert.style.background = 'linear-gradient(135deg, #10b981, #059669)';
                break;
            case 'error':
                alert.style.background = 'linear-gradient(135deg, #ef4444, #dc2626)';
                break;
            case 'warning':
                alert.style.background = 'linear-gradient(135deg, #f59e0b, #d97706)';
                break;
            default:
                alert.style.background = 'linear-gradient(135deg, #6366f1, #5855eb)';
        }

        alert.textContent = message;
        document.body.appendChild(alert);

        // 애니메이션으로 표시
        setTimeout(() => {
            alert.style.transform = 'translateX(0)';
        }, 100);

        // 3초 후 자동 제거
        setTimeout(() => {
            alert.style.transform = 'translateX(100%)';
            setTimeout(() => {
                if (alert.parentNode) {
                    alert.remove();
                }
            }, 300);
        }, 3000);
        }
        
        // 메이플관리 탭 전환 함수
        function switchMaeipleTab(tabName) {
            console.log('메이플관리 탭 전환:', tabName);
            
            // 모든 탭 버튼에서 active 클래스 제거
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            
            // 모든 탭 콘텐츠 숨기기
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
                content.style.display = 'none';
            });
            
            // 선택된 탭 버튼 활성화
            const selectedBtn = document.querySelector(`[data-tab="${tabName}"]`);
            if (selectedBtn) {
                selectedBtn.classList.add('active');
            }
            
            // 선택된 탭 콘텐츠 표시
            let targetContent;
            if (tabName === 'list') {
                targetContent = document.getElementById('maeiple-tab-list');
                // 아파트목록 탭 선택시 팀원 목록 로드하여 일괄 담당자 변경 드롭다운 채움
                loadTeamEmployeesForBulk();
            } else if (tabName === 'stats') {
                targetContent = document.getElementById('maeiple-tab-stats');
                // 팀장메이플관리 탭 선택시 데이터 로드
                loadMaeipePropertiesTeamLeader();
            }
            
            if (targetContent) {
                targetContent.classList.add('active');
                targetContent.style.display = 'block';
            }
        }

        // 메이플관리 섹션 활성화시 기본적으로 아파트목록 탭 표시
        function activateMaeipeTab(e) {
            e.preventDefault();
            
            // 기본 컨텐츠 숨기기
            document.getElementById('default-content').style.display = 'none';
            
            // 메이플관리 섹션 표시
            document.getElementById('maeiple-section').style.display = 'block';
            
            // 사이드바 active 상태 업데이트
            document.querySelectorAll('.nav-item').forEach(item => item.classList.remove('active'));
            e.target.closest('.nav-item').classList.add('active');
            
            // 기본적으로 아파트목록 탭 활성화
            switchMaeipleTab('list');
            
            // 아파트목록 데이터 로드
            loadMaeipeProperties(1);
            
            const section = document.getElementById('maeiple-section');
            if (section) {
                section.scrollIntoView({ behavior: 'smooth', block: 'start' });
            }
        }

        // 전역 변수들
        let properties = [];
        let teamProperties = [];
        let currentMaeiplePage = 1;
        let currentTeamMaeiplePage = 1;
        let maeipleTotalPages = 0;
        let teamMaeipleTotalPages = 0;
        const maeipePerPage = 20;
        const teamMaeipePerPage = 20;
        let currentSortBy = 'room_number';
        let currentSortOrder = 'asc';
        let currentTeamSortBy = 'room_number';
        let currentTeamSortOrder = 'asc';
        
        // 필터 변수들
        let statusFilter = 'all';
        let occupiedFilter = 'all';
        let dealTypeFilterAdmin = 'all';
        let dealTypeFilterTeamLeader = 'all';
        let roomSearchFilterAdmin = '';
        let roomSearchFilterTeamLeader = '';
        let employeeSearchFilterAdmin = '';
        let employeeSearchFilterTeamLeader = '';
        let teamFilterAdmin = 'all';
        let teamFilterTeamLeader = 'all';
        
        // 매물 목록 조회 (아파트목록 탭용) - 팀장은 관리자와 동일한 API 사용
        async function loadMaeipeProperties(page = 1) {
            console.log('🏠 loadMaeipeProperties() 시작 - 팀장용 아파트 목록 로드');
            try {
                currentMaeiplePage = page;
                // 관리자와 동일한 API 사용 - 팀장도 전체 매물 조회 가능
                const url = `/api/maeiple?sort_by=${currentSortBy}&sort_order=${currentSortOrder}&page=${page}&per_page=${maeipePerPage}`;
                console.log('📡 API 호출 URL:', url);
                
                const response = await fetch(url);
                console.log('📥 API 응답 상태:', response.status, response.statusText);
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                
                const data = await response.json();
                console.log('📋 API 응답 데이터:', data);
                
                if (data.success) {
                    properties = data.properties;
                    maeipleTotalPages = data.total_pages || 0;
                    console.log(`✅ 팀장용 메이플관리 매물 로드 완료: ${properties.length}개 (페이지 ${page}/${maeipleTotalPages})`);
                    
                    // 필터 업데이트
                    updateAdminFilters();
                    
                    // 매물 목록 렌더링
                    renderMaeipeProperties();
                    
                    // 페이지네이션 렌더링
                    renderMaeipePagination();
                    
                    console.log('🎯 아파트 목록 렌더링 완료');
                } else {
                    console.error('❌ API 응답 실패:', data);
                    showMaeipeError('매물 목록을 불러오는데 실패했습니다.');
                }
            } catch (error) {
                console.error('❌ loadMaeipeProperties 오류:', error);
                showMaeipeError('매물 목록을 불러오는데 실패했습니다.');
            }
        }

        // 팀장 개인 매물 로드 (개인매물관리 탭용)
        async function loadMaeipePropertiesTeamLeader(page = 1) {
            try {
                currentTeamMaeiplePage = page;
                const currentEmployeeName = '{{ employee_name }}';
                console.log('🔄 팀장 개인 매물 로드 시작:', currentEmployeeName);
                
                // 팀장 개인 매물만 조회 - employee_name 필터 추가
                const url = `/api/maeiple?sort_by=${currentTeamSortBy}&sort_order=${currentTeamSortOrder}&page=${page}&per_page=${teamMaeipePerPage}&employee_name=${encodeURIComponent(currentEmployeeName)}`;
                const response = await fetch(url);
                const data = await response.json();
                
                console.log('📥 팀장 개인 매물 API 응답:', data);
                
                if (data.success) {
                    // 팀장 개인 매물로 필터링 (서버에서 필터링되지 않은 경우 클라이언트에서 추가 필터링)
                    const personalProperties = data.properties.filter(p => p.employee_name === currentEmployeeName);
                    
                    teamProperties = personalProperties;
                    teamMaeipleTotalPages = data.total_pages || 0;
                    console.log(`✅ 팀장 개인 매물 로드 완료: ${teamProperties.length}개 (페이지 ${page}/${teamMaeipleTotalPages})`);
                    updateTeamLeaderFilters();
                    renderTeamMaeipeProperties();
                    renderTeamMaeipePagination();
                } else {
                    showTeamMaeipeError('개인 매물 목록을 불러오는데 실패했습니다.');
                }
            } catch (error) {
                console.error('❌ 팀장 개인 매물 로드 오류:', error);
                showTeamMaeipeError('개인 매물 목록을 불러오는데 실패했습니다.');
            }
        }
        
        // 새 매물 추가 함수 (팀장용)
        function addNewPropertyRow() {
            console.log('팀장 새 매물 행 추가 시작...');
            
            const tbody = document.querySelector('#maeiple-table-content table tbody');
            if (!tbody) {
                console.error('매물 테이블 tbody를 찾을 수 없습니다.');
                alert('테이블을 찾을 수 없습니다. 메이플관리 섹션이 제대로 로드되지 않았습니다.');
                return;
            }
            
            // 오늘 날짜 구하기 (한국시간 기준)
            const now = new Date();
            now.setHours(now.getHours() + 9);
            const today = now.toISOString().slice(0, 10);
            
            const currentTeam = '{{ employee_team }}';
            const currentEmployee = '{{ employee_name }}';
            
            const newRow = document.createElement('tr');
            newRow.className = 'new-property-row';
            newRow.innerHTML = `
                <td style="text-align: center;">
                    <input type="checkbox" class="property-checkbox" style="width: 16px; height: 16px;" title="매물 선택">
                </td>
                <td class="editable-cell" data-field="check_date" data-type="date" onclick="editAdminPropertyCell(this)">${today}</td>
                <td class="editable-cell" data-field="building_number" data-type="number" onclick="editAdminPropertyCell(this)" style="color: #64748b;">동 번호 (선택)</td>
                <td class="editable-cell" data-field="room_number" data-type="number" onclick="editAdminPropertyCell(this)" style="color: #64748b;">호수 (선택)</td>
                <td class="editable-cell" data-field="status" data-type="select" onclick="editAdminPropertyCell(this)">
                    <span class="badge" style="background: #e0f2fe; color: #0369a1; padding:4px 8px; border-radius:4px; font-size:12px; font-weight:500;">거래가능</span>
                </td>
                <td class="editable-cell" data-field="jeonse_price" data-type="number" onclick="editAdminPropertyCell(this)" style="color: #64748b;">전세가 입력</td>
                <td class="editable-cell" data-field="monthly_deposit" data-type="number" onclick="editAdminPropertyCell(this)" style="color: #64748b;">월세보증금 입력</td>
                <td class="editable-cell" data-field="monthly_rent" data-type="number" onclick="editAdminPropertyCell(this)" style="color: #64748b;">월세 입력</td>
                <td class="editable-cell" data-field="sale_price" data-type="number" onclick="editAdminPropertyCell(this)" style="color: #64748b;">매매가 입력</td>
                <td class="editable-cell" data-field="is_occupied" data-type="select" onclick="editAdminPropertyCell(this)">
                    <span class="badge" style="background: #fecaca; color: #dc2626; padding:4px 8px; border-radius:4px; font-size:12px; font-weight:500;">X</span>
                </td>
                <td class="editable-cell" data-field="phone" data-type="text" onclick="editAdminPropertyCell(this)" style="color: #64748b;">연락처 입력</td>
                <td class="memo-cell" onclick="openNewPropertyMemoModal(this)" style="color: #64748b; cursor: pointer;">메모 입력</td>
                <td>
                    <span style="color: #4f46e5; font-weight: 500;">${currentEmployee}</span>
                </td>
                <td>
                    <span class="status-badge" style="background: ${getTeamBadgeColor(currentTeam)}; color: ${getTeamTextColor(currentTeam)};">
                        ${currentTeam}
                    </span>
                </td>
                <td>
                    <div style="cursor: pointer; user-select: none; display: flex; align-items: center; justify-content: center; gap: 2px;" onclick="openLikesModal('new', 'likes', 0, this)" data-count="0">
                        <span style="color: #9ca3af; font-size: 14px;">❤️ 0</span>
                    </div>
                </td>
                <td>
                    <div style="cursor: pointer; user-select: none; display: flex; align-items: center; justify-content: center; gap: 2px;" onclick="openLikesModal('new', 'dislikes', 0, this)" data-count="0">
                        <span style="color: #9ca3af; font-size: 14px;">👎 0</span>
                    </div>
                </td>
            `;
            
            tbody.insertBefore(newRow, tbody.firstChild);
            console.log('새 매물 행이 추가되었습니다.');
            alert('새 매물 행이 추가되었습니다. 셀을 편집하면 자동으로 저장됩니다.');
        }
        
        // 필터 함수들
        function filterByRoomAdmin(value) {
            roomSearchFilterAdmin = value;
            renderMaeipeProperties();
        }
        
        function filterByRoomTeamLeader(value) {
            roomSearchFilterTeamLeader = value;
            renderTeamMaeipeProperties();
        }
        
        function setDealTypeFilterAdmin(type, btn) {
            dealTypeFilterAdmin = type;
            document.querySelectorAll('#deal-type-filter-group-admin .filter-btn').forEach(b => b.classList.remove('active'));
            btn.classList.add('active');
            renderMaeipeProperties();
        }
        
        function setDealTypeFilterTeamLeader(type, btn) {
            dealTypeFilterTeamLeader = type;
            document.querySelectorAll('#deal-type-filter-group-team-leader .filter-btn').forEach(b => b.classList.remove('active'));
            btn.classList.add('active');
            renderTeamMaeipeProperties();
        }
        
        function setStatusFilter(status, btn) {
            statusFilter = status;
            document.querySelectorAll('#status-filter-group .filter-btn').forEach(b => b.classList.remove('active'));
            btn.classList.add('active');
            renderMaeipeProperties();
        }
        
        function setStatusFilterTeamLeader(status, btn) {
            statusFilter = status;
            document.querySelectorAll('#status-filter-group-team-leader .filter-btn').forEach(b => b.classList.remove('active'));
            btn.classList.add('active');
            renderTeamMaeipeProperties();
        }
        
        function setOccupiedFilter(occupied, btn) {
            occupiedFilter = occupied;
            document.querySelectorAll('#occupied-filter-group .filter-btn').forEach(b => b.classList.remove('active'));
            btn.classList.add('active');
            renderMaeipeProperties();
        }
        
        function setOccupiedFilterTeamLeader(occupied, btn) {
            occupiedFilter = occupied;
            document.querySelectorAll('#occupied-filter-group-team-leader .filter-btn').forEach(b => b.classList.remove('active'));
            btn.classList.add('active');
            renderTeamMaeipeProperties();
        }
        
        function filterByEmployeeAdmin(value) {
            employeeSearchFilterAdmin = value;
            renderMaeipeProperties();
        }
        
        function filterByEmployeeTeamLeader(value) {
            employeeSearchFilterTeamLeader = value;
            renderTeamMaeipeProperties();
        }
        
        function setTeamFilterAdmin(team, btn) {
            const currentTeam = '{{ employee_team }}';
            // 팀장: 자신의 팀 또는 전체만 허용
            if (team !== 'all' && team !== currentTeam) {
                alert('자신의 팀만 필터링할 수 있습니다.');
                return;
            }
            teamFilterAdmin = team;
            document.querySelectorAll('#team-filter-group-admin .filter-btn').forEach(b => b.classList.remove('active'));
            btn.classList.add('active');
            renderMaeipeProperties();
        }
        
        function setTeamFilterTeamLeader(team, btn) {
            teamFilterTeamLeader = team;
            document.querySelectorAll('#team-filter-group-team-leader .filter-btn').forEach(b => b.classList.remove('active'));
            btn.classList.add('active');
            renderTeamMaeipeProperties();
        }
        
        // 매물 목록 렌더링 (관리자 패널에서 이식)
        function renderMaeipeProperties() {
            const tableContent = document.getElementById('maeiple-table-content');
            
            // 필터 적용
            let list = Array.isArray(properties) ? properties.slice() : [];
            // 팀장: 자신의 팀 외 매물은 숨김
            const currentTeam = '{{ employee_team }}';
            list = list.filter(p => (p.employee_team || '') === currentTeam);
            
            // 현황 필터
            if (statusFilter !== 'all') {
                list = list.filter(p => (p.status || '') === statusFilter);
            }
            
            // 실거주 필터
            if (occupiedFilter !== 'all') {
                const want = occupiedFilter === 'O';
                list = list.filter(p => !!p.is_occupied === want);
            }
            
            // 거래유형 필터 (관리자용)
            if (dealTypeFilterAdmin !== 'all') {
                list = list.filter(p => {
                    if (dealTypeFilterAdmin === '전세') {
                        const jeonsePrice = parseInt(String(p.jeonse_price || '0').replace(/[^\d]/g, '')) || 0;
                        return jeonsePrice > 0;
                    } else if (dealTypeFilterAdmin === '월세') {
                        const monthlyRent = parseInt(String(p.monthly_rent || '0').replace(/[^\d]/g, '')) || 0;
                        return monthlyRent > 0;
                    } else if (dealTypeFilterAdmin === '매매') {
                        const salePrice = parseInt(String(p.sale_price || '0').replace(/[^\d]/g, '')) || 0;
                        return salePrice > 0;
                    }
                    return true;
                });
            }
            
            // 호수 검색 필터 (관리자용)
            if (roomSearchFilterAdmin.trim()) {
                const searchTerm = roomSearchFilterAdmin.trim().toLowerCase();
                list = list.filter(p => {
                    const roomNumber = String(p.room_number || '').toLowerCase();
                    return roomNumber.includes(searchTerm);
                });
            }
            
            // 담당자 검색 필터 (관리자용)
            if (employeeSearchFilterAdmin.trim()) {
                const searchTerm = employeeSearchFilterAdmin.trim().toLowerCase();
                list = list.filter(p => {
                    const employeeName = String(p.employee_name || '').toLowerCase();
                    return employeeName.includes(searchTerm);
                });
            }
            
            // 팀 필터 (관리자용) - 팀장은 자신의 팀만 보도록 수정
            if (teamFilterAdmin !== 'all') {
                list = list.filter(p => (p.employee_team || '') === teamFilterAdmin);
            }
            
            if (list.length === 0) {
                tableContent.innerHTML = `
                    <div style="text-align: center; padding: 60px 20px; color: #64748b;">
                        <div style="font-size: 48px; margin-bottom: 16px; opacity: 0.5;">🏢</div>
                        <p>조건에 맞는 매물이 없습니다.</p>
                        <p>필터를 변경하거나 새 매물을 추가해보세요.</p>
                    </div>
                `;
                return;
            }
            
            let tableHTML = `
                <table class="employees-table">
                    <thead>
                        <tr>
                            <th style="width: 50px;">
                                <input type="checkbox" id="select-all-properties" onchange="toggleSelectAll(this)" 
                                       style="width: 16px; height: 16px; cursor: pointer;">
                            </th>
                            <th>
                                <div style="display: flex; align-items: center; gap: 4px; cursor: pointer; user-select: none;" onclick="toggleSort('check_date')">
                                    확인날짜
                                    <span style="font-size: 12px; color: #9ca3af;">${currentSortBy === 'check_date' ? (currentSortOrder === 'desc' ? '▼' : '▲') : '↕️'}</span>
                                </div>
                            </th>
                            <th>동</th>
                            <th>호수</th>
                            <th>현황</th>
                            <th>전세 (만원)</th>
                            <th>월세보증금 (만원)</th>
                            <th>월세 (만원)</th>
                            <th>매매 (만원)</th>
                            <th>실거주 여부</th>
                            <th>전화번호</th>
                            <th>특이사항</th>
                            <th>담당자</th>
                            <th>팀</th>
                            <th>좋아요</th>
                            <th>싫어요</th>
                        </tr>
                    </thead>
                    <tbody>
            `;
            
            list.forEach(property => {
                tableHTML += `
                    <tr data-property-id="${property.id}">
                        <td style="text-align: center;">
                            <input type="checkbox" class="property-checkbox" value="${property.id}" 
                                   onchange="updateSelectionCount()" style="width: 16px; height: 16px; cursor: pointer;">
                        </td>
                        <td style="cursor: pointer;" onclick="editAdminDate(${property.id}, '${property.check_date || ''}', this)">${property.check_date || '-'}</td>
                        <td style="cursor: pointer;" onclick="editAdminNumber(${property.id}, 'building_number', '${property.building_number || ''}', this)">${property.building_number || '-'}</td>
                        <td style="cursor: pointer;" onclick="editAdminNumber(${property.id}, 'room_number', '${property.room_number || ''}', this)">${property.room_number || '-'}</td>
                        <td>
                            <button style="padding: 6px 12px; border: none; border-radius: 6px; font-size: 12px; font-weight: 500; cursor: pointer; ${property.status === '계약완료' ? 'background: #d1fae5; color: #065f46;' : property.status === '보류' ? 'background: #fef3c7; color: #92400e;' : property.status === '부재' ? 'background: #ede9fe; color: #5b21b6;' : 'background: #e0f2fe; color: #0369a1;'}" 
                                    onclick="showAdminStatusOptions(${property.id}, '${property.status || '거래가능'}', this)">
                                ${property.status || '거래가능'}
                            </button>
                        </td>
                        <td style="cursor: pointer; color: #2563eb; font-weight: 500;" onclick="editAdminPrice(${property.id}, 'jeonse_price', '${property.jeonse_price || ''}', this)">
                            ${property.jeonse_price ? formatNumber(property.jeonse_price) + ' 만원' : '-'}
                        </td>
                        <td style="cursor: pointer; color: #2563eb; font-weight: 500;" onclick="editAdminPrice(${property.id}, 'monthly_deposit', '${property.monthly_deposit || property.deposit || ''}', this)">
                            ${property.monthly_deposit || property.deposit ? formatNumber(property.monthly_deposit || property.deposit) + ' 만원' : '-'}
                        </td>
                        <td style="cursor: pointer; color: #2563eb; font-weight: 500;" onclick="editAdminPrice(${property.id}, 'monthly_rent', '${property.monthly_rent || ''}', this)">
                            ${property.monthly_rent ? formatNumber(property.monthly_rent) + ' 만원' : '-'}
                        </td>
                        <td style="cursor: pointer; color: #2563eb; font-weight: 500;" onclick="editAdminPrice(${property.id}, 'sale_price', '${property.sale_price || ''}', this)">
                            ${property.sale_price ? formatNumber(property.sale_price) + ' 만원' : '-'}
                        </td>
                        <td>
                            <button style="background: none; border: none; cursor: pointer; font-size: 18px; padding: 4px; border-radius: 4px; color: ${property.is_occupied ? '#059669' : '#dc2626'};" 
                                    onclick="toggleAdminOccupied(${property.id}, ${property.is_occupied})">
                                ${property.is_occupied ? 'O' : 'X'}
                            </button>
                        </td>
                        <td style="cursor: pointer; font-family: monospace; letter-spacing: 0.5px; max-width: 120px; overflow: hidden; text-overflow: ellipsis;" onclick="editAdminPhone(${property.id}, '${property.phone || ''}', this)">
                            ${property.phone ? formatPhoneNumber(property.phone) : '-'}
                        </td>
                        <td class="memo-cell" onclick="editAdminMemo(${property.id}, '${(property.memo || '').replace(/'/g, "\\'")}', this)" style="color: #64748b; font-style: italic; max-width: 150px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; cursor: pointer;">
                            ${property.memo ? (property.memo.length > 20 ? property.memo.substring(0, 20) + '...' : property.memo) : '클릭하여 메모 추가'}
                        </td>
                        <td class="editable-cell" data-field="employee_id" data-type="select" onclick="editPropertyCell(this)" style="cursor: pointer;">
                            <span style="color: #4f46e5; font-weight: 500;">
                                ${property.employee_name || '미지정'}
                            </span>
                        </td>
                        <td>
                            <span class="status-badge" style="background: ${getTeamBadgeColor(property.employee_team)}; color: ${getTeamTextColor(property.employee_team)};">
                                ${property.employee_team || '미지정'}
                            </span>
                        </td>
                        <td>
                            <div style="cursor: pointer; user-select: none; display: flex; align-items: center; justify-content: center; gap: 2px;" onclick="openLikesModal(${property.id}, 'likes', ${property.likes || 0}, this)" data-count="${property.likes || 0}">
                                <span style="color: ${(property.likes || 0) > 0 ? '#ef4444' : '#9ca3af'}; font-size: 14px;">❤️ ${property.likes || 0}</span>
                            </div>
                        </td>
                        <td>
                            <div style="cursor: pointer; user-select: none; display: flex; align-items: center; justify-content: center; gap: 2px;" onclick="openLikesModal(${property.id}, 'dislikes', ${property.dislikes || 0}, this)" data-count="${property.dislikes || 0}">
                                <span style="color: ${(property.dislikes || 0) > 0 ? '#ef4444' : '#9ca3af'}; font-size: 14px;">👎 ${property.dislikes || 0}</span>
                            </div>
                        </td>
                    </tr>
                `;
            });
            
            tableHTML += `
                    </tbody>
                </table>
            `;
            
            tableContent.innerHTML = tableHTML;
        }

        // 팀장 팀원 목록 로드하여 담당자 변경 드롭다운 채움
        async function loadTeamEmployeesForBulk() {
            try {
                console.log('🔄 팀원 목록 로드 시작...');
                const resp = await fetch('/api/employees?per_page=200&page=1');
                const data = await resp.json();
                
                console.log('📥 API 응답 데이터:', data);
                
                const currentTeam = '{{ employee_team }}';
                console.log('👥 현재 팀장의 팀:', currentTeam);
                
                const select = document.getElementById('bulk-employee-select');
                if (!select) {
                    console.error('❌ bulk-employee-select 엘리먼트를 찾을 수 없습니다.');
                    return;
                }
                
                if (!data.employees) {
                    console.error('❌ employees 데이터가 없습니다.');
                    alert('직원 데이터를 불러올 수 없습니다.');
                    return;
                }
                
                // 자신의 팀 멤버 (팀장 포함) - Supabase 필드명 사용
                const teamMembers = data.employees.filter(e => {
                    const isCorrectTeam = e.team === currentTeam;
                    const isTeamLeaderOrEmployee = e.role && (e.role === '팀장' || e.role === '직원');
                    console.log(`👤 직원: ${e.name}, 팀: ${e.team}, 역할: ${e.role}, 필터 결과: ${isCorrectTeam && isTeamLeaderOrEmployee}`);
                    return isCorrectTeam && isTeamLeaderOrEmployee;
                });
                
                console.log('✅ 필터링된 팀원 목록:', teamMembers);
                
                select.innerHTML = '<option value="">담당자 선택</option>';
                
                if (teamMembers.length === 0) {
                    const noMembersOption = document.createElement('option');
                    noMembersOption.value = '';
                    noMembersOption.textContent = '해당 팀에 팀원이 없습니다';
                    noMembersOption.disabled = true;
                    select.appendChild(noMembersOption);
                    console.warn('⚠️ 해당 팀에 팀원이 없습니다.');
                    return;
                }
                
                teamMembers.forEach(m => {
                    const opt = document.createElement('option');
                    opt.value = m.id || m.employee_id || m.name;
                    opt.dataset.employeeName = m.name;
                    opt.dataset.employeeTeam = m.team || currentTeam;
                    opt.textContent = `${m.name}${m.role ? ` (${m.role})` : ''}`;
                    select.appendChild(opt);
                    console.log(`➕ 옵션 추가: ${opt.textContent}`);
                });
                
                console.log('✅ 담당자 드롭다운 업데이트 완료');
                
            } catch (e) {
                console.error('❌ 팀원 목록 로드 실패:', e);
                alert('팀원 목록을 불러오는데 실패했습니다. 관리자에게 문의하세요.');
            }
        }

        // 전체 선택/해제
        function toggleSelectAll(master) {
            const boxes = document.querySelectorAll('.property-checkbox');
            boxes.forEach(b => b.checked = master.checked);
            updateSelectionCount();
        }

        // 선택 개수 업데이트 및 패널 표시
        function updateSelectionCount() {
            const selected = document.querySelectorAll('.property-checkbox:checked');
            const countEl = document.getElementById('selected-count');
            const panel = document.getElementById('bulk-actions-panel');
            if (countEl) countEl.textContent = `${selected.length}개`;
            if (panel) panel.style.display = selected.length > 0 ? 'block' : 'none';
            const all = document.querySelectorAll('.property-checkbox');
            const master = document.getElementById('select-all-properties');
            if (master) {
                master.indeterminate = selected.length > 0 && selected.length < all.length;
                master.checked = selected.length > 0 && selected.length === all.length;
            }
        }

        function clearSelection() {
            const boxes = document.querySelectorAll('.property-checkbox, #select-all-properties');
            boxes.forEach(b => b.checked = false);
            updateSelectionCount();
        }

        // 팀장: 일괄 담당자 변경 (자신의 팀 매물만 적용)
        async function bulkAssignEmployeeTeamLeader() {
            const selected = Array.from(document.querySelectorAll('.property-checkbox:checked')).map(cb => cb.value);
            if (selected.length === 0) { 
                alert('선택된 매물이 없습니다.'); 
                return; 
            }
            
            const employeeSelect = document.getElementById('bulk-employee-select');
            if (!employeeSelect || !employeeSelect.value) { 
                alert('담당자를 선택해주세요.'); 
                return; 
            }
            
            const employeeId = employeeSelect.value;
            const selectedOption = employeeSelect.options[employeeSelect.selectedIndex];
            const employeeName = selectedOption.dataset.employeeName || selectedOption.text.split(' (')[0];
            const employeeTeam = selectedOption.dataset.employeeTeam || '{{ employee_team }}';
            
            console.log('🔄 일괄 담당자 변경 시작:', { 
                selected, 
                employeeId,
                employeeName,
                employeeTeam,
                selectedCount: selected.length 
            });
            
            if (!confirm(`선택된 ${selected.length}개 매물의 담당자를 "${employeeName}"으로 변경하시겠습니까?`)) return;
            
            try {
                // 서버의 공용 일괄 변경 API 사용 (관리자와 동일) - 서버에서 권한 검증 필요
                const resp = await fetch('/api/maeiple/bulk-assign', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ 
                        property_ids: selected, 
                        employee_id: employeeId,
                        employee_name: employeeName
                    })
                });
                
                const result = await resp.json();
                console.log('📥 일괄 변경 API 응답:', result);
                
                if (result.success) {
                    // UI 즉시 업데이트 - 선택된 매물들의 담당자 셀 업데이트
                    selected.forEach(propertyId => {
                        const row = document.querySelector(`tr[data-property-id="${propertyId}"]`);
                        if (row) {
                            const employeeCell = row.querySelector('td:nth-child(13)'); // 담당자 셀
                            const teamCell = row.querySelector('td:nth-child(14)'); // 팀 셀
                            
                            if (employeeCell) {
                                employeeCell.innerHTML = `<span style="color: #4f46e5; font-weight: 500;">${employeeName}</span>`;
                            }
                            
                            if (teamCell) {
                                teamCell.innerHTML = `<span class="status-badge" style="background: ${getTeamBadgeColor(employeeTeam)}; color: ${getTeamTextColor(employeeTeam)};">${employeeTeam}</span>`;
                            }
                            
                            // 변경된 행에 하이라이트 효과
                            row.style.backgroundColor = '#f0f9ff';
                            row.style.transition = 'background-color 0.5s ease';
                            setTimeout(() => {
                                row.style.backgroundColor = '';
                            }, 2000);
                        }
                    });
                    
                    alert(`${selected.length}개 매물의 담당자가 "${employeeName}"으로 변경되었습니다.`);
                    clearSelection();
                    console.log('✅ 일괄 담당자 변경 완료');
                } else {
                    console.error('❌ 일괄 변경 실패:', result);
                    alert('담당자 변경에 실패했습니다: ' + (result.message || result.error));
                }
            } catch (e) {
                console.error('❌ 일괄 담당자 변경 중 오류:', e);
                alert('담당자 변경 중 오류가 발생했습니다.');
            }
        }

        // 셀 편집 기능 (팀장: 담당자 변경만 가능)
        async function editPropertyCell(cell) {
            const field = cell.dataset.field;
            const type = cell.dataset.type;
            
            // 팀장은 담당자(employee_id) 필드만 편집 가능
            if (field !== 'employee_id') {
                alert('팀장은 담당자만 변경할 수 있습니다.');
                return;
            }
            
            // 이미 편집 중이면 편집 모드 종료
            if (cell.classList.contains('editing-cell')) {
                const existingSelector = cell.querySelector('.employee-selector');
                if (existingSelector) {
                    existingSelector.remove();
                }
                cell.classList.remove('editing-cell');
                return;
            }
            
            let currentValue = cell.textContent.trim();
            
            // 담당자 선택 드롭다운 생성
            const selector = document.createElement('select');
            selector.className = 'employee-selector';
            selector.style.cssText = 'width: 100%; padding: 4px; border: 1px solid #3b82f6; border-radius: 4px; font-size: 12px; background: white;';
            
            // 팀장의 팀원 목록 로드
            try {
                console.log('🔄 개별 편집용 팀원 목록 로드 시작...');
                const resp = await fetch('/api/employees?per_page=200&page=1');
                const data = await resp.json();
                const currentTeam = '{{ employee_team }}';
                
                console.log('📥 개별 편집 API 응답:', data);
                console.log('👥 현재 팀:', currentTeam);
                
                if (data.employees) {
                    // 자신의 팀 멤버 필터링 (팀장 포함) - Supabase 필드명 사용
                    const teamMembers = data.employees.filter(e => {
                        const isCorrectTeam = e.team === currentTeam;
                        const isTeamLeaderOrEmployee = e.role && (e.role === '팀장' || e.role === '직원');
                        return isCorrectTeam && isTeamLeaderOrEmployee;
                    });
                    
                    console.log('✅ 개별 편집용 필터링된 팀원:', teamMembers);
                    
                    selector.innerHTML = '<option value="">담당자 선택</option>';
                    
                    if (teamMembers.length === 0) {
                        const noMembersOption = document.createElement('option');
                        noMembersOption.value = '';
                        noMembersOption.textContent = '해당 팀에 팀원이 없습니다';
                        noMembersOption.disabled = true;
                        selector.appendChild(noMembersOption);
                        console.warn('⚠️ 개별 편집: 해당 팀에 팀원이 없습니다.');
                    } else {
                        teamMembers.forEach(emp => {
                            const option = document.createElement('option');
                            option.value = emp.id || emp.employee_id || emp.name;
                            option.dataset.employeeName = emp.name;
                            option.dataset.employeeTeam = emp.team || currentTeam;
                            option.textContent = `${emp.name}${emp.role ? ` (${emp.role})` : ''}`;
                            if (emp.name === currentValue) {
                                option.selected = true;
                            }
                            selector.appendChild(option);
                        });
                    }
                }
            } catch (error) {
                console.error('❌ 개별 편집용 팀원 목록 로드 실패:', error);
                alert('팀원 목록을 불러오는데 실패했습니다.');
                return;
            }
            
            // 셀을 편집 모드로 변경
            cell.classList.add('editing-cell');
            const originalContent = cell.innerHTML;
            cell.innerHTML = '';
            cell.appendChild(selector);
            
            // 포커스 설정
            selector.focus();
            
            // 저장 함수
            const saveCell = async (moveNext = false) => {
                const newValue = selector.value;
                const propertyId = cell.closest('tr').dataset.propertyId;
                
                if (newValue !== currentValue) {
                    try {
                        // 선택된 직원의 이름 가져오기
                        const selectedOption = selector.options[selector.selectedIndex];
                        const employeeName = selectedOption.dataset.employeeName || selectedOption.textContent.split(' (')[0];
                        
                        // 서버에 변경사항 저장
                        const response = await fetch(`/api/maeiple/${propertyId}/update`, {
                            method: 'PUT',
                            headers: {
                                'Content-Type': 'application/json'
                            },
                            body: JSON.stringify({
                                employee_id: newValue,
                                employee_name: employeeName
                            })
                        });
                        
                        const result = await response.json();
                        if (result.success) {
                            // 성공시 UI 업데이트
                            cell.innerHTML = `<span style="color: #4f46e5; font-weight: 500;">${employeeName || '미지정'}</span>`;
                            console.log('담당자 변경 성공');
                        } else {
                            throw new Error(result.message || '저장 실패');
                        }
                    } catch (error) {
                        console.error('저장 실패:', error);
                        alert('변경사항 저장에 실패했습니다.');
                        cell.innerHTML = originalContent;
                    }
                } else {
                    // 변경사항이 없으면 원래 내용 복원
                    cell.innerHTML = originalContent;
                }
                
                cell.classList.remove('editing-cell');
            };
            
            // 이벤트 리스너
            selector.addEventListener('change', () => {
                saveCell();
            });
            
            selector.addEventListener('keydown', (e) => {
                if (e.key === 'Enter') {
                    e.preventDefault();
                    saveCell();
                } else if (e.key === 'Escape') {
                    e.preventDefault();
                    cell.innerHTML = originalContent;
                    cell.classList.remove('editing-cell');
                }
            });
            
            selector.addEventListener('blur', () => {
                saveCell();
            });
        }

        // 아파트목록 탭용 매물 편집 기능들 (관리자 패널 스타일)
        
        // 아파트목록 탭용 날짜 편집
        function editAdminDate(propertyId, currentDate, cell) {
            if (cell.querySelector('input')) return;
            
            const input = document.createElement('input');
            input.type = 'date';
            input.value = currentDate;
            input.className = 'admin-edit-input';
            input.style.cssText = 'width: 100%; padding: 4px; border: 1px solid #ccc; border-radius: 4px;';
            
            cell.innerHTML = '';
            cell.appendChild(input);
            input.focus();
            
            input.onblur = async function() {
                const newValue = input.value;
                cell.textContent = newValue;
                
                if (propertyId === 'new') {
                    await autoSaveNewProperty(cell);
                } else {
                    await updateAdminProperty(propertyId, 'check_date', newValue);
                }
            };
            
            input.onkeypress = function(e) {
                if (e.key === 'Enter') {
                    e.preventDefault();
                    input.blur();
                    // 다음 편집 가능한 셀로 이동
                    const nextCell = cell.nextElementSibling;
                    if (nextCell && nextCell.onclick) {
                        nextCell.click();
                    }
                }
            };
        }
        
        // 아파트목록 탭용 호수/동 번호 편집
        function editAdminNumber(propertyId, field, currentValue, cell) {
            if (cell.querySelector('input')) return;
            
            const input = document.createElement('input');
            input.type = 'text';
            input.value = currentValue;
            input.className = 'admin-edit-input';
            input.style.cssText = 'width: 100%; padding: 4px; border: 1px solid #ccc; border-radius: 4px;';
            input.placeholder = field === 'building_number' ? '동 번호' : '호수';
            
            cell.innerHTML = '';
            cell.appendChild(input);
            input.focus();
            
            input.onblur = async function() {
                const newValue = input.value;
                cell.textContent = newValue;
                
                if (propertyId === 'new') {
                    await autoSaveNewProperty(cell);
                } else {
                    await updateAdminProperty(propertyId, field, newValue);
                }
            };
            
            input.onkeypress = function(e) {
                if (e.key === 'Enter') {
                    e.preventDefault();
                    input.blur();
                    // 다음 편집 가능한 셀로 이동
                    const nextCell = cell.nextElementSibling;
                    if (nextCell && nextCell.onclick) {
                        nextCell.click();
                    }
                }
            };
        }
        
        // 아파트목록 탭용 가격 편집
        function editAdminPrice(propertyId, field, currentValue, cell) {
            if (cell.querySelector('input')) return;
            
            const input = document.createElement('input');
            input.type = 'text';
            input.value = extractNumber(currentValue) || '';
            input.className = 'admin-edit-input';
            input.style.cssText = 'width: 100%; padding: 4px; border: 1px solid #ccc; border-radius: 4px;';
            input.placeholder = '가격 (만원)';
            
            cell.innerHTML = '';
            cell.appendChild(input);
            input.focus();
            
            input.onblur = async function() {
                const newValue = input.value;
                const displayValue = newValue ? formatNumber(newValue) + ' 만원' : '-';
                cell.innerHTML = `<span style="cursor: pointer; color: #2563eb; font-weight: 500;">${displayValue}</span>`;
                
                if (propertyId === 'new') {
                    await autoSaveNewProperty(cell);
                } else {
                    await updateAdminProperty(propertyId, field, newValue);
                }
            };
            
            input.onkeypress = function(e) {
                if (e.key === 'Enter') {
                    e.preventDefault();
                    input.blur();
                    // 다음 편집 가능한 셀로 이동
                    const nextCell = cell.nextElementSibling;
                    if (nextCell && nextCell.onclick) {
                        nextCell.click();
                    }
                }
            };
        }
        
        // 아파트목록 탭용 전화번호 편집
        function editAdminPhone(propertyId, currentValue, cell) {
            if (cell.querySelector('input')) return;
            
            const input = document.createElement('input');
            input.type = 'tel';
            input.value = currentValue === '-' ? '' : currentValue;
            input.className = 'admin-edit-input';
            input.style.cssText = 'width: 100%; padding: 4px; border: 1px solid #ccc; border-radius: 4px; font-family: monospace;';
            input.placeholder = '전화번호';
            
            cell.innerHTML = '';
            cell.appendChild(input);
            input.focus();
            
            input.onblur = async function() {
                const newValue = input.value || '-';
                cell.textContent = newValue === '-' ? '-' : formatPhoneNumber(newValue);
                
                if (propertyId === 'new') {
                    await autoSaveNewProperty(cell);
                } else {
                    await updateAdminProperty(propertyId, 'phone', newValue === '-' ? '' : newValue);
                }
            };
            
            input.onkeypress = function(e) {
                if (e.key === 'Enter') {
                    e.preventDefault();
                    input.blur();
                    // 다음 편집 가능한 셀로 이동
                    const nextCell = cell.nextElementSibling;
                    if (nextCell && nextCell.onclick) {
                        nextCell.click();
                    }
                }
            };
        }
        
        // 아파트목록 탭용 메모 편집 (모달 방식)
        function editAdminMemo(propertyId, currentValue, cell) {
            // 매물 정보 추출
            const row = cell.closest('tr');
            const buildingCell = row.cells[2]; // 동 번호
            const roomCell = row.cells[3]; // 호수
            const buildingNumber = buildingCell ? buildingCell.textContent.trim() : '';
            const roomNumber = roomCell ? roomCell.textContent.trim() : '';
            
            if (propertyId === 'new') {
                // 새 매물인 경우 새 매물 모달 함수 사용
                openNewPropertyMemoModal(cell);
            } else {
                // 기존 매물인 경우 기존 매물 모달 함수 사용
                openPropertyMemoModal(propertyId, currentValue, buildingNumber, roomNumber);
            }
        }
        
        // 아파트목록 탭용 상태 변경
        function showAdminStatusOptions(propertyId, currentStatus, button) {
            const options = ['거래가능', '계약완료', '보류', '부재'];
            
            // 기존 옵션 메뉴가 있다면 제거
            const existingMenu = document.querySelector('.admin-status-menu');
            if (existingMenu) {
                existingMenu.remove();
                return;
            }
            
            const menu = document.createElement('div');
            menu.className = 'admin-status-menu';
            menu.style.cssText = `
                position: absolute;
                background: white;
                border: 1px solid #e2e8f0;
                border-radius: 6px;
                box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
                z-index: 1000;
                min-width: 100px;
            `;
            
            options.forEach(status => {
                const option = document.createElement('button');
                option.textContent = status;
                option.style.cssText = `
                    width: 100%;
                    padding: 8px 12px;
                    border: none;
                    background: ${status === currentStatus ? '#f1f5f9' : 'transparent'};
                    text-align: left;
                    cursor: pointer;
                    font-size: 12px;
                `;
                
                option.onmouseenter = () => option.style.background = '#f1f5f9';
                option.onmouseleave = () => option.style.background = status === currentStatus ? '#f1f5f9' : 'transparent';
                
                option.onclick = async () => {
                    button.textContent = status;
                    button.style.cssText = getAdminStatusBadge(status);
                    menu.remove();
                    
                    if (propertyId === 'new') {
                        await autoSaveNewProperty(button.closest('td'));
                    } else {
                        await updateAdminProperty(propertyId, 'status', status);
                    }
                };
                
                menu.appendChild(option);
            });
            
            // 메뉴 위치 설정
            const rect = button.getBoundingClientRect();
            menu.style.left = rect.left + 'px';
            menu.style.top = (rect.bottom + window.scrollY) + 'px';
            
            document.body.appendChild(menu);
            
            // 외부 클릭 시 메뉴 닫기
            setTimeout(() => {
                document.addEventListener('click', function closeMenu(e) {
                    if (!menu.contains(e.target)) {
                        menu.remove();
                        document.removeEventListener('click', closeMenu);
                    }
                });
            }, 0);
        }
                
        // 아파트목록 탭용 거주 상태 토글
        async function toggleAdminOccupied(propertyId, currentState) {
            const newState = !currentState;
            
            // UI 즉시 업데이트
            const button = event.target;
            button.textContent = newState ? 'O' : 'X';
            button.style.cssText = getAdminOccupiedBadge(newState);
            
            if (propertyId === 'new') {
                await autoSaveNewProperty(button.closest('td'));
            } else {
                await updateAdminProperty(propertyId, 'is_occupied', newState);
            }
        }
        
        // 아파트목록 탭용 매물 업데이트 (관리자와 동일한 방식)
        async function updateAdminProperty(propertyId, field, value) {
            console.log('🔄 updateAdminProperty 호출:', { propertyId, field, value });
            try {
                const requestData = {
                    id: propertyId,
                    field: field,
                    value: value
                };
                console.log('📤 API 요청 데이터:', requestData);
                
                const response = await fetch('/api/maeiple/update', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(requestData)
                });
                
                console.log('📥 API 응답 상태:', response.status, response.statusText);
                
                if (!response.ok) {
                    const errorText = await response.text();
                    console.error('❌ API 에러 응답:', errorText);
                    throw new Error(`HTTP ${response.status}: ${errorText}`);
                }
                
                const result = await response.json();
                console.log('📥 API 응답 데이터:', result);
                
                if (!result.success) {
                    console.error('❌ API 실패 응답:', result);
                    throw new Error(result.error || '업데이트 실패');
                }
                
                console.log('✅ updateAdminProperty 성공:', field, value);
                
                // 로컬 데이터도 업데이트하여 순서 유지
                const property = properties.find(p => p.id === propertyId);
                if (property) {
                    property[field] = value;
                }
                
            } catch (error) {
                console.error('아파트목록 매물 업데이트 실패:', error);
                alert('수정 중 오류가 발생했습니다.');
            }
        }
        
        // 관리자 스타일 매물 셀 편집 함수 (관리자 패널과 동일)
        function editAdminPropertyCell(cell) {
            // 이미 편집 중이면 편집 모드 종료
            if (cell.classList.contains('editing-cell')) {
                return;
            }
            
            const field = cell.dataset.field;
            const type = cell.dataset.type;
            let currentValue = cell.textContent.trim();
            
            // 배지에서 현재 값 추출
            if (field === 'status') {
                const badge = cell.querySelector('.badge');
                currentValue = badge ? badge.textContent.trim() : '거래가능';
            } else if (field === 'is_occupied') {
                const badge = cell.querySelector('.badge');
                currentValue = badge ? badge.textContent.trim() : 'X';
            }
            
            cell.classList.add('editing-cell');
            
            if (field === 'status') {
                // 상태 선택 드롭다운
                const statusOptions = ['거래가능', '거래중', '계약완료', '보류', '부재'];
                const selector = document.createElement('select');
                selector.className = 'status-selector';
                selector.style.cssText = 'width: 100%; padding: 4px; border: 1px solid #ccc; border-radius: 4px; font-size: 12px;';
                
                statusOptions.forEach(status => {
                    const option = document.createElement('option');
                    option.value = status;
                    option.textContent = status;
                    if (status === currentValue) {
                        option.selected = true;
                    }
                    selector.appendChild(option);
                });
                
                selector.addEventListener('change', () => {
                    const selectedValue = selector.value;
                    const statusColors = {
                        '거래가능': { bg: '#e0f2fe', color: '#0369a1' },
                        '거래중': { bg: '#fef3c7', color: '#d97706' },
                        '계약완료': { bg: '#dcfce7', color: '#16a34a' },
                        '보류': { bg: '#fef3c7', color: '#d97706' },
                        '부재': { bg: '#fecaca', color: '#dc2626' }
                    };
                    const colors = statusColors[selectedValue] || statusColors['거래가능'];
                    
                    cell.innerHTML = `<span class="badge" style="background: ${colors.bg}; color: ${colors.color}; padding:4px 8px; border-radius:4px; font-size:12px; font-weight:500;">${selectedValue}</span>`;
                    cell.classList.remove('editing-cell');
                    
                    // 자동저장 실행
                    autoSaveNewProperty(cell);
                });
                
                cell.innerHTML = '';
                cell.appendChild(selector);
                selector.focus();
                
            } else if (field === 'is_occupied') {
                // 거주 여부 선택
                const occupiedOptions = [
                    { value: false, text: 'X', bg: '#fecaca', color: '#dc2626' },
                    { value: true, text: 'O', bg: '#dcfce7', color: '#16a34a' }
                ];
                const selector = document.createElement('select');
                selector.className = 'occupied-selector';
                selector.style.cssText = 'width: 100%; padding: 4px; border: 1px solid #ccc; border-radius: 4px; font-size: 12px;';
                
                occupiedOptions.forEach(option => {
                    const opt = document.createElement('option');
                    opt.value = option.value;
                    opt.textContent = option.text;
                    if ((option.text === 'O' && currentValue === 'O') || (option.text === 'X' && currentValue === 'X')) {
                        opt.selected = true;
                    }
                    selector.appendChild(opt);
                });
                
                selector.addEventListener('change', () => {
                    const selectedValue = selector.value === 'true';
                    const option = occupiedOptions.find(opt => opt.value === selectedValue);
                    
                    cell.innerHTML = `<span class="badge" style="background: ${option.bg}; color: ${option.color}; padding:4px 8px; border-radius:4px; font-size:12px; font-weight:500;">${option.text}</span>`;
                    cell.classList.remove('editing-cell');
                    
                    // 자동저장 실행
                    autoSaveNewProperty(cell);
                });
                
                cell.innerHTML = '';
                cell.appendChild(selector);
                selector.focus();
                
            } else {
                // 일반 입력 필드
                const input = document.createElement('input');
                input.type = type === 'date' ? 'date' : (type === 'number' ? 'text' : 'text');
                // 플레이스홀더 텍스트인 경우에만 빈 문자열로 설정
                const placeholderTexts = [
                    '전세가 입력', '월세보증금 입력', '월세 입력', '매매가 입력', 
                    '연락처 입력', '메모 입력', '호수 입력', '면적 입력',
                    '층수 입력', '방향 입력', '건축년도 입력'
                ];
                input.value = placeholderTexts.includes(currentValue.trim()) ? '' : currentValue;
                input.style.cssText = 'width: 100%; padding: 4px; border: 1px solid #ccc; border-radius: 4px; font-size: 12px;';
                
                input.addEventListener('blur', () => {
                    let newValue = input.value;
                    if (type === 'number' && field.includes('price')) {
                        const num = parseInt(newValue.replace(/[^0-9]/g, ''));
                        if (!isNaN(num) && num > 0) {
                            newValue = num.toLocaleString();
                        }
                    }
                    
                    cell.textContent = newValue || (field.includes('price') || field.includes('deposit') || field.includes('rent') ? '0' : '');
                    cell.style.color = newValue ? '#1f2937' : '#64748b';
                    cell.classList.remove('editing-cell');
                    
                    // 자동저장 실행
                    autoSaveNewProperty(cell);
                });
                
                input.addEventListener('keypress', (e) => {
                    if (e.key === 'Enter') {
                        e.preventDefault();
                        input.blur();
                        // 다음 편집 가능한 셀로 이동
                        const nextCell = cell.parentElement.nextElementSibling?.querySelector('.editable-cell');
                        if (nextCell) {
                            nextCell.click();
                        }
                    }
                });
                
                cell.innerHTML = '';
                cell.appendChild(input);
                input.focus();
            }
        }

        // 아파트목록 탭용 자동저장 (관리자와 동일한 방식)
        async function autoSaveNewProperty(cell) {
            const row = cell.closest('tr');
            if (!row || !row.classList.contains('new-property-row')) {
                return; // 새 매물 행이 아니면 저장하지 않음
            }
            
            console.log('🔄 새 매물 자동저장 시작...');
            
            try {
                // 데이터 수집 (관리자 패널과 동일한 방식)
                const propertyData = {};
                const cells = row.querySelectorAll('.editable-cell');
                
                cells.forEach(cell => {
                    const field = cell.dataset.field;
                    let value = cell.textContent.trim();
                    
                    // 배지에서 값 추출
                    if (field === 'status') {
                        const badge = cell.querySelector('.badge');
                        value = badge ? badge.textContent.trim() : '거래가능';
                    } else if (field === 'is_occupied') {
                        const badge = cell.querySelector('.badge');
                        value = badge && badge.textContent.trim() === 'O';
                    } else if (field.includes('price') || field.includes('deposit') || field.includes('rent')) {
                        // 가격 필드 처리
                        const numValue = value.replace(/[^0-9]/g, '');
                        value = numValue ? parseInt(numValue) : null;
                    } else if (field === 'building_number' || field === 'room_number') {
                        // 동/호수 처리 (선택사항)
                        value = value.replace(/[^0-9]/g, '');
                        // 필수 검증 제거 - 빈 값도 허용
                    } else if (field === 'phone') {
                        // 전화번호 처리
                        if (value === '연락처 입력' || value === '') {
                            value = '';
                        }
                    }
                    
                    // 플레이스홀더 텍스트 제거 (관리자 패널과 동일)
                    if (field === 'employee_name' && typeof value === 'string' && value.includes('입력')) {
                        value = '';
                    }
                    
                    propertyData[field] = value;
                });
                
                // 메모 처리
                const memoCell = row.querySelector('.memo-cell');
                propertyData.memo = memoCell.dataset.memo || '';
                
                // 담당자와 팀 정보 (관리자 패널과 동일)
                propertyData.employee_name = propertyData.employee_name || '';
                propertyData.employee_team = propertyData.employee_team || '';
                
                // 좋아요/싫어요 정보 추가
                const likesElement = row.querySelector('[onclick*="editNewPropertyLikes"][onclick*="like"]');
                const dislikesElement = row.querySelector('[onclick*="editNewPropertyLikes"][onclick*="dislike"]');
                propertyData.likes = parseInt(likesElement?.dataset?.count) || 0;
                propertyData.dislikes = parseInt(dislikesElement?.dataset?.count) || 0;
                
                console.log('자동저장할 매물 데이터:', propertyData);
                
                // API 호출
                const response = await fetch('/api/maeiple', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(propertyData)
                });
                
                if (!response.ok) {
                    const errorText = await response.text();
                    console.error('서버 응답 오류:', response.status, errorText);
                    return;
                }
                
                const result = await response.json();
                console.log('서버 응답:', result);
                
                if (result && result.success === true) {
                    console.log('✅ 새 매물 자동저장 성공:', result);
                    
                    // 성공적으로 저장된 경우 새 행을 제거하고 테이블에 추가
                    if (result.created_property) {
                        await addNewPropertyToTable(result.created_property);
                        row.remove();
                        
                        // 성공 메시지 표시
                        alert('매물이 자동으로 저장되었습니다.');
                    }
                        } else {
                    const errorMsg = result?.error || result?.message || '자동저장에 실패했습니다.';
                    console.warn('자동저장 실패:', errorMsg);
                }
                
            } catch (error) {
                console.error('매물 자동저장 오류:', error);
                // 오류가 발생해도 사용자에게는 알리지 않음 (자동저장이므로)
            }
        }
        
        // 아파트목록 탭용 상태 배지 생성
        function getAdminStatusBadge(status) {
            const styles = {
                '거래가능': 'padding: 6px 12px; border: none; border-radius: 6px; font-size: 12px; font-weight: 500; cursor: pointer; background: #e0f2fe; color: #0369a1;',
                '거래중': 'padding: 6px 12px; border: none; border-radius: 6px; font-size: 12px; font-weight: 500; cursor: pointer; background: #fef3c7; color: #92400e;',
                '계약완료': 'padding: 6px 12px; border: none; border-radius: 6px; font-size: 12px; font-weight: 500; cursor: pointer; background: #d1fae5; color: #065f46;',
                '보류': 'padding: 6px 12px; border: none; border-radius: 6px; font-size: 12px; font-weight: 500; cursor: pointer; background: #fecaca; color: #dc2626;',
                '부재': 'padding: 6px 12px; border: none; border-radius: 6px; font-size: 12px; font-weight: 500; cursor: pointer; background: #ede9fe; color: #5b21b6;'
            };
            return styles[status] || styles['거래가능'];
        }
        
        // 아파트목록 탭용 거주 상태 배지 생성
        function getAdminOccupiedBadge(isOccupied) {
            return `background: none; border: none; cursor: pointer; font-size: 18px; padding: 4px; border-radius: 4px; color: ${isOccupied ? '#059669' : '#dc2626'};`;
        }

        // 새로 추가된 매물을 아파트목록 테이블에 즉시 표시
        async function addNewPropertyToTable(property) {
            console.log('🔄 새 매물을 아파트목록 테이블에 즉시 추가:', property);
            
            const tbody = document.querySelector('#maeiple-table-content table tbody');
            if (!tbody) {
                console.error('아파트목록 테이블 tbody를 찾을 수 없습니다.');
                return;
            }
            
            // 새 행 생성
            const newRow = document.createElement('tr');
            newRow.className = 'property-row';
            newRow.dataset.propertyId = property.id;
            
            newRow.innerHTML = `
                <td style="text-align: center;">
                    <input type="checkbox" class="property-checkbox" value="${property.id}" 
                           onchange="updateSelectionCount()" style="width: 16px; height: 16px; cursor: pointer;">
                </td>
                <td style="cursor: pointer;" onclick="editAdminDate(${property.id}, '${property.check_date || ''}', this)">${property.check_date || '-'}</td>
                <td style="cursor: pointer;" onclick="editAdminNumber(${property.id}, 'building_number', '${property.building_number || ''}', this)">${property.building_number || '-'}</td>
                <td style="cursor: pointer;" onclick="editAdminNumber(${property.id}, 'room_number', '${property.room_number || ''}', this)">${property.room_number || '-'}</td>
                <td>
                    <button style="padding: 6px 12px; border: none; border-radius: 6px; font-size: 12px; font-weight: 500; cursor: pointer; ${property.status === '계약완료' ? 'background: #d1fae5; color: #065f46;' : property.status === '보류' ? 'background: #fef3c7; color: #92400e;' : property.status === '부재' ? 'background: #ede9fe; color: #5b21b6;' : 'background: #e0f2fe; color: #0369a1;'}" 
                            onclick="showAdminStatusOptions(${property.id}, '${property.status || '거래가능'}', this)">
                        ${property.status || '거래가능'}
                    </button>
                </td>
                <td style="cursor: pointer; color: #2563eb; font-weight: 500;" onclick="editAdminPrice(${property.id}, 'jeonse_price', '${property.jeonse_price || ''}', this)">
                    ${property.jeonse_price ? formatNumber(property.jeonse_price) + ' 만원' : '-'}
                </td>
                <td style="cursor: pointer; color: #2563eb; font-weight: 500;" onclick="editAdminPrice(${property.id}, 'monthly_deposit', '${property.monthly_deposit || property.deposit || ''}', this)">
                    ${property.monthly_deposit || property.deposit ? formatNumber(property.monthly_deposit || property.deposit) + ' 만원' : '-'}
                </td>
                <td style="cursor: pointer; color: #2563eb; font-weight: 500;" onclick="editAdminPrice(${property.id}, 'monthly_rent', '${property.monthly_rent || ''}', this)">
                    ${property.monthly_rent ? formatNumber(property.monthly_rent) + ' 만원' : '-'}
                </td>
                <td style="cursor: pointer; color: #2563eb; font-weight: 500;" onclick="editAdminPrice(${property.id}, 'sale_price', '${property.sale_price || ''}', this)">
                    ${property.sale_price ? formatNumber(property.sale_price) + ' 만원' : '-'}
                </td>
                <td>
                    <button style="background: none; border: none; cursor: pointer; font-size: 18px; padding: 4px; border-radius: 4px; color: ${property.is_occupied ? '#059669' : '#dc2626'};" 
                            onclick="toggleAdminOccupied(${property.id}, ${property.is_occupied})">
                        ${property.is_occupied ? 'O' : 'X'}
                    </button>
                </td>
                <td style="cursor: pointer; font-family: monospace; letter-spacing: 0.5px; max-width: 120px; overflow: hidden; text-overflow: ellipsis;" onclick="editAdminPhone(${property.id}, '${property.phone || ''}', this)">
                    ${property.phone || '-'}
                </td>
                <td class="memo-cell" onclick="editAdminMemo(${property.id}, '${(property.memo || '').replace(/'/g, "\\'")}', this)" style="color: #64748b; font-style: italic; max-width: 150px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; cursor: pointer;">
                    ${property.memo ? (property.memo.length > 20 ? property.memo.substring(0, 20) + '...' : property.memo) : '클릭하여 메모 추가'}
                </td>
                <td class="editable-cell" data-field="employee_id" data-type="select" onclick="editPropertyCell(this)" style="cursor: pointer;">
                    <span style="color: #4f46e5; font-weight: 500;">
                        ${property.employee_name || '미지정'}
                    </span>
                </td>
                <td>
                    <span class="status-badge" style="background: ${getTeamBadgeColor(property.employee_team)}; color: ${getTeamTextColor(property.employee_team)};">
                        ${property.employee_team || '미지정'}
                    </span>
                </td>
                <td>
                    <div style="cursor: pointer; user-select: none; display: flex; align-items: center; justify-content: center; gap: 2px;" onclick="editPropertyLikes(${property.id}, 'likes', ${property.likes || 0}, this)" data-count="${property.likes || 0}">
                        <span style="color: #9ca3af; font-size: 14px;">❤️ ${property.likes || 0}</span>
                    </div>
                </td>
                <td>
                    <div style="cursor: pointer; user-select: none; display: flex; align-items: center; justify-content: center; gap: 2px;" onclick="editPropertyLikes(${property.id}, 'dislikes', ${property.dislikes || 0}, this)" data-count="${property.dislikes || 0}">
                        <span style="color: #9ca3af; font-size: 14px;">👎 ${property.dislikes || 0}</span>
                    </div>
                </td>
            `;
            
            tbody.insertBefore(newRow, tbody.firstChild);
            
            // 새로 추가된 행에 하이라이트 효과 적용
            newRow.style.backgroundColor = '#f0f9ff';
            newRow.style.transition = 'background-color 0.5s ease';
            
            setTimeout(() => {
                newRow.style.backgroundColor = '';
            }, 2000);
            
            console.log('✅ 새 매물이 아파트목록 테이블에 즉시 추가됨');
        }

        // 팀장용 매물 셀 편집 기능 (관리자 패널 기능 이식)
        function editTeamLeaderPropertyCell(cell) {
            // 이미 편집 중이면 편집 모드 종료
            if (cell.classList.contains('editing-cell')) {
                const existingSelector = cell.querySelector('.status-selector');
                if (existingSelector) {
                    existingSelector.remove();
                }
                cell.classList.remove('editing-cell');
                return;
            }
            
            const field = cell.dataset.field;
            const type = cell.dataset.type;
            let currentValue = cell.textContent.trim();
            
            // 배지에서 실제 값 추출
            if (field === 'status') {
                const badge = cell.querySelector('.badge');
                currentValue = badge ? badge.textContent.trim() : '거래가능';
            } else if (field === 'is_occupied') {
                const badge = cell.querySelector('.badge');
                currentValue = badge && badge.textContent.trim() === 'O' ? true : false;
            }
            
            // 플레이스홀더 텍스트 제거 (정확한 플레이스홀더 문자열만 제거)
            const placeholderTexts = [
                '전세가 입력', '월세보증금 입력', '월세 입력', '매매가 입력', 
                '연락처 입력', '메모 입력', '호수 입력', '면적 입력',
                '층수 입력', '방향 입력', '건축년도 입력'
            ];
            if (placeholderTexts.includes(currentValue.trim())) {
                currentValue = '';
            }
            
            cell.classList.add('editing-cell');
            
            if (type === 'select') {
                if (field === 'status') {
                    // 상태 선택 드롭다운
                    const statusOptions = ['거래가능', '계약완료', '보류', '부재'];
                    const selector = document.createElement('select');
                    selector.className = 'status-selector';
                    selector.style.cssText = 'width: 100%; padding: 4px; border: 2px solid #3b82f6; border-radius: 4px; background: white; font-size: 12px;';
                    
                    statusOptions.forEach(option => {
                        const optionElement = document.createElement('option');
                        optionElement.value = option;
                        optionElement.textContent = option;
                        if (option === currentValue) {
                            optionElement.selected = true;
                        }
                        selector.appendChild(optionElement);
                    });
                    
                    const updateStatusCell = () => {
                        const selectedValue = selector.value;
                        const statusColors = {
                            '거래가능': { bg: '#e0f2fe', color: '#0369a1' },
                            '계약완료': { bg: '#dcfce7', color: '#16a34a' },
                            '보류': { bg: '#fef3c7', color: '#d97706' },
                            '부재': { bg: '#fecaca', color: '#dc2626' }
                        };
                        const colors = statusColors[selectedValue] || statusColors['거래가능'];
                        
                        cell.innerHTML = `<span class="badge" style="background: ${colors.bg}; color: ${colors.color}; padding:4px 8px; border-radius:4px; font-size:12px; font-weight:500;">${selectedValue}</span>`;
                        cell.classList.remove('editing-cell');
                        
                        // 자동저장 실행
                        autoSaveNewProperty(cell);
                    };
                    
                    selector.addEventListener('change', updateStatusCell);
                    selector.addEventListener('blur', updateStatusCell);
                    
                    cell.innerHTML = '';
                    cell.appendChild(selector);
                    selector.focus();
                    
                } else if (field === 'is_occupied') {
                    // 거주 여부 선택
                    const occupiedOptions = [
                        { value: false, text: 'X', bg: '#fecaca', color: '#dc2626' },
                        { value: true, text: 'O', bg: '#dcfce7', color: '#16a34a' }
                    ];
                    
                    const selector = document.createElement('select');
                    selector.className = 'status-selector';
                    selector.style.cssText = 'width: 100%; padding: 4px; border: 2px solid #3b82f6; border-radius: 4px; background: white; font-size: 12px;';
                    
                    occupiedOptions.forEach(option => {
                        const optionElement = document.createElement('option');
                        optionElement.value = option.value;
                        optionElement.textContent = option.text;
                        if (option.value === currentValue) {
                            optionElement.selected = true;
                        }
                        selector.appendChild(optionElement);
                    });
                    
                    const updateOccupiedCell = () => {
                        const selectedValue = selector.value === 'true';
                        const option = occupiedOptions.find(opt => opt.value === selectedValue);
                        
                        cell.innerHTML = `<span class="badge" style="background: ${option.bg}; color: ${option.color}; padding:4px 8px; border-radius:4px; font-size:12px; font-weight:500;">${option.text}</span>`;
                        cell.classList.remove('editing-cell');
                        
                        // 자동저장 실행
                        autoSaveNewProperty(cell);
                    };
                    
                    selector.addEventListener('change', updateOccupiedCell);
                    selector.addEventListener('blur', updateOccupiedCell);
                    
                    cell.innerHTML = '';
                    cell.appendChild(selector);
                    selector.focus();
                }
                        } else {
                // 일반 입력 필드
                const input = document.createElement('input');
                input.type = type === 'date' ? 'date' : (type === 'number' ? 'number' : 'text');
                input.value = currentValue;
                input.style.cssText = 'width: 100%; padding: 4px; border: 2px solid #3b82f6; border-radius: 4px; background: white; font-size: 12px;';
                
                const saveInput = () => {
                    const newValue = input.value;
                    
                    // UI 업데이트
                    if (type === 'number' && newValue) {
                        cell.innerHTML = formatNumber(newValue) + ' 만원';
                        cell.style.color = '#2563eb';
                        cell.style.fontWeight = '500';
                    } else {
                        cell.innerHTML = newValue || '-';
                        if (field === 'building_number' || field === 'room_number') {
                            cell.style.color = '#1a202c';
                        }
                    }
                    
                    cell.classList.remove('editing-cell');
                    
                    // 자동저장 실행
                    autoSaveNewProperty(cell);
                };
                
                input.addEventListener('keydown', (e) => {
                    if (e.key === 'Enter') {
                        e.preventDefault();
                        saveInput();
                    } else if (e.key === 'Escape') {
                        e.preventDefault();
                        cell.innerHTML = currentValue || '-';
                        cell.classList.remove('editing-cell');
                    }
                });
                
                input.addEventListener('blur', saveInput);
                
                cell.innerHTML = '';
                cell.appendChild(input);
                input.focus();
                if (input.type === 'text') {
                    input.select();
                }
            }
        }




        // 새 매물 메모 편집
        function openNewPropertyMemoModal(cell) {
            const currentMemo = cell.textContent.trim();
            const newMemo = prompt('메모를 입력하세요:', currentMemo === '메모 입력' ? '' : currentMemo);
            if (newMemo !== null) {
                const row = cell.closest('tr');
                row.dataset.memo = newMemo;
                cell.textContent = newMemo || '메모 입력';
                cell.style.color = newMemo ? '#1a202c' : '#64748b';
            }
        }

        // 새 매물 좋아요/싫어요 편집
        async function editNewPropertyLikes(element, type) {
            const currentCount = parseInt(element.dataset.count) || 0;
            const newCount = prompt(`${type === 'like' ? '좋아요' : '싫어요'} 수를 입력하세요:`, currentCount);
            if (newCount !== null && !isNaN(newCount)) {
                const count = Math.max(0, parseInt(newCount));
                element.dataset.count = count;
                const row = element.closest('tr');
                row.dataset[type === 'like' ? 'likes' : 'dislikes'] = count;
                
                const emoji = type === 'like' ? '❤️' : '👎';
                element.innerHTML = `<span style="color: ${count > 0 ? '#ef4444' : '#9ca3af'}; font-size: 14px;">${emoji} ${count}</span>`;
                
                // 새매물인 경우 자동저장
                if (row.classList.contains('new-property-row')) {
                    await autoSaveNewProperty(element);
                }
            }
        }
        
        // 기존 매물 좋아요/싫어요 편집
        async function editPropertyLikes(propertyId, field, currentCount, element) {
            console.log('🔄 좋아요/싫어요 편집 시작:', field, 'propertyId:', propertyId, 'currentCount:', currentCount);
            
            const fieldName = field === 'likes' ? '좋아요' : '싫어요';
            const newCount = prompt(`${fieldName} 수를 입력하세요:`, currentCount);
            
            if (newCount !== null && !isNaN(newCount)) {
                const count = Math.max(0, parseInt(newCount));
                element.dataset.count = count;
                
                const emoji = field === 'likes' ? '❤️' : '👎';
                element.innerHTML = `<span style="color: ${count > 0 ? '#ef4444' : '#9ca3af'}; font-size: 14px;">${emoji} ${count}</span>`;
                
                // 서버에 저장
                console.log('💾 서버 저장 시도:', { propertyId, field, count });
                try {
                    await updateAdminProperty(propertyId, field, count);
                    console.log('✅ 좋아요/싫어요 저장 성공');
                    alert(`${fieldName}가 ${count}개로 저장되었습니다.`);
                } catch (error) {
                    console.error('❌ 좋아요/싫어요 저장 실패:', error);
                    alert('저장에 실패했습니다: ' + error.message);
                }
            }
        }

        // 메모 모달 기능
        function openPropertyMemoModal(propertyId, currentMemo, building, room) {
            const newMemo = prompt(`매물 ${building}동 ${room}호 메모 편집:`, currentMemo || '');
            if (newMemo !== null) {
                // 서버에 메모 업데이트
                updatePropertyMemo(propertyId, newMemo);
            }
        }

        async function updatePropertyMemo(propertyId, memo) {
            try {
                const response = await fetch('/api/maeiple/update', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        id: propertyId,
                        field: 'memo',
                        value: memo
                    })
                });
                
                const result = await response.json();
                if (result.success) {
                    // UI만 업데이트 (순서 유지를 위해 페이지 새로고침하지 않음)
                    console.log('메모 업데이트 성공');
                        } else {
                    alert('메모 저장에 실패했습니다: ' + (result.message || result.error));
                }
            } catch (error) {
                console.error('메모 업데이트 실패:', error);
                alert('메모 저장 중 오류가 발생했습니다.');
            }
        }

        // 유틸리티 함수들
        function formatNumber(num) {
            if (!num) return '';
            return parseInt(num).toLocaleString();
        }

        function getTeamBadgeColor(team) {
            const colors = {
                '1팀': '#e0f2fe',
                '2팀': '#fef3c7', 
                '3팀': '#d1fae5',
                '4팀': '#ede9fe',
                '5팀': '#fecaca'
            };
            return colors[team] || '#f1f5f9';
        }

        function getTeamTextColor(team) {
            const colors = {
                '1팀': '#0369a1',
                '2팀': '#92400e',
                '3팀': '#065f46', 
                '4팀': '#5b21b6',
                '5팀': '#dc2626'
            };
            return colors[team] || '#64748b';
        }

        function showMaeipeError(message) {
            const tableContent = document.getElementById('maeiple-table-content');
            if (tableContent) {
                tableContent.innerHTML = `
                    <div style="text-align: center; padding: 60px 20px; color: #ef4444;">
                        <div style="font-size: 48px; margin-bottom: 16px;">⚠️</div>
                        <p>${message}</p>
                        <button onclick="loadMaeipeProperties(1)" style="margin-top: 16px; padding: 8px 16px; background: #3b82f6; color: white; border: none; border-radius: 6px; cursor: pointer;">다시 시도</button>
                    </div>
                `;
            }
        }
        
        function renderTeamMaeipeProperties() {
            const tableContent = document.getElementById('maeiple-table-content-team-leader');
            
            // 필터 적용
            let list = Array.isArray(teamProperties) ? teamProperties.slice() : [];
            
            // 현황 필터
            if (statusFilter !== 'all') {
                list = list.filter(p => (p.status || '') === statusFilter);
            }
            
            // 실거주 필터
            if (occupiedFilter !== 'all') {
                const want = occupiedFilter === 'O';
                list = list.filter(p => !!p.is_occupied === want);
            }
            
            // 거래유형 필터
            if (dealTypeFilterTeamLeader !== 'all') {
                list = list.filter(p => {
                    if (dealTypeFilterTeamLeader === '전세') {
                        const jeonsePrice = parseInt(String(p.jeonse_price || '0').replace(/[^\\d]/g, '')) || 0;
                        return jeonsePrice > 0;
                    } else if (dealTypeFilterTeamLeader === '월세') {
                        const monthlyRent = parseInt(String(p.monthly_rent || '0').replace(/[^\\d]/g, '')) || 0;
                        const monthlyDeposit = parseInt(String(p.monthly_deposit || p.deposit || '0').replace(/[^\\d]/g, '')) || 0;
                        return monthlyRent > 0 || monthlyDeposit > 0;
                    } else if (dealTypeFilterTeamLeader === '매매') {
                        const salePrice = parseInt(String(p.sale_price || '0').replace(/[^\\d]/g, '')) || 0;
                        return salePrice > 0;
                    }
                    return true;
                });
            }
            
            // 호수 검색 필터
            if (roomSearchFilterTeamLeader.trim()) {
                const searchTerm = roomSearchFilterTeamLeader.trim().toLowerCase();
                list = list.filter(p => {
                    const roomNumber = String(p.room_number || '').toLowerCase();
                    return roomNumber.includes(searchTerm);
                });
            }
            
            // 담당자 검색 필터
            if (employeeSearchFilterTeamLeader.trim()) {
                const searchTerm = employeeSearchFilterTeamLeader.trim().toLowerCase();
                list = list.filter(p => {
                    const employeeName = String(p.employee_name || '').toLowerCase();
                    return employeeName.includes(searchTerm);
                });
            }
            
            // 팀 필터
            if (teamFilterTeamLeader !== 'all') {
                list = list.filter(p => (p.employee_team || '') === teamFilterTeamLeader);
            }
            
            let tableHTML = `
                <table class="employees-table">
                    <thead>
                        <tr>
                            <th>
                                <div style="display: flex; align-items: center; gap: 4px; cursor: pointer; user-select: none;" onclick="toggleTeamSort('check_date')">
                                    확인날짜
                                    <span style="font-size: 12px; color: #9ca3af;">${currentTeamSortBy === 'check_date' ? (currentTeamSortOrder === 'desc' ? '▼' : '▲') : '↕️'}</span>
                                </div>
                            </th>
                            <th>동</th>
                            <th>호수</th>
                            <th>현황</th>
                            <th>전세 (만원)</th>
                            <th>월세보증금 (만원)</th>
                            <th>월세 (만원)</th>
                            <th>매매 (만원)</th>
                            <th>실거주 여부</th>
                            <th>전화번호</th>
                            <th>특이사항</th>
                            <th>좋아요</th>
                            <th>싫어요</th>
                        </tr>
                    </thead>
                    <tbody>
            `;

            if (list.length === 0) {
                tableHTML += `
                    <tr>
                        <td colspan="13" style="text-align: center; padding: 60px 20px; color: #64748b;">
                            <div style="font-size: 48px; margin-bottom: 16px; opacity: 0.5;">🏠</div>
                            <p>조건에 맞는 개인 매물이 없습니다.</p>
                            <p>필터를 변경하거나 새로운 개인 매물을 추가해보세요.</p>
                        </td>
                    </tr>
                `;
                    } else {
                list.forEach(property => {
                tableHTML += `
                    <tr data-property-id="${property.id}">
                        <td style="cursor: pointer;" onclick="editTeamDate(${property.id}, '${property.check_date || ''}', this)">${property.check_date || '-'}</td>
                        <td style="cursor: pointer;" onclick="editTeamNumber(${property.id}, 'building_number', '${property.building_number || ''}', this)">${property.building_number || '-'}</td>
                        <td style="cursor: pointer;" onclick="editTeamNumber(${property.id}, 'room_number', '${property.room_number || ''}', this)">${property.room_number || '-'}</td>
                        <td>
                            <button style="padding: 6px 12px; border: none; border-radius: 6px; font-size: 12px; font-weight: 500; cursor: pointer; ${property.status === '계약완료' ? 'background: #d1fae5; color: #065f46;' : property.status === '보류' ? 'background: #fef3c7; color: #92400e;' : property.status === '부재' ? 'background: #ede9fe; color: #5b21b6;' : 'background: #e0f2fe; color: #0369a1;'}" 
                                    onclick="showTeamStatusOptions(${property.id}, '${property.status || '거래가능'}', this)">
                                ${property.status || '거래가능'}
                            </button>
                        </td>
                        <td style="cursor: pointer; color: #2563eb; font-weight: 500;" onclick="editTeamPrice(${property.id}, 'jeonse_price', '${property.jeonse_price || ''}', this)">
                            ${property.jeonse_price ? formatNumber(property.jeonse_price) + ' 만원' : '-'}
                        </td>
                        <td style="cursor: pointer; color: #2563eb; font-weight: 500;" onclick="editTeamPrice(${property.id}, 'monthly_deposit', '${property.monthly_deposit || property.deposit || ''}', this)">
                            ${property.monthly_deposit || property.deposit ? formatNumber(property.monthly_deposit || property.deposit) + ' 만원' : '-'}
                        </td>
                        <td style="cursor: pointer; color: #2563eb; font-weight: 500;" onclick="editTeamPrice(${property.id}, 'monthly_rent', '${property.monthly_rent || ''}', this)">
                            ${property.monthly_rent ? formatNumber(property.monthly_rent) + ' 만원' : '-'}
                        </td>
                        <td style="cursor: pointer; color: #2563eb; font-weight: 500;" onclick="editTeamPrice(${property.id}, 'sale_price', '${property.sale_price || ''}', this)">
                            ${property.sale_price ? formatNumber(property.sale_price) + ' 만원' : '-'}
                        </td>
                        <td>
                            <button style="background: none; border: none; cursor: pointer; font-size: 18px; padding: 4px; border-radius: 4px; color: ${property.is_occupied ? '#059669' : '#dc2626'};" 
                                    onclick="toggleTeamOccupied(${property.id}, ${property.is_occupied})">
                                ${property.is_occupied ? 'O' : 'X'}
                            </button>
                        </td>
                        <td style="cursor: pointer; font-family: monospace; letter-spacing: 0.5px; max-width: 120px; overflow: hidden; text-overflow: ellipsis;" onclick="editTeamPhone(${property.id}, '${property.phone || ''}', this)">
                            ${property.phone || '-'}
                        </td>
                        <td class="memo-cell" onclick="editTeamMemo(${property.id}, '${(property.memo || '').replace(/'/g, "\\'")}', this)" style="color: #64748b; font-style: italic; max-width: 150px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; cursor: pointer;">
                            ${property.memo ? (property.memo.length > 20 ? property.memo.substring(0, 20) + '...' : property.memo) : '클릭하여 메모 추가'}
                        </td>
                        <td>
                            <div style="cursor: pointer; user-select: none; display: flex; align-items: center; justify-content: center; gap: 2px;" onclick="openLikesModal(${property.id}, 'likes', ${property.likes || 0}, this)" data-count="${property.likes || 0}">
                                <span style="color: ${(property.likes || 0) > 0 ? '#ef4444' : '#9ca3af'}; font-size: 14px;">❤️ ${property.likes || 0}</span>
                            </div>
                        </td>
                        <td>
                            <div style="cursor: pointer; user-select: none; display: flex; align-items: center; justify-content: center; gap: 2px;" onclick="openLikesModal(${property.id}, 'dislikes', ${property.dislikes || 0}, this)" data-count="${property.dislikes || 0}">
                                <span style="color: ${(property.dislikes || 0) > 0 ? '#ef4444' : '#9ca3af'}; font-size: 14px;">👎 ${property.dislikes || 0}</span>
                            </div>
                        </td>
                    </tr>
                `;
                });
            }
            
            tableHTML += `
                    </tbody>
                </table>
            `;
            
            tableContent.innerHTML = tableHTML;
        }
        
        function renderMaeipePagination() {
            const pagination = document.getElementById('maeiple-pagination');
            if (!pagination || maeipleTotalPages <= 1) {
                if (pagination) pagination.innerHTML = '';
                return;
            }
            
            let paginationHTML = '';
            
            // 이전 페이지 버튼
            if (currentMaeiplePage > 1) {
                paginationHTML += `<button class="btn btn-outline-primary btn-sm" onclick="loadMaeipeProperties(${currentMaeiplePage - 1})" style="margin-right: 5px;">‹ 이전</button>`;
            }
            
            // 페이지 번호 버튼들
            const startPage = Math.max(1, currentMaeiplePage - 2);
            const endPage = Math.min(maeipleTotalPages, currentMaeiplePage + 2);
            
            for (let i = startPage; i <= endPage; i++) {
                const isActive = i === currentMaeiplePage;
                paginationHTML += `
                    <button class="btn ${isActive ? 'btn-primary' : 'btn-outline-primary'} btn-sm" 
                            onclick="loadMaeipeProperties(${i})" 
                            style="margin: 0 2px; ${isActive ? 'font-weight: bold;' : ''}">
                        ${i}
                    </button>
                `;
            }
            
            // 다음 페이지 버튼
            if (currentMaeiplePage < maeipleTotalPages) {
                paginationHTML += `<button class="btn btn-outline-primary btn-sm" onclick="loadMaeipeProperties(${currentMaeiplePage + 1})" style="margin-left: 5px;">다음 ›</button>`;
            }
            
            // 페이지 정보
            paginationHTML += `<span style="margin-left: 15px; color: #64748b; font-size: 14px;">${currentMaeiplePage} / ${maeipleTotalPages} 페이지</span>`;
            
            pagination.innerHTML = paginationHTML;
        }
        
        function renderTeamMaeipePagination() {
            const pagination = document.getElementById('maeiple-pagination-team-leader');
            if (!pagination || teamMaeipleTotalPages <= 1) {
                if (pagination) pagination.innerHTML = '';
                return;
            }
            
            let paginationHTML = '';
            
            // 이전 페이지 버튼
            if (currentTeamMaeiplePage > 1) {
                paginationHTML += `<button class="btn btn-outline-primary btn-sm" onclick="loadMaeipePropertiesTeamLeader(${currentTeamMaeiplePage - 1})" style="margin-right: 5px;">‹ 이전</button>`;
            }
            
            // 페이지 번호 버튼들
            const startPage = Math.max(1, currentTeamMaeiplePage - 2);
            const endPage = Math.min(teamMaeipleTotalPages, currentTeamMaeiplePage + 2);
            
            for (let i = startPage; i <= endPage; i++) {
                const isActive = i === currentTeamMaeiplePage;
                paginationHTML += `
                    <button class="btn ${isActive ? 'btn-primary' : 'btn-outline-primary'} btn-sm" 
                            onclick="loadMaeipePropertiesTeamLeader(${i})" 
                            style="margin: 0 2px; ${isActive ? 'font-weight: bold;' : ''}">
                        ${i}
                    </button>
                `;
            }
            
            // 다음 페이지 버튼
            if (currentTeamMaeiplePage < teamMaeipleTotalPages) {
                paginationHTML += `<button class="btn btn-outline-primary btn-sm" onclick="loadMaeipePropertiesTeamLeader(${currentTeamMaeiplePage + 1})" style="margin-left: 5px;">다음 ›</button>`;
            }
            
            // 페이지 정보
            paginationHTML += `<span style="margin-left: 15px; color: #64748b; font-size: 14px;">${currentTeamMaeiplePage} / ${teamMaeipleTotalPages} 페이지</span>`;
            
            pagination.innerHTML = paginationHTML;
        }
        
        function updateAdminFilters() {
            // 팀 필터 업데이트 (팀장은 자신의 팀만 표시)
            updateTeamFilter();
            // 팀장: 자신의 팀 외 버튼 비활성화
            const currentTeam = '{{ employee_team }}';
            const buttons = document.querySelectorAll('#team-filter-group-admin .filter-btn');
            buttons.forEach(btn => {
                const value = btn.getAttribute('data-value');
                if (value && value !== 'all' && value !== currentTeam) {
                    btn.disabled = true;
                    btn.style.opacity = '0.5';
                    btn.style.cursor = 'not-allowed';
                }
            });
        }
        
        function updateTeamLeaderFilters() {
            // 팀장용 필터 업데이트 (팀장메이플관리 탭)
            updateTeamLeaderFilter();
        }
        
        // 팀 필터 업데이트 (아파트목록 탭용)
        function updateTeamFilter() {
            const filterGroup = document.getElementById('team-filter-group-admin');
            const filterButtons = filterGroup.querySelector('.filter-buttons');
            
            // 현재 팀장의 팀 정보만 표시
            const teams = [...new Set(properties.map(p => p.employee_team).filter(Boolean))];
            
            filterButtons.innerHTML = '<button class="filter-btn active" data-value="all" onclick="setTeamFilterAdmin(\'all\', this)">전체</button>';
            
            teams.forEach(team => {
                const button = document.createElement('button');
                button.className = 'filter-btn';
                button.setAttribute('data-value', team);
                button.onclick = () => setTeamFilterAdmin(team, button);
                button.textContent = team;
                filterButtons.appendChild(button);
            });
            // 기본값: 자신의 팀으로 필터 적용
            const currentTeam = '{{ employee_team }}';
            const selfTeamButton = Array.from(filterButtons.querySelectorAll('.filter-btn')).find(b => b.getAttribute('data-value') === currentTeam);
            if (selfTeamButton) {
                setTeamFilterAdmin(currentTeam, selfTeamButton);
            }
        }
        
        // 팀장용 팀 필터 업데이트 (팀장메이플관리 탭용)
        function updateTeamLeaderFilter() {
            const filterGroup = document.getElementById('team-filter-group-team-leader');
            const filterButtons = filterGroup.querySelector('.filter-buttons');
            
            // 현재 팀장의 팀 정보만 표시
            const teams = [...new Set(teamProperties.map(p => p.employee_team).filter(Boolean))];
            
            filterButtons.innerHTML = '<button class="filter-btn active" data-value="all" onclick="setTeamFilterTeamLeader(\'all\', this)">전체</button>';
            
            teams.forEach(team => {
                const button = document.createElement('button');
                button.className = 'filter-btn';
                button.setAttribute('data-value', team);
                button.onclick = () => setTeamFilterTeamLeader(team, button);
                button.textContent = team;
                filterButtons.appendChild(button);
            });
        }
        
        function showMaeipeError(message) {
            const content = document.getElementById('maeiple-table-content');
            content.innerHTML = `<div style="padding: 40px; text-align: center; color: #ef4444;">${message}</div>`;
        }
        
        function showTeamMaeipeError(message) {
            const content = document.getElementById('maeiple-table-content-team-leader');
            content.innerHTML = `<div style="padding: 40px; text-align: center; color: #ef4444;">${message}</div>`;
        }
        
        // 팀장 개인 매물 추가 함수 (개인매물관리 탭용)
        function addNewPersonalPropertyRow() {
            console.log('🔄 팀장 개인 매물 추가 시작...');
            
            const tbody = document.querySelector('#maeiple-table-content-team-leader table tbody');
            if (!tbody) {
                console.error('❌ 개인매물 테이블 tbody를 찾을 수 없습니다.');
                alert('테이블을 찾을 수 없습니다. 개인매물관리 탭이 제대로 로드되지 않았습니다.');
                return;
            }
            
            console.log('팀장 테이블 tbody 찾음:', tbody);
            
            // 현재 날짜를 기본값으로 설정
            const now = new Date();
            now.setHours(now.getHours() + 9);
            const today = now.toISOString().slice(0, 10);
            
            const newRow = document.createElement('tr');
            newRow.className = 'new-team-property-row';
            newRow.innerHTML = `
                <td style="cursor: pointer;" onclick="editTeamDate('new', '${today}', this)">${today}</td>
                <td style="cursor: pointer;" onclick="editTeamNumber('new', 'building_number', '', this)"></td>
                <td style="cursor: pointer;" onclick="editTeamNumber('new', 'room_number', '', this)"></td>
                <td>
                    <button style="padding: 6px 12px; border: none; border-radius: 6px; font-size: 12px; font-weight: 500; cursor: pointer; background: #e0f2fe; color: #0369a1;" 
                            onclick="showTeamStatusOptions('new', '거래가능', this)">
                        거래가능
                    </button>
                </td>
                <td style="cursor: pointer; color: #2563eb; font-weight: 500;" onclick="editTeamPrice('new', 'jeonse_price', '', this)">-</td>
                <td style="cursor: pointer; color: #2563eb; font-weight: 500;" onclick="editTeamPrice('new', 'monthly_deposit', '', this)">-</td>
                <td style="cursor: pointer; color: #2563eb; font-weight: 500;" onclick="editTeamPrice('new', 'monthly_rent', '', this)">-</td>
                <td style="cursor: pointer; color: #2563eb; font-weight: 500;" onclick="editTeamPrice('new', 'sale_price', '', this)">-</td>
                <td>
                    <button style="background: none; border: none; cursor: pointer; font-size: 18px; padding: 4px; border-radius: 4px; color: #dc2626;" 
                            onclick="toggleTeamOccupied('new', false)">
                        X
                    </button>
                </td>
                <td style="cursor: pointer; font-family: monospace; letter-spacing: 0.5px;" onclick="editTeamPhone('new', '', this)">-</td>
                <td style="cursor: pointer; font-size: 12px; color: #64748b;" onclick="editTeamMemo('new', '', this)">클릭하여 메모 추가</td>
                <td>
                    <div style="cursor: pointer; user-select: none; display: flex; align-items: center; justify-content: center; gap: 2px;" onclick="openLikesModal('new', 'likes', 0, this)" data-count="0">
                        <span style="color: #9ca3af; font-size: 14px;">❤️ 0</span>
                    </div>
                </td>
                <td>
                    <div style="cursor: pointer; user-select: none; display: flex; align-items: center; justify-content: center; gap: 2px;" onclick="openLikesModal('new', 'dislikes', 0, this)" data-count="0">
                        <span style="color: #9ca3af; font-size: 14px;">👎 0</span>
                    </div>
                </td>
            `;
            
            tbody.insertBefore(newRow, tbody.firstChild);
            console.log('새 팀장 매물 행이 테이블에 추가됨');
            
            console.log('새 팀장 매물 행 추가 완료 - 원하는 셀을 클릭하여 편집하세요');
            alert('새 매물 행이 추가되었습니다. 셀을 편집하면 자동으로 저장됩니다.');
        }

        // 팀장용 매물 자동저장 함수
        async function autoSaveNewTeamProperty(cell) {
            const row = cell.closest('tr');
            if (!row || !row.classList.contains('new-team-property-row')) {
                return; // 새 매물 행이 아니면 저장하지 않음
            }
            
            console.log('🔄 팀장 새 매물 자동저장 시작...');
            
            // 행의 모든 데이터 수집
            const cells = row.cells;
            const currentEmployeeName = '{{ employee_name }}';
            const newProperty = {
                check_date: cells[0].textContent.trim(),
                building_number: cells[1].textContent.trim(),
                room_number: cells[2].textContent.trim(),
                status: cells[3].querySelector('button').textContent.trim(),
                jeonse_price: extractNumber(cells[4].textContent),
                monthly_deposit: extractNumber(cells[5].textContent),
                monthly_rent: extractNumber(cells[6].textContent),
                sale_price: extractNumber(cells[7].textContent),
                is_occupied: cells[8].querySelector('button').textContent.trim() === 'O',
                phone: cells[9].textContent.trim() === '-' ? '' : cells[9].textContent.trim(),
                memo: cells[10].textContent.trim() === '클릭하여 메모 추가' ? '' : cells[10].textContent.trim(),
                employee_name: currentEmployeeName
            };
            
            console.log('팀장 새 매물 저장 데이터:', newProperty);
            
            try {
                const response = await fetch('/api/maeiple', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(newProperty)
                });
                
                if (!response.ok) {
                    const errorText = await response.text();
                    throw new Error(`HTTP ${response.status}: ${errorText}`);
                }
                
                const result = await response.json();
                
                if (result && result.success === true) {
                    console.log('✅ 팀장 새 매물 자동저장 성공:', result);
                    
                    // 성공적으로 저장된 경우 새 행을 제거하고 팀장 테이블에 추가
                    if (result.created_property) {
                        await addNewTeamPropertyToTable(result.created_property);
                        row.remove();
                        
                        // 성공 메시지 표시
                        alert('매물이 자동으로 저장되었습니다.');
                    }
                } else {
                    const errorMsg = result?.error || result?.message || '자동저장에 실패했습니다.';
                    console.warn('팀장 자동저장 실패:', errorMsg);
                }
                
            } catch (error) {
                console.error('팀장 매물 자동저장 오류:', error);
                // 오류가 발생해도 사용자에게는 알리지 않음 (자동저장이므로)
            }
        }

        // 새로 추가된 팀장 매물을 테이블에 즉시 표시
        async function addNewTeamPropertyToTable(property) {
            console.log('🔄 새 팀장 매물을 테이블에 즉시 추가:', property);
            
            const tbody = document.querySelector('#maeiple-table-content-team-leader table tbody');
            if (!tbody) {
                console.error('팀장 매물 테이블 tbody를 찾을 수 없습니다.');
                return;
            }
            
            // 새 행 생성
            const newRow = document.createElement('tr');
            newRow.className = 'property-row';
            newRow.dataset.propertyId = property.id;
            
            // 상태에 따른 배지 색상 설정
            const statusBadge = getTeamStatusBadge(property.status);
            const occupiedBadge = getTeamOccupiedBadge(property.is_occupied);
            
            newRow.innerHTML = `
                <td style="cursor: pointer;" onclick="editTeamDate(${property.id}, '${property.check_date || ''}', this)">${property.check_date || ''}</td>
                <td style="cursor: pointer;" onclick="editTeamNumber(${property.id}, 'building_number', '${property.building_number || ''}', this)">${property.building_number || ''}</td>
                <td style="cursor: pointer;" onclick="editTeamNumber(${property.id}, 'room_number', '${property.room_number || ''}', this)">${property.room_number || ''}</td>
                <td>
                    <button style="${statusBadge}" 
                            onclick="showTeamStatusOptions(${property.id}, '${property.status || '거래가능'}', this)">
                        ${property.status || '거래가능'}
                    </button>
                </td>
                <td style="cursor: pointer; color: #2563eb; font-weight: 500;" onclick="editTeamPrice(${property.id}, 'jeonse_price', '${property.jeonse_price || ''}', this)">
                    ${property.jeonse_price ? formatNumber(property.jeonse_price) + ' 만원' : '-'}
                </td>
                <td style="cursor: pointer; color: #2563eb; font-weight: 500;" onclick="editTeamPrice(${property.id}, 'monthly_deposit', '${property.monthly_deposit || ''}', this)">
                    ${property.monthly_deposit ? formatNumber(property.monthly_deposit) + ' 만원' : '-'}
                </td>
                <td style="cursor: pointer; color: #2563eb; font-weight: 500;" onclick="editTeamPrice(${property.id}, 'monthly_rent', '${property.monthly_rent || ''}', this)">
                    ${property.monthly_rent ? formatNumber(property.monthly_rent) + ' 만원' : '-'}
                </td>
                <td style="cursor: pointer; color: #2563eb; font-weight: 500;" onclick="editTeamPrice(${property.id}, 'sale_price', '${property.sale_price || ''}', this)">
                    ${property.sale_price ? formatNumber(property.sale_price) + ' 만원' : '-'}
                </td>
                <td>
                    <button style="${occupiedBadge}" 
                            onclick="toggleTeamOccupied(${property.id}, ${property.is_occupied})">
                        ${property.is_occupied ? 'O' : 'X'}
                    </button>
                </td>
                <td style="cursor: pointer; font-family: monospace; letter-spacing: 0.5px;" onclick="editTeamPhone(${property.id}, '${property.phone || ''}', this)">
                    ${property.phone ? formatPhoneNumber(property.phone) : '-'}
                </td>
                <td style="cursor: pointer; font-size: 12px; color: #64748b;" onclick="editTeamMemo(${property.id}, '${property.memo || ''}', this)">
                    ${property.memo || '클릭하여 메모 추가'}
                </td>
                <td>
                    <div style="cursor: pointer; user-select: none; display: flex; align-items: center; justify-content: center; gap: 2px;" onclick="openLikesModal(${property.id}, 'likes', ${property.likes || 0}, this)" data-count="${property.likes || 0}">
                        <span style="color: ${(property.likes || 0) > 0 ? '#ef4444' : '#9ca3af'}; font-size: 14px;">❤️ ${property.likes || 0}</span>
                    </div>
                </td>
                <td>
                    <div style="cursor: pointer; user-select: none; display: flex; align-items: center; justify-content: center; gap: 2px;" onclick="openLikesModal(${property.id}, 'dislikes', ${property.dislikes || 0}, this)" data-count="${property.dislikes || 0}">
                        <span style="color: ${(property.dislikes || 0) > 0 ? '#ef4444' : '#9ca3af'}; font-size: 14px;">👎 ${property.dislikes || 0}</span>
                    </div>
                </td>
            `;
            
            tbody.insertBefore(newRow, tbody.firstChild);
            
            // 새로 추가된 행에 하이라이트 효과 적용
            newRow.style.backgroundColor = '#f0f9ff';
            newRow.style.transition = 'background-color 0.5s ease';
            
            setTimeout(() => {
                newRow.style.backgroundColor = '';
            }, 2000);
            
            console.log('✅ 새 팀장 매물이 테이블에 즉시 추가됨');
        }

        // 유틸리티 함수들 (관리자 패널에서 이식)
        function formatNumber(num) {
            if (!num) return '';
            return num.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ',');
        }
        
        function getTeamBadgeColor(team) {
            const colors = {
                '빈시트': '#e0f2fe',
                '팀A': '#fef3c7', 
                '팀B': '#e0e7ff',
                '팀C': '#f0fdf4',
                '팀D': '#fce7f3'
            };
            return colors[team] || '#f1f5f9';
        }
        
        function getTeamTextColor(team) {
            const colors = {
                '빈시트': '#0369a1',
                '팀A': '#92400e',
                '팀B': '#3730a3', 
                '팀C': '#166534',
                '팀D': '#be185d'
            };
            return colors[team] || '#64748b';
        }
        
        // 팀장용 매물 수정 기능들
        
        // 팀장용 날짜 편집
        function editTeamDate(propertyId, currentDate, cell) {
            if (cell.querySelector('input')) return; // 이미 편집 중이면 리턴
            
            const input = document.createElement('input');
            input.type = 'date';
            input.value = currentDate;
            input.className = 'team-edit-input';
            input.style.cssText = 'width: 100%; padding: 4px; border: 1px solid #ccc; border-radius: 4px;';

                cell.innerHTML = '';
                cell.appendChild(input);
                input.focus();
                
            input.onblur = async function() {
                const newValue = input.value;
                cell.textContent = newValue;
                
                if (propertyId === 'new') {
                    // 새 매물의 경우 자동저장 시도
                    await autoSaveNewTeamProperty(cell);
                } else {
                    // 기존 매물 업데이트
                    await updateTeamProperty(propertyId, 'check_date', newValue);
                }
            };
            
            input.onkeypress = function(e) {
                if (e.key === 'Enter') {
                    e.preventDefault();
                    input.blur();
                    // 다음 편집 가능한 셀로 이동
                    const nextCell = cell.nextElementSibling;
                    if (nextCell && nextCell.onclick) {
                        nextCell.click();
                    }
                }
            };
        }
        
        // 팀장용 호수/동 번호 편집
        function editTeamNumber(propertyId, field, currentValue, cell) {
            if (cell.querySelector('input')) return;
            
            const input = document.createElement('input');
            input.type = 'text';
            input.value = currentValue;
            input.className = 'team-edit-input';
            input.style.cssText = 'width: 100%; padding: 4px; border: 1px solid #ccc; border-radius: 4px;';
            input.placeholder = field === 'building_number' ? '동 번호' : '호수';
            
            cell.innerHTML = '';
            cell.appendChild(input);
            input.focus();
            
            input.onblur = async function() {
                const newValue = input.value;
                cell.textContent = newValue;
                
                if (propertyId === 'new') {
                    await autoSaveNewTeamProperty(cell);
                } else {
                    await updateTeamProperty(propertyId, field, newValue);
                }
            };
            
            input.onkeypress = function(e) {
                if (e.key === 'Enter') {
                    e.preventDefault();
                    input.blur();
                    // 다음 편집 가능한 셀로 이동
                    const nextCell = cell.nextElementSibling;
                    if (nextCell && nextCell.onclick) {
                        nextCell.click();
                    }
                }
            };
        }
        
        // 팀장용 가격 편집
        function editTeamPrice(propertyId, field, currentValue, cell) {
            if (cell.querySelector('input')) return;
            
            const input = document.createElement('input');
            input.type = 'text';
            input.value = extractNumber(currentValue) || '';
            input.className = 'team-edit-input';
            input.style.cssText = 'width: 100%; padding: 4px; border: 1px solid #ccc; border-radius: 4px;';
            input.placeholder = '가격 (만원)';
            
            cell.innerHTML = '';
            cell.appendChild(input);
            input.focus();
            
            input.onblur = async function() {
                const newValue = input.value;
                const displayValue = newValue ? formatNumber(newValue) + ' 만원' : '-';
                cell.innerHTML = `<span style="cursor: pointer; color: #2563eb; font-weight: 500;">${displayValue}</span>`;
                
                if (propertyId === 'new') {
                    await autoSaveNewTeamProperty(cell);
                } else {
                    await updateTeamProperty(propertyId, field, newValue);
                }
            };
            
            input.onkeypress = function(e) {
                if (e.key === 'Enter') {
                    e.preventDefault();
                    input.blur();
                    // 다음 편집 가능한 셀로 이동
                    const nextCell = cell.nextElementSibling;
                    if (nextCell && nextCell.onclick) {
                        nextCell.click();
                    }
                }
            };
        }
        
        // 팀장용 전화번호 편집
        function editTeamPhone(propertyId, currentValue, cell) {
            if (cell.querySelector('input')) return;
            
            const input = document.createElement('input');
            input.type = 'tel';
            input.value = currentValue === '-' ? '' : currentValue;
            input.className = 'team-edit-input';
            input.style.cssText = 'width: 100%; padding: 4px; border: 1px solid #ccc; border-radius: 4px; font-family: monospace;';
            input.placeholder = '전화번호';
            
            cell.innerHTML = '';
            cell.appendChild(input);
            input.focus();
            
            input.onblur = async function() {
                const newValue = input.value || '-';
                cell.textContent = newValue === '-' ? '-' : formatPhoneNumber(newValue);
                
                if (propertyId === 'new') {
                    await autoSaveNewTeamProperty(cell);
                } else {
                    await updateTeamProperty(propertyId, 'phone', newValue === '-' ? '' : newValue);
                }
            };
            
            input.onkeypress = function(e) {
                if (e.key === 'Enter') {
                    e.preventDefault();
                    input.blur();
                    // 다음 편집 가능한 셀로 이동
                    const nextCell = cell.nextElementSibling;
                    if (nextCell && nextCell.onclick) {
                        nextCell.click();
                    }
                }
            };
        }
        
        // 팀장용 메모 편집 (모달 방식)
        function editTeamMemo(propertyId, currentValue, cell) {
            // 매물 정보 추출
            const row = cell.closest('tr');
            const buildingCell = row.cells[1]; // 동 번호 (팀장메이플관리 탭은 체크박스가 없으므로 인덱스 1)
            const roomCell = row.cells[2]; // 호수
            const buildingNumber = buildingCell ? buildingCell.textContent.trim() : '';
            const roomNumber = roomCell ? roomCell.textContent.trim() : '';
            
            if (propertyId === 'new') {
                // 새 매물인 경우 새 매물 모달 함수 사용
                openNewPropertyMemoModal(cell);
            } else {
                // 기존 매물인 경우 기존 매물 모달 함수 사용
                openPropertyMemoModal(propertyId, currentValue, buildingNumber, roomNumber);
            }
        }
        
        // 팀장용 상태 변경
        function showTeamStatusOptions(propertyId, currentStatus, button) {
            const options = ['거래가능', '계약완료', '보류', '부재'];
            
            // 기존 옵션 메뉴가 있다면 제거
            const existingMenu = document.querySelector('.team-status-menu');
            if (existingMenu) {
                existingMenu.remove();
                return;
            }
            
            const menu = document.createElement('div');
            menu.className = 'team-status-menu';
            menu.style.cssText = `
                position: absolute;
                background: white;
                border: 1px solid #e2e8f0;
                border-radius: 6px;
                box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
                z-index: 1000;
                min-width: 100px;
            `;
            
            options.forEach(status => {
                const option = document.createElement('button');
                option.textContent = status;
                option.style.cssText = `
                    width: 100%;
                    padding: 8px 12px;
                    border: none;
                    background: ${status === currentStatus ? '#f1f5f9' : 'transparent'};
                    text-align: left;
                    cursor: pointer;
                    font-size: 12px;
                `;
                
                option.onmouseenter = () => option.style.background = '#f1f5f9';
                option.onmouseleave = () => option.style.background = status === currentStatus ? '#f1f5f9' : 'transparent';
                
                option.onclick = async () => {
                    button.textContent = status;
                    button.style.cssText = getTeamStatusBadge(status);
                    menu.remove();
                    
                    if (propertyId === 'new') {
                        await autoSaveNewTeamProperty(button.closest('td'));
                    } else {
                        await updateTeamProperty(propertyId, 'status', status);
                    }
                };
                
                menu.appendChild(option);
            });
            
            // 메뉴 위치 설정
            const rect = button.getBoundingClientRect();
            menu.style.left = rect.left + 'px';
            menu.style.top = (rect.bottom + window.scrollY) + 'px';
            
            document.body.appendChild(menu);
            
            // 외부 클릭 시 메뉴 닫기
            setTimeout(() => {
                document.addEventListener('click', function closeMenu(e) {
                    if (!menu.contains(e.target)) {
                        menu.remove();
                        document.removeEventListener('click', closeMenu);
                    }
                });
            }, 0);
        }
        
        // 팀장용 거주 상태 토글
        async function toggleTeamOccupied(propertyId, currentState) {
            const newState = !currentState;
            
            // UI 즉시 업데이트
            const button = event.target;
            button.textContent = newState ? 'O' : 'X';
            button.style.cssText = getTeamOccupiedBadge(newState);
            
            if (propertyId === 'new') {
                await autoSaveNewTeamProperty(button.closest('td'));
            } else {
                await updateTeamProperty(propertyId, 'is_occupied', newState);
            }
        }
        
        // 팀장용 매물 업데이트 (관리자와 동일한 방식)
        async function updateTeamProperty(propertyId, field, value) {
            console.log('🔄 updateTeamProperty 호출:', { propertyId, field, value });
            try {
                const requestData = {
                    id: propertyId,
                    field: field,
                    value: value
                };
                console.log('📤 팀장 API 요청 데이터:', requestData);
                
                const response = await fetch('/api/maeiple/update', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(requestData)
                });
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}`);
                }
                
                const result = await response.json();
                
                if (!result.success) {
                    throw new Error(result.error || '업데이트 실패');
                }
                
                console.log('팀장 매물 업데이트 성공:', field, value);
                
                // 로컬 데이터도 업데이트하여 순서 유지
                const teamProperty = teamProperties.find(p => p.id === propertyId);
                if (teamProperty) {
                    teamProperty[field] = value;
                }
                
            } catch (error) {
                console.error('팀장 매물 업데이트 실패:', error);
                alert('수정 중 오류가 발생했습니다.');
            }
        }
        
        // 팀장용 상태 배지 생성
        function getTeamStatusBadge(status) {
            const styles = {
                '거래가능': 'padding: 6px 12px; border: none; border-radius: 6px; font-size: 12px; font-weight: 500; cursor: pointer; background: #e0f2fe; color: #0369a1;',
                '거래중': 'padding: 6px 12px; border: none; border-radius: 6px; font-size: 12px; font-weight: 500; cursor: pointer; background: #fef3c7; color: #92400e;',
                '계약완료': 'padding: 6px 12px; border: none; border-radius: 6px; font-size: 12px; font-weight: 500; cursor: pointer; background: #d1fae5; color: #065f46;',
                '보류': 'padding: 6px 12px; border: none; border-radius: 6px; font-size: 12px; font-weight: 500; cursor: pointer; background: #fecaca; color: #dc2626;',
                '부재': 'padding: 6px 12px; border: none; border-radius: 6px; font-size: 12px; font-weight: 500; cursor: pointer; background: #ede9fe; color: #5b21b6;'
            };
            return styles[status] || styles['거래가능'];
        }
        
        // 팀장용 거주 상태 배지 생성
        function getTeamOccupiedBadge(isOccupied) {
            return `background: none; border: none; cursor: pointer; font-size: 18px; padding: 4px; border-radius: 4px; color: ${isOccupied ? '#059669' : '#dc2626'};`;
        }
        
        // 숫자 추출 헬퍼 함수
        function extractNumber(text) {
            if (!text) return '';
            return text.toString().replace(/[^\d]/g, '');
        }
        
        // 정렬 기능
        async function toggleSort(field) {
            if (currentSortBy === field) {
                currentSortOrder = currentSortOrder === 'desc' ? 'asc' : 'desc';
            } else {
                currentSortBy = field;
                currentSortOrder = 'desc';
            }
            await loadMaeipeProperties(currentMaeiplePage);
        }

        // 팀장 개인매물관리 정렬 토글 함수
        async function toggleTeamSort(field) {
            if (currentTeamSortBy === field) {
                currentTeamSortOrder = currentTeamSortOrder === 'desc' ? 'asc' : 'desc';
            } else {
                currentTeamSortBy = field;
                currentTeamSortOrder = 'desc';
            }
            await loadMaeipePropertiesTeamLeader(currentTeamMaeiplePage);
        }

        // ==================== 좋아요/싫어요 모달 관련 함수들 ====================
        
        // 좋아요/싫어요 모달 열기
        function openLikesModal(propertyId, type, currentCount, element) {
            const modal = document.getElementById('likes-modal');
            const title = document.getElementById('likes-modal-title');
            const propertyInfo = document.getElementById('likes-property-info');
            const inputLabel = document.getElementById('likes-input-label');
            const input = document.getElementById('likes-input');
            
            // 매물 정보 추출
            const row = element.closest('tr');
            const buildingCell = row.cells[2]; // 동 번호
            const roomCell = row.cells[3]; // 호수
            const buildingNumber = buildingCell ? buildingCell.textContent.trim() : '';
            const roomNumber = roomCell ? roomCell.textContent.trim() : '';
            const propertyDisplay = `${buildingNumber || '동'}${roomNumber ? '-' + roomNumber + '호' : ''}`;
            
            // 모달 내용 설정
            const isLikes = type === 'likes';
            title.textContent = isLikes ? '❤️ 좋아요 편집' : '👎 싫어요 편집';
            propertyInfo.textContent = propertyDisplay;
            inputLabel.textContent = isLikes ? '좋아요 수:' : '싫어요 수:';
            input.value = currentCount || 0;
            
            // 모달 표시
            modal.classList.add('active');
            
            // 포커스 설정 및 키보드 이벤트
            setTimeout(() => {
                input.focus();
                    input.select();
            }, 100);
            
            // Enter 키로 저장
            input.addEventListener('keydown', function(e) {
                if (e.key === 'Enter') {
                    e.preventDefault();
                    saveLikes();
                } else if (e.key === 'Escape') {
                    e.preventDefault();
                    closeLikesModal();
                }
            });
            
            // 전역 변수에 현재 편집 중인 정보 저장
            window.currentLikesEdit = {
                propertyId: propertyId,
                type: type,
                element: element
            };
        }
        
        // 좋아요/싫어요 모달 닫기
        function closeLikesModal() {
            const modal = document.getElementById('likes-modal');
            modal.classList.remove('active');
            window.currentLikesEdit = null;
        }
        
        // 좋아요/싫어요 저장
        async function saveLikes() {
            const input = document.getElementById('likes-input');
            const count = parseInt(input.value) || 0;
            
            if (!window.currentLikesEdit) {
                alert('오류: 편집 정보를 찾을 수 없습니다.');
                return;
            }
            
            const { propertyId, type, element } = window.currentLikesEdit;
            
            try {
                // 새 매물인 경우
                if (propertyId === 'new') {
                    // UI 즉시 업데이트
                    const emoji = type === 'likes' ? '❤️' : '👎';
                    element.dataset.count = count;
                    element.innerHTML = `<span style="color: ${count > 0 ? '#ef4444' : '#9ca3af'}; font-size: 14px;">${emoji} ${count}</span>`;
                    
                    // 새 매물 행에 데이터 저장
                    const row = element.closest('tr');
                    row.dataset[type] = count;
                    
                    // 자동저장 실행
                    if (row.classList.contains('new-property-row')) {
                        autoSaveNewProperty(element);
                    } else if (row.classList.contains('new-team-property-row')) {
                        autoSaveNewTeamProperty(element);
                    }
                    
                    closeLikesModal();
                    return;
                }
                
                // 기존 매물인 경우 - 서버에 저장
                const response = await fetch('/api/maeiple/update', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        id: propertyId,
                        field: type,
                        value: count
                    })
                });
                
                const result = await response.json();
                
                if (result.success) {
                    // UI 업데이트
                    const emoji = type === 'likes' ? '❤️' : '👎';
                    element.dataset.count = count;
                    element.innerHTML = `<span style="color: ${count > 0 ? '#ef4444' : '#9ca3af'}; font-size: 14px;">${emoji} ${count}</span>`;
                    
                    closeLikesModal();
                    alert(`${type === 'likes' ? '좋아요' : '싫어요'}가 ${count}개로 저장되었습니다.`);
                    } else {
                    alert('저장에 실패했습니다: ' + result.error);
                }
            } catch (error) {
                console.error('좋아요/싫어요 저장 오류:', error);
                alert('저장 중 오류가 발생했습니다.');
            }
        }

        // ==================== 메모 모달 관련 함수들 ====================
        
        // 새 매물 메모 모달 열기
        function openNewPropertyMemoModal(cell) {
            const modal = document.getElementById('property-memo-modal');
            const textarea = document.getElementById('property-memo-textarea');
            const propertyInfo = document.getElementById('property-memo-info');
            
            // 매물 정보 표시 (새 매물)
            propertyInfo.textContent = '새 매물';
            
            // 현재 메모 내용 설정
            const currentMemo = cell.textContent.trim() === '메모 입력' ? '' : cell.textContent.trim();
            textarea.value = currentMemo;
            
            // 모달 표시
            modal.classList.add('active');
            
            // 포커스 설정
            setTimeout(() => {
                textarea.focus();
            }, 100);
            
            // 전역 변수에 현재 편집 중인 셀 저장
            window.currentMemoCell = cell;
        }

        // 기존 매물 메모 모달 열기
        function openPropertyMemoModal(propertyId, currentMemo, buildingNumber, roomNumber) {
            const modal = document.getElementById('property-memo-modal');
            const textarea = document.getElementById('property-memo-textarea');
            const propertyInfo = document.getElementById('property-memo-info');
            
            // 매물 정보 표시
            const propertyDisplay = `${buildingNumber || '동'}${roomNumber ? '-' + roomNumber + '호' : ''}`;
            propertyInfo.textContent = propertyDisplay;
            
            // 현재 메모 내용 설정
            textarea.value = currentMemo || '';
            
            // 모달 표시
            modal.classList.add('active');
            
            // 포커스 설정
            setTimeout(() => {
                textarea.focus();
            }, 100);
            
            // 전역 변수에 현재 편집 중인 매물 정보 저장
            window.currentPropertyMemo = {
                id: propertyId,
                element: null
            };
        }
        
        // 메모 모달 닫기
        function closePropertyMemoModal() {
            const modal = document.getElementById('property-memo-modal');
            modal.classList.remove('active');
            window.currentPropertyMemo = null;
            window.currentMemoCell = null;
        }
        
        // 메모 저장
        async function savePropertyMemo() {
            const textarea = document.getElementById('property-memo-textarea');
            const memo = textarea.value.trim();
            
            // 새 매물의 메모인 경우
            if (window.currentMemoCell) {
                const cell = window.currentMemoCell;
                cell.textContent = memo || '메모 입력';
                cell.style.color = memo ? '#1f2937' : '#64748b';
                
                // 메모 데이터를 dataset에 저장
                cell.dataset.memo = memo;
                
                // 새 매물 행의 종류에 따라 적절한 자동저장 함수 호출
                const row = cell.closest('tr');
                if (row.classList.contains('new-property-row')) {
                    // 아파트목록 탭의 새 매물
                    autoSaveNewProperty(cell);
                } else if (row.classList.contains('new-team-property-row')) {
                    // 팀장메이플관리 탭의 새 매물
                    autoSaveNewTeamProperty(cell);
                }
                
                closePropertyMemoModal();
                return;
            }
            
            // 기존 매물의 메모인 경우
            if (!window.currentPropertyMemo) {
                alert('오류: 매물 정보를 찾을 수 없습니다.');
                return;
            }
            
            try {
                const response = await fetch('/api/maeiple/update', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        id: window.currentPropertyMemo.id,
                        field: 'memo',
                        value: memo
                    })
                });
                
                const result = await response.json();
                
                if (result.success) {
                    // UI 즉시 업데이트 (순서 유지를 위해 페이지 새로고침하지 않음)
                    const propertyRow = document.querySelector(`tr[data-property-id="${window.currentPropertyMemo.id}"]`);
                    if (propertyRow) {
                        const memoCell = propertyRow.querySelector('.memo-cell');
                        if (memoCell) {
                            const memoText = memo || '클릭하여 메모 추가';
                            const displayText = memoText.length > 20 ? memoText.substring(0, 20) + '...' : memoText;
                            memoCell.textContent = displayText;
                            memoCell.style.color = memo ? '#1f2937' : '#64748b';
                            memoCell.style.fontStyle = memo ? 'normal' : 'italic';
                            
                            // onclick 이벤트 업데이트
                            const escapedMemo = (memo || '').replace(/'/g, "\\'");
                            memoCell.setAttribute('onclick', `editTeamMemo(${window.currentPropertyMemo.id}, '${escapedMemo}', this)`);
                        }
                    }
                    
                    // 팀 properties 배열도 업데이트 (개인매물관리용)
                    const teamProperty = teamProperties.find(p => p.id === window.currentPropertyMemo.id);
                    if (teamProperty) {
                        teamProperty.memo = memo;
                    }
                    
                    // 일반 properties 배열도 업데이트 (아파트목록용)  
                    const property = properties.find(p => p.id === window.currentPropertyMemo.id);
                    if (property) {
                        property.memo = memo;
                    }
                    
                    closePropertyMemoModal();
                    } else {
                    alert('메모 저장에 실패했습니다: ' + result.error);
                }
            } catch (error) {
                console.error('메모 저장 오류:', error);
                alert('메모 저장 중 오류가 발생했습니다.');
            }
        }

        // ===== 직원 관리 JavaScript 함수들 =====
        // 전역 변수들
        let currentEmployeePage = 1;
        const employeePerPage = 20;
        let employeeTotalPages = 1;
        let employees = [];

        // 직원 목록 불러오기 (팀장용)
        async function loadTeamLeaderEmployees(page = 1) {
            console.log(`👥 직원 목록 로드 시작 (페이지 ${page})`);
            try {
                currentEmployeePage = page;
                const response = await fetch(`/api/employees?page=${page}&per_page=${employeePerPage}`);
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                
                const data = await response.json();
                console.log('👥 직원 API 응답 데이터:', data);
                
                if (data.success && data.employees) {
                    console.log(`✅ 직원 ${data.employees.length}명 로드 완료`);
                    employees = data.employees;
                    displayTeamLeaderEmployees(data.employees);
                    
                    // 페이지네이션 업데이트
                    employeeTotalPages = data.total_pages || data.totalPages || 1;
                    console.log(`📄 총 페이지 수: ${employeeTotalPages}`);
                    renderTeamLeaderEmployeePagination();
                } else {
                    console.error('❌ API 응답 오류:', data);
                    throw new Error(data.error || data.message || '직원 목록을 불러올 수 없습니다');
                }
            } catch (error) {
                console.error('❌ 직원 목록 로드 실패:', error);
                
                let errorMessage = '직원 목록을 불러오는데 실패했습니다.';
                if (error.message.includes('HTTP 401')) {
                    errorMessage = '권한이 없습니다. 로그인 상태를 확인해주세요.';
                } else if (error.message.includes('HTTP 403')) {
                    errorMessage = '접근 권한이 없습니다. 관리자에게 문의하세요.';
                } else if (error.message.includes('HTTP 500')) {
                    errorMessage = '서버 오류가 발생했습니다. 잠시 후 다시 시도해주세요.';
                }
                
                showAlert(errorMessage, 'error');
                
                // 빈 테이블 표시
                const tbody = document.querySelector('#employees-list');
                if (tbody) {
                    tbody.innerHTML = `<tr><td colspan="7" style="text-align: center; padding: 40px; color: #64748b;">
                        <div>📋 직원 목록을 불러올 수 없습니다.</div>
                        <div style="margin-top: 8px; font-size: 12px;">${errorMessage}</div>
                        <button class="btn btn-sm btn-primary" onclick="loadTeamLeaderEmployees()" style="margin-top: 12px;">🔄 다시 시도</button>
                    </td></tr>`;
                }
            }
        }

        // 새 고객 행 추가
        function addNewCustomerRow() {
            const tbody = document.getElementById('customers-list');
            const newRow = document.createElement('tr');
            newRow.classList.add('new-customer-row');
            
            // 오늘 날짜 구하기 (한국시간 기준)
            const now = new Date();
            const todayString = now.getFullYear() + '-' + 
                String(now.getMonth() + 1).padStart(2, '0') + '-' + 
                String(now.getDate()).padStart(2, '0');
            
            newRow.innerHTML = `
                <td class="editable-cell" data-field="date" data-type="date" onclick="editCustomerCell(this)">${todayString}</td>
                <td class="editable-cell" data-field="move_in_date" data-type="date" onclick="editCustomerCell(this)">-</td>
                <td class="editable-cell" data-field="customer_name" data-type="text" onclick="editCustomerCell(this)">-</td>
                <td class="editable-cell" data-field="customer_phone" data-type="text" onclick="editCustomerCell(this)">-</td>
                <td class="editable-cell" data-field="budget" data-type="text" onclick="editCustomerCell(this)">-</td>
                <td class="editable-cell" data-field="rooms" data-type="text" onclick="editCustomerCell(this)">-</td>
                <td class="editable-cell" data-field="location" data-type="text" onclick="editCustomerCell(this)">-</td>
                <td class="editable-cell" data-field="loan" data-type="text" onclick="editCustomerCell(this)">-</td>
                <td class="editable-cell" data-field="parking" data-type="text" onclick="editCustomerCell(this)">-</td>
                <td class="editable-cell" data-field="pets" data-type="text" onclick="editCustomerCell(this)">-</td>
                <td class="memo-cell" onclick="editCustomerMemo(this)">-</td>
                <td class="editable-cell" data-field="status" data-type="select" onclick="editCustomerCell(this)">
                    <span class="status-badge status-progress">진행중</span>
                </td>
                <td><span class="property-link-placeholder">주거사이트 생성 중...</span></td>
                <td><span class="property-link-placeholder">업무사이트 생성 중...</span></td>
            `;
            tbody.insertBefore(newRow, tbody.firstChild);
        }

        // 고객 셀 편집
        function editCustomerCell(cell) {
            if (cell.querySelector('input') || cell.querySelector('select')) return;
            
            const row = cell.closest('tr');
            const customerId = row.getAttribute('data-customer-id');
            const field = cell.getAttribute('data-field');
            const type = cell.getAttribute('data-type');
            let currentValue = cell.textContent.trim();
            
            // 상태 배지에서 실제 값 추출
            if (field === 'status') {
                const badge = cell.querySelector('.status-badge');
                currentValue = badge ? badge.textContent.trim() : currentValue;
            }
            
            if (currentValue === '-' || currentValue === '') {
                currentValue = '';
            }
            
            cell.classList.add('editing-cell');
            
            let inputElement;
            if (type === 'select' && field === 'status') {
                inputElement = document.createElement('select');
                inputElement.innerHTML = `
                    <option value="진행중" ${currentValue === '진행중' ? 'selected' : ''}>진행중</option>
                    <option value="완료" ${currentValue === '완료' ? 'selected' : ''}>완료</option>
                    <option value="계약" ${currentValue === '계약' ? 'selected' : ''}>계약</option>
                    <option value="보류" ${currentValue === '보류' ? 'selected' : ''}>보류</option>
                `;
            } else {
                inputElement = document.createElement('input');
                inputElement.type = type;
                inputElement.value = currentValue === '-' ? '' : currentValue;
                
                if (type === 'date' && !inputElement.value) {
                    const now = new Date();
                    const todayString = now.getFullYear() + '-' + 
                        String(now.getMonth() + 1).padStart(2, '0') + '-' + 
                        String(now.getDate()).padStart(2, '0');
                    inputElement.value = todayString;
                }
            }
            
            inputElement.style.width = '100%';
            inputElement.style.border = 'none';
            inputElement.style.background = 'transparent';
            inputElement.style.outline = 'none';
            
            const saveEdit = async (moveNext = false) => {
                const newValue = inputElement.value.trim();
                
                if (row.classList.contains('new-customer-row')) {
                    // 새 고객의 경우
                    if (field === 'status') {
                        const statusClass = newValue === '계약' ? 'status-complete' : 
                                           newValue === '보류' ? 'status-hold' : 'status-progress';
                        cell.innerHTML = `<span class="status-badge ${statusClass}">${newValue}</span>`;
                    } else if (field === 'customer_phone') {
                        cell.textContent = newValue || '-';
                        cell.style.fontFamily = newValue ? 'monospace' : 'inherit';
                        cell.style.letterSpacing = newValue ? '0.5px' : 'normal';
                    } else {
                        cell.textContent = newValue || '-';
                    }
                    cell.classList.remove('editing-cell');
                } else if (customerId) {
                    // 기존 고객 업데이트
                    const success = await updateCustomerField(customerId, field, newValue, cell, moveNext);
                    if (success) {
                        if (field === 'status') {
                            const statusClass = newValue === '계약' ? 'status-complete' : 
                                               newValue === '보류' ? 'status-hold' : 'status-progress';
                            cell.innerHTML = `<span class="status-badge ${statusClass}">${newValue}</span>`;
                        } else if (field === 'customer_phone') {
                            cell.textContent = newValue || '-';
                            cell.style.fontFamily = newValue ? 'monospace' : 'inherit';
                            cell.style.letterSpacing = newValue ? '0.5px' : 'normal';
                        } else {
                            cell.textContent = newValue || '-';
                        }
                        cell.classList.remove('editing-cell');
                        showAlert('수정이 완료되었습니다.', 'success');
                    } else {
                        cell.classList.remove('editing-cell');
                        cell.textContent = currentValue || '-';
                    }
                }
                
                // 엔터로 저장 후 옆 셀로 이동
                if (moveNext) {
                    const editableCells = Array.from(cell.parentElement.querySelectorAll('.editable-cell, .memo-cell'));
                    const idx = editableCells.indexOf(cell);
                    if (idx !== -1 && idx < editableCells.length - 1) {
                        setTimeout(() => editCustomerCell(editableCells[idx + 1]), 50);
                    }
                }
            };
            
            inputElement.addEventListener('keydown', (e) => {
                if (e.key === 'Enter') {
                    e.preventDefault();
                    saveEdit(true);
                } else if (e.key === 'Escape') {
                    cell.classList.remove('editing-cell');
                    if (field === 'status') {
                        const statusClass = currentValue === '계약' ? 'status-complete' : 
                                           currentValue === '보류' ? 'status-hold' : 'status-progress';
                        cell.innerHTML = `<span class="status-badge ${statusClass}">${currentValue}</span>`;
                    } else {
                        cell.textContent = currentValue;
                    }
                }
            });
            
            inputElement.addEventListener('blur', () => saveEdit(false));
            
            cell.innerHTML = '';
            cell.appendChild(inputElement);
            inputElement.focus();
        }

        // 고객 필드 업데이트
        async function updateCustomerField(customerId, field, value, cell, moveNext = false) {
            try {
                const response = await fetch(`/api/customers/${customerId}/field`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ [field]: value })
                });
                
                const result = await response.json();
                
                if (result.success) {
                    return true;
                } else {
                    showAlert(result.error || '수정에 실패했습니다.', 'error');
                    return false;
                }
            } catch (error) {
                console.error('필드 업데이트 오류:', error);
                showAlert('서버 오류가 발생했습니다.', 'error');
                return false;
            }
        }



        // 필터 기능
        function filterCustomers(status) {
            // 활성 버튼 업데이트
            document.querySelectorAll('.filter-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            document.querySelector(`[data-filter="${status}"]`).classList.add('active');
            
            // 필터링
            if (status === 'all') {
                filteredCustomers = [...customers];
            } else {
                filteredCustomers = customers.filter(customer => 
                    customer.status === status
                );
            }
            
            displayCustomers(filteredCustomers);
        }

        // 날짜별 필터
        function filterByDate(period) {
            const now = new Date();
            let startDate;
            
            switch(period) {
                case 'today':
                    startDate = new Date(now.getFullYear(), now.getMonth(), now.getDate());
                    break;
                case 'week':
                    startDate = new Date(now.getFullYear(), now.getMonth(), now.getDate() - 7);
                    break;
                case 'month':
                    startDate = new Date(now.getFullYear(), now.getMonth(), 1);
                    break;
                case 'all':
                default:
                    startDate = null;
                    break;
            }
            
            if (startDate) {
                filteredCustomers = customers.filter(customer => {
                    if (!customer.date) return false;
                    const customerDate = new Date(customer.date);
                    return customerDate >= startDate;
                });
            } else {
                filteredCustomers = [...customers];
            }
            
            displayCustomers(filteredCustomers);
        }

        // ===== 직원 관리 JavaScript 함수들 =====
        // 중복 제거 - 이미 위에서 정의됨

        // 직원 목록 표시
        function displayTeamLeaderEmployees(employeeList) {
            const tbody = document.getElementById('employees-list');
            
            if (employeeList.length === 0) {
                tbody.innerHTML = '<tr><td colspan="7" style="text-align: center; padding: 40px; color: #64748b;">등록된 직원이 없습니다.</td></tr>';
                return;
            }
            
            tbody.innerHTML = employeeList.map(emp => {
                // status 또는 employee_status 확인
                const isActive = (emp.status === 'active' || emp.employee_status === 'active');
                const employeeName = emp.name || emp.employee_name || emp.employee_id || '-';
                const employeeRole = emp.role || emp.employee_role || '직원';
                
                return `
                <tr data-employee-id="${emp.id}">
                    <td><strong>${emp.employee_id || emp.name || '-'}</strong></td>
                    <td>${employeeName}</td>
                    <td><span class="status-badge" style="background: #e0e7ff; color: #4338ca;">${emp.team || '미지정'}</span></td>
                    <td><span class="status-badge" style="background: ${getRoleBadgeColor(employeeRole)}; color: ${getRoleTextColor(employeeRole)};">${employeeRole}</span></td>
                    <td><span class="status-badge" style="background: ${isActive ? '#dcfce7' : '#fee2e2'}; color: ${isActive ? '#166534' : '#991b1b'};">${isActive ? '활성' : '비활성'}</span></td>
                    <td>${emp.created_at ? new Date(emp.created_at).toLocaleDateString() : '-'}</td>
                    <td>
                        <div style="display: flex; gap: 4px; flex-wrap: wrap;">
                            <button class="btn btn-sm" style="background: #3b82f6; color: white; font-size: 11px; padding: 4px 8px;" onclick="editEmployee(${emp.id})">수정</button>
                            ${isActive ? 
                                `<button class="btn btn-sm" style="background: #dc2626; color: white; font-size: 11px; padding: 4px 8px;" onclick="handleEmployeeDeletion(${emp.id}, '${employeeName}')">삭제</button>` :
                                `<button class="btn btn-sm" style="background: #059669; color: white; font-size: 11px; padding: 4px 8px;" onclick="activateEmployee(${emp.id})">활성화</button>`
                            }
                            ${!isActive ? 
                                `<button class="btn btn-sm" style="background: #ef4444; color: white; font-size: 11px; padding: 4px 8px;" onclick="handleEmployeeDeletion(${emp.id}, '${employeeName}')">완전삭제</button>` :
                                ''
                            }
                            <button class="btn btn-sm" style="background: #6b7280; color: white; font-size: 11px; padding: 4px 8px;" onclick="resetPasswordModal(${emp.id})">비밀번호 재설정</button>
                        </div>
                    </td>
                </tr>`;
            }).join('');
        }

        // 역할별 배지 색상
        function getRoleBadgeColor(role) {
            switch(role) {
                case '팀장': return '#dcfce7';
                case '직원': return '#e0f2fe';
                default: return '#f3f4f6';
            }
        }

        function getRoleTextColor(role) {
            switch(role) {
                case '팀장': return '#166534';
                case '직원': return '#0369a1';
                default: return '#374151';
            }
        }

        // 직원 추가/수정 폼 토글
        // 직원 추가 모달 열기
        function openAddEmployeeModal() {
            const modal = document.getElementById('addEmployeeModal');
            modal.style.display = 'flex';
            resetEmployeeForm();
            // 첫 번째 입력 필드에 포커스
            setTimeout(() => {
                document.getElementById('employee_id').focus();
            }, 100);
        }
        
        // 직원 추가 모달 닫기
        function closeAddEmployeeModal() {
            const modal = document.getElementById('addEmployeeModal');
            modal.style.display = 'none';
            resetEmployeeForm();
        }
        
        // ESC 키로 모달 닫기
        document.addEventListener('keydown', function(event) {
            if (event.key === 'Escape') {
                const modal = document.getElementById('addEmployeeModal');
                if (modal.style.display === 'flex') {
                    closeAddEmployeeModal();
                }
            }
        });

        // 직원 폼 초기화
        function resetEmployeeForm() {
            const form = document.getElementById('add-employee-form');
            if (form) {
            form.reset();
            form.removeAttribute('data-edit-mode');
            form.removeAttribute('data-employee-id');
            }
            
            const employeeIdField = document.getElementById('employee_id');
            if (employeeIdField) {
                employeeIdField.readOnly = false;
            }
            
            const teamField = document.getElementById('team');
            if (teamField) {
                teamField.disabled = false;
                // 팀 추가 버튼 다시 표시
                const addTeamBtn = teamField.parentElement ? teamField.parentElement.querySelector('button') : null;
                if (addTeamBtn) {
                    addTeamBtn.style.display = '';
                }
            }
            
            const addBtn = document.getElementById('add-btn');
            if (addBtn) {
                addBtn.innerHTML = '<span>➕</span> 직원 추가';
            }
            
            // cancel-btn은 존재하지 않을 수 있으므로 체크
            const cancelBtn = document.getElementById('cancel-btn');
            if (cancelBtn) {
                cancelBtn.style.display = 'none';
            }
        }

        // 직원 수정
        async function editEmployee(empId) {
            const employee = employees.find(emp => emp.id === empId);
            if (!employee) {
                showAlert('직원을 찾을 수 없습니다.', 'error');
                return;
            }
            
            // 모달 열기
            const modal = document.getElementById('addEmployeeModal');
            modal.style.display = 'flex';
            
            // 폼 필드에 기존 값 설정
            document.getElementById('employee_id').value = employee.employee_id || employee.name || '';
            document.getElementById('employee_id').readOnly = true; // ID는 수정 불가
            document.getElementById('employee_name').value = employee.employee_name || employee.name || '';
            document.getElementById('team').value = employee.team || '';
            
            const roleField = document.getElementById('employee_role');
            if (roleField) {
                roleField.value = employee.role || employee.employee_role || '직원';
            }
            
            const statusField = document.getElementById('employee_status');
            if (statusField) {
                statusField.value = employee.status || employee.employee_status || 'active';
            }
            
            const passwordField = document.getElementById('employee_password');
            if (passwordField) {
                passwordField.value = ''; // 비밀번호는 표시하지 않음
            }
            
            // 팀장인 경우 팀 필드 비활성화
            const currentTeam = '{{ employee_team }}';
            const isTeamLeader = '{{ employee_role }}' === '팀장';
            const isAdmin = '{{ is_admin }}' === 'True';
            
            if (isTeamLeader && !isAdmin) {
                const teamSelect = document.getElementById('team');
                teamSelect.value = currentTeam;
                teamSelect.disabled = true;
            }
            
            // 버튼 텍스트 변경
            const addBtn = document.getElementById('add-btn');
            if (addBtn) {
            addBtn.innerHTML = '<span>✏️</span> 직원 수정';
            }
            
            // 폼에 수정 모드 표시
            const form = document.getElementById('add-employee-form');
            form.setAttribute('data-edit-mode', 'true');
            form.setAttribute('data-employee-id', empId);
        }
        
        // 직원 활성화
        async function activateEmployee(empId) {
            if (!confirm('이 직원을 활성화하시겠습니까?')) return;
            
            try {
                const response = await fetch(`/api/employees/${empId}/activate`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json',
                    }
                });
                
                const result = await response.json();
                
                if (result.success) {
                    showAlert('직원이 활성화되었습니다.', 'success');
                    loadTeamLeaderEmployees(currentEmployeePage);
                } else {
                    showAlert(result.message || '활성화에 실패했습니다.', 'error');
                }
            } catch (error) {
                console.error('활성화 오류:', error);
                showAlert('서버 오류가 발생했습니다.', 'error');
            }
        }
        
        // 2단계 직원 삭제 처리 (비활성화 → 완전삭제)
        async function handleEmployeeDeletion(empId, employeeName) {
            // 직원 상태 확인
            const employee = employees.find(emp => emp.id === empId);
            if (!employee) {
                showAlert('직원을 찾을 수 없습니다.', 'error');
                return;
            }
            
            const isActive = (employee.status === 'active' || employee.employee_status === 'active');
            
            if (isActive) {
                // 1단계: 활성 상태인 경우 비활성화
                if (!confirm(`"${employeeName}" 직원을 비활성화하시겠습니까?\n\n⚠️ 비활성화된 직원은 로그인이 불가능합니다.`)) {
                    return;
                }
                
                try {
                    const response = await fetch(`/api/employees/${empId}/deactivate`, {
                        method: 'PUT',
                        headers: {
                            'Content-Type': 'application/json',
                        }
                    });
                    
                    const result = await response.json();
                    
                    if (result.success) {
                        showAlert(`"${employeeName}" 직원이 비활성화되었습니다.\n\n다시 삭제 버튼을 누르면 완전히 삭제됩니다.`, 'success');
                        loadTeamLeaderEmployees(currentEmployeePage);
                    } else {
                        showAlert(result.message || '비활성화에 실패했습니다.', 'error');
                    }
                } catch (error) {
                    console.error('비활성화 오류:', error);
                    showAlert('서버 오류가 발생했습니다.', 'error');
                }
            } else {
                // 2단계: 이미 비활성화된 경우 완전 삭제
                if (!confirm(`"${employeeName}" 직원을 완전히 삭제하시겠습니까?\n\n⚠️ 이 작업은 되돌릴 수 없으며, 모든 데이터가 영구적으로 삭제됩니다.`)) {
                    return;
                }
                
                try {
                    const response = await fetch(`/api/employees/${empId}/permanent-delete`, {
                        method: 'DELETE',
                        headers: {
                            'Content-Type': 'application/json',
                        }
                    });

                if (!response.ok) {
                    const errorText = await response.text();
                    throw new Error(`HTTP ${response.status}: ${errorText}`);
                }

                const result = await response.json();
                
                if (result.success) {
                        showAlert(`"${employeeName}" 직원이 완전히 삭제되었습니다.`, 'success');
                        loadTeamLeaderEmployees(currentEmployeePage);
                    } else {
                        showAlert(result.message || '삭제에 실패했습니다.', 'error');
                    }
                } catch (error) {
                    console.error('삭제 오류:', error);
                    showAlert(`서버 오류: ${error.message}`, 'error');
                }
            }
        }
        
        // 비밀번호 재설정 모달 열기
        function resetPasswordModal(empId) {
            const employee = employees.find(emp => emp.id === empId);
            if (!employee) {
                showAlert('직원을 찾을 수 없습니다.', 'error');
                return;
            }
            
            const employeeName = employee.name || employee.employee_name || employee.employee_id || '직원';
            const newPassword = prompt(`${employeeName}의 새 비밀번호를 입력하세요:\n(비워두면 기본값 1234로 설정됩니다)`);
            
            if (newPassword === null) return; // 취소 클릭
            
            resetPassword(empId, newPassword || '1234');
        }
        
        // 비밀번호 재설정
        async function resetPassword(empId, newPassword) {
            try {
                console.log('비밀번호 재설정 요청:', empId, newPassword);
                const response = await fetch(`/api/employees/${empId}/reset-password`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        new_password: newPassword
                    })
                });
                
                console.log('응답 상태:', response.status);
                
                if (!response.ok) {
                    const errorText = await response.text();
                    console.error('에러 응답:', errorText);
                    throw new Error(`HTTP ${response.status}: ${errorText}`);
                }
                
                const result = await response.json();
                console.log('응답 결과:', result);
                
                if (result.success) {
                    showAlert(result.message || '비밀번호가 재설정되었습니다.', 'success');
                } else {
                    showAlert(result.error || result.message || '비밀번호 재설정에 실패했습니다.', 'error');
                }
            } catch (error) {
                console.error('비밀번호 재설정 오류 상세:', error);
                showAlert(`서버 오류: ${error.message}`, 'error');
            }
        }
        
        // 직원 삭제
        async function deleteEmployee(empId) {
            if (!confirm('정말로 이 직원을 삭제하시겠습니까?\n이 작업은 되돌릴 수 없습니다.')) return;
            
            try {
                console.log('직원 삭제 요청:', empId);
                const response = await fetch(`/api/employees/${empId}`, {
                    method: 'DELETE',
                    headers: {
                        'Content-Type': 'application/json',
                    }
                });
                
                console.log('삭제 응답 상태:', response.status);
                
                if (!response.ok) {
                    const errorText = await response.text();
                    console.error('삭제 에러 응답:', errorText);
                    throw new Error(`HTTP ${response.status}: ${errorText}`);
                }
                
                const result = await response.json();
                console.log('삭제 응답 결과:', result);
                
                if (result.success) {
                    showAlert(result.message || '직원이 삭제되었습니다.', 'success');
                    loadTeamLeaderEmployees(currentEmployeePage);
                } else {
                    showAlert(result.message || '삭제에 실패했습니다.', 'error');
                }
            } catch (error) {
                console.error('삭제 오류 상세:', error);
                showAlert(`서버 오류: ${error.message}`, 'error');
            }
        }

        // 페이지네이션 렌더링
        function renderTeamLeaderEmployeePagination() {
            const paginationDiv = document.getElementById('employee-pagination');
            if (!paginationDiv || window.teamLeaderEmployeeTotalPages <= 1) {
                if (paginationDiv) paginationDiv.style.display = 'none';
                return;
            }
            
            paginationDiv.style.display = 'flex';
            let paginationHTML = '';
            
            // 이전 페이지 버튼
            if (window.teamLeaderEmployeePage > 1) {
                paginationHTML += `<button onclick="loadTeamLeaderEmployees(${window.teamLeaderEmployeePage - 1})" style="padding: 8px 12px; border: 1px solid #d1d5db; background: #f9fafb; border-radius: 6px; cursor: pointer; color: #374151;">이전</button>`;
            }
            
            // 페이지 번호 버튼들
            const startPage = Math.max(1, window.teamLeaderEmployeePage - 3);
            const endPage = Math.min(window.teamLeaderEmployeeTotalPages, startPage + 6);
            
            for (let i = startPage; i <= endPage; i++) {
                const isActive = i === window.teamLeaderEmployeePage;
                paginationHTML += `
                    <button onclick="loadTeamLeaderEmployees(${i})" 
                            style="padding: 8px 12px; border: 1px solid ${isActive ? '#3b82f6' : '#d1d5db'}; 
                                   background: ${isActive ? '#3b82f6' : '#f9fafb'}; color: ${isActive ? 'white' : '#374151'}; 
                                   border-radius: 6px; cursor: pointer; font-weight: ${isActive ? '600' : 'normal'};">
                        ${i}
                    </button>
                `;
            }
            
            // 다음 페이지 버튼
            if (window.teamLeaderEmployeePage < window.teamLeaderEmployeeTotalPages) {
                paginationHTML += `<button onclick="loadTeamLeaderEmployees(${window.teamLeaderEmployeePage + 1})" style="padding: 8px 12px; border: 1px solid #d1d5db; background: #f9fafb; border-radius: 6px; cursor: pointer; color: #374151;">다음</button>`;
            }
            
            paginationDiv.innerHTML = paginationHTML;
        }

        // 직원 비활성화
        async function deactivateEmployee(empId) {
            if (!confirm('이 직원을 비활성화하시겠습니까?')) return;
            
            try {
                const response = await fetch(`/api/employees/${empId}/deactivate`, {
                    method: 'PUT'
                });
                const result = await response.json();
                
                if (result.success) {
                    showAlert('직원이 비활성화되었습니다.', 'success');
                    loadTeamLeaderEmployees();
                } else {
                    showAlert(result.message || '비활성화에 실패했습니다.', 'error');
                }
            } catch (error) {
                showAlert('서버 오류가 발생했습니다.', 'error');
            }
        }

        // 직원 활성화
        async function activateEmployee(empId) {
            try {
                const response = await fetch(`/api/employees/${empId}/activate`, {
                    method: 'PUT'
                });
                const result = await response.json();
                
                if (result.success) {
                    showAlert('직원이 활성화되었습니다.', 'success');
                    loadTeamLeaderEmployees();
                } else {
                    showAlert('활성화에 실패했습니다.', 'error');
                }
            } catch (error) {
                showAlert('서버 오류가 발생했습니다.', 'error');
            }
        }

        // 비밀번호 재설정
        async function resetPassword(empId) {
            if (!confirm('이 직원의 비밀번호를 재설정하시겠습니까?')) return;
            
            try {
                const response = await fetch(`/api/employees/${empId}/reset-password`, {
                    method: 'PUT'
                });
                const result = await response.json();
                
                if (result.success) {
                    showAlert(`비밀번호가 재설정되었습니다. 새 비밀번호: ${result.new_password}`, 'success');
                } else {
                    showAlert('비밀번호 재설정에 실패했습니다.', 'error');
                }
            } catch (error) {
                showAlert('서버 오류가 발생했습니다.', 'error');
            }
        }

        // 직원 삭제
        async function deleteEmployee(empId) {
            if (!confirm('정말로 이 직원을 삭제하시겠습니까? 이 작업은 되돌릴 수 없습니다.')) return;
            
            try {
                const response = await fetch(`/api/employees/${empId}`, {
                    method: 'DELETE'
                });
                const result = await response.json();
                
                if (result.success) {
                    showAlert('직원이 삭제되었습니다.', 'success');
                    loadTeamLeaderEmployees();
                } else {
                    showAlert(result.message || '삭제에 실패했습니다.', 'error');
                }
            } catch (error) {
                showAlert('서버 오류가 발생했습니다.', 'error');
            }
        }

        // 알림 표시 함수
        function showAlert(message, type) {
            // 기존 알림이 있다면 제거
            const existingAlert = document.querySelector('.alert-message');
            if (existingAlert) {
                existingAlert.remove();
            }
            
            const alert = document.createElement('div');
            alert.className = 'alert-message';
            alert.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                padding: 12px 20px;
                border-radius: 8px;
                font-weight: 500;
                z-index: 10000;
                opacity: 0;
                transition: all 0.3s ease;
                ${type === 'success' ? 'background: #dcfce7; color: #166534; border: 1px solid #bbf7d0;' : 'background: #fee2e2; color: #991b1b; border: 1px solid #fecaca;'}
            `;
            alert.textContent = message;
            
            document.body.appendChild(alert);
            
            // 애니메이션 효과
            requestAnimationFrame(() => {
                alert.style.opacity = '1';
            });
            
            // 3초 후 자동 제거
            setTimeout(() => {
                alert.style.opacity = '0';
                setTimeout(() => {
                    if (alert.parentNode) {
                        alert.parentNode.removeChild(alert);
                    }
                }, 300);
            }, 3000);
        }

        // 팀 관리 모달 함수들
        function showAddTeamModal() {
            const modal = document.getElementById('addTeamModal');
            if (modal) {
                modal.style.display = 'flex';
                modal.classList.add('active');
                document.getElementById('newTeamName').value = '';
                document.getElementById('newTeamDescription').value = '';
                document.getElementById('newTeamName').focus();
            }
        }

        function closeAddTeamModal() {
            const modal = document.getElementById('addTeamModal');
            if (modal) {
                modal.style.display = 'none';
                modal.classList.remove('active');
            }
        }

        async function addNewTeam() {
            const teamName = document.getElementById('newTeamName').value.trim();
            const teamDescription = document.getElementById('newTeamDescription').value.trim();
            
            if (!teamName) {
                showAlert('팀 이름을 입력해주세요.', 'error');
                return;
            }
            
            try {
                // 팀 추가 API 호출 (필요시 구현)
                showAlert(`새 팀 "${teamName}"이 추가되었습니다.`, 'success');
                
                // 팀 드롭다운 업데이트
                const teamSelect = document.getElementById('team');
                const deleteTeamSelect = document.getElementById('deleteTeamSelect');
                
                // 새 옵션 추가
                const newOption = document.createElement('option');
                newOption.value = teamName;
                newOption.textContent = teamName;
                
                if (teamSelect) {
                    teamSelect.appendChild(newOption.cloneNode(true));
                }
                if (deleteTeamSelect) {
                    deleteTeamSelect.appendChild(newOption);
                }
                
                closeAddTeamModal();
            } catch (error) {
                console.error('팀 추가 오류:', error);
                showAlert('팀 추가에 실패했습니다.', 'error');
            }
        }

        async function deleteSelectedTeam() {
            const teamSelect = document.getElementById('deleteTeamSelect');
            const selectedTeam = teamSelect ? teamSelect.value : '';
            
            if (!selectedTeam) {
                showAlert('삭제할 팀을 선택해주세요.', 'error');
                return;
            }
            
            if (!confirm(`정말로 "${selectedTeam}" 팀을 삭제하시겠습니까?`)) {
                return;
            }
            
            try {
                // 팀 삭제 API 호출 (필요시 구현)
                showAlert(`"${selectedTeam}" 팀이 삭제되었습니다.`, 'success');
                
                // 드롭다운에서 제거
                const teamMainSelect = document.getElementById('team');
                if (teamMainSelect) {
                    const option = teamMainSelect.querySelector(`option[value="${selectedTeam}"]`);
                    if (option) option.remove();
                }
                
                if (teamSelect) {
                    const option = teamSelect.querySelector(`option[value="${selectedTeam}"]`);
                    if (option) option.remove();
                    teamSelect.value = '';
                }
            } catch (error) {
                console.error('팀 삭제 오류:', error);
                showAlert('팀 삭제에 실패했습니다.', 'error');
            }
        }

        // 폼 제출 이벤트 리스너 추가
        document.addEventListener('DOMContentLoaded', function() {
            const employeeForm = document.getElementById('add-employee-form');
            if (employeeForm) {
                employeeForm.addEventListener('submit', async function(e) {
                    e.preventDefault();
                    
                    const isEditMode = this.getAttribute('data-edit-mode') === 'true';
                    const employeeId = this.getAttribute('data-employee-id');
                    
                    const data = {
                        employee_id: document.getElementById('employee_id').value,
                        employee_name: document.getElementById('employee_name').value,
                        team: document.getElementById('team').value,
                        employee_role: document.getElementById('employee_role').value,
                        employee_status: document.getElementById('employee_status').value
                    };
                    
                    try {
                        let response;
                        if (isEditMode && employeeId) {
                            // 수정 모드
                            response = await fetch(`/api/employees/${employeeId}/update`, {
                                method: 'PUT',
                                headers: {
                                    'Content-Type': 'application/json',
                                },
                                body: JSON.stringify(data)
                            });
                        } else {
                            // 추가 모드
                            response = await fetch('/api/employees', {
                                method: 'POST',
                                headers: {
                                    'Content-Type': 'application/json',
                                },
                                body: JSON.stringify(data)
                            });
                        }
                        
                        const result = await response.json();
                        
                        if (result.success) {
                            showAlert(isEditMode ? '직원 정보가 수정되었습니다.' : '직원이 성공적으로 추가되었습니다.', 'success');
                            resetEmployeeForm();
                            loadTeamLeaderEmployees();
                            closeAddEmployeeModal();
                        } else {
                            showAlert(result.message || (isEditMode ? '직원 수정에 실패했습니다.' : '직원 추가에 실패했습니다.'), 'error');
                        }
                    } catch (error) {
                        console.error('직원 저장 오류:', error);
                        showAlert('서버 오류가 발생했습니다.', 'error');
                    }
                });
            }
        });
    </script>

    <!-- 메모 모달 -->
    <div id="property-memo-modal" class="modal-overlay" onclick="closePropertyMemoModal()">
        <div class="modal-content" onclick="event.stopPropagation()">
            <div class="modal-header">
                <h3 class="modal-title">📝 매물 특이사항 편집</h3>
                <button class="modal-close" onclick="closePropertyMemoModal()">×</button>
            </div>
            <div class="modal-body">
                <div class="memo-info">
                    <div class="memo-property-info">
                        <span class="memo-label">매물:</span>
                        <span id="property-memo-info" class="memo-value">동-호수</span>
                    </div>
                </div>
                <textarea id="property-memo-textarea" class="memo-textarea" placeholder="매물의 특이사항을 입력하세요..." rows="8"></textarea>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closePropertyMemoModal()">취소</button>
                <button class="btn btn-primary" onclick="savePropertyMemo()">저장</button>
            </div>
        </div>
    </div>

    <!-- 좋아요/싫어요 모달 -->
    <div id="likes-modal" class="modal-overlay" onclick="closeLikesModal()">
        <div class="modal-content" onclick="event.stopPropagation()">
            <div class="modal-header">
                <h3 class="modal-title" id="likes-modal-title">❤️ 좋아요 편집</h3>
                <button class="modal-close" onclick="closeLikesModal()">×</button>
            </div>
            <div class="modal-body">
                <div class="likes-info">
                    <div class="likes-property-info">
                        <span class="likes-label">매물:</span>
                        <span id="likes-property-info" class="likes-value">동-호수</span>
                    </div>
                </div>
                <div class="likes-input-group">
                    <label class="likes-input-label" id="likes-input-label">좋아요 수:</label>
                    <input type="number" id="likes-input" class="likes-input" min="0" value="0" placeholder="숫자 입력">
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeLikesModal()">취소</button>
                <button class="btn btn-primary" onclick="saveLikes()">저장</button>
            </div>
        </div>
    </div>

    <style>
        /* 메모 모달 스타일 */
        .modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }
        
        .modal-overlay.active {
            display: flex;
        }
        
        .modal-content {
            background: white;
            border-radius: 8px;
            width: 90%;
            max-width: 500px;
            max-height: 80vh;
            overflow: hidden;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 16px 20px;
            border-bottom: 1px solid #e2e8f0;
            background: #f8fafc;
        }
        
        .modal-title {
            margin: 0;
            font-size: 18px;
            font-weight: 600;
            color: #1f2937;
        }
        
        .modal-close {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: #6b7280;
            padding: 0;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .modal-close:hover {
            background: #f3f4f6;
            color: #374151;
        }
        
        .modal-body {
            padding: 20px;
        }
        
        .memo-info {
            margin-bottom: 16px;
        }
        
        .memo-property-info {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px 12px;
            background: #f1f5f9;
            border-radius: 6px;
            border-left: 4px solid #3b82f6;
        }
        
        .memo-label {
            font-weight: 600;
            color: #475569;
        }
        
        .memo-value {
            color: #1e40af;
            font-weight: 500;
        }
        
        .memo-textarea {
            width: 100%;
            padding: 12px;
            border: 1px solid #d1d5db;
            border-radius: 6px;
            font-size: 14px;
            line-height: 1.5;
            resize: vertical;
            font-family: inherit;
        }
        
        .memo-textarea:focus {
            outline: none;
            border-color: #3b82f6;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }
        
        .modal-footer {
            display: flex;
            justify-content: flex-end;
            gap: 8px;
            padding: 16px 20px;
            border-top: 1px solid #e2e8f0;
            background: #f8fafc;
        }
        
        /* 좋아요/싫어요 모달 전용 스타일 */
        .likes-info {
            margin-bottom: 16px;
        }
        
        .likes-property-info {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px 12px;
            background: #f1f5f9;
            border-radius: 6px;
            border-left: 4px solid #ef4444;
        }
        
        .likes-label {
            font-weight: 600;
            color: #475569;
        }
        
        .likes-value {
            color: #dc2626;
            font-weight: 500;
        }
        
        .likes-input-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }
        
        .likes-input-label {
            font-weight: 600;
            color: #374151;
            font-size: 14px;
        }
        
        .likes-input {
            width: 100%;
            padding: 12px;
            border: 1px solid #d1d5db;
            border-radius: 6px;
            font-size: 16px;
            text-align: center;
            font-weight: 600;
        }
        
        .likes-input:focus {
            outline: none;
            border-color: #ef4444;
            box-shadow: 0 0 0 3px rgba(239, 68, 68, 0.1);
        }
    </style>
    <!-- 직원 추가 모달 -->
    <div id="addEmployeeModal" class="modal" style="display: none;">
        <div class="modal-overlay" onclick="closeAddEmployeeModal()"></div>
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">
                    <span style="font-size: 20px;">👤</span>
                    새 직원 추가
                </h2>
                <button type="button" class="modal-close" onclick="closeAddEmployeeModal()">
                    <span>✕</span>
                </button>
            </div>
            <form id="add-employee-form" class="add-employee-form">
                <div class="modal-body">
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px; margin-bottom: 20px;">
                        <div class="form-group" style="margin: 0;">
                            <label class="form-label">직원 아이디</label>
                            <input type="text" id="employee_id" class="form-input" placeholder="직원 아이디 입력" required>
                        </div>
                        <div class="form-group" style="margin: 0;">
                            <label class="form-label">직원 이름</label>
                            <input type="text" id="employee_name" class="form-input" placeholder="직원 이름 입력" required>
                        </div>
                    </div>
                    
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px; margin-bottom: 20px;">
                        <div class="form-group" style="margin: 0;">
                            <label class="form-label">팀</label>
                            <div style="display: flex; gap: 8px; align-items: end;">
                                <select id="team" class="form-input" required style="flex: 1;">
                                    <option value="">팀 선택</option>
                                    <option value="빈시트">빈시트</option>
                                    <option value="위플러스">위플러스</option>
                                    <option value="반클리셰">반클리셰</option>
                                    <option value="대표">대표</option>
                                </select>
                                <button type="button" class="btn btn-outline-primary btn-sm" onclick="showAddTeamModal()">
                                    <span>➕</span>
                                </button>
                            </div>
                        </div>
                        <div class="form-group" style="margin: 0;">
                            <label class="form-label">역할</label>
                            <select id="employee_role" class="form-input" required>
                                <option value="">역할 선택</option>
                                <option value="팀장">팀장</option>
                                <option value="직원">직원</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="form-group" style="margin-bottom: 0;">
                        <label class="form-label">상태</label>
                        <select id="employee_status" class="form-input" required>
                            <option value="active">활성</option>
                            <option value="inactive">비활성</option>
                        </select>
                    </div>
                </div>
                
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" onclick="closeAddEmployeeModal()">
                        <span>❌</span> 취소
                    </button>
                    <button type="submit" class="btn btn-primary" id="add-btn">
                        <span>➕</span> 직원 추가
                    </button>
                </div>
            </form>
        </div>
    </div>

</body>
</html>
